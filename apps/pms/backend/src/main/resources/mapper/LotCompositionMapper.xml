<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.pms.infrastructure.out.persistence.mapper.LotCompositionMapper">

    <resultMap id="LotCompositionResultMap" type="com.example.pms.domain.model.quality.LotComposition">
        <id property="id" column="ID"/>
        <result property="parentLotNumber" column="親ロット番号"/>
        <result property="childLotNumber" column="子ロット番号"/>
        <result property="usedQuantity" column="使用数量"/>
        <result property="createdAt" column="作成日時"/>
    </resultMap>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id" keyColumn="ID">
        INSERT INTO "ロット構成" (
            "親ロット番号", "子ロット番号", "使用数量"
        ) VALUES (
            #{parentLotNumber}, #{childLotNumber}, #{usedQuantity}
        )
    </insert>

    <select id="findById" resultMap="LotCompositionResultMap">
        SELECT * FROM "ロット構成"
        WHERE "ID" = #{id}
    </select>

    <select id="findByParentLotNumber" resultMap="LotCompositionResultMap">
        SELECT * FROM "ロット構成"
        WHERE "親ロット番号" = #{parentLotNumber}
    </select>

    <select id="findByChildLotNumber" resultMap="LotCompositionResultMap">
        SELECT * FROM "ロット構成"
        WHERE "子ロット番号" = #{childLotNumber}
    </select>

    <select id="findAll" resultMap="LotCompositionResultMap">
        SELECT * FROM "ロット構成"
        ORDER BY "親ロット番号", "子ロット番号"
    </select>

    <update id="update">
        UPDATE "ロット構成" SET
            "使用数量" = #{usedQuantity}
        WHERE "ID" = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM "ロット構成"
        WHERE "ID" = #{id}
    </delete>

    <delete id="deleteByParentLotNumber">
        DELETE FROM "ロット構成"
        WHERE "親ロット番号" = #{parentLotNumber}
    </delete>

    <delete id="deleteByChildLotNumber">
        DELETE FROM "ロット構成"
        WHERE "子ロット番号" = #{childLotNumber}
    </delete>
</mapper>
