<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}"
      lang="ja">
<head>
    <title>BOM 展開</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>BOM 展開（部品展開）</h1>
            <a th:href="@{/bom}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> 一覧へ戻る
            </a>
        </div>

        <!-- 展開条件 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">展開条件</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/bom/{code}/explode(code=${item.itemCode})}" method="get" class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">品目コード</label>
                        <input type="text" class="form-control" th:value="${item.itemCode}" readonly disabled>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">品名</label>
                        <input type="text" class="form-control" th:value="${item.itemName}" readonly disabled>
                    </div>
                    <div class="col-md-2">
                        <label for="quantity" class="form-label">数量</label>
                        <input type="number" id="quantity" name="quantity" class="form-control"
                               th:value="${quantity}" min="1" step="0.01">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-arrow-clockwise"></i> 再展開
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 展開結果 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">展開結果</h5>
            </div>
            <div class="card-body">
                <div th:if="${#lists.isEmpty(explosionList)}" class="alert alert-info">
                    この品目には子部品が登録されていません。
                </div>
                <table th:if="${not #lists.isEmpty(explosionList)}" class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>レベル</th>
                            <th>親品目コード</th>
                            <th>子品目コード</th>
                            <th>基準数量</th>
                            <th>所要量</th>
                            <th>不良率</th>
                            <th>総所要量</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="explosion : ${explosionList}">
                            <td>
                                <span th:each="i : ${#numbers.sequence(1, explosion.level)}">&nbsp;&nbsp;</span>
                                <span th:text="${explosion.level}"></span>
                            </td>
                            <td th:text="${explosion.parentItemCode}"></td>
                            <td>
                                <a th:href="@{/items/{code}(code=${explosion.childItemCode})}"
                                   th:text="${explosion.childItemCode}"></a>
                            </td>
                            <td th:text="${explosion.baseQuantity}"></td>
                            <td th:text="${explosion.requiredQuantity}"></td>
                            <td th:text="${explosion.defectRate}"></td>
                            <td class="fw-bold" th:text="${explosion.totalQuantity}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
