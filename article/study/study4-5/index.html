
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../study4-4/">
      
      
        <link rel="next" href="../../part3-orm/chapter14-orm/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>研究5 AxonCQRS/ESの実装 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#5-axon-cqrses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              研究5 AxonCQRS/ESの実装
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-setup-instruction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    プロジェクトセットアップ手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" checked>
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        はじめに
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#38axon-cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        第38章：Axon CQRS/ES アーキテクチャの基礎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第38章：Axon CQRS/ES アーキテクチャの基礎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#381-cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.1 CQRS とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#382-event-sourcing" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.2 Event Sourcing とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#383" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.3 ヘキサゴナルアーキテクチャとの統合
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#384" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.4 技術スタック
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="38.4 技術スタック">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildgradlekts" class="md-nav__link">
    <span class="md-ellipsis">
      
        build.gradle.kts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#385" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.5 ディレクトリ構造
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#386-axon" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.6 Axon 設定クラス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#387-mybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.7 MyBatis 設定クラス
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#39" class="md-nav__link">
    <span class="md-ellipsis">
      
        第39章：ドメインモデルとイベント設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第39章：ドメインモデルとイベント設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#391-workorder-bounded-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        39.1 WorkOrder Bounded Context（製造指図）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="39.1 WorkOrder Bounded Context（製造指図）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        状態遷移図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント一覧
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#392-api-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        39.2 イベント定義（API Layer）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="39.2 イベント定義（API Layer）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sealed-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        sealed interface によるイベントの型安全性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#record" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント record の実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#393-domain-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        39.3 コマンド定義（Domain Layer）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#394-java" class="md-nav__link">
    <span class="md-ellipsis">
      
        39.4 ドメインモデル（純粋な Java）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#395-material-bounded-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        39.5 Material Bounded Context（資材・在庫）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="39.5 Material Bounded Context（資材・在庫）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        ドメインモデル
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#40aggregate-adapter-policy-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        第40章：Aggregate Adapter と Policy Handler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第40章：Aggregate Adapter と Policy Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#401-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        40.1 Aggregate Adapter パターン
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#402-workorder-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        40.2 WorkOrder Aggregate Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#403-material-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        40.3 Material Aggregate Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#404-policy-handlerchoreography" class="md-nav__link">
    <span class="md-ellipsis">
      
        40.4 Policy Handler（Choreography パターン）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#405-workordereventhandlermaterial-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        40.5 WorkOrderEventHandler（Material Context 内）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#406-materialeventhandlerworkorder-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        40.6 MaterialEventHandler（WorkOrder Context 内）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#41projection-read-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        第41章：Projection と Read Model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第41章：Projection と Read Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-projection" class="md-nav__link">
    <span class="md-ellipsis">
      
        41.1 Projection の役割
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-workorder-projectionmybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        41.2 WorkOrder Projection（MyBatis 版）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413-read-model-entity" class="md-nav__link">
    <span class="md-ellipsis">
      
        41.3 Read Model Entity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#414-mybatis-mapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        41.4 MyBatis Mapper インターフェース
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#415-mybatis-mapper-xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        41.5 MyBatis Mapper XML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#416-read-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        41.6 Read Model スキーマ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#417" class="md-nav__link">
    <span class="md-ellipsis">
      
        41.7 最小限フィールドの原則
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        第42章：REST API と統合テスト
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第42章：REST API と統合テスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-rest-controllerinbound-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.1 REST Controller（Inbound Adapter）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-requestresponse-dto" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.2 Request/Response DTO
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.3 API エンドポイント一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424-axon-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.4 Axon Test による単体テスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      
        研究 5 のまとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="研究 5 のまとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        実装した機能一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        アーキテクチャの特徴
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        設計上の特徴
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        技術スタック
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        生産管理システムにおける CQRS/ES の利点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        API 形式の比較
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cqrses_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        CQRS/ES を選択する場面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter22-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 Axon CQRS/ESの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_18" >
        
          
          <label class="md-nav__link" for="__nav_1_18" id="__nav_1_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（FAS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（PMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="5-axon-cqrses">実践データベース設計：生産管理システム 研究 5 - Axon CQRS/ES の実装<a class="headerlink" href="#5-axon-cqrses" title="Permanent link">&para;</a></h1>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本研究では、REST API（第32章）、gRPC（研究 3）、GraphQL（研究 4）とは異なるアプローチとして、<strong>CQRS（Command Query Responsibility Segregation）</strong> と <strong>Event Sourcing</strong> による生産管理システムを実装します。Axon Framework を使用し、コマンド（書き込み）とクエリ（読み取り）を分離し、すべての状態変更をイベントとして記録するアーキテクチャを構築します。</p>
<p>研究 1 で構築したヘキサゴナルアーキテクチャの考え方を踏襲しつつ、<strong>ドメインモデルをフレームワークから分離</strong>し、Axon Aggregate Adapter を介して連携させます。Read Model の永続化には <strong>MyBatis</strong> を使用します。</p>
<hr />
<h2 id="38axon-cqrses">第38章：Axon CQRS/ES アーキテクチャの基礎<a class="headerlink" href="#38axon-cqrses" title="Permanent link">&para;</a></h2>
<h3 id="381-cqrs">38.1 CQRS とは<a class="headerlink" href="#381-cqrs" title="Permanent link">&para;</a></h3>
<p>CQRS（Command Query Responsibility Segregation）は、コマンド（書き込み）とクエリ（読み取り）の責務を分離するアーキテクチャパターンです。生産管理システムでは、製造指図の発行・進捗管理と、在庫照会・生産実績照会を分離することで、それぞれに最適化された設計が可能になります。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjU5NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzMycHg7aGVpZ2h0OjU5NnB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMzMiA1OTYiIHdpZHRoPSIzMzJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTk2IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzMyIiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgQ29tbWFuZCBTaWRlIChXcml0ZSktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4iIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNOC41LDYgTDE4OC4yODAzLDYgQTMuNzUsMy43NSAwIDAgMSAxOTAuNzgwMyw4LjUgTDE5Ny43ODAzLDI4LjI5NjkgTDE5Ny41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgMjAwLDMwLjc5NjkgTDIwMCwzNzkuNjkgQTIuNSwyLjUgMCAwIDEgMTk3LjUsMzgyLjE5IEw4LjUsMzgyLjE5IEEyLjUsMi41IDAgMCAxIDYsMzc5LjY5IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE5Ny43ODAzIiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc4Ljc4MDMiIHg9IjEwIiB5PSIyMC45OTUxIj5Db21tYW5kIFNpZGUgKFdyaXRlKTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgUXVlcnkgU2lkZSAoUmVhZCktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZSAuUmVhZC4iIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0iZW50MDAxMCI+PHBhdGggZD0iTTM4LjUsNDA2LjE5IEwxODMuNTgxMSw0MDYuMTkgQTMuNzUsMy43NSAwIDAgMSAxODYuMDgxMSw0MDguNjkgTDE5My4wODExLDQyOC40ODY5IEwzMjIuNSw0MjguNDg2OSBBMi41LDIuNSAwIDAgMSAzMjUsNDMwLjk4NjkgTDMyNSw1ODcuMjggQTIuNSwyLjUgMCAwIDEgMzIyLjUsNTg5Ljc4IEwzOC41LDU4OS43OCBBMi41LDIuNSAwIDAgMSAzNiw1ODcuMjggTDM2LDQwOC42OSBBMi41LDIuNSAwIDAgMSAzOC41LDQwNi4xOSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzYiIHgyPSIxOTMuMDgxMSIgeTE9IjQyOC40ODY5IiB5Mj0iNDI4LjQ4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ0LjA4MTEiIHg9IjQwIiB5PSI0MjEuMTg1MSI+UXVlcnkgU2lkZSAoUmVhZCk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkVTVCBDb250cm9sbGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4uUkVTVCBDb250cm9sbGVyIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkuNjM0OCIgeD0iNDQuMTgiIHk9IjQxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjU0LjE4IiB5PSI2My45OTUxIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQ29tbWFuZEdhdGV3YXktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUgLldyaXRlLi5Db21tYW5kR2F0ZXdheSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUzLjc5OTgiIHg9IjI2LjEiIHk9IjEzNy4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjc5OTgiIHg9IjM2LjEiIHk9IjE2MC4yOTUxIj5Db21tYW5kR2F0ZXdheTwvdGV4dD48L2c+PCEtLWVudGl0eSBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUgLldyaXRlLi5BZ2dyZWdhdGUiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDA2Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkzLjI4ODEiIHg9IjUyLjM2IiB5PSIyMzMuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My4yODgxIiB4PSI2Mi4zNiIgeT0iMjU2LjU4NTEiPkFnZ3JlZ2F0ZTwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSAuV3JpdGUuLkV2ZW50IFN0b3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwOCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDEuODY3MiIgeD0iNDcuMDciIHk9IjMyOS44OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjU3LjA3IiB5PSIzNTIuODg1MSI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuLlByb2plY3Rpb24iIGRhdGEtc291cmNlLWxpbmU9IjExIiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS43ODEzIiB4PSI1Mi4xMSIgeT0iNDQxLjE5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuNzgxMyIgeD0iNjIuMTEiIHk9IjQ2NC4xODUxIj5Qcm9qZWN0aW9uPC90ZXh0PjwvZz48IS0tZW50aXR5IFJlYWQgTW9kZWwgREItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJRdWVyeSBTaWRlIC5SZWFkLi5SZWFkIE1vZGVsIERCIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMTMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI3LjEyNiIgeD0iMTE1LjQ0IiB5PSI1MzcuNDgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuMTI2IiB4PSIxMjUuNDQiIHk9IjU2MC40NzUxIj5SZWFkIE1vZGVsIERCPC90ZXh0PjwvZz48IS0tZW50aXR5IE15QmF0aXMgTWFwcGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZSAuUmVhZC4uTXlCYXRpcyBNYXBwZXIiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAxNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzIuNDcxNyIgeD0iMTc2Ljc2IiB5PSI0NDEuMTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMTg2Ljc2IiB5PSI0NjQuMTg1MSI+TXlCYXRpcyBNYXBwZXI8L3RleHQ+PC9nPjwhLS1saW5rIFJFU1QgQ29udHJvbGxlciB0byBDb21tYW5kR2F0ZXdheS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA0IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImxuazUiPjxwYXRoIGQ9Ik0xMDcuOSw3Ny40NCBDMTA2LjgyLDk0LjM1IDEwNS41NzA5LDExMy45NzIxIDEwNC40OTA5LDEzMC45NTIxIiBmaWxsPSJub25lIiBpZD0iUkVTVCBDb250cm9sbGVyLXRvLUNvbW1hbmRHYXRld2F5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDQuMTEsMTM2Ljk0LDEwOC42NzMyLDEyOC4yMTIxLDEwNC40Mjc0LDEzMS45NTAxLDEwMC42ODk0LDEyNy43MDQyLDEwNC4xMSwxMzYuOTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQ29tbWFuZEdhdGV3YXkgdG8gQWdncmVnYXRlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDQiIGRhdGEtZW50aXR5LTI9ImVudDAwMDYiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0ibG5rNyI+PHBhdGggZD0iTTEwMi4yNywxNzMuNzQgQzEwMS41NSwxOTAuNjUgMTAwLjcxNDIsMjEwLjI2NTQgOTkuOTk0MiwyMjcuMjQ1NCIgZmlsbD0ibm9uZSIgaWQ9IkNvbW1hbmRHYXRld2F5LXRvLUFnZ3JlZ2F0ZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTkuNzQsMjMzLjI0LDEwNC4xMTc3LDIyNC40MTc1LDk5Ljk1MTgsMjI4LjI0NDUsOTYuMTI0OSwyMjQuMDc4Niw5OS43NCwyMzMuMjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQWdncmVnYXRlIHRvIEV2ZW50IFN0b3JlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMDgiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0ibG5rOSI+PHBhdGggZD0iTTk4LjgyLDI3MC4wNCBDOTguNjQsMjg2Ljk0IDk4LjQzMzYsMzA2LjU1MDMgOTguMjUzNiwzMjMuNTMwMyIgZmlsbD0ibm9uZSIgaWQ9IkFnZ3JlZ2F0ZS10by1FdmVudCBTdG9yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTguMTksMzI5LjUzLDEwMi4yODUyLDMyMC41NzI5LDk4LjI0MywzMjQuNTMwMyw5NC4yODU2LDMyMC40ODgxLDk4LjE5LDMyOS41MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBFdmVudCBTdG9yZSB0byBQcm9qZWN0aW9uLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDgiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImxuazEyIj48cGF0aCBkPSJNOTcuODQsMzY2LjYgQzk3LjY1LDM4Ni45OSA5Ny40MDU5LDQxNC40NDAzIDk3LjIxNTksNDM0LjgyMDMiIGZpbGw9Im5vbmUiIGlkPSJFdmVudCBTdG9yZS10by1Qcm9qZWN0aW9uIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5Ny4xNiw0NDAuODIsMTAxLjI0MzcsNDMxLjg1NzcsOTcuMjA2Niw0MzUuODIwMiw5My4yNDQxLDQzMS43ODMxLDk3LjE2LDQ0MC44MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBQcm9qZWN0aW9uIHRvIFJlYWQgTW9kZWwgREItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMSIgZGF0YS1lbnRpdHktMj0iZW50MDAxMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0ibG5rMTQiPjxwYXRoIGQ9Ik0xMTIuMDQsNDc3LjYzIEMxMjYuNzQsNDk0LjU0IDE0NS4wNzIyLDUxNS42MjMgMTU5Ljg0MjIsNTMyLjYwMyIgZmlsbD0ibm9uZSIgaWQ9IlByb2plY3Rpb24tdG8tUmVhZCBNb2RlbCBEQiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTYzLjc4LDUzNy4xMywxNjAuODkxMyw1MjcuNzE0MywxNjAuNDk4NSw1MzMuMzU3NSwxNTQuODU1Myw1MzIuOTY0NywxNjMuNzgsNTM3LjEzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFJFU1QgQ29udHJvbGxlciB0byBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDE1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJsbmsxNiI+PHBhdGggZD0iTTEzOC4wNiw3Ny42MiBDMTU4LjA0LDkxLjI2IDE4My4zNSwxMTIuMTEgMTk3LDEzNy4zIEMyNTMuMzQsMjQxLjI1IDI0OC42MzUxLDM4NC43MDU4IDI0NC45NzUxLDQzNS4wNDU4IiBmaWxsPSJub25lIiBpZD0iUkVTVCBDb250cm9sbGVyLXRvLU15QmF0aXMgTWFwcGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDQuNTQsNDQxLjAzLDI0OS4xODIxLDQzMi4zNDM4LDI0NC45MDI2LDQzNi4wNDMyLDI0MS4yMDMyLDQzMS43NjM2LDI0NC41NCw0NDEuMDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgTXlCYXRpcyBNYXBwZXIgdG8gUmVhZCBNb2RlbCBEQi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDE1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEzIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJsbmsxNyI+PHBhdGggZD0iTTIzMS4yNiw0NzcuNjMgQzIxOS43OSw0OTQuNTQgMjA1Ljc2ODYsNTE1LjE4NDkgMTk0LjI0ODYsNTMyLjE2NDkiIGZpbGw9Im5vbmUiIGlkPSJNeUJhdGlzIE1hcHBlci10by1SZWFkIE1vZGVsIERCIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxOTAuODgsNTM3LjEzLDE5OS4yNDMsNTMxLjkyOCwxOTMuNjg3MSw1MzIuOTkyNCwxOTIuNjIyOCw1MjcuNDM2NiwxOTAuODgsNTM3LjEzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjw/cGxhbnR1bWwtc3JjIFRPejFRbThuNDhObC1ITTNsVFkzVnE2ZXN6TkpXaGc1N2NHRnVzTzhTUkVQQzFqUjVsNl9EbkFuWXhKYUNkZGxjeVVSZVJDLWU2MEZCVlUxRlZiT256NEgyQktIbE42YVhXVG9uQk9wbWNVbDJ0T2l5QjhrUnEtZmEwbXExQkUyLW53elhqZmdXbGNkczRZbEN4WWVteHdpRncxVzd1TVQ4c2JXaUxaMnVPdmxDRDh0WmVydzVaQnJQZW9HSUw4MlZrVmliTC1mQ1RJSDlSZE5JUEZUY01JeXp6V0p3Ym5aWWtVMGhWMGZkTWhQZl9KOTl4a3RKUVhPYXVGdExWRlY2VE11bWNXN2czMjQ5QWZkdVMtaXdteTA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<p><strong>CQRS の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>スケーラビリティ</strong></td>
<td>読み取りと書き込みを独立してスケール可能</td>
</tr>
<tr>
<td><strong>パフォーマンス</strong></td>
<td>読み取りに最適化されたモデルで高速クエリ</td>
</tr>
<tr>
<td><strong>複雑性の分離</strong></td>
<td>書き込みロジックと読み取りロジックを独立して開発</td>
</tr>
<tr>
<td><strong>監査対応</strong></td>
<td>Event Sourcing と組み合わせて完全な履歴を保持</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="382-event-sourcing">38.2 Event Sourcing とは<a class="headerlink" href="#382-event-sourcing" title="Permanent link">&para;</a></h3>
<p>Event Sourcing は、アプリケーションの状態をイベントの連続として保存するパターンです。生産管理システムでは、製造指図の作成、着手、完成などの状態変更をイベントとして記録し、必要に応じてイベントを再生して現在の状態を再構築します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUwMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDIycHg7aGVpZ2h0OjUwMnB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQyMiA1MDIiIHdpZHRoPSI0MjJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTAyIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNDIyIiB4PSIwIiB5PSIwIi8+PCEtLWVudGl0eSBDb21tYW5kLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTEuOTU1MSIgeD0iOTcuNDMiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MS45NTUxIiB4PSIxMDcuNDMiIHk9IjI5Ljk5NTEiPkNvbW1hbmQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQWdncmVnYXRlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQWdncmVnYXRlIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5My4yODgxIiB4PSI5Ni43NiIgeT0iMTIwLjI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuMjg4MSIgeD0iMTA2Ljc2IiB5PSIxNDMuMjg1MSI+QWdncmVnYXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBNb2RlbCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIwLjgwOTYiIHg9IjciIHk9IjIzMy41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC44MDk2IiB4PSIxNyIgeT0iMjU2LjU4NTEiPkRvbWFpbiBNb2RlbDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2MC4xMDY0IiB4PSI2NC4zNSIgeT0iMzQ2Ljg5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTA2NCIgeD0iNzQuMzUiIHk9IjM2OS44ODUxIj5FdmVudDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IFN0b3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDEuODY3MiIgeD0iMTExLjQ3IiB5PSI0NjAuMTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxMjEuNDciIHk9IjQ4My4xNzUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PCEtLWxpbmsgQ29tbWFuZCB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJsbms0Ij48cGF0aCBkPSJNMTQzLjQsNDMuNTMgQzE0My40LDY0LjMyIDE0My40LDkyLjkxIDE0My40LDExMy44MSIgZmlsbD0ibm9uZSIgaWQ9IkNvbW1hbmQtdG8tQWdncmVnYXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDMuNCwxMTkuODEsMTQ3LjQsMTEwLjgxLDE0My40LDExNC44MSwxMzkuNCwxMTAuODEsMTQzLjQsMTE5LjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuNTM1NyIgeD0iMTQ0LjQiIHk9Ijg2LjM1NjkiPjEuICYjMTI0Njc7JiMxMjUxMDsmIzEyNTMxOyYjMTI0ODk7JiMyMTQ2MzsmIzIwNDQ5OzwvdGV4dD48L2c+PCEtLWxpbmsgQWdncmVnYXRlIHRvIERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImxuazYiPjxwYXRoIGQ9Ik05Ni41LDE1My40MiBDODAuNjEsMTYwLjY1IDY0LjU4LDE3MS4yNyA1NS40LDE4Ni41OSBDNDYuOTEsMjAwLjc4IDQ5LjYwNTEsMjE0LjE1MzEgNTUuNTU1MSwyMjcuNzUzMSIgZmlsbD0ibm9uZSIgaWQ9IkFnZ3JlZ2F0ZS10by1Eb21haW4gTW9kZWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Ljk2LDIzMy4yNSw1OC4wMTczLDIyMy40MDEzLDU1Ljk1NTksMjI4LjY2OTIsNTAuNjg4LDIyNi42MDc5LDU3Ljk2LDIzMy4yNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni41MzU4IiB4PSI1Ni40IiB5PSIxOTkuNjU2OSI+Mi4gJiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOyYjMjM0NTU7JiMzNDg5Mjs8L3RleHQ+PC9nPjwhLS1saW5rIERvbWFpbiBNb2RlbCB0byBFdmVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImxuazgiPjxwYXRoIGQ9Ik03MS42MiwyNzAuMTMgQzc2LjY3LDI5MC45MSA4My42NDU1LDMxOS42NjkxIDg4LjcxNTUsMzQwLjU2OTEiIGZpbGw9Im5vbmUiIGlkPSJEb21haW4gTW9kZWwtdG8tRXZlbnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjkwLjEzLDM0Ni40LDkxLjg5NTUsMzM2LjcxMDcsODguOTUxMywzNDEuNTQwOSw4NC4xMjEsMzM4LjU5NjcsOTAuMTMsMzQ2LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC41MzU3IiB4PSI4My41MiIgeT0iMzEyLjk1NjkiPjMuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyOTk4MzsmIzI1MTA0OzwvdGV4dD48L2c+PCEtLWxpbmsgRXZlbnQgdG8gRXZlbnQgU3RvcmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNyIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJsbmsxMCI+PHBhdGggZD0iTTkwLjIzLDM4My40MSBDODcuOTIsMzk2Ljk0IDg2Ljg2LDQxNS43OCA5NC40LDQzMC4xOCBDMTAwLjkzLDQ0Mi42NiAxMDcuMzU1Miw0NDkuMjg5IDExOS4wNTUyLDQ1Ni42NjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudC10by1FdmVudCBTdG9yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI0LjEzLDQ1OS44NywxMTguNjUxOCw0NTEuNjg1MywxMTkuOTAxLDQ1Ny4yMDI1LDExNC4zODM4LDQ1OC40NTE3LDEyNC4xMyw0NTkuODciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuNTM1OCIgeD0iOTUuNCIgeT0iNDI2LjI0NjkiPjQuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyNzcwNDsmIzMyMTU0OyYjMjEyNzA7PC90ZXh0PjwvZz48IS0tbGluayBFdmVudCBTdG9yZSB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOSIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJsbmsxMSI+PHBhdGggZD0iTTE4NS4xLDQ2MC4wOSBDMTkzLjgyLDQ1Mi4wNyAyMDIuNzgsNDQxLjc0IDIwNy40LDQzMC4xOCBDMjQ3LjY3LDMyOS42OCAyNTYuMjQsMjgzLjIyIDIwNy40LDE4Ni41OSBDMjAxLjE4LDE3NC4yNyAxOTUuMDQ4NCwxNjcuNjk5IDE4My43OTg0LDE2MC4yMjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudCBTdG9yZS10by1BZ2dyZWdhdGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3OC44LDE1Ni45MSwxODQuMDg1LDE2NS4yMjA3LDE4Mi45NjU0LDE1OS42NzU4LDE4OC41MTAzLDE1OC41NTYyLDE3OC44LDE1Ni45MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3Mi41MzU4IiB4PSIyNDEuODkiIHk9IjMxMi45NTY5Ij41LiAmIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA4Nzc7JiMyOTk4MzsmIzY1Mjg4OyYjMjkzNjY7JiMyNDkwNzsmIzI0NDg5OyYjMjA4MDM7JiM2NTI4OTs8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIEF5eEVwMmo4QjRoQ0xLWkVwb3Q4cHFsREFtYWtnU245TElYQUpJdjlwNGxGSVVLZ1hZajlJYXBFSllfQUJ5ckJTU3hGb0l6SUs3UHAxSzRraGNaZF9EcFNuQm9LTTBMVE5KazVRQ1ZxekFCS3pDSUlyNVc1QW1MM0ZPTjdKUGlWRHl6eHQwbWFFdl9zSnQtb1ZvNE5pWGdtN2ZWeXRDSkNGME5WXzlKSzc5MHM4dzJzdmljRmN0T3lSa3Z6dEJKcFNWRFFDQmx2U1RGd2YtbGNsclpPbXVNYzFNb0FRbmRHMG8zam5ZMVJicG5rZFdjc2pVRnZiRmRGRVlQbW1VR0hRWE0ySV9BQm1FdXFHVE5uUkNFRXZ6amNGVXNQbmVNZzRERTNmZ1dRZHhScjBjcnhsd1ZaVVRVc1B3dFRKX1VqVkRoUV83dkY5bTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<p><strong>Event Sourcing の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>完全な履歴</strong></td>
<td>すべての状態変更が記録される</td>
</tr>
<tr>
<td><strong>監査証跡</strong></td>
<td>いつ、誰が、何を変更したかが明確</td>
</tr>
<tr>
<td><strong>時間旅行</strong></td>
<td>過去の任意の時点の状態を再構築可能</td>
</tr>
<tr>
<td><strong>イベント駆動</strong></td>
<td>他システムとの連携が容易</td>
</tr>
<tr>
<td><strong>デバッグ</strong></td>
<td>問題発生時にイベントを追跡可能</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="383">38.3 ヘキサゴナルアーキテクチャとの統合<a class="headerlink" href="#383" title="Permanent link">&para;</a></h3>
<p>本実装では、ヘキサゴナルアーキテクチャ（Ports &amp; Adapters）を採用し、ビジネスロジックを外部依存から分離します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjQ4NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTY0OHB4O2hlaWdodDo0ODZweDtiYWNrZ3JvdW5kOiNGRUZFRkU7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNjQ4IDQ4NiIgd2lkdGg9IjE2NDhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNDg2IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTY0OCIgeD0iMCIgeT0iMCIvPjwhLS1jbHVzdGVyIEhleGFnb25hbCBBcmNoaXRlY3R1cmUgKENRUlMvRVMgPyktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLiIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxwYXRoIGQ9Ik01MTMuMTYsNiBMODA1LjI2ODMsNiBBMy43NSwzLjc1IDAgMCAxIDgwNy43NjgzLDguNSBMODE0Ljc2ODMsMjguMjk2OSBMMTYzOS4xNiwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDE2NDEuNjYsMzAuNzk2OSBMMTY0MS42Niw0NzcuMzkgQTIuNSwyLjUgMCAwIDEgMTYzOS4xNiw0NzkuODkgTDUxMy4xNiw0NzkuODkgQTIuNSwyLjUgMCAwIDEgNTEwLjY2LDQ3Ny4zOSBMNTEwLjY2LDguNSBBMi41LDIuNSAwIDAgMSA1MTMuMTYsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTEwLjY2IiB4Mj0iODE0Ljc2ODMiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOTEuMTA4MyIgeD0iNTE0LjY2IiB5PSIyMC45OTUxIj5IZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIChDUVJTL0VTICYjMjkyNTY7KTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgSW5ib3VuZCBBZGFwdGVycy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkluYm91bmQgQWRhcHRlcnMiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDAzIj48cGF0aCBkPSJNNTczLjE2LDQ5IEw3MTUuNTU0NSw0OSBBMy43NSwzLjc1IDAgMCAxIDcxOC4wNTQ1LDUxLjUgTDcyNS4wNTQ1LDcxLjI5NjkgTDc1MC4xNiw3MS4yOTY5IEEyLjUsMi41IDAgMCAxIDc1Mi42Niw3My43OTY5IEw3NTIuNjYsMTQzLjggQTIuNSwyLjUgMCAwIDEgNzUwLjE2LDE0Ni4zIEw1NzMuMTYsMTQ2LjMgQTIuNSwyLjUgMCAwIDEgNTcwLjY2LDE0My44IEw1NzAuNjYsNTEuNSBBMi41LDIuNSAwIDAgMSA1NzMuMTYsNDkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjU3MC42NiIgeDI9IjcyNS4wNTQ1IiB5MT0iNzEuMjk2OSIgeTI9IjcxLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQxLjM5NDUiIHg9IjU3NC42NiIgeT0iNjMuOTk1MSI+SW5ib3VuZCBBZGFwdGVyczwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gQ29yZS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0iZW50MDAwNSI+PHBhdGggZD0iTTUzNy4xNiwxNzAuMyBMNjY4LjYyMzksMTcwLjMgQTMuNzUsMy43NSAwIDAgMSA2NzEuMTIzOSwxNzIuOCBMNjc4LjEyMzksMTkyLjU5NjkgTDEyNTAuMTYsMTkyLjU5NjkgQTIuNSwyLjUgMCAwIDEgMTI1Mi42NiwxOTUuMDk2OSBMMTI1Mi42Niw0NTMuMzkgQTIuNSwyLjUgMCAwIDEgMTI1MC4xNiw0NTUuODkgTDUzNy4xNiw0NTUuODkgQTIuNSwyLjUgMCAwIDEgNTM0LjY2LDQ1My4zOSBMNTM0LjY2LDE3Mi44IEEyLjUsMi41IDAgMCAxIDUzNy4xNiwxNzAuMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTM0LjY2IiB4Mj0iNjc4LjEyMzkiIHkxPSIxOTIuNTk2OSIgeTI9IjE5Mi41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC40NjM5IiB4PSI1MzguNjYiIHk9IjE4NS4yOTUxIj5BcHBsaWNhdGlvbiBDb3JlPC90ZXh0PjwvZz48IS0tY2x1c3RlciBBcHBsaWNhdGlvbiBMYXllci0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuQXBwbGljYXRpb24gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjExIiBpZD0iZW50MDAwNiI+PHBhdGggZD0iTTU2MS4xNiwyMTMuMyBMNzAwLjIyNTQsMjEzLjMgQTMuNzUsMy43NSAwIDAgMSA3MDIuNzI1NCwyMTUuOCBMNzA5LjcyNTQsMjM1LjU5NjkgTDEwODIuMTYsMjM1LjU5NjkgQTIuNSwyLjUgMCAwIDEgMTA4NC42NiwyMzguMDk2OSBMMTA4NC42NiwzMDguMDkgQTIuNSwyLjUgMCAwIDEgMTA4Mi4xNiwzMTAuNTkgTDU2MS4xNiwzMTAuNTkgQTIuNSwyLjUgMCAwIDEgNTU4LjY2LDMwOC4wOSBMNTU4LjY2LDIxNS44IEEyLjUsMi41IDAgMCAxIDU2MS4xNiwyMTMuMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTU4LjY2IiB4Mj0iNzA5LjcyNTQiIHkxPSIyMzUuNTk2OSIgeTI9IjIzNS41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOC4wNjU0IiB4PSI1NjIuNjYiIHk9IjIyOC4yOTUxIj5BcHBsaWNhdGlvbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgRG9tYWluIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5Eb21haW4gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjE3IiBpZD0iZW50MDAxMCI+PHBhdGggZD0iTTU2OS4xNiwzMzQuNTkgTDY3OC45Njc2LDMzNC41OSBBMy43NSwzLjc1IDAgMCAxIDY4MS40Njc2LDMzNy4wOSBMNjg4LjQ2NzYsMzU2Ljg4NjkgTDEwNjIuMTYsMzU2Ljg4NjkgQTIuNSwyLjUgMCAwIDEgMTA2NC42NiwzNTkuMzg2OSBMMTA2NC42Niw0MjkuMzkgQTIuNSwyLjUgMCAwIDEgMTA2Mi4xNiw0MzEuODkgTDU2OS4xNiw0MzEuODkgQTIuNSwyLjUgMCAwIDEgNTY2LjY2LDQyOS4zOSBMNTY2LjY2LDMzNy4wOSBBMi41LDIuNSAwIDAgMSA1NjkuMTYsMzM0LjU5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1NjYuNjYiIHgyPSI2ODguNDY3NiIgeTE9IjM1Ni44ODY5IiB5Mj0iMzU2Ljg4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjgwNzYiIHg9IjU3MC42NiIgeT0iMzQ5LjU4NTEiPkRvbWFpbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQVBJIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5BUEkgTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0iZW50MDAxNCI+PHBhdGggZD0iTTExMTEuMTYsMjEzLjMgTDExODcuMjMyMywyMTMuMyBBMy43NSwzLjc1IDAgMCAxIDExODkuNzMyMywyMTUuOCBMMTE5Ni43MzIzLDIzNS41OTY5IEwxMjI2LjE2LDIzNS41OTY5IEEyLjUsMi41IDAgMCAxIDEyMjguNjYsMjM4LjA5NjkgTDEyMjguNjYsMzA4LjA5IEEyLjUsMi41IDAgMCAxIDEyMjYuMTYsMzEwLjU5IEwxMTExLjE2LDMxMC41OSBBMi41LDIuNSAwIDAgMSAxMTA4LjY2LDMwOC4wOSBMMTEwOC42NiwyMTUuOCBBMi41LDIuNSAwIDAgMSAxMTExLjE2LDIxMy4zIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMTA4LjY2IiB4Mj0iMTE5Ni43MzIzIiB5MT0iMjM1LjU5NjkiIHkyPSIyMzUuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NS4wNzIzIiB4PSIxMTEyLjY2IiB5PSIyMjguMjk1MSI+QVBJIExheWVyPC90ZXh0PjwvZz48IS0tY2x1c3RlciBPdXRib3VuZCBBZGFwdGVycy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLk91dGJvdW5kIEFkYXB0ZXJzIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgaWQ9ImVudDAwMTYiPjxwYXRoIGQ9Ik0xMjc5LjE2LDMzNC41OSBMMTQzNC45MzkzLDMzNC41OSBBMy43NSwzLjc1IDAgMCAxIDE0MzcuNDM5MywzMzcuMDkgTDE0NDQuNDM5MywzNTYuODg2OSBMMTYxNS4xNiwzNTYuODg2OSBBMi41LDIuNSAwIDAgMSAxNjE3LjY2LDM1OS4zODY5IEwxNjE3LjY2LDQyOS4zOSBBMi41LDIuNSAwIDAgMSAxNjE1LjE2LDQzMS44OSBMMTI3OS4xNiw0MzEuODkgQTIuNSwyLjUgMCAwIDEgMTI3Ni42Niw0MjkuMzkgTDEyNzYuNjYsMzM3LjA5IEEyLjUsMi41IDAgMCAxIDEyNzkuMTYsMzM0LjU5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMjc2LjY2IiB4Mj0iMTQ0NC40MzkzIiB5MT0iMzU2Ljg4NjkiIHkyPSIzNTYuODg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTQuNzc5MyIgeD0iMTI4MC42NiIgeT0iMzQ5LjU4NTEiPk91dGJvdW5kIEFkYXB0ZXJzPC90ZXh0PjwvZz48IS0tZW50aXR5IFJFU1QgQ29udHJvbGxlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uSW5ib3VuZCBBZGFwdGVycy5SRVNUIENvbnRyb2xsZXIiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDA0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0OS42MzQ4IiB4PSI1ODYuODQiIHk9Ijg0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjcxNi40NzQ4IiB5PSI4OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNzE0LjQ3NDgiIHk9IjkxIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI3MTQuNDc0OCIgeT0iOTUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkuNjM0OCIgeD0iNjAxLjg0IiB5PSIxMTYuOTk1MSI+UkVTVCBDb250cm9sbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IEFnZ3JlZ2F0ZSBBZGFwdGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkFwcGxpY2F0aW9uIExheWVyLkFnZ3JlZ2F0ZSBBZGFwdGVyIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczLjUyNjQiIHg9IjU3NC45IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI3MjguNDI2NCIgeT0iMjUzLjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcyNi40MjY0IiB5PSIyNTUuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNzI2LjQyNjQiIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjUyNjQiIHg9IjU4OS45IiB5PSIyODEuMjk1MSI+QWdncmVnYXRlIEFkYXB0ZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5BcHBsaWNhdGlvbiBMYXllci5Qcm9qZWN0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA5Ljc4MTMiIHg9Ijc4My43NyIgeT0iMjQ4LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iODczLjU1MTMiIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI4NzEuNTUxMyIgeT0iMjU1LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijg3MS41NTEzIiB5PSIyNTkuMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9Ijc5OC43NyIgeT0iMjgxLjI5NTEiPlByb2plY3Rpb248L3RleHQ+PC9nPjwhLS1lbnRpdHkgUG9saWN5IEhhbmRsZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuQXBwbGljYXRpb24gTGF5ZXIuUG9saWN5IEhhbmRsZXIiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDAuMzQ0NyIgeD0iOTI4LjQ5IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxMDQ4LjgzNDciIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDQ2LjgzNDciIHk9IjI1NS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDQ2LjgzNDciIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAwLjM0NDciIHg9Ijk0My40OSIgeT0iMjgxLjI5NTEiPlBvbGljeSBIYW5kbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5Eb21haW4gTGF5ZXIuRG9tYWluIE1vZGVsIiBkYXRhLXNvdXJjZS1saW5lPSIxOCIgaWQ9ImVudDAwMTEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwLjgwOTYiIHg9IjU4Mi4yNiIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjcwMy4wNjk2IiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcwMS4wNjk2IiB5PSIzNzYuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcwMS4wNjk2IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDAuODA5NiIgeD0iNTk3LjI2IiB5PSI0MDIuNTg1MSI+RG9tYWluIE1vZGVsPC90ZXh0PjwvZz48IS0tZW50aXR5IENvbW1hbmRzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkRvbWFpbiBMYXllci5Db21tYW5kcyIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGlkPSJlbnQwMDEyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExOS4yNDkiIHg9Ijc1OC4wNCIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9Ijg1Ny4yODkiIHk9IjM3NC41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iODU1LjI4OSIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI4NTUuMjg5IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OS4yNDkiIHg9Ijc3My4wNCIgeT0iNDAyLjU4NTEiPkNvbW1hbmRzPC90ZXh0PjwvZz48IS0tZW50aXR5IFZhbHVlIE9iamVjdHMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuRG9tYWluIExheWVyLlZhbHVlIE9iamVjdHMiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBpZD0iZW50MDAxMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzYuODcyMSIgeD0iOTEyLjIyIiB5PSIzNjkuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTAyOS4wOTIxIiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjEwMjcuMDkyMSIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDI3LjA5MjEiIHk9IjM4MC41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2Ljg3MjEiIHg9IjkyNy4yMiIgeT0iNDAyLjU4NTEiPlZhbHVlIE9iamVjdHM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgRXZlbnRzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkFQSSBMYXllci5FdmVudHMiIGRhdGEtc291cmNlLWxpbmU9IjI0IiBpZD0iZW50MDAxNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4Ny40MDA0IiB4PSIxMTI0Ljk2IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxMTkyLjM2MDQiIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkwLjM2MDQiIHk9IjI1NS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkwLjM2MDQiIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDcuNDAwNCIgeD0iMTEzOS45NiIgeT0iMjgxLjI5NTEiPkV2ZW50czwvdGV4dD48L2c+PCEtLWVudGl0eSBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uT3V0Ym91bmQgQWRhcHRlcnMuTXlCYXRpcyBNYXBwZXIiIGRhdGEtc291cmNlLWxpbmU9IjI5IiBpZD0iZW50MDAxNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTIuNDcxNyIgeD0iMTI5Mi40MiIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE0MjQuODkxNyIgeT0iMzc0LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNDIyLjg5MTciIHk9IjM3Ni41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTQyMi44OTE3IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMTMwNy40MiIgeT0iNDAyLjU4NTEiPk15QmF0aXMgTWFwcGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IEV2ZW50IFN0b3JlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5PdXRib3VuZCBBZGFwdGVycy5FdmVudCBTdG9yZSIgZGF0YS1zb3VyY2UtbGluZT0iMzAiIGlkPSJlbnQwMDE4Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMS44NjcyIiB4PSIxNDc5LjczIiB5PSIzNjkuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTU4MS41OTcyIiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE1NzkuNTk3MiIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNTc5LjU5NzIiIHk9IjM4MC41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjE0OTQuNzMiIHk9IjQwMi41ODUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMjIiIGRhdGEtc291cmNlLWxpbmU9IjM5IiBpZD0iZW50MDAyMyI+PHBhdGggZD0iTTI4Mi4xOCwyNDMuNzUgTDI4Mi4xOCwyOTkuMTQ4NCBBMCwwIDAgMCAwIDI4Mi4xOCwyOTkuMTQ4NCBMNDQ0LjU3LDI5OS4xNDg0IEw2MDIuNzQsMzY5LjE4IEw0NTIuNTcsMjk5LjE0ODQgTDQ5NS4xMzMyLDI5OS4xNDg0IEEwLDAgMCAwIDAgNDk1LjEzMzIsMjk5LjE0ODQgTDQ5NS4xMzMyLDI1My43NSBMNDg1LjEzMzIsMjQzLjc1IEwyODIuMTgsMjQzLjc1IEEwLDAgMCAwIDAgMjgyLjE4LDI0My43NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTQ4NS4xMzMyLDI0My43NSBMNDg1LjEzMzIsMjUzLjc1IEw0OTUuMTMzMiwyNTMuNzUgTDQ4NS4xMzMyLDI0My43NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjI4OC4xOCIgeT0iMjYwLjgxNjkiPiYjMzIwMjA7JiMzMTg4MzsmIzEyMzk0OyYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjUxNDsmIzEyNDg3OyYjMTI1MjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5MS45NTMyIiB4PSIyODguMTgiIHk9IjI3NS45NDk3Ij5BeG9uIEZyYW1ld29yayAmIzEyMzk1OyYjMjAzODE7JiMyMzM4NDsmIzEyMzc1OyYjMTIzOTQ7JiMxMjM1Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjI4OC4xOCIgeT0iMjkxLjA4MjUiPiYjMTI0OTk7JiMxMjQ3MjsmIzEyNDkzOyYjMTI0NzM7JiMxMjUyNTsmIzEyNDcyOyYjMTI0ODM7JiMxMjQ2MzsmIzEyMzk4OyYjMTI0MTU7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4yNSIgZGF0YS1zb3VyY2UtbGluZT0iNDUiIGlkPSJlbnQwMDI2Ij48cGF0aCBkPSJNNiwyNDMuNzUgTDYsMjk5LjE0ODQgTDI0Ny4zMjA4LDI5OS4xNDg0IEwyNDcuMzIwOCwyNTMuNzUgTDIzNy4zMjA4LDI0My43NSBMNiwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yMzcuMzIwOCwyNDMuNzUgTDIzNy4zMjA4LDI1My43NSBMMjQ3LjMyMDgsMjUzLjc1IEwyMzcuMzIwOCwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTQuOTExNyIgeD0iMTIiIHk9IjI2MC44MTY5Ij5BeG9uICYjMjk5OTI7JiMxMjQ1MDsmIzEyNDgwOyYjMTI1MDM7JiMxMjQ3OTsmIzEyNTQwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjAuMzIwOCIgeD0iMTIiIHk9IjI3NS45NDk3Ij5AQWdncmVnYXRlLCBAQ29tbWFuZEhhbmRsZXI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU2LjAwMDIiIHg9IjEyIiB5PSIyOTEuMDgyNSI+JiMxMjUwMTsmIzEyNTI0OyYjMTI1NDA7JiMxMjUxMjsmIzEyNTI3OyYjMTI1NDA7JiMxMjQ2MzsmIzIwMzgxOyYjMjMzODQ7JiMxMjQzNDsmIzIxNTYwOyYjMjE0NTQ7PC90ZXh0PjwvZz48IS0tbGluayBSRVNUIENvbnRyb2xsZXIgdG8gQWdncmVnYXRlIEFkYXB0ZXItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAwNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjM0IiBpZD0ibG5rMTkiPjxwYXRoIGQ9Ik02NjEuNjYsMTMwLjcxIEM2NjEuNjYsMTYxLjYzIDY2MS42NiwyMTAuODUgNjYxLjY2LDI0MS44MSIgZmlsbD0ibm9uZSIgaWQ9IlJFU1QgQ29udHJvbGxlci10by1BZ2dyZWdhdGUgQWRhcHRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjYxLjY2LDI0Ny44MSw2NjUuNjYsMjM4LjgxLDY2MS42NiwyNDIuODEsNjU3LjY2LDIzOC44MSw2NjEuNjYsMjQ3LjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEFnZ3JlZ2F0ZSBBZGFwdGVyIHRvIERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA3IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzUiIGlkPSJsbmsyMCI+PHBhdGggZD0iTTY1OS45NywyOTQuODggQzY1OC4zNiwzMTYuMjEgNjU2LjM5OTYsMzQyLjEyNjkgNjU0Ljc5OTYsMzYzLjQxNjkiIGZpbGw9Im5vbmUiIGlkPSJBZ2dyZWdhdGUgQWRhcHRlci10by1Eb21haW4gTW9kZWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY1NC4zNSwzNjkuNCw2NTkuMDEzMiwzNjAuNzI1MSw2NTQuNzI0NywzNjQuNDE0MSw2NTEuMDM1NywzNjAuMTI1NSw2NTQuMzUsMzY5LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUHJvamVjdGlvbiB0byBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDE3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzYiIGlkPSJsbmsyMSI+PHBhdGggZD0iTTg2Ni4zNSwyOTQuOTkgQzg3OS4wNywzMDQuMDQgODk0LjgzLDMxMy41MSA5MTAuNjYsMzE4LjU5IEM5NDMuMjksMzI5LjA4IDEwMzAuNjksMzIyLjEgMTA2NC42NiwzMjYuNTkgQzExNDIuOTIsMzM2Ljk0IDEyMjUuMTU0MiwzNTUuMjk0NSAxMjg2LjI3NDIsMzcwLjM1NDUiIGZpbGw9Im5vbmUiIGlkPSJQcm9qZWN0aW9uLXRvLU15QmF0aXMgTWFwcGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMjkyLjEsMzcxLjc5LDEyODQuMzE4MywzNjUuNzUzLDEyODcuMjQ1MiwzNzAuNTkzOCwxMjgyLjQwNDQsMzczLjUyMDYsMTI5Mi4xLDM3MS43OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBHTU4yNSB0byBBZ2dyZWdhdGUgQWRhcHRlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDI2IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iYXNzb2NpYXRpb24iIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBpZD0ibG5rMjciPjxwYXRoIGQ9Ik0xNTQuMjEsMjQzLjQ0IEMxODAuMzgsMjE4LjQ2IDIyMS45NiwxODIuNzYgMjY0LjY2LDE2Mi4zIEMyNzEuODYsMTU4Ljg1IDI3NC4yMywxNTkuMTkgMjgyLjE2LDE1OC4zIEMzMjkuMiwxNTIuOTkgNDQ4LjEzLDE1Mi45OSA0OTUuMTYsMTU4LjMgQzU1Ni44LDE2NS4yNSA2MTMuMDEsMjE2Ljk2IDY0MS42OCwyNDguMDEiIGZpbGw9Im5vbmUiIGlkPSJHTU4yNS1BZ2dyZWdhdGUgQWRhcHRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48P3BsYW50dW1sLXNyYyBSTEJUUWpIMDVCd1ZmcFpNNm1NQlJvMkRRVmUzTkxqdFlwVWI1eEY5UjhteEVuQ2NpemY1MTlDSFIxNV9xNGd6QVFYdThUUXdlNXZLNEZpbW5zTFZtdmJpQjY1dG9TdDlkRV9sZDliQjRVaWFXYTRweUJVek13aVIwT0lTUFhkOWtlYjhnUTh6UURFbTZvbFA1djRsa0xIbVVJTG03bzZmUlQyT21TOFFzd0VuNTlJM2Z5QXhZTVFYeFlpNkxfcFJwVFJyZTBOWldfc2gyXzJtbmJXTlJJUzhOYUhKcExKY2tabERlQktEbFhIUUlTd1BzWU1GUVdtbEpOYUlLZnI4T0o2QUVTUlN2V09UQzVOZ1VONmlNNG1yLXMtcEl0UXNiQm5kdXJjVy12Nk1ETzByQWc4UGxzTlBlcWJUaEpmZW84WG5vX0xiaHNUdmNJdGxLRHZkaURic21qYkt3Z3RyY2FIbWR1YTllZXhQeEVpdm9zV0NSamZ2Q2NaR0Qyc0pic0hlUUpqeGZKMnBDNVhTbDA1cG52dXpjczJkWGdmalB6QVZKYTY0ajFmUWZZMHhxLXBucHlGbnpzVU9WcTVwV0VPMzVmX0dfNDNwNFNySkQyVjRzeEVOaXM4VjU3aVdMSFNtRl9keHZ0WHEtV3hwOHlWOWRuMHFSeDB1R19DU1lyemVKaWxRTzM3NF8xbGN2dUpQNUpkeEFXSGQ3THNjYzNEbHdKSy1fOG81VE4tQ3ZXWUJTcElfb1Q4NXpYZWlMSlRPdFJ2clZ1bGNncU1YVU96Y3c4ZllNNEtpTmV6VWRPclVsaFo4eTB5MD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>設計原則：</strong></p>
<ol>
<li><strong>ドメインモデルの純粋性</strong>: ドメインモデルは Axon に依存しない純粋な Java コード</li>
<li><strong>Aggregate Adapter</strong>: Axon Framework 用のアダプターを Application Layer に配置</li>
<li><strong>イベントは公開 API</strong>: イベントは他の Context から参照される公開 API として定義</li>
</ol>
<hr />
<h3 id="384">38.4 技術スタック<a class="headerlink" href="#384" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カテゴリ</th>
<th>技術</th>
<th>バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td>言語</td>
<td>Java</td>
<td>21</td>
</tr>
<tr>
<td>フレームワーク</td>
<td>Spring Boot</td>
<td>3.4.1</td>
</tr>
<tr>
<td>CQRS/ES</td>
<td>Axon Framework</td>
<td>4.10.3</td>
</tr>
<tr>
<td>ORM</td>
<td>MyBatis</td>
<td>3.0.4</td>
</tr>
<tr>
<td>API ドキュメント</td>
<td>SpringDoc OpenAPI</td>
<td>2.7.0</td>
</tr>
<tr>
<td>データベース</td>
<td>H2 (開発) / PostgreSQL (本番)</td>
<td>-</td>
</tr>
</tbody>
</table>
<h4 id="buildgradlekts">build.gradle.kts<a class="headerlink" href="#buildgradlekts" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: build.gradle.kts</summary>

<div class="highlight"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Spring Boot</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-validation&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Axon Framework</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-spring-boot-starter:4.10.3&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exclude</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;org.axonframework&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;axon-server-connector&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// MyBatis</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.4&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// OpenAPI</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springdoc:springdoc-openapi-starter-webmvc-ui:2.7.0&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Database</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;com.h2database:h2&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;org.postgresql:postgresql&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-test:4.10.3&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.mybatis.spring.boot:mybatis-spring-boot-starter-test:3.0.4&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="385">38.5 ディレクトリ構造<a class="headerlink" href="#385" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: ディレクトリ構成</summary>

<div class="highlight"><pre><span></span><code>src/main/java/com/example/production/
├── app/                              # アプリケーション共通
│   └── RootController.java
├── config/                           # 設定クラス
│   ├── AxonConfig.java
│   ├── MyBatisConfig.java
│   └── OpenApiConfig.java
├── workorder/                        # WorkOrder Bounded Context（製造指図）
│   ├── api/
│   │   └── events/                   # 公開イベント API
│   │       ├── WorkOrderEvent.java   # sealed interface
│   │       ├── WorkOrderCreatedEvent.java
│   │       ├── WorkOrderReleasedEvent.java
│   │       ├── WorkOrderStartedEvent.java
│   │       ├── WorkOrderCompletedEvent.java
│   │       └── WorkOrderCancelledEvent.java
│   ├── adapter/
│   │   ├── inbound/rest/workorders/  # Inbound Adapter (REST)
│   │   │   ├── WorkOrdersController.java
│   │   │   └── protocol/             # Request/Response DTO
│   │   └── outbound/persistence/     # Outbound Adapter (MyBatis)
│   │       ├── entity/
│   │       │   └── WorkOrderEntity.java
│   │       └── mapper/
│   │           └── WorkOrderMapper.java
│   ├── application/
│   │   ├── aggregate/                # Axon Aggregate Adapter
│   │   │   └── WorkOrderAggregateAdapter.java
│   │   ├── policy/                   # イベントハンドラー（Choreography）
│   │   │   └── MaterialEventHandler.java
│   │   └── query/                    # Projection
│   │       └── WorkOrderProjection.java
│   └── domain/
│       └── model/aggregate/workorder/    # 純粋なドメインモデル
│           ├── WorkOrder.java
│           ├── WorkOrderCommands.java
│           └── WorkOrderStatus.java
└── material/                         # Material Bounded Context（資材・在庫）
    ├── api/events/
    │   ├── MaterialEvent.java
    │   ├── MaterialReservedEvent.java
    │   ├── MaterialReservationFailedEvent.java
    │   ├── MaterialIssuedEvent.java
    │   └── MaterialReturnedEvent.java
    ├── application/
    │   ├── aggregate/
    │   │   └── MaterialAggregateAdapter.java
    │   └── policy/
    │       └── WorkOrderEventHandler.java
    └── domain/model/aggregate/material/
        ├── Material.java
        └── MaterialCommands.java

src/main/resources/
├── application.yml
├── schema.sql                        # Read Model スキーマ
└── mapper/
    └── WorkOrderMapper.xml           # MyBatis マッパー XML
</code></pre></div>

</details>

<hr />
<h3 id="386-axon">38.6 Axon 設定クラス<a class="headerlink" href="#386-axon" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: AxonConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EmbeddedEventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.Serializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.json.JacksonSerializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Axon Framework 設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AxonConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JDBC ベースの Event Storage Engine</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="nf">eventStorageEngine</span><span class="p">(</span>
<span class="w">            </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">,</span>
<span class="w">            </span><span class="n">Serializer</span><span class="w"> </span><span class="n">serializer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JdbcEventStorageEngine</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">snapshotSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">eventSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">dataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Event Store</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStore</span><span class="w"> </span><span class="nf">eventStore</span><span class="p">(</span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="n">eventStorageEngine</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EmbeddedEventStore</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">storageEngine</span><span class="p">(</span><span class="n">eventStorageEngine</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JSON シリアライザー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Serializer</span><span class="w"> </span><span class="nf">eventSerializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JacksonSerializer</span><span class="p">.</span><span class="na">defaultSerializer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="387-mybatis">38.7 MyBatis 設定クラス<a class="headerlink" href="#387-mybatis" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: MyBatisConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.session.SqlSessionFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.SqlSessionFactoryBean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.annotation.MapperScan</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.core.io.support.PathMatchingResourcePatternResolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * MyBatis 設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@MapperScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;com.example.production.workorder.adapter.outbound.persistence.mapper&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;com.example.production.material.adapter.outbound.persistence.mapper&quot;</span>
<span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyBatisConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">sqlSessionFactory</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SqlSessionFactoryBean</span><span class="w"> </span><span class="n">factoryBean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBean</span><span class="p">();</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setMapperLocations</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">PathMatchingResourcePatternResolver</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">getResources</span><span class="p">(</span><span class="s">&quot;classpath:mapper/**/*.xml&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setTypeAliasesPackage</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;com.example.production.workorder.adapter.outbound.persistence.entity,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;com.example.production.material.adapter.outbound.persistence.entity&quot;</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">session</span><span class="p">.</span><span class="na">Configuration</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">session</span><span class="p">.</span><span class="na">Configuration</span><span class="p">();</span>
<span class="w">        </span><span class="n">configuration</span><span class="p">.</span><span class="na">setMapUnderscoreToCamelCase</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setConfiguration</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">getObject</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="39">第39章：ドメインモデルとイベント設計<a class="headerlink" href="#39" title="Permanent link">&para;</a></h2>
<h3 id="391-workorder-bounded-context">39.1 WorkOrder Bounded Context（製造指図）<a class="headerlink" href="#391-workorder-bounded-context" title="Permanent link">&para;</a></h3>
<p>製造指図の作成から完成までのライフサイクルを管理します。</p>
<h4 id="_2">状態遷移図<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNUQVRFIiBoZWlnaHQ9IjYyOHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTIwMXB4O2hlaWdodDo2MjhweDtiYWNrZ3JvdW5kOiNGRUZFRkU7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjAxIDYyOCIgd2lkdGg9IjEyMDFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNjI4IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTIwMSIgeD0iMCIgeT0iMCIvPjxlbGxpcHNlIGN4PSI4NTQuMDciIGN5PSIxMDQuOTQiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4Ni4xMDM1IiB4PSI4MTEuMDIiIHk9IjE5MS45NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgxMS4wMiIgeDI9Ijg5Ny4xMjM1IiB5MT0iMjE4LjIzNjkiIHkyPSIyMTguMjM2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY2LjEwMzUiIHg9IjgyMS4wMiIgeT0iMjA5LjkzNTEiPkNSRUFURUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTMuMzA4NiIgeD0iNzEzLjQyIiB5PSIzMTguOTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3MTMuNDIiIHgyPSI4MDYuNzI4NiIgeTE9IjM0NS4yMzY5IiB5Mj0iMzQ1LjIzNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My4zMDg2IiB4PSI3MjMuNDIiIHk9IjMzNi45MzUxIj5SRUxFQVNFRDwvdGV4dD48L2c+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDMuNjcxOSIgeD0iNzA4LjIzIiB5PSI1NzIuOTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI3MDguMjMiIHgyPSI4MTEuOTAxOSIgeTE9IjU5OS4yMzY5IiB5Mj0iNTk5LjIzNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My42NzE5IiB4PSI3MTguMjMiIHk9IjU5MC45MzUxIj5DQU5DRUxMRUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE3Ljk4NjMiIHg9IjM2OS4wOCIgeT0iNDQ1Ljk0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzY5LjA4IiB4Mj0iNDg3LjA2NjMiIHkxPSI0NzIuMjM2OSIgeTI9IjQ3Mi4yMzY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTg2MyIgeD0iMzc5LjA4IiB5PSI0NjMuOTM1MSI+SU5fUFJPR1JFU1M8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA2LjEzOTYiIHg9IjciIHk9IjU3Mi45NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjciIHgyPSIxMTMuMTM5NiIgeTE9IjU5OS4yMzY5IiB5Mj0iNTk5LjIzNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ni4xMzk2IiB4PSIxNyIgeT0iNTkwLjkzNTEiPkNPTVBMRVRFRDwvdGV4dD48L2c+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDYuMTg3NSIgeD0iMjgxLjk4IiB5PSI1NzIuOTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyODEuOTgiIHgyPSIzODguMTY3NSIgeTE9IjU5OS4yMzY5IiB5Mj0iNTk5LjIzNjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ni4xODc1IiB4PSIyOTEuOTgiIHk9IjU5MC45MzUxIj5TVVNQRU5ERUQ8L3RleHQ+PC9nPjwhLS1saW5rICpzdGFydCogdG8gQ1JFQVRFRC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAyIiBkYXRhLWVudGl0eS0yPSJlbnQwMDAzIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgaWQ9ImxuazQiPjxwYXRoIGQ9Ik04NTQuMDcsMTE1LjMyIEM4NTQuMDcsMTMyLjA1IDg1NC4wNywxNjEuNTMgODU0LjA3LDE4NS41NyIgZmlsbD0ibm9uZSIgaWQ9IipzdGFydCotdG8tQ1JFQVRFRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODU0LjA3LDE5MS41Nyw4NTguMDcsMTgyLjU3LDg1NC4wNywxODYuNTcsODUwLjA3LDE4Mi41Nyw4NTQuMDcsMTkxLjU3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIyLjU4NTkiIHg9Ijg1NS4wNyIgeT0iMTU4LjAwNjkiPldvcmtPcmRlckNyZWF0ZWQ8L3RleHQ+PC9nPjwhLS1saW5rIENSRUFURUQgdG8gUkVMRUFTRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJsbms2Ij48cGF0aCBkPSJNODE5Ljk5LDI0Mi4zNyBDODA5Ljc2LDI1MC44OCA3OTkuMTIsMjYxLjA1IDc5MS4wNywyNzEuOTQgQzc4MC42NywyODYgNzc0Ljg3NDQsMjk4LjQ0NTQgNzY5LjY4NDQsMzEyLjg0NTQiIGZpbGw9Im5vbmUiIGlkPSJDUkVBVEVELXRvLVJFTEVBU0VEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3NjcuNjUsMzE4LjQ5LDc3NC40NjQ2LDMxMS4zNzk0LDc2OS4zNDUzLDMxMy43ODYyLDc2Ni45Mzg1LDMwOC42NjY5LDc2Ny42NSwzMTguNDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuNDgyNCIgeD0iNzkyLjA3IiB5PSIyODUuMDA2OSI+V29ya09yZGVyUmVsZWFzZWQ8L3RleHQ+PC9nPjwhLS1saW5rIENSRUFURUQgdG8gQ0FOQ0VMTEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0ibG5rOCI+PHBhdGggZD0iTTg5Ny41MiwyNDAuMDkgQzkwOS4yOCwyNDguMzcgOTIwLjU0LDI1OC45OSA5MjcuMDcsMjcxLjk0IEM5NTMuMzQsMzI0LjA0IDExOTQuMzcsNiA5MDQuMDcsNDk1Ljk0IEM4ODMuMDYsNTMxLjQxIDg0OS40NzQ5LDU1NC43NjU4IDgxNy40MDQ5LDU3MS41NjU4IiBmaWxsPSJub25lIiBpZD0iQ1JFQVRFRC10by1DQU5DRUxMRUQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgxMi4wOSw1NzQuMzUsODIxLjkxODUsNTczLjcxNjksODE2LjUxOTEsNTcyLjAyOTgsODE4LjIwNjIsNTY2LjYzMDQsODEyLjA5LDU3NC4zNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNC43NTQ0IiB4PSI5NTcuOTciIHk9IjQxMi4wMDY5Ij5Xb3JrT3JkZXJDYW5jZWxsZWQ8L3RleHQ+PC9nPjwhLS1saW5rIFJFTEVBU0VEIHRvIElOX1BST0dSRVNTLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMDkiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0ibG5rMTAiPjxwYXRoIGQ9Ik03MTMuMDEsMzYyLjIgQzY4NC4zOCwzNzIuNzQgNjQ3LjA4LDM4Ni41MyA2MTQuMDcsMzk4Ljk0IEM1NzEuNjgsNDE0Ljg3IDUyOS41NzI0LDQzMC45NDIxIDQ5My4wODI0LDQ0NC45MzIxIiBmaWxsPSJub25lIiBpZD0iUkVMRUFTRUQtdG8tSU5fUFJPR1JFU1MiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ4Ny40OCw0NDcuMDgsNDk3LjMxNTUsNDQ3LjU5MzEsNDkyLjE0ODYsNDQ1LjI5MDEsNDk0LjQ1MTYsNDQwLjEyMzIsNDg3LjQ4LDQ0Ny4wOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOC44NTk5IiB4PSI2MTUuMDciIHk9IjQxMi4wMDY5Ij5Xb3JrT3JkZXJTdGFydGVkPC90ZXh0PjwvZz48IS0tbGluayBSRUxFQVNFRCB0byBDQU5DRUxMRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNSIgZGF0YS1lbnRpdHktMj0iZW50MDAwNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJsbmsxMSI+PHBhdGggZD0iTTc2MC4wNywzNjkuMSBDNzYwLjA3LDQxNy4xNSA3NjAuMDcsNTE4LjE5IDc2MC4wNyw1NjYuNDgiIGZpbGw9Im5vbmUiIGlkPSJSRUxFQVNFRC10by1DQU5DRUxMRUQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc2MC4wNyw1NzIuNDgsNzY0LjA3LDU2My40OCw3NjAuMDcsNTY3LjQ4LDc1Ni4wNyw1NjMuNDgsNzYwLjA3LDU3Mi40OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNC43NTQ0IiB4PSI3NjEuMDciIHk9IjQ3NS41MDY5Ij5Xb3JrT3JkZXJDYW5jZWxsZWQ8L3RleHQ+PC9nPjwhLS1saW5rIElOX1BST0dSRVNTIHRvIENPTVBMRVRFRC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA5IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEyIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImxuazEzIj48cGF0aCBkPSJNMzY4LjY0LDQ3NCBDMjgxLjgzLDQ3OC4xOSAxMjYuMDgsNDkwLjU0IDg0LjA3LDUyNS45NCBDNzAuNDQsNTM3LjQzIDY1LjQ4MzcsNTUxLjAyNzkgNjIuOTMzNyw1NjYuNjk3OSIgZmlsbD0ibm9uZSIgaWQ9IklOX1BST0dSRVNTLXRvLUNPTVBMRVRFRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjEuOTcsNTcyLjYyLDY3LjM2MzYsNTY0LjM3OTMsNjIuNzczMSw1NjcuNjg0OSw1OS40Njc1LDU2My4wOTQ0LDYxLjk3LDU3Mi42MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MS43NTU5IiB4PSI4NS4wNyIgeT0iNTM5LjAwNjkiPldvcmtPcmRlckNvbXBsZXRlZDwvdGV4dD48L2c+PCEtLWxpbmsgSU5fUFJPR1JFU1MgdG8gU1VTUEVOREVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDkiIGRhdGEtZW50aXR5LTI9ImVudDAwMTQiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBpZD0ibG5rMTUiPjxwYXRoIGQ9Ik0zNjguODUsNDgxLjA1IEMzMTkuOCw0ODkuOTUgMjU1LjcsNTA1LjE5IDI0MC4wNyw1MjUuOTQgQzIyMy4xLDU0OC40NyAyNDUuOTYzNiw1NjQuOTA3NSAyNzYuMDMzNiw1NzcuNDY3NSIgZmlsbD0ibm9uZSIgaWQ9IklOX1BST0dSRVNTLXRvLVNVU1BFTkRFRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjgxLjU3LDU3OS43OCwyNzQuODA3LDU3Mi42MjAyLDI3Ni45NTYzLDU3Ny44NTI5LDI3MS43MjM2LDU4MC4wMDIyLDI4MS41Nyw1NzkuNzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuMTA3OSIgeD0iMjQxLjA3IiB5PSI1MzkuMDA2OSI+V29ya09yZGVyU3VzcGVuZGVkPC90ZXh0PjwvZz48IS0tbGluayBTVVNQRU5ERUQgdG8gSU5fUFJPR1JFU1MtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxNCIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0ibG5rMTYiPjxwYXRoIGQ9Ik0zNjIuNDgsNTcyLjUgQzM3MS41Myw1NjMuNjggMzgxLjI3LDU1My4zMyAzODkuMDcsNTQyLjk0IEMzOTkuOTYsNTI4LjQzIDQwNy4xMTAzLDUxNS44OTM0IDQxNC4xNzAzLDUwMS42ODM0IiBmaWxsPSJub25lIiBpZD0iU1VTUEVOREVELXRvLUlOX1BST0dSRVNTIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MTYuODQsNDk2LjMxLDQwOS4yNTMzLDUwMi41OTAzLDQxNC42MTUzLDUwMC43ODc4LDQxNi40MTc3LDUwNi4xNDk4LDQxNi44NCw0OTYuMzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzEuODA5MSIgeD0iNDAxLjI1IiB5PSI1MzkuMDA2OSI+V29ya09yZGVyUmVzdW1lZDwvdGV4dD48L2c+PCEtLWxpbmsgSU5fUFJPR1JFU1MgdG8gQ0FOQ0VMTEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDkiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImxuazE3Ij48cGF0aCBkPSJNNDgzLjU1LDQ5Ni4zMyBDNTE2LjU3LDUxMC41NCA1NTkuNDQsNTI4LjQ2IDU5OC4wNyw1NDIuOTQgQzYzNC40Myw1NTYuNTcgNjcwLjI4NzEsNTY4LjU1NjEgNzAyLjIxNzEsNTc4LjgwNjEiIGZpbGw9Im5vbmUiIGlkPSJJTl9QUk9HUkVTUy10by1DQU5DRUxMRUQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjcwNy45Myw1ODAuNjQsNzAwLjU4MzMsNTc0LjA4MDYsNzAzLjE2OTMsNTc5LjExMTcsNjk4LjEzODEsNTgxLjY5NzcsNzA3LjkzLDU4MC42NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNC43NTQ0IiB4PSI1OTkuMDciIHk9IjUzOS4wMDY5Ij5Xb3JrT3JkZXJDYW5jZWxsZWQ8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIFhTX0gyZThtNTBSV1V2ellxNXRXMnRHSG8zbjVpNUlzZWVrOE03YzhTNndvcFZURldxZzc2RVZvX19adlp3a1VrZjVNcmtHY3h6TjNjYlFOcjJYWm9NODNfS05IVU5hWFNSbWNiNERvVzlJaW9DZE9BaFNiTWNmSFVZb1pKekdwM1dtSUNOT1M1S2VORzlmYTUxV0I2Z00tZXI4VF9WUnFUZlRUMnZ2bEVHV25yQzlCd3FGeGZ0VE96VVJ2bGMwR0ZjUmdIZzZWdUU4ZTJpWklDSFVqUXIyTjdWXzVDeEN2a2hRVWNaQXhfMEswPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_3">イベント一覧<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>イベント</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WorkOrderCreatedEvent</code></td>
<td>製造指図が作成された</td>
</tr>
<tr>
<td><code>WorkOrderReleasedEvent</code></td>
<td>製造指図がリリースされた（資材引当成功）</td>
</tr>
<tr>
<td><code>WorkOrderRejectedEvent</code></td>
<td>製造指図が却下された（資材引当失敗）</td>
</tr>
<tr>
<td><code>WorkOrderStartedEvent</code></td>
<td>製造が開始された</td>
</tr>
<tr>
<td><code>WorkOrderSuspendedEvent</code></td>
<td>製造が中断された</td>
</tr>
<tr>
<td><code>WorkOrderResumedEvent</code></td>
<td>製造が再開された</td>
</tr>
<tr>
<td><code>WorkOrderCompletedEvent</code></td>
<td>製造が完了した</td>
</tr>
<tr>
<td><code>WorkOrderCancelledEvent</code></td>
<td>製造指図がキャンセルされた</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="392-api-layer">39.2 イベント定義（API Layer）<a class="headerlink" href="#392-api-layer" title="Permanent link">&para;</a></h3>
<h4 id="sealed-interface">sealed interface によるイベントの型安全性<a class="headerlink" href="#sealed-interface" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: WorkOrderEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder イベントの sealed interface</span>
<span class="cm"> * すべての WorkOrder イベントの親インターフェース</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">WorkOrderEvent</span><span class="w"> </span><span class="n">permits</span>
<span class="w">        </span><span class="n">WorkOrderCreatedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderReleasedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderRejectedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderStartedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderSuspendedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderResumedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderCompletedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderCancelledEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">workOrderId</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>sealed interface の利点：</strong></p>
<ul>
<li><strong>網羅性チェック</strong>: switch 式でコンパイル時に全ケースをチェック</li>
<li><strong>型安全性</strong>: 許可されたクラスのみが実装可能</li>
<li><strong>ドキュメント</strong>: 存在するイベントが一目でわかる</li>
</ul>
<h4 id="record">イベント record の実装<a class="headerlink" href="#record" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: WorkOrderCreatedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造指図作成イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrderCreatedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WorkOrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: WorkOrderReleasedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造指図リリースイベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrderReleasedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">releasedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WorkOrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: WorkOrderStartedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造開始イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrderStartedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualStartTime</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WorkOrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: WorkOrderCompletedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造完了イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrderCompletedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualEndTime</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WorkOrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: WorkOrderCancelledEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造指図キャンセルイベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrderCancelledEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WorkOrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="393-domain-layer">39.3 コマンド定義（Domain Layer）<a class="headerlink" href="#393-domain-layer" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderCommands.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.TargetAggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder 集約へのコマンド定義</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorkOrderCommands</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">WorkOrderCommands</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造指図作成コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CreateWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造指図リリースコマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ReleaseWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">releasedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造指図却下コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">RejectWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造開始コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">StartWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造中断コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">SuspendWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">suspendedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造再開コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ResumeWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">resumedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造完了コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CompleteWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセルコマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CancelWorkOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>@TargetAggregateIdentifier の役割：</strong></p>
<ul>
<li>Axon がコマンドをどの集約インスタンスにルーティングするかを決定</li>
<li>集約の一意識別子となるフィールドに付与</li>
</ul>
<hr />
<h3 id="394-java">39.4 ドメインモデル（純粋な Java）<a class="headerlink" href="#394-java" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrder.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder ドメインモデル（Axon 非依存）</span>
<span class="cm"> * 純粋なビジネスロジックのみを含む</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrder</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">,</span>
<span class="w">        </span><span class="n">WorkOrderStatus</span><span class="w"> </span><span class="n">status</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ======== ファクトリメソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造指図作成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// バリデーション</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">orderQuantity</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Order quantity must be positive&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">plannedEndDate</span><span class="p">.</span><span class="na">isBefore</span><span class="p">(</span><span class="n">plannedStartDate</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Planned end date must be after start date&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">                </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">                </span><span class="n">itemName</span><span class="p">,</span>
<span class="w">                </span><span class="n">orderQuantity</span><span class="p">,</span>
<span class="w">                </span><span class="n">unitOfMeasure</span><span class="p">,</span>
<span class="w">                </span><span class="n">plannedStartDate</span><span class="p">,</span>
<span class="w">                </span><span class="n">plannedEndDate</span><span class="p">,</span>
<span class="w">                </span><span class="n">workCenterId</span><span class="p">,</span>
<span class="w">                </span><span class="n">createdBy</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントからの再構築</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">WorkOrder</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">WorkOrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrder</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">itemName</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">unitOfMeasure</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">plannedStartDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">plannedEndDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">workCenterId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">CREATED</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== 状態遷移メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造指図リリース</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrderReleasedEvent</span><span class="w"> </span><span class="nf">release</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">CREATED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only created work orders can be released&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderReleasedEvent</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造指図却下</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrderRejectedEvent</span><span class="w"> </span><span class="nf">reject</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">CREATED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only created work orders can be rejected&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderRejectedEvent</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造開始</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrderStartedEvent</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">RELEASED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only released work orders can be started&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderStartedEvent</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">operatorId</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造中断</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrderSuspendedEvent</span><span class="w"> </span><span class="nf">suspend</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">IN_PROGRESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only in-progress work orders can be suspended&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderSuspendedEvent</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造再開</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrderResumedEvent</span><span class="w"> </span><span class="nf">resume</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">SUSPENDED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only suspended work orders can be resumed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderResumedEvent</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造完了</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrderCompletedEvent</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">IN_PROGRESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only in-progress work orders can be completed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">completedQuantity</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Completed quantity cannot be negative&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">defectQuantity</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Defect quantity cannot be negative&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCompletedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">                </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">                </span><span class="n">completedQuantity</span><span class="p">,</span>
<span class="w">                </span><span class="n">defectQuantity</span><span class="p">,</span>
<span class="w">                </span><span class="n">operatorId</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセル</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrderCancelledEvent</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">COMPLETED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Completed work orders cannot be cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Work order is already cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCancelledEvent</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== イベント適用メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントを適用して新しい状態を生成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WorkOrder</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">WorkOrderEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderReleasedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">RELEASED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderRejectedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">REJECTED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderStartedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">IN_PROGRESS</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderSuspendedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">SUSPENDED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderResumedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">IN_PROGRESS</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderCompletedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">COMPLETED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">WorkOrderCancelledEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 状態更新ヘルパー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">WorkOrder</span><span class="w"> </span><span class="nf">withStatus</span><span class="p">(</span><span class="n">WorkOrderStatus</span><span class="w"> </span><span class="n">newStatus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrder</span><span class="p">(</span>
<span class="w">                </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">,</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">,</span>
<span class="w">                </span><span class="n">plannedStartDate</span><span class="p">,</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">,</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">,</span><span class="w"> </span><span class="n">newStatus</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: WorkOrderStatus.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造指図ステータス</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">WorkOrderStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CREATED</span><span class="p">,</span><span class="w">      </span><span class="c1">// 作成済み</span>
<span class="w">    </span><span class="n">RELEASED</span><span class="p">,</span><span class="w">     </span><span class="c1">// リリース済み（資材引当完了）</span>
<span class="w">    </span><span class="n">REJECTED</span><span class="p">,</span><span class="w">     </span><span class="c1">// 却下（資材引当失敗）</span>
<span class="w">    </span><span class="n">IN_PROGRESS</span><span class="p">,</span><span class="w">  </span><span class="c1">// 製造中</span>
<span class="w">    </span><span class="n">SUSPENDED</span><span class="p">,</span><span class="w">    </span><span class="c1">// 中断</span>
<span class="w">    </span><span class="n">COMPLETED</span><span class="p">,</span><span class="w">    </span><span class="c1">// 完了</span>
<span class="w">    </span><span class="n">CANCELLED</span><span class="w">     </span><span class="c1">// キャンセル</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>ドメインモデル設計原則：</strong></p>
<table>
<thead>
<tr>
<th>原則</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Axon 非依存</strong></td>
<td>ドメインモデルにフレームワーク依存を持たせない</td>
</tr>
<tr>
<td><strong>イミュータブル</strong></td>
<td>record でイミュータブルに設計</td>
</tr>
<tr>
<td><strong>イベントを返す</strong></td>
<td>状態遷移メソッドはイベントを返す</td>
</tr>
<tr>
<td><strong>最小限のフィールド</strong></td>
<td>状態遷移の判定に必要な最小限のみ保持</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="395-material-bounded-context">39.5 Material Bounded Context（資材・在庫）<a class="headerlink" href="#395-material-bounded-context" title="Permanent link">&para;</a></h3>
<p>部品・原材料の引当・払出・返却を管理します。</p>
<h4 id="_4">イベント定義<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: MaterialEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.material.api.events</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Material イベントの sealed interface</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">MaterialEvent</span><span class="w"> </span><span class="n">permits</span>
<span class="w">        </span><span class="n">MaterialInitializedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">MaterialReservedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">MaterialReservationFailedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">MaterialIssuedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">MaterialReturnedEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">materialId</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: MaterialReservedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.material.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 資材引当成功イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">MaterialReservedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">materialId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">reservedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MaterialEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: MaterialReservationFailedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.material.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 資材引当失敗イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">MaterialReservationFailedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">materialId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">requestedQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">failedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MaterialEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: MaterialIssuedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.material.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 資材払出イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">MaterialIssuedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">materialId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">issuedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">issuedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MaterialEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="_5">ドメインモデル<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: Material.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.material.domain.model.aggregate.material</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.material.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Material ドメインモデル（資材・在庫管理）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">Material</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">materialId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">locationId</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reservations</span><span class="w">  </span><span class="c1">// workOrderId -&gt; quantity</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Material</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservations</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">reservations</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 初期化ファクトリ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Material</span><span class="w"> </span><span class="nf">initial</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">locationId</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">initialQuantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Material</span><span class="p">(</span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">locationId</span><span class="p">,</span><span class="w"> </span><span class="n">initialQuantity</span><span class="p">,</span><span class="w"> </span><span class="n">initialQuantity</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 資材引当（成功または失敗イベントを返す）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MaterialEvent</span><span class="w"> </span><span class="nf">reserve</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reservations</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MaterialReservationFailedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;Work order already has a reservation&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">availableQuantity</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MaterialReservationFailedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;Insufficient material&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MaterialReservedEvent</span><span class="p">(</span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 資材払出（製造開始時）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MaterialIssuedEvent</span><span class="w"> </span><span class="nf">issue</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">issuedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">reservations</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;No reservation found for work order: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MaterialIssuedEvent</span><span class="p">(</span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">issuedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 資材返却（キャンセル時）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MaterialReturnedEvent</span><span class="w"> </span><span class="nf">returnMaterial</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">returnedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MaterialReturnedEvent</span><span class="p">(</span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">returnedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベント適用</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Material</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">MaterialEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MaterialInitializedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">initial</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">materialId</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">locationId</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">initialQuantity</span><span class="p">());</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MaterialReservedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">newReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">reservations</span><span class="p">);</span>
<span class="w">                </span><span class="n">newReservations</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span>
<span class="w">                </span><span class="kd">yield</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Material</span><span class="p">(</span>
<span class="w">                        </span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">locationId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">totalQuantity</span><span class="p">,</span>
<span class="w">                        </span><span class="n">availableQuantity</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">()),</span>
<span class="w">                        </span><span class="n">newReservations</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MaterialReservationFailedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">  </span><span class="c1">// 状態変更なし</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MaterialIssuedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">newReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">reservations</span><span class="p">);</span>
<span class="w">                </span><span class="n">newReservations</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">());</span>
<span class="w">                </span><span class="kd">yield</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Material</span><span class="p">(</span>
<span class="w">                        </span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">locationId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">totalQuantity</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">()),</span>
<span class="w">                        </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">                        </span><span class="n">newReservations</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MaterialReturnedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Material</span><span class="p">(</span>
<span class="w">                    </span><span class="n">materialId</span><span class="p">,</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">locationId</span><span class="p">,</span>
<span class="w">                    </span><span class="n">totalQuantity</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">()),</span>
<span class="w">                    </span><span class="n">availableQuantity</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">()),</span>
<span class="w">                    </span><span class="n">reservations</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="40aggregate-adapter-policy-handler">第40章：Aggregate Adapter と Policy Handler<a class="headerlink" href="#40aggregate-adapter-policy-handler" title="Permanent link">&para;</a></h2>
<h3 id="401-aggregate-adapter">40.1 Aggregate Adapter パターン<a class="headerlink" href="#401-aggregate-adapter" title="Permanent link">&para;</a></h3>
<p>Aggregate Adapter は、純粋なドメインモデルと Axon Framework を繋ぐアダプター層です。フレームワーク固有のアノテーションやライフサイクル処理をドメインモデルから分離します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjUxMHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjE5cHg7aGVpZ2h0OjUxMHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYxOSA1MTAiIHdpZHRoPSI2MTlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTEwIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjE5IiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gTGF5ZXItLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQXBwbGljYXRpb24gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNOC41LDYgTDE0Ny41NjU0LDYgQTMuNzUsMy43NSAwIDAgMSAxNTAuMDY1NCw4LjUgTDE1Ny4wNjU0LDI4LjI5NjkgTDQ3My41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgNDc2LDMwLjc5NjkgTDQ3NiwyMDguNTUgQTIuNSwyLjUgMCAwIDEgNDczLjUsMjExLjA1IEw4LjUsMjExLjA1IEEyLjUsMi41IDAgMCAxIDYsMjA4LjU1IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE1Ny4wNjU0IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM4LjA2NTQiIHg9IjEwIiB5PSIyMC45OTUxIj5BcHBsaWNhdGlvbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgRG9tYWluIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBMYXllciIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDA0Ij48cGF0aCBkPSJNMzA0LjUsMjYwLjA1IEw0MTQuMzA3NiwyNjAuMDUgQTMuNzUsMy43NSAwIDAgMSA0MTYuODA3NiwyNjIuNTUgTDQyMy44MDc2LDI4Mi4zNDY5IEw2MDkuNSwyODIuMzQ2OSBBMi41LDIuNSAwIDAgMSA2MTIsMjg0Ljg0NjkgTDYxMiw0MTMuNyBBMi41LDIuNSAwIDAgMSA2MDkuNSw0MTYuMiBMMzA0LjUsNDE2LjIgQTIuNSwyLjUgMCAwIDEgMzAyLDQxMy43IEwzMDIsMjYyLjU1IEEyLjUsMi41IDAgMCAxIDMwNC41LDI2MC4wNSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzAyIiB4Mj0iNDIzLjgwNzYiIHkxPSIyODIuMzQ2OSIgeTI9IjI4Mi4zNDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC44MDc2IiB4PSIzMDYiIHk9IjI3NS4wNDUxIj5Eb21haW4gTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbGFzcyBXb3JrT3JkZXJBZ2dyZWdhdGVBZGFwdGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQXBwbGljYXRpb24gTGF5ZXIuV29ya09yZGVyQWdncmVnYXRlQWRhcHRlciIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTU0LjA0NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQzOC40NzM2IiB4PSIyMS43NiIgeT0iNDEiLz48ZWxsaXBzZSBjeD0iMTM0LjA1NzQiIGN5PSI2MS4xMzI4IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0xMzcuMDI2MSw2Ni43NzM0IFExMzYuNDQ4LDY3LjA3MDMgMTM1LjgwNzQsNjcuMjEwOSBRMTM1LjE2NjcsNjcuMzY3MiAxMzQuNDYzNiw2Ny4zNjcyIFExMzEuOTYzNiw2Ny4zNjcyIDEzMC42MzU1LDY1LjcyNjYgUTEyOS4zMjMsNjQuMDcwMyAxMjkuMzIzLDYwLjk0NTMgUTEyOS4zMjMsNTcuODIwMyAxMzAuNjM1NSw1Ni4xNjQxIFExMzEuOTYzNiw1NC41MDc4IDEzNC40NjM2LDU0LjUwNzggUTEzNS4xNjY3LDU0LjUwNzggMTM1LjgwNzQsNTQuNjY0MSBRMTM2LjQ2MzYsNTQuODIwMyAxMzcuMDI2MSw1NS4xMTcyIEwxMzcuMDI2MSw1Ny44MzU5IFExMzYuNDAxMSw1Ny4yNTc4IDEzNS44MDc0LDU2Ljk5MjIgUTEzNS4yMTM2LDU2LjcxMDkgMTM0LjU4ODYsNTYuNzEwOSBRMTMzLjI0NDksNTYuNzEwOSAxMzIuNTU3NCw1Ny43ODkxIFExMzEuODY5OSw1OC44NTE2IDEzMS44Njk5LDYwLjk0NTMgUTEzMS44Njk5LDYzLjAzOTEgMTMyLjU1NzQsNjQuMTE3MiBRMTMzLjI0NDksNjUuMTc5NyAxMzQuNTg4Niw2NS4xNzk3IFExMzUuMjEzNiw2NS4xNzk3IDEzNS44MDc0LDY0LjkxNDEgUTEzNi40MDExLDY0LjYzMjggMTM3LjAyNjEsNjQuMDU0NyBMMTM3LjAyNjEsNjYuNzczNCBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODkuNTAyIiB4PSIyMTIuNDk1OCIgeT0iNTcuMTM4NyI+JiMxNzE7QEFnZ3JlZ2F0ZSYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMDUuMzc4OSIgeD0iMTU0LjU1NzQiIHk9IjcyLjk2MzkiPldvcmtPcmRlckFnZ3JlZ2F0ZUFkYXB0ZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjIuNzYiIHgyPSI0NTkuMjMzNiIgeTE9IjgxLjI2NTYiIHkyPSI4MS4yNjU2Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOS43NiIgeT0iOTEuOTE0MSIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzcuODc0IiB4PSI0MS43NiIgeT0iOTguMjYwNyI+d29ya09yZGVySWQ6IFN0cmluZzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI5Ljc2IiB5PSIxMDguMjEwOSIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTkuMzc5OSIgeD0iNDEuNzYiIHk9IjExNC41NTc2Ij53b3JrT3JkZXI6IFdvcmtPcmRlcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMi43NiIgeDI9IjQ1OS4yMzM2IiB5MT0iMTIxLjg1OTQiIHkyPSIxMjEuODU5NCIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX01FVEhPRCI+PGVsbGlwc2UgY3g9IjMyLjc2IiBjeT0iMTM1LjUwNzgiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MDMuOTY5NyIgeD0iNDEuNzYiIHk9IjEzOC44NTQ1Ij5AQ29tbWFuZEhhbmRsZXI6IGhhbmRsZShDcmVhdGVXb3JrT3JkZXJDb21tYW5kKTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19NRVRIT0QiPjxlbGxpcHNlIGN4PSIzMi43NiIgY3k9IjE1MS44MDQ3IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEyLjQ3MzYiIHg9IjQxLjc2IiB5PSIxNTUuMTUxNCI+QENvbW1hbmRIYW5kbGVyOiBoYW5kbGUoUmVsZWFzZVdvcmtPcmRlckNvbW1hbmQpPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX01FVEhPRCI+PGVsbGlwc2UgY3g9IjMyLjc2IiBjeT0iMTY4LjEwMTYiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzODAuMzEwNSIgeD0iNDEuNzYiIHk9IjE3MS40NDgyIj5ARXZlbnRTb3VyY2luZ0hhbmRsZXI6IG9uKFdvcmtPcmRlckNyZWF0ZWRFdmVudCk8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzIuNzYiIGN5PSIxODQuMzk4NCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM4OC44MTQ1IiB4PSI0MS43NiIgeT0iMTg3Ljc0NTEiPkBFdmVudFNvdXJjaW5nSGFuZGxlcjogb24oV29ya09yZGVyUmVsZWFzZWRFdmVudCk8L3RleHQ+PC9nPjwhLS1jbGFzcyBXb3JrT3JkZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJEb21haW4gTGF5ZXIuV29ya09yZGVyIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTA1LjE1NjMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI3OC4wNzUyIiB4PSIzMTcuOTYiIHk9IjI5NS4wNSIvPjxlbGxpcHNlIGN4PSI0MTQuNTk2MiIgY3k9IjMxNS4xODI4IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00MTcuNTY1LDMyMC44MjM0IFE0MTYuOTg2OSwzMjEuMTIwMyA0MTYuMzQ2MiwzMjEuMjYwOSBRNDE1LjcwNTYsMzIxLjQxNzIgNDE1LjAwMjUsMzIxLjQxNzIgUTQxMi41MDI1LDMyMS40MTcyIDQxMS4xNzQ0LDMxOS43NzY2IFE0MDkuODYxOSwzMTguMTIwMyA0MDkuODYxOSwzMTQuOTk1MyBRNDA5Ljg2MTksMzExLjg3MDMgNDExLjE3NDQsMzEwLjIxNDEgUTQxMi41MDI1LDMwOC41NTc4IDQxNS4wMDI1LDMwOC41NTc4IFE0MTUuNzA1NiwzMDguNTU3OCA0MTYuMzQ2MiwzMDguNzE0MSBRNDE3LjAwMjUsMzA4Ljg3MDMgNDE3LjU2NSwzMDkuMTY3MiBMNDE3LjU2NSwzMTEuODg1OSBRNDE2Ljk0LDMxMS4zMDc4IDQxNi4zNDYyLDMxMS4wNDIyIFE0MTUuNzUyNSwzMTAuNzYwOSA0MTUuMTI3NSwzMTAuNzYwOSBRNDEzLjc4MzcsMzEwLjc2MDkgNDEzLjA5NjIsMzExLjgzOTEgUTQxMi40MDg3LDMxMi45MDE2IDQxMi40MDg3LDMxNC45OTUzIFE0MTIuNDA4NywzMTcuMDg5MSA0MTMuMDk2MiwzMTguMTY3MiBRNDEzLjc4MzcsMzE5LjIyOTcgNDE1LjEyNzUsMzE5LjIyOTcgUTQxNS43NTI1LDMxOS4yMjk3IDQxNi4zNDYyLDMxOC45NjQxIFE0MTYuOTQsMzE4LjY4MjggNDE3LjU2NSwzMTguMTA0NyBMNDE3LjU2NSwzMjAuODIzNCBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmb250LXN0eWxlPSJpdGFsaWMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTMuNDkwMiIgeD0iNDQ2LjUwMjUiIHk9IjMxMS4xODg3Ij4mIzE3MTtyZWNvcmQmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzYuMzAyNyIgeD0iNDM1LjA5NjIiIHk9IjMyNy4wMTM5Ij5Xb3JrT3JkZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzE4Ljk2IiB4Mj0iNTk1LjAzNTIiIHkxPSIzMzUuMzE1NiIgeTI9IjMzNS4zMTU2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzE4Ljk2IiB4Mj0iNTk1LjAzNTIiIHkxPSIzNDMuMzE1NiIgeTI9IjM0My4zMTU2Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzI4Ljk2IiBjeT0iMzU2Ljk2NDEiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzYuOTYwOSIgeD0iMzM3Ljk2IiB5PSIzNjAuMzEwNyI+Y3JlYXRlKCk6IFdvcmtPcmRlckNyZWF0ZWRFdmVudDwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19NRVRIT0QiPjxlbGxpcHNlIGN4PSIzMjguOTYiIGN5PSIzNzMuMjYwOSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1Mi4wNzUyIiB4PSIzMzcuOTYiIHk9IjM3Ni42MDc2Ij5yZWxlYXNlKCk6IFdvcmtPcmRlclJlbGVhc2VkRXZlbnQ8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzI4Ljk2IiBjeT0iMzg5LjU1NzgiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzQuNzk0OSIgeD0iMzM3Ljk2IiB5PSIzOTIuOTA0NSI+YXBwbHkoZXZlbnQpOiBXb3JrT3JkZXI8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjciIGRhdGEtc291cmNlLWxpbmU9IjI1IiBpZD0iZW50MDAwOCI+PHBhdGggZD0iTTY5LjUyLDMyNy40OSBMNjkuNTIsMzY3Ljc1NTYgQTAsMCAwIDAgMCA2OS41MiwzNjcuNzU1NiBMMjgyLjQ3MzIsMzY3Ljc1NTYgQTAsMCAwIDAgMCAyODIuNDczMiwzNjcuNzU1NiBMMjgyLjQ3MzIsMzM3LjQ5IEwyNzIuNDczMiwzMjcuNDkgTDE4NS41MSwzMjcuNDkgTDIxOS4xOCwxOTUuNDUgTDE3Ny41MSwzMjcuNDkgTDY5LjUyLDMyNy40OSBBMCwwIDAgMCAwIDY5LjUyLDMyNy40OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTI3Mi40NzMyLDMyNy40OSBMMjcyLjQ3MzIsMzM3LjQ5IEwyODIuNDczMiwzMzcuNDkgTDI3Mi40NzMyLDMyNy40OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkxLjk1MzIiIHg9Ijc1LjUyIiB5PSIzNDQuNTU2OSI+QXhvbiBGcmFtZXdvcmsgJiMyOTk5MjsmIzEyNDUwOyYjMTI0ODA7JiMxMjUwMzsmIzEyNDc5OyYjMTI1NDA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Ni4wMDAyIiB4PSI3NS41MiIgeT0iMzU5LjY4OTciPiYjMTI1MDE7JiMxMjUyNDsmIzEyNTQwOyYjMTI1MTI7JiMxMjUyNzsmIzEyNTQwOyYjMTI0NjM7JiMyMDM4MTsmIzIzMzg0OyYjMTI0MzQ7JiMyMTU2MDsmIzIxNDU0OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMTAiIGRhdGEtc291cmNlLWxpbmU9IjMwIiBpZD0iZW50MDAxMSI+PHBhdGggZD0iTTM4MS41LDQ2My4yIEwzODEuNSw1MDMuNDY1NiBBMCwwIDAgMCAwIDM4MS41LDUwMy40NjU2IEw1MzIuNTAwMiw1MDMuNDY1NiBBMCwwIDAgMCAwIDUzMi41MDAyLDUwMy40NjU2IEw1MzIuNTAwMiw0NzMuMiBMNTIyLjUwMDIsNDYzLjIgTDQ2MSw0NjMuMiBMNDU3LDQwMC4zMiBMNDUzLDQ2My4yIEwzODEuNSw0NjMuMiBBMCwwIDAgMCAwIDM4MS41LDQ2My4yIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTIyLjUwMDIsNDYzLjIgTDUyMi41MDAyLDQ3My4yIEw1MzIuNTAwMiw0NzMuMiBMNTIyLjUwMDIsNDYzLjIiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC4wMDAyIiB4PSIzODcuNSIgeT0iNDgwLjI2NjkiPiYjMzIwMjA7JiMzMTg4MzsmIzEyMzk0OyYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjUxNDsmIzEyNDg3OyYjMTI1MjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNC45MTE3IiB4PSIzODcuNSIgeT0iNDk1LjM5OTciPkF4b24gJiMxMjM5NTsmIzIwMzgxOyYjMjMzODQ7JiMxMjM3NTsmIzEyMzk0OyYjMTIzNTY7PC90ZXh0PjwvZz48IS0tbGluayBXb3JrT3JkZXJBZ2dyZWdhdGVBZGFwdGVyIHRvIFdvcmtPcmRlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjIiIGlkPSJsbms2Ij48cGF0aCBjb2RlTGluZT0iMjIiIGQ9Ik0zMTMuNTMsMTk1LjQ1IEMzNDQuNTMsMjI4LjEyIDM3NS43OTkyLDI2MS4wNjg0IDQwMy42NzkyLDI5MC40Mzg0IiBmaWxsPSJub25lIiBpZD0iV29ya09yZGVyQWdncmVnYXRlQWRhcHRlci10by1Xb3JrT3JkZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwNy44MSwyOTQuNzksNDA0LjUxNDgsMjg1LjUwODcsNDA0LjM2NzYsMjkxLjE2MzcsMzk4LjcxMjcsMjkxLjAxNjUsNDA3LjgxLDI5NC43OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2IiB4PSIzNTYuNDgiIHk9IjI0MC4xMTY5Ij4mIzIyOTk2OyYjMzU2OTg7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBaTDlUSW05MTU3c1ZOdDZuNXFOeTBvQUlNNTRHMUZkR3l4V3hST2t4Q3lrdUxYOTF4V0dIR0tLT3pIOUsxNEtiV2xOR0d6SUZrT2R6WjZSTmhuS29PWFl1cDlucHAtN1NNd3RPdEFFSWtiMmNIaU1JZWlSRGVkMjRYOWM1LVYwR3VrYUZRWjU4NTNwRmlHdGdzdUIzQ2dxcGNPMFRPWllxTWVLcjhJaWhxY0lvTzVjSU1USGQxUER3RmZFR295N2l3MTdvVUt0OW1ET0dsY0hjZVVIQmNybG5yLW91N3FkM1I1NnVCa05jZWh2RS1CYUg1U2NZUEJoYjIzYjBmVnZXaDNBN3FVaGxiRmJEbmxzSWc0YjNjbmFIMUstRXFQNlU2RzdfSUhhODNaY3gtZXBaZDFDa2pRU2Q2SU9kY0k2YXNLeWozS1BhODljQW5IRnRmMTZvaHBTMWNWMldDTEhGaVB2YWFRRHVxOTZ2d05GQ1BGOG5ScmI4VEUtUnR3ckVXWDBrejYzQm1sVTUyczl6LVlnR21oUFVkME16UW9vU0RGSVEzblpTZWpmM1RPNzE5d2Z0V2tlU3JSRWtLNXNaUWVUNXFGeHdrRWdzQlo0dXd2dy1USy1FMlVDY1g5aEpiS2RsalRkaDc2N1o0VEtYZ1hpQ3hiMnplRDlZMXdZVS1hUW15SkpldEJXOGFPdHpLVVNWPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="402-workorder-aggregate-adapter">40.2 WorkOrder Aggregate Adapter<a class="headerlink" href="#402-workorder-aggregate-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderAggregateAdapter.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder.WorkOrder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder.WorkOrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.CommandHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.EventSourcingHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateLifecycle</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.spring.stereotype.Aggregate</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder Aggregate Adapter（Axon Framework 用）</span>
<span class="cm"> */</span>
<span class="nd">@Aggregate</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorkOrderAggregateAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@AggregateIdentifier</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">WorkOrder</span><span class="w"> </span><span class="n">workOrder</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Axon が使用するデフォルトコンストラクタ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="nf">WorkOrderAggregateAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Command Handlers ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 集約作成コマンドハンドラー（コンストラクタ）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WorkOrderAggregateAdapter</span><span class="p">(</span><span class="n">CreateWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ドメインモデルのファクトリメソッドを呼び出し</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WorkOrder</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">itemName</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">unitOfMeasure</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">plannedStartDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">plannedEndDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">workCenterId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">createdBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// イベントを発行</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * リリースコマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ReleaseWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">release</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">releasedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 却下コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">RejectWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">reject</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 製造開始コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">StartWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">operatorId</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 中断コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">SuspendWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">suspend</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">suspendedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 再開コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ResumeWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">resume</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">resumedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 完了コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">CompleteWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">complete</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">completedQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">defectQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">operatorId</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセルコマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">CancelWorkOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">cancel</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Event Sourcing Handlers（状態復元）========</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WorkOrder</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderReleasedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderStartedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderSuspendedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderResumedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCompletedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrder</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>Axon アノテーション解説：</strong></p>
<table>
<thead>
<tr>
<th>アノテーション</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Aggregate</code></td>
<td>Event Sourcing 集約であることを宣言</td>
</tr>
<tr>
<td><code>@AggregateIdentifier</code></td>
<td>集約の識別子フィールド</td>
</tr>
<tr>
<td><code>@CommandHandler</code></td>
<td>コマンドを処理するメソッド</td>
</tr>
<tr>
<td><code>@EventSourcingHandler</code></td>
<td>イベントから状態を復元するメソッド</td>
</tr>
<tr>
<td><code>AggregateLifecycle.apply()</code></td>
<td>イベントを発行するメソッド</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="403-material-aggregate-adapter">40.3 Material Aggregate Adapter<a class="headerlink" href="#403-material-aggregate-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: MaterialAggregateAdapter.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.material.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.material.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.material.domain.model.aggregate.material.Material</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.material.domain.model.aggregate.material.MaterialCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.CommandHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.EventSourcingHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateLifecycle</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.spring.stereotype.Aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Material Aggregate Adapter</span>
<span class="cm"> */</span>
<span class="nd">@Aggregate</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MaterialAggregateAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@AggregateIdentifier</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">materialId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Material</span><span class="w"> </span><span class="n">material</span><span class="p">;</span>

<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="nf">MaterialAggregateAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MaterialAggregateAdapter</span><span class="p">(</span><span class="n">InitializeMaterialCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MaterialInitializedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">materialId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">locationId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">initialQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ReserveMaterialCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="na">reserve</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">IssueMaterialCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="na">issue</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">issuedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ReturnMaterialCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="na">returnMaterial</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">returnedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">MaterialInitializedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">materialId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">materialId</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Material</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">materialId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">locationId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">initialQuantity</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">MaterialReservedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">MaterialReservationFailedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 状態変更なし</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">MaterialIssuedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">MaterialReturnedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">material</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="404-policy-handlerchoreography">40.4 Policy Handler（Choreography パターン）<a class="headerlink" href="#404-policy-handlerchoreography" title="Permanent link">&para;</a></h3>
<p>Policy Handler は、他の Bounded Context から発行されたイベントを購読し、自律的に反応する処理を実装します。Choreography パターンでは、各 Context が独立して動作し、イベントを介して連携します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjgyN3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjgwcHg7aGVpZ2h0OjgyN3B4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY4MCA4MjciIHdpZHRoPSI2ODBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iODI3IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjgwIiB4PSIwIiB5PSIwIi8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyMzIuNzM0NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNjIxLjQ4OTMiIHg9IjEwIiB5PSIxOTYuODI4MSIvPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iV29ya09yZGVyIiBpZD0icGFydDEtbGlmZWxpbmUiPjxnPjx0aXRsZT5Xb3JrT3JkZXIgQ29udGV4dDwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9Ijc1NS41OTM4IiB3aWR0aD0iOCIgeD0iOTAuOTIxOSIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9Ijk0IiB4Mj0iOTQiIHkxPSIzNi4yOTY5IiB5Mj0iNzkxLjg5MDYiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MiIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQnVzIiBpZD0icGFydDItbGlmZWxpbmUiPjxnPjx0aXRsZT5FdmVudCBCdXM8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI3NTUuNTkzOCIgd2lkdGg9IjgiIHg9IjMyMS42MDE2IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMzI1LjQzNzUiIHgyPSIzMjUuNDM3NSIgeTE9IjM2LjI5NjkiIHkyPSI3OTEuODkwNiIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJNYXRlcmlhbCIgaWQ9InBhcnQzLWxpZmVsaW5lIj48Zz48dGl0bGU+TWF0ZXJpYWwgQ29udGV4dDwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9Ijc1NS41OTM4IiB3aWR0aD0iOCIgeD0iNTUyLjI4MTMiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI1NTYuMDczMiIgeDI9IjU1Ni4wNzMyIiB5MT0iMzYuMjk2OSIgeTI9Ijc5MS44OTA2Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iV29ya09yZGVyIiBpZD0icGFydDEtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDkuODQzOCIgeD0iMjAiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzUuODQzOCIgeD0iMjciIHk9IjI0Ljk5NTEiPldvcmtPcmRlciBDb250ZXh0PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iV29ya09yZGVyIiBpZD0icGFydDEtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDkuODQzOCIgeD0iMjAiIHk9Ijc5MC44OTA2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM1Ljg0MzgiIHg9IjI3IiB5PSI4MTAuODg1NyI+V29ya09yZGVyIENvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJCdXMiIGlkPSJwYXJ0Mi1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0LjMyODEiIHg9IjI4My40Mzc1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjkwLjQzNzUiIHk9IjI0Ljk5NTEiPkV2ZW50IEJ1czwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkJ1cyIgaWQ9InBhcnQyLXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODQuMzI4MSIgeD0iMjgzLjQzNzUiIHk9Ijc5MC44OTA2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjkwLjQzNzUiIHk9IjgxMC44ODU3Ij5FdmVudCBCdXM8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJNYXRlcmlhbCIgaWQ9InBhcnQzLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMwLjQxNiIgeD0iNDkxLjA3MzIiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuNDE2IiB4PSI0OTguMDczMiIgeT0iMjQuOTk1MSI+TWF0ZXJpYWwgQ29udGV4dDwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ik1hdGVyaWFsIiBpZD0icGFydDMtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzAuNDE2IiB4PSI0OTEuMDczMiIgeT0iNzkwLjg5MDYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuNDE2IiB4PSI0OTguMDczMiIgeT0iODEwLjg4NTciPk1hdGVyaWFsIENvbnRleHQ8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjY3My41MDA1IiB4PSIwIiB5PSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI2NzMuNTAwNSIgeTE9IjY2Ljg2MzMiIHkyPSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI2NzMuNTAwNSIgeTE9IjY5Ljg2MzMiIHkyPSI2OS44NjMzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMTM1LjUyNiIgeD0iMjY4Ljk4NzIiIHk9IjU2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjI3NC45ODcyIiB5PSI3Mi4zNjM4Ij4mIzM1MDY5OyYjMzY4OTY7JiMyNTM1MTsmIzIyMjU5OyYjMjAzMTY7JiMyNTEwNDsmIzEyNTAxOyYjMTI1MjU7JiMxMjU0MDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzEiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzEzLjYwMTYsMTA2LjU2MjUsMzIzLjYwMTYsMTEwLjU2MjUsMzEzLjYwMTYsMTE0LjU2MjUsMzE3LjYwMTYsMTEwLjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iOTQuOTIxOSIgeDI9IjMxOS42MDE2IiB5MT0iMTEwLjU2MjUiIHkyPSIxMTAuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OS44Mjc2IiB4PSIxMDEuOTIxOSIgeT0iMTA1LjQ5NjYiPldvcmtPcmRlckNyZWF0ZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzIiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTQ0LjI4MTMsMTM1LjY5NTMsNTU0LjI4MTMsMTM5LjY5NTMsNTQ0LjI4MTMsMTQzLjY5NTMsNTQ4LjI4MTMsMTM5LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzI1LjYwMTYiIHgyPSI1NTAuMjgxMyIgeTE9IjEzOS42OTUzIiB5Mj0iMTM5LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTkuODI3NiIgeD0iMzMyLjYwMTYiIHk9IjEzNC42Mjk0Ij5Xb3JrT3JkZXJDcmVhdGVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2czIj48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTU2LjI4MTMiIHgyPSI1OTguMjgxMyIgeTE9IjE2OC44MjgxIiB5Mj0iMTY4LjgyODEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTk4LjI4MTMiIHgyPSI1OTguMjgxMyIgeTE9IjE2OC44MjgxIiB5Mj0iMTgxLjgyODEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTU3LjI4MTMiIHgyPSI1OTguMjgxMyIgeTE9IjE4MS44MjgxIiB5Mj0iMTgxLjgyODEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU2Ny4yODEzLDE3Ny44MjgxLDU1Ny4yODEzLDE4MS44MjgxLDU2Ny4yODEzLDE4NS44MjgxLDU2My4yODEzLDE4MS44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTkuMjkzNSIgeD0iNTYzLjI4MTMiIHk9IjE2My43NjIyIj5yZXNlcnZlKCk8L3RleHQ+PC9nPjxwYXRoIGQ9Ik0xMCwxOTYuODI4MSBMNzQuNDQyOSwxOTYuODI4MSBMNzQuNDQyOSwyMDMuOTYwOSBMNjQuNDQyOSwyMTMuOTYwOSBMMTAsMjEzLjk2MDkgTDEwLDE5Ni44MjgxIiBmaWxsPSIjRUVFRUVFIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIzMi43MzQ0IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2MjEuNDg5MyIgeD0iMTAiIHk9IjE5Ni44MjgxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5LjQ0MjkiIHg9IjI1IiB5PSIyMDkuODk1Ij5hbHQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU0LjA1NDQiIHg9Ijg5LjQ0MjkiIHk9IjIwOS4wMzg2Ij5bJiMzNjAzOTsmIzI2NDQ4OyYjMTIzNTQ7JiMxMjQyNjtdPC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMzNi42MDE2LDIzMS4wOTM4LDMyNi42MDE2LDIzNS4wOTM4LDMzNi42MDE2LDIzOS4wOTM4LDMzMi42MDE2LDIzNS4wOTM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMzMC42MDE2IiB4Mj0iNTU1LjI4MTMiIHkxPSIyMzUuMDkzOCIgeTI9IjIzNS4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUxLjE0NCIgeD0iMzQyLjYwMTYiIHk9IjIzMC4wMjc4Ij5NYXRlcmlhbFJlc2VydmVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDEiIGlkPSJtc2c1Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwNS45MjE5LDI2MC4yMjY2LDk1LjkyMTksMjY0LjIyNjYsMTA1LjkyMTksMjY4LjIyNjYsMTAxLjkyMTksMjY0LjIyNjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iOTkuOTIxOSIgeDI9IjMyNC42MDE2IiB5MT0iMjY0LjIyNjYiIHkyPSIyNjQuMjI2NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MS4xNDQiIHg9IjExMS45MjE5IiB5PSIyNTkuMTYwNiI+TWF0ZXJpYWxSZXNlcnZlZEV2ZW50PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDEiIGRhdGEtZW50aXR5LTI9InBhcnQxIiBpZD0ibXNnNiI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijk0LjkyMTkiIHgyPSIxMzYuOTIxOSIgeTE9IjI5My4zNTk0IiB5Mj0iMjkzLjM1OTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTM2LjkyMTkiIHgyPSIxMzYuOTIxOSIgeTE9IjI5My4zNTk0IiB5Mj0iMzA2LjM1OTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iOTUuOTIxOSIgeDI9IjEzNi45MjE5IiB5MT0iMzA2LjM1OTQiIHkyPSIzMDYuMzU5NCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTA1LjkyMTksMzAyLjM1OTQsOTUuOTIxOSwzMDYuMzU5NCwxMDUuOTIxOSwzMTAuMzU5NCwxMDEuOTIxOSwzMDYuMzU5NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3LjgzMzUiIHg9IjEwMS45MjE5IiB5PSIyODguMjkzNSI+cmVsZWFzZSgpPC90ZXh0PjwvZz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iMTAiIHgyPSI2MzEuNDg5MyIgeTE9IjMxNS4zNTk0IiB5Mj0iMzE1LjM1OTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuMDU0NCIgeD0iMTUiIHk9IjMyNS41Njk4Ij5bJiMzNjAzOTsmIzI2NDQ4OyYjMTk5ODE7JiMzNjI3NTtdPC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2c3Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMzNi42MDE2LDM0Ni4yOTY5LDMyNi42MDE2LDM1MC4yOTY5LDMzNi42MDE2LDM1NC4yOTY5LDMzMi42MDE2LDM1MC4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMzMC42MDE2IiB4Mj0iNTU1LjI4MTMiIHkxPSIzNTAuMjk2OSIgeTI9IjM1MC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjA2LjY3OTciIHg9IjM0Mi42MDE2IiB5PSIzNDUuMjMxIj5NYXRlcmlhbFJlc2VydmF0aW9uRmFpbGVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDEiIGlkPSJtc2c4Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwNS45MjE5LDM3NS40Mjk3LDk1LjkyMTksMzc5LjQyOTcsMTA1LjkyMTksMzgzLjQyOTcsMTAxLjkyMTksMzc5LjQyOTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iOTkuOTIxOSIgeDI9IjMyNC42MDE2IiB5MT0iMzc5LjQyOTciIHkyPSIzNzkuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwNi42Nzk3IiB4PSIxMTEuOTIxOSIgeT0iMzc0LjM2MzgiPk1hdGVyaWFsUmVzZXJ2YXRpb25GYWlsZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzkiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI5NC45MjE5IiB4Mj0iMTM2LjkyMTkiIHkxPSI0MDguNTYyNSIgeTI9IjQwOC41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEzNi45MjE5IiB4Mj0iMTM2LjkyMTkiIHkxPSI0MDguNTYyNSIgeTI9IjQyMS41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijk1LjkyMTkiIHgyPSIxMzYuOTIxOSIgeTE9IjQyMS41NjI1IiB5Mj0iNDIxLjU2MjUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwNS45MjE5LDQxNy41NjI1LDk1LjkyMTksNDIxLjU2MjUsMTA1LjkyMTksNDI1LjU2MjUsMTAxLjkyMTksNDIxLjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0Ny4zNDA4IiB4PSIxMDEuOTIxOSIgeT0iNDAzLjQ5NjYiPnJlamVjdCgpPC90ZXh0PjwvZz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjMiIHN0eWxlPSJzdHJva2U6I0VFRUVFRTtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2NzMuNTAwNSIgeD0iMCIgeT0iNDU3LjEyODkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9IjY3My41MDA1IiB5MT0iNDU3LjEyODkiIHkyPSI0NTcuMTI4OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiIHgxPSIwIiB4Mj0iNjczLjUwMDUiIHkxPSI0NjAuMTI4OSIgeTI9IjQ2MC4xMjg5Ii8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMTA5LjUyNiIgeD0iMjgxLjk4NzMiIHk9IjQ0Ni41NjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjI4Ny45ODczIiB5PSI0NjIuNjI5NCI+JiMzNTA2OTsmIzM2ODk2OyYjMzgyODM7JiMyMjk4NzsmIzEyNTAxOyYjMTI1MjU7JiMxMjU0MDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzEwIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMxMy42MDE2LDQ5Ni44MjgxLDMyMy42MDE2LDUwMC44MjgxLDMxMy42MDE2LDUwNC44MjgxLDMxNy42MDE2LDUwMC44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijk0LjkyMTkiIHgyPSIzMTkuNjAxNiIgeTE9IjUwMC44MjgxIiB5Mj0iNTAwLjgyODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTYuMTAxNiIgeD0iMTAxLjkyMTkiIHk9IjQ5NS43NjIyIj5Xb3JrT3JkZXJTdGFydGVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cxMSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NDQuMjgxMyw1MjUuOTYwOSw1NTQuMjgxMyw1MjkuOTYwOSw1NDQuMjgxMyw1MzMuOTYwOSw1NDguMjgxMyw1MjkuOTYwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMjUuNjAxNiIgeDI9IjU1MC4yODEzIiB5MT0iNTI5Ljk2MDkiIHkyPSI1MjkuOTYwOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Ni4xMDE2IiB4PSIzMzIuNjAxNiIgeT0iNTI0Ljg5NSI+V29ya09yZGVyU3RhcnRlZEV2ZW50PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQzIiBpZD0ibXNnMTIiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1NTYuMjgxMyIgeDI9IjU5OC4yODEzIiB5MT0iNTU5LjA5MzgiIHkyPSI1NTkuMDkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1OTguMjgxMyIgeDI9IjU5OC4yODEzIiB5MT0iNTU5LjA5MzgiIHkyPSI1NzIuMDkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1NTcuMjgxMyIgeDI9IjU5OC4yODEzIiB5MT0iNTcyLjA5MzgiIHkyPSI1NzIuMDkzOCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTY3LjI4MTMsNTY4LjA5MzgsNTU3LjI4MTMsNTcyLjA5MzgsNTY3LjI4MTMsNTc2LjA5MzgsNTYzLjI4MTMsNTcyLjA5MzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0My41Mzg2IiB4PSI1NjMuMjgxMyIgeT0iNTU0LjAyNzgiPmlzc3VlKCk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxMyI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMzYuNjAxNiw1OTcuMjI2NiwzMjYuNjAxNiw2MDEuMjI2NiwzMzYuNjAxNiw2MDUuMjI2NiwzMzIuNjAxNiw2MDEuMjI2NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMzAuNjAxNiIgeDI9IjU1NS4yODEzIiB5MT0iNjAxLjIyNjYiIHkyPSI2MDEuMjI2NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS45MjMzIiB4PSIzNDIuNjAxNiIgeT0iNTk2LjE2MDYiPk1hdGVyaWFsSXNzdWVkRXZlbnQ8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjY3My41MDA1IiB4PSIwIiB5PSI2MjkuNzkzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI2NzMuNTAwNSIgeTE9IjYyOS43OTMiIHkyPSI2MjkuNzkzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI2NzMuNTAwNSIgeTE9IjYzMi43OTMiIHkyPSI2MzIuNzkzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMTIyLjUyNiIgeD0iMjc1LjQ4NzIiIHk9IjYxOS4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIyODEuNDg3MiIgeT0iNjM1LjI5MzUiPiYjMTI0NjE7JiMxMjUxNTsmIzEyNTMxOyYjMTI0NzU7JiMxMjUyMzsmIzEyNTAxOyYjMTI1MjU7JiMxMjU0MDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzE0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMxMy42MDE2LDY2OS40OTIyLDMyMy42MDE2LDY3My40OTIyLDMxMy42MDE2LDY3Ny40OTIyLDMxNy42MDE2LDY3My40OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijk0LjkyMTkiIHgyPSIzMTkuNjAxNiIgeTE9IjY3My40OTIyIiB5Mj0iNjczLjQ5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzEuOTk2MSIgeD0iMTAxLjkyMTkiIHk9IjY2OC40MjYzIj5Xb3JrT3JkZXJDYW5jZWxsZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzE1Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU0NC4yODEzLDY5OC42MjUsNTU0LjI4MTMsNzAyLjYyNSw1NDQuMjgxMyw3MDYuNjI1LDU0OC4yODEzLDcwMi42MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzI1LjYwMTYiIHgyPSI1NTAuMjgxMyIgeTE9IjcwMi42MjUiIHkyPSI3MDIuNjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTcxLjk5NjEiIHg9IjMzMi42MDE2IiB5PSI2OTcuNTU5MSI+V29ya09yZGVyQ2FuY2VsbGVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cxNiI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU1Ni4yODEzIiB4Mj0iNTk4LjI4MTMiIHkxPSI3MzEuNzU3OCIgeTI9IjczMS43NTc4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU5OC4yODEzIiB4Mj0iNTk4LjI4MTMiIHkxPSI3MzEuNzU3OCIgeTI9Ijc0NC43NTc4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU1Ny4yODEzIiB4Mj0iNTk4LjI4MTMiIHkxPSI3NDQuNzU3OCIgeTI9Ijc0NC43NTc4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NjcuMjgxMyw3NDAuNzU3OCw1NTcuMjgxMyw3NDQuNzU3OCw1NjcuMjgxMyw3NDguNzU3OCw1NjMuMjgxMyw3NDQuNzU3OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMy4yMTkyIiB4PSI1NjMuMjgxMyIgeT0iNzI2LjY5MTkiPnJldHVybk1hdGVyaWFsKCk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxNyI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMzYuNjAxNiw3NjkuODkwNiwzMjYuNjAxNiw3NzMuODkwNiwzMzYuNjAxNiw3NzcuODkwNiwzMzIuNjAxNiw3NzMuODkwNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMzAuNjAxNiIgeDI9IjU1NS4yODEzIiB5MT0iNzczLjg5MDYiIHkyPSI3NzMuODkwNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MC4yNTU0IiB4PSIzNDIuNjAxNiIgeT0iNzY4LjgyNDciPk1hdGVyaWFsUmV0dXJuZWRFdmVudDwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgWlA4X0ltQ241QzN0VjhmRzVudHkwaTh2TTVmbTRBNEVwbDdrOFY1WWhZSXZ1Z1h0R3lLZ1RENTUxUTYzV3BXVEk0N3hRVEFNemJrT3pDLXJHUXVVRG1KVS14cnRsLUd6NkxCVTk4OVN1WkZZWC1TWVlkYkdaTFdheTVRelBaLTRKNWZIZHBPOUx4WG82ZWRtTTBHV1MzTlkyZ3ZLMUhFOXl3V0JycmZXWmVET3BZMXBra2FaZWExR21mbk1vbzEyZGVTZGxTN3EtY3J5dG51elB5RjFvX1lzZ3pEN2ROeGd6MFR4N2JoOXhFeFJ6ZFhsUEw4TE8zZTVDbUxhU21SOVZyWjR2TzBCMnYwV01oMnpXbVhKVTlBcm53elRWUEZldkN3ZmMxaWk4dXJ2YU1rbUNZdTJkSmtqdW04TzQ2YWJXNGJPTTBweDN2RWx4NXlCZWNaNHd1SW9xWmZfQVpQdU5PMmxoMU9GcmVPc1ZVZ0N0WmtibnRNWXA2UUs2OVYzNU9vQklYZFJUb2YtYktEQkI5Zk9QUHFPbnZ2RUN2cnl3X0laXzk4SHhXRFpQVFJDOUdpTkpTTTJCbUNSaHoyT2VPai1sbTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="405-workordereventhandlermaterial-context">40.5 WorkOrderEventHandler（Material Context 内）<a class="headerlink" href="#405-workordereventhandlermaterial-context" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderEventHandler.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.material.application.policy</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.material.domain.model.aggregate.material.MaterialCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events.WorkOrderCancelledEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events.WorkOrderCreatedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events.WorkOrderStartedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder イベントに反応して資材操作を実行する Policy Handler</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorkOrderEventHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WorkOrderEventHandler</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When a work order is created, reserve material&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// BOM に基づいて必要な資材を引当</span>
<span class="w">        </span><span class="c1">// 簡略化のため、単一の資材を引当</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReserveMaterialCommand</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;material-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span><span class="w">  </span><span class="c1">// 資材ID（簡略化）</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When a work order is started, issue material&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderStartedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 製造開始時に資材を払出</span>
<span class="w">        </span><span class="c1">// 実際には workOrderId から必要な資材を取得</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IssueMaterialCommand</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;material-default&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// 資材ID（簡略化）</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ONE</span><span class="p">,</span><span class="w">  </span><span class="c1">// 数量（簡略化）</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">operatorId</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When a work order is cancelled, return material&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReturnMaterialCommand</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;material-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ONE</span><span class="p">,</span><span class="w">  </span><span class="c1">// 数量（簡略化）</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="406-materialeventhandlerworkorder-context">40.6 MaterialEventHandler（WorkOrder Context 内）<a class="headerlink" href="#406-materialeventhandlerworkorder-context" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: MaterialEventHandler.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.application.policy</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.material.api.events.MaterialReservationFailedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.material.api.events.MaterialReservedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder.WorkOrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Material イベントに反応して製造指図状態を更新する Policy Handler</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MaterialEventHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MaterialEventHandler</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When material is reserved, release the work order&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">MaterialReservedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReleaseWorkOrderCommand</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;system&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When material reservation fails, reject the work order&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">MaterialReservationFailedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RejectWorkOrderCommand</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>Policy Handler の設計原則：</strong></p>
<table>
<thead>
<tr>
<th>原則</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>単一責任</strong></td>
<td>1 つの Policy Handler は 1 つの関心事のみを扱う</td>
</tr>
<tr>
<td><strong>疎結合</strong></td>
<td>他の Context のイベントを購読し、自 Context のコマンドを発行</td>
</tr>
<tr>
<td><strong>自律性</strong></td>
<td>他のサービスに依存せず独立して動作</td>
</tr>
<tr>
<td><strong>冪等性</strong></td>
<td>同じイベントを複数回受信しても問題ないよう設計</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="41projection-read-model">第41章：Projection と Read Model<a class="headerlink" href="#41projection-read-model" title="Permanent link">&para;</a></h2>
<h3 id="411-projection">41.1 Projection の役割<a class="headerlink" href="#411-projection" title="Permanent link">&para;</a></h3>
<p>Projection は、イベントを購読して Read Model（クエリ用のデータモデル）を更新するコンポーネントです。CQRS では、書き込みモデル（Event Store）と読み取りモデル（Read Model DB）を分離し、それぞれに最適化されたデータ構造を使用します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjUzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzYxcHg7aGVpZ2h0OjUzNHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc2MSA1MzQiIHdpZHRoPSI3NjFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTM0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNzYxIiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDSCIgaWQ9InBhcnQxLWxpZmVsaW5lIj48Zz48dGl0bGU+Q29tbWFuZEhhbmRsZXI8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjcxLjU0IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNzUiIHgyPSI3NSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJFUyIgaWQ9InBhcnQyLWxpZmVsaW5lIj48Zz48dGl0bGU+RXZlbnQgU3RvcmU8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjIwMC4wMTM3IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMjAzLjA4MDEiIHgyPSIyMDMuMDgwMSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJQIiBpZD0icGFydDMtbGlmZWxpbmUiPjxnPjx0aXRsZT5Qcm9qZWN0aW9uPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSIzMDIuMDEzOCIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjMwNS4xMjMxIiB4Mj0iMzA1LjEyMzEiIHkxPSIzNi4yOTY5IiB5Mj0iNDk5LjI4OTEiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NCIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iTUIiIGlkPSJwYXJ0NC1saWZlbGluZSI+PGc+PHRpdGxlPk15QmF0aXMgTWFwcGVyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSI0MTcuMTQwMiIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjQyMC45MDQ0IiB4Mj0iNDIwLjkwNDQiIHkxPSIzNi4yOTY5IiB5Mj0iNDk5LjI4OTEiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iREIiIGlkPSJwYXJ0NS1saWZlbGluZSI+PGc+PHRpdGxlPlJlYWQgTW9kZWwgREI8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjU1MC45MzkxIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNTU0LjM3NjEiIHgyPSI1NTQuMzc2MSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ2IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJSQyIgaWQ9InBhcnQ2LWxpZmVsaW5lIj48Zz48dGl0bGU+UkVTVCBDb250cm9sbGVyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSI2ODMuMzE5NCIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjY4Ni41MDIiIHgyPSI2ODYuNTAyIiB5MT0iMzYuMjk2OSIgeTI9IjQ5OS4yODkxIi8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ0giIGlkPSJwYXJ0MS1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MS4wODAxIiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3LjA4MDEiIHg9IjEyIiB5PSIyNC45OTUxIj5Db21tYW5kSGFuZGxlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNIIiBpZD0icGFydDEtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDEuMDgwMSIgeD0iNSIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjcuMDgwMSIgeD0iMTIiIHk9IjUxOC4yODQyIj5Db21tYW5kSGFuZGxlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkVTIiBpZD0icGFydDItaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5NS44NjcyIiB4PSIxNTYuMDgwMSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjE2My4wODAxIiB5PSIyNC45OTUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkVTIiBpZD0icGFydDItdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5NS44NjcyIiB4PSIxNTYuMDgwMSIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxNjMuMDgwMSIgeT0iNTE4LjI4NDIiPkV2ZW50IFN0b3JlPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUCIgaWQ9InBhcnQzLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODMuNzgxMyIgeD0iMjY0LjEyMzEiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS43ODEzIiB4PSIyNzEuMTIzMSIgeT0iMjQuOTk1MSI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlAiIGlkPSJwYXJ0My10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjgzLjc4MTMiIHg9IjI2NC4xMjMxIiB5PSI0OTguMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9IjI3MS4xMjMxIiB5PSI1MTguMjg0MiI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDQiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ik1CIiBpZD0icGFydDQtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjYuNDcxNyIgeD0iMzU3LjkwNDQiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMzY0LjkwNDQiIHk9IjI0Ljk5NTEiPk15QmF0aXMgTWFwcGVyPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NCIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iTUIiIGlkPSJwYXJ0NC10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyNi40NzE3IiB4PSIzNTcuOTA0NCIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMzY0LjkwNDQiIHk9IjUxOC4yODQyIj5NeUJhdGlzIE1hcHBlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDUiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRCIiBpZD0icGFydDUtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEuMTI2IiB4PSI0OTQuMzc2MSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNy4xMjYiIHg9IjUwMS4zNzYxIiB5PSIyNC45OTUxIj5SZWFkIE1vZGVsIERCPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iREIiIGlkPSJwYXJ0NS10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMS4xMjYiIHg9IjQ5NC4zNzYxIiB5PSI0OTguMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNy4xMjYiIHg9IjUwMS4zNzYxIiB5PSI1MTguMjg0MiI+UmVhZCBNb2RlbCBEQjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDYiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlJDIiBpZD0icGFydDYtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjMuNjM0OCIgeD0iNjI1LjUwMiIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSI2MzIuNTAyIiB5PSIyNC45OTUxIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ2IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJSQyIgaWQ9InBhcnQ2LXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIzLjYzNDgiIHg9IjYyNS41MDIiIHk9IjQ5OC4yODkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjYzMi41MDIiIHk9IjUxOC4yODQyIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9Ijc1NC4xMzY4IiB4PSIwIiB5PSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjY2Ljg2MzMiIHkyPSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjY5Ljg2MzMiIHkyPSI2OS44NjMzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMjAxLjM2MzkiIHg9IjI3Ni4zODY1IiB5PSI1Ni4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4Ny4zNjM5IiB4PSIyODIuMzg2NSIgeT0iNzIuMzYzOCI+JiMyNjM2MDsmIzEyMzY1OyYjMzY3OTY7JiMxMjQxNTsmIzY1Mjg4O0NvbW1hbmQgU2lkZSYjNjUyODk7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5Mi4wMTM3LDEwNi41NjI1LDIwMi4wMTM3LDExMC41NjI1LDE5Mi4wMTM3LDExNC41NjI1LDE5Ni4wMTM3LDExMC41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc1LjU0IiB4Mj0iMTk4LjAxMzciIHkxPSIxMTAuNTYyNSIgeTI9IjExMC41NjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iODIuNTQiIHk9IjEwNS40OTY2Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA0NDU7JiMyMzM4NDs8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cyIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI5NC4wMTM4LDEzNS42OTUzLDMwNC4wMTM4LDEzOS42OTUzLDI5NC4wMTM4LDE0My42OTUzLDI5OC4wMTM4LDEzOS42OTUzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjIwNC4wMTM3IiB4Mj0iMzAwLjAxMzgiIHkxPSIxMzkuNjk1MyIgeTI9IjEzOS42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMjExLjAxMzciIHk9IjEzNC42Mjk0Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMzY4OTA7JiMzMDY5Mzs8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9Ijc1NC4xMzY4IiB4PSIwIiB5PSIxNjguMjYxNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiIHgxPSIwIiB4Mj0iNzU0LjEzNjgiIHkxPSIxNjguMjYxNyIgeTI9IjE2OC4yNjE3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjE3MS4yNjE3IiB5Mj0iMTcxLjI2MTciLz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjIzLjEzMjgiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjsiIHdpZHRoPSIxMzUuNTI2IiB4PSIzMDkuMzA1NCIgeT0iMTU3LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjMxNS4zMDU0IiB5PSIxNzMuNzYyMiI+JiMzNTUwMTsmIzEyNDE1OyYjMjE0NjI7JiMxMjQyNjsmIzEyNTE0OyYjMTI0ODc7JiMxMjUyMzsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDQiIGlkPSJtc2czIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwOS4xNDAyLDIwNy45NjA5LDQxOS4xNDAyLDIxMS45NjA5LDQwOS4xNDAyLDIxNS45NjA5LDQxMy4xNDAyLDIxMS45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMwNi4wMTM4IiB4Mj0iNDE1LjE0MDIiIHkxPSIyMTEuOTYwOSIgeTI9IjIxMS45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODcuMjQ4NSIgeD0iMzEzLjAxMzgiIHk9IjIwNi44OTUiPmluc2VydC91cGRhdGU8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NCIgZGF0YS1lbnRpdHktMj0icGFydDUiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU0Mi45MzkxLDIzNy4wOTM4LDU1Mi45MzkxLDI0MS4wOTM4LDU0Mi45MzkxLDI0NS4wOTM4LDU0Ni45MzkxLDI0MS4wOTM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQyMS4xNDAyIiB4Mj0iNTQ4LjkzOTEiIHkxPSIyNDEuMDkzOCIgeTI9IjI0MS4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuODU5NCIgeD0iNDI4LjE0MDIiIHk9IjIzNi4wMjc4Ij5TUUwgJiMyMzQ1NTsmIzM0ODkyOzwvdGV4dD48L2c+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIzIiBzdHlsZT0ic3Ryb2tlOiNFRUVFRUU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNzU0LjEzNjgiIHg9IjAiIHk9IjI2OS42NjAyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjI2OS42NjAyIiB5Mj0iMjY5LjY2MDIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9Ijc1NC4xMzY4IiB5MT0iMjcyLjY2MDIiIHkyPSIyNzIuNjYwMiIvPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMjMuMTMyOCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyOyIgd2lkdGg9IjE3Mi40NzU3IiB4PSIyOTAuODMwNiIgeT0iMjU5LjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU4LjQ3NTciIHg9IjI5Ni44MzA2IiB5PSIyNzUuMTYwNiI+JiMzNTUwMTsmIzEyNDE1OyYjMjE0NjI7JiMxMjQyNjsmIzY1Mjg4O1F1ZXJ5IFNpZGUmIzY1Mjg5OzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDYiIGRhdGEtZW50aXR5LTI9InBhcnQ0IiBpZD0ibXNnNSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MzIuMTQwMiwzMDkuMzU5NCw0MjIuMTQwMiwzMTMuMzU5NCw0MzIuMTQwMiwzMTcuMzU5NCw0MjguMTQwMiwzMTMuMzU5NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0MjYuMTQwMiIgeDI9IjY4Ni4zMTk0IiB5MT0iMzEzLjM1OTQiIHkyPSIzMTMuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzLjM3NzQiIHg9IjQzOC4xNDAyIiB5PSIzMDguMjkzNSI+ZmluZEJ5SWQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NCIgZGF0YS1lbnRpdHktMj0icGFydDUiIGlkPSJtc2c2Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU0Mi45MzkxLDMzOC40OTIyLDU1Mi45MzkxLDM0Mi40OTIyLDU0Mi45MzkxLDM0Ni40OTIyLDU0Ni45MzkxLDM0Mi40OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQyMS4xNDAyIiB4Mj0iNTQ4LjkzOTEiIHkxPSIzNDIuNDkyMiIgeTI9IjM0Mi40OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguOTQwNCIgeD0iNDI4LjE0MDIiIHk9IjMzNy40MjYzIj5TRUxFQ1Q8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NSIgZGF0YS1lbnRpdHktMj0icGFydDQiIGlkPSJtc2c3Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQzMi4xNDAyLDM2Ny42MjUsNDIyLjE0MDIsMzcxLjYyNSw0MzIuMTQwMiwzNzUuNjI1LDQyOC4xNDAyLDM3MS42MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDI2LjE0MDIiIHgyPSI1NTMuOTM5MSIgeTE9IjM3MS42MjUiIHkyPSIzNzEuNjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjQzOC4xNDAyIiB5PSIzNjYuNTU5MSI+JiMzMjA4MDsmIzI2NTI0OzwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQ0IiBkYXRhLWVudGl0eS0yPSJwYXJ0NiIgaWQ9Im1zZzgiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjc1LjMxOTQsMzk2Ljc1NzgsNjg1LjMxOTQsNDAwLjc1NzgsNjc1LjMxOTQsNDA0Ljc1NzgsNjc5LjMxOTQsNDAwLjc1NzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDIxLjE0MDIiIHgyPSI2ODEuMzE5NCIgeTE9IjQwMC43NTc4IiB5Mj0iNDAwLjc1NzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNy45NTI2IiB4PSI0MjguMTQwMiIgeT0iMzk1LjY5MTkiPkVudGl0eTwvdGV4dD48L2c+PHBhdGggZD0iTTMxMSw0MTMuNzU3OCBMMzExLDQ4My43NTc4IEw0NTEsNDgzLjc1NzggTDQ1MSw0MjMuNzU3OCBMNDQxLDQxMy43NTc4IEwzMTEsNDEzLjc1NzgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NDEsNDEzLjc1NzggTDQ0MSw0MjMuNzU3OCBMNDUxLDQyMy43NTc4IEw0NDEsNDEzLjc1NzgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjkyOTIiIHg9IjMxNyIgeT0iNDMwLjgyNDciPlByb2plY3Rpb24gJiMxMjM5OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjMxNyIgeT0iNDQ1Ljk1NzUiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMxMjQzNDsmIzM2MDkyOyYjMzU1MDE7JiMxMjM3NTsmIzEyMzkwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC40MDg3IiB4PSIzMTciIHk9IjQ2MS4wOTAzIj5NeUJhdGlzICYjMzIwNzY7JiMzMDAwMTsmIzEyMzkxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuNTQ1NSIgeD0iMzE3IiB5PSI0NzYuMjIzMSI+UmVhZCBNb2RlbCAmIzEyNDM0OyYjMjYzNTY7JiMyNjAzMjs8L3RleHQ+PD9wbGFudHVtbC1zcmMgUFA3QklXQ241OFJ0VU9nM2hpTXpLMVNwN1FkV0dFdHUwaDRKRFRlY0d2ZUF0SmNUWEhTS0hTSngxU0tCQUR2R21LTkhYdWN6a0Y4TEYxc2pUZkdtUDNaVlZfeHlvSWREUzE1R0hPaW1KbENwYXFnTVhNX0JXYkpHRS1JcTVvNjhEU19wVzBlREZST2k1Z2RtQ19XTGNFZTFNVzh4YXZHdWltbXRKcWw1T2t2dUlQdkxTZmhiRFBTWW5qYWFUSWlNclJtNEJXczJ4bURTQW9kOUNVZzNBdHJNV0JHTEF6OV81T3V0MWhPS01pYjI5c1JFOVlJTFdpUlVpbWJOTVl5cjR4di1yMVEteG1DVXp6YjdSSjZMOGRPNi1XT25EMG8wZ1B3UVFDVDQzb1BRVTdpemc1emw0d21acFZ3MXh0RXhwUUVwc0J6clVPdEV6VExES3Jxb3FPYzl2YXJxclRYeFI2cFUwUmZkcy1za1hWclNiOVpJX1VOMGZ2ZUhCMjU4anU0dEVXQnJjd0ZNeVY4X0dtbXlNY1FncVhLdFBfeXVKZDNYTXZMWEZzN2NaM1pzNkM3X2xld2ktUkpNRURvRkhMWjJfVzVtWEVRd0dlWUdjZTdZYXJDUXYwSEV2ZFRLT0M5UnFkcmJLcnJsRlRKWVM1aWNGMlVUa0pNVmJmaVJ6b1F5ODVyWkdsN040bjI2UnpxLXZIQzA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="412-workorder-projectionmybatis">41.2 WorkOrder Projection（MyBatis 版）<a class="headerlink" href="#412-workorder-projectionmybatis" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderProjection.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.application.query</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.outbound.persistence.entity.WorkOrderEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.outbound.persistence.mapper.WorkOrderMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder Projection（MyBatis を使用した Read Model の更新）</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorkOrderProjection</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">WorkOrderMapper</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WorkOrderProjection</span><span class="p">(</span><span class="n">WorkOrderMapper</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrderMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderEntity</span><span class="p">();</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setWorkOrderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setItemId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">itemId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setItemName</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">itemName</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setOrderQuantity</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setUnitOfMeasure</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">unitOfMeasure</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setPlannedStartDate</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">plannedStartDate</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setPlannedEndDate</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">plannedEndDate</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setWorkCenterId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workCenterId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;CREATED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCreatedBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">createdBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">createdAt</span><span class="p">());</span>

<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderReleasedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;RELEASED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateReleasedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">releasedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">releasedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;REJECTED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateRejection</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">rejectedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderStartedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;IN_PROGRESS&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStarted</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">operatorId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">actualStartTime</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderSuspendedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;SUSPENDED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateSuspended</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">suspendedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">suspendedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderResumedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;IN_PROGRESS&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateResumed</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">resumedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">resumedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCompletedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;COMPLETED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateCompleted</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">completedQuantity</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">defectQuantity</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">operatorId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">actualEndTime</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">WorkOrderCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;CANCELLED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">updateCancellation</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">workOrderId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">cancelledAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="413-read-model-entity">41.3 Read Model Entity<a class="headerlink" href="#413-read-model-entity" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderEntity.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.outbound.persistence.entity</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder Read Model（表示用のすべてのフィールドを保持）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorkOrderEntity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">releasedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualStartTime</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualEndTime</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">suspendReason</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">suspendedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">resumedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Getters and Setters</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getWorkOrderId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setWorkOrderId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">workOrderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getItemId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">itemId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setItemId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">itemId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getItemName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">itemName</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setItemName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">itemName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemName</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getOrderQuantity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setOrderQuantity</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">orderQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getUnitOfMeasure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUnitOfMeasure</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">unitOfMeasure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="nf">getPlannedStartDate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPlannedStartDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">plannedStartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="nf">getPlannedEndDate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPlannedEndDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">plannedEndDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getWorkCenterId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setWorkCenterId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">workCenterId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getStatus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCreatedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createdBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCreatedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getReleasedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setReleasedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">releasedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getReleasedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">releasedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setReleasedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">releasedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">releasedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">releasedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRejectionReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectionReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectionReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getRejectedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getOperatorId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">operatorId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setOperatorId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">operatorId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">operatorId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getActualStartTime</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">actualStartTime</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setActualStartTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualStartTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">actualStartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actualStartTime</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getActualEndTime</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">actualEndTime</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setActualEndTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualEndTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">actualEndTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actualEndTime</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getCompletedQuantity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCompletedQuantity</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">completedQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getDefectQuantity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDefectQuantity</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">defectQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSuspendReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">suspendReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSuspendReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">suspendReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">suspendReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suspendReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSuspendedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSuspendedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">suspendedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getSuspendedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">suspendedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSuspendedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">suspendedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">suspendedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suspendedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getResumedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setResumedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">resumedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getResumedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">resumedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setResumedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">resumedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">resumedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resumedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancelledBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancellationReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancellationReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancellationReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCancelledAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="414-mybatis-mapper">41.4 MyBatis Mapper インターフェース<a class="headerlink" href="#414-mybatis-mapper" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderMapper.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.outbound.persistence.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.outbound.persistence.entity.WorkOrderEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Param</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder MyBatis Mapper</span>
<span class="cm"> */</span>
<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">WorkOrderMapper</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// 挿入</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">WorkOrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 検索</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">WorkOrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WorkOrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WorkOrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByItemId</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;itemId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WorkOrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByStatus</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WorkOrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByWorkCenterId</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workCenterId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 更新</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateStatus</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateReleasedAt</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;releasedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;releasedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">releasedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateRejection</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;rejectionReason&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;rejectedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateStarted</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;operatorId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;actualStartTime&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualStartTime</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateSuspended</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;suspendReason&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">suspendReason</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;suspendedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;suspendedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">suspendedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateResumed</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;resumedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;resumedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">resumedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateCompleted</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;completedQuantity&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;defectQuantity&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;operatorId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;actualEndTime&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualEndTime</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateCancellation</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;workOrderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancelledBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancellationReason&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancelledAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="415-mybatis-mapper-xml">41.5 MyBatis Mapper XML<a class="headerlink" href="#415-mybatis-mapper-xml" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderMapper.xml</summary>

<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.production.workorder.adapter.outbound.persistence.mapper.WorkOrderMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;workOrderResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;WorkOrderEntity&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;workOrderId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;work_order_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;item_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemName&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;item_name&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;orderQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;order_quantity&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;unitOfMeasure&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;unit_of_measure&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;plannedStartDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;planned_start_date&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;plannedEndDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;planned_end_date&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;workCenterId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;work_center_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;status&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;status&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;created_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;created_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;releasedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;released_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;releasedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;released_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;rejectionReason&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;rejection_reason&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;rejectedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;rejected_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;operatorId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;operator_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;actualStartTime&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;actual_start_time&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;actualEndTime&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;actual_end_time&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;completedQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;completed_quantity&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;defectQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;defect_quantity&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;suspendReason&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;suspend_reason&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;suspendedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;suspended_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;suspendedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;suspended_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;resumedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;resumed_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;resumedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;resumed_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancelledBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancelled_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancellationReason&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancellation_reason&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancelledAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancelled_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;WorkOrderEntity&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>work_orders<span class="w"> </span>(
<span class="w">            </span>work_order_id,<span class="w"> </span>item_id,<span class="w"> </span>item_name,<span class="w"> </span>order_quantity,<span class="w"> </span>unit_of_measure,
<span class="w">            </span>planned_start_date,<span class="w"> </span>planned_end_date,<span class="w"> </span>work_center_id,<span class="w"> </span>status,
<span class="w">            </span>created_by,<span class="w"> </span>created_at
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{workOrderId},<span class="w"> </span>#{itemId},<span class="w"> </span>#{itemName},<span class="w"> </span>#{orderQuantity},<span class="w"> </span>#{unitOfMeasure},
<span class="w">            </span>#{plannedStartDate},<span class="w"> </span>#{plannedEndDate},<span class="w"> </span>#{workCenterId},<span class="w"> </span>#{status},
<span class="w">            </span>#{createdBy},<span class="w"> </span>#{createdAt}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;workOrderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>work_orders<span class="w"> </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;workOrderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>work_orders<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByItemId&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;workOrderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>work_orders<span class="w"> </span>WHERE<span class="w"> </span>item_id<span class="w"> </span>=<span class="w"> </span>#{itemId}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByStatus&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;workOrderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>work_orders<span class="w"> </span>WHERE<span class="w"> </span>status<span class="w"> </span>=<span class="w"> </span>#{status}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByWorkCenterId&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;workOrderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>work_orders<span class="w"> </span>WHERE<span class="w"> </span>work_center_id<span class="w"> </span>=<span class="w"> </span>#{workCenterId}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateStatus&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders<span class="w"> </span>SET<span class="w"> </span>status<span class="w"> </span>=<span class="w"> </span>#{status}<span class="w"> </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateReleasedAt&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders
<span class="w">        </span>SET<span class="w"> </span>released_by<span class="w"> </span>=<span class="w"> </span>#{releasedBy},<span class="w"> </span>released_at<span class="w"> </span>=<span class="w"> </span>#{releasedAt}
<span class="w">        </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateRejection&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders
<span class="w">        </span>SET<span class="w"> </span>rejection_reason<span class="w"> </span>=<span class="w"> </span>#{rejectionReason},<span class="w"> </span>rejected_at<span class="w"> </span>=<span class="w"> </span>#{rejectedAt}
<span class="w">        </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateStarted&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders
<span class="w">        </span>SET<span class="w"> </span>operator_id<span class="w"> </span>=<span class="w"> </span>#{operatorId},<span class="w"> </span>actual_start_time<span class="w"> </span>=<span class="w"> </span>#{actualStartTime}
<span class="w">        </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateSuspended&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders
<span class="w">        </span>SET<span class="w"> </span>suspend_reason<span class="w"> </span>=<span class="w"> </span>#{suspendReason},<span class="w"> </span>suspended_by<span class="w"> </span>=<span class="w"> </span>#{suspendedBy},<span class="w"> </span>suspended_at<span class="w"> </span>=<span class="w"> </span>#{suspendedAt}
<span class="w">        </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateResumed&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders
<span class="w">        </span>SET<span class="w"> </span>resumed_by<span class="w"> </span>=<span class="w"> </span>#{resumedBy},<span class="w"> </span>resumed_at<span class="w"> </span>=<span class="w"> </span>#{resumedAt}
<span class="w">        </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateCompleted&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders
<span class="w">        </span>SET<span class="w"> </span>completed_quantity<span class="w"> </span>=<span class="w"> </span>#{completedQuantity},
<span class="w">            </span>defect_quantity<span class="w"> </span>=<span class="w"> </span>#{defectQuantity},
<span class="w">            </span>operator_id<span class="w"> </span>=<span class="w"> </span>#{operatorId},
<span class="w">            </span>actual_end_time<span class="w"> </span>=<span class="w"> </span>#{actualEndTime}
<span class="w">        </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateCancellation&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>work_orders
<span class="w">        </span>SET<span class="w"> </span>cancelled_by<span class="w"> </span>=<span class="w"> </span>#{cancelledBy},
<span class="w">            </span>cancellation_reason<span class="w"> </span>=<span class="w"> </span>#{cancellationReason},
<span class="w">            </span>cancelled_at<span class="w"> </span>=<span class="w"> </span>#{cancelledAt}
<span class="w">        </span>WHERE<span class="w"> </span>work_order_id<span class="w"> </span>=<span class="w"> </span>#{workOrderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<hr />
<h3 id="416-read-model">41.6 Read Model スキーマ<a class="headerlink" href="#416-read-model" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: schema.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- Read Model: WorkOrders テーブル</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">work_orders</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">work_order_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">item_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">item_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">order_quantity</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">unit_of_measure</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">planned_start_date</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">planned_end_date</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">work_center_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">released_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">released_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">rejection_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">rejected_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">operator_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">actual_start_time</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">actual_end_time</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">completed_quantity</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span>
<span class="w">    </span><span class="n">defect_quantity</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span>
<span class="w">    </span><span class="n">suspend_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">suspended_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">suspended_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">resumed_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">resumed_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">cancelled_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">cancellation_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">cancelled_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_work_orders_item_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">work_orders</span><span class="p">(</span><span class="n">item_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_work_orders_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">work_orders</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_work_orders_work_center_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">work_orders</span><span class="p">(</span><span class="n">work_center_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_work_orders_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">work_orders</span><span class="p">(</span><span class="n">created_at</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_work_orders_planned_start_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">work_orders</span><span class="p">(</span><span class="n">planned_start_date</span><span class="p">);</span>
</code></pre></div>

</details>

<hr />
<h3 id="417">41.7 最小限フィールドの原則<a class="headerlink" href="#417" title="Permanent link">&para;</a></h3>
<p>Event Sourcing では、ドメインモデルは「次のコマンドを処理するために必要な最小限の状態」のみを保持します。一方、Read Model は表示に必要なすべてのフィールドを保持します。</p>
<table>
<thead>
<tr>
<th>フィールド</th>
<th style="text-align: center;">ドメインモデル</th>
<th style="text-align: center;">Read Model</th>
<th>理由</th>
</tr>
</thead>
<tbody>
<tr>
<td>workOrderId</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>識別子として必要</td>
</tr>
<tr>
<td>status</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>状態遷移の判定に必要</td>
</tr>
<tr>
<td>itemId</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>資材引当に必要</td>
</tr>
<tr>
<td>orderQuantity</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>完了数量の検証に必要</td>
</tr>
<tr>
<td>actualStartTime</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>completedQuantity</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>cancelledBy</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>createdAt</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="42rest-api">第42章：REST API と統合テスト<a class="headerlink" href="#42rest-api" title="Permanent link">&para;</a></h2>
<h3 id="421-rest-controllerinbound-adapter">42.1 REST Controller（Inbound Adapter）<a class="headerlink" href="#421-rest-controllerinbound-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrdersController.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.inbound.rest.workorders</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.inbound.rest.workorders.protocol.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.outbound.persistence.mapper.WorkOrderMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder.WorkOrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.Operation</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.tags.Tag</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.ResponseEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletableFuture</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * WorkOrder REST Controller（Inbound Adapter）</span>
<span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/work-orders&quot;</span><span class="p">)</span>
<span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WorkOrders&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Work Order management API&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorkOrdersController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">WorkOrderMapper</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WorkOrdersController</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">,</span><span class="w"> </span><span class="n">WorkOrderMapper</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">workOrderMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Command Side (Write) ==========</span>

<span class="w">    </span><span class="nd">@PostMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Create a new work order&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">WorkOrderCreateResponse</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">WorkOrderCreateRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">workOrderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateWorkOrderCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">itemId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">itemName</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">unitOfMeasure</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">plannedStartDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">plannedEndDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">workCenterId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">createdBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span>
<span class="w">                        </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CREATED</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCreateResponse</span><span class="p">(</span><span class="n">workOrderId</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/start&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Start manufacturing&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">WorkOrderStartRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StartWorkOrderCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">operatorId</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/suspend&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Suspend manufacturing&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">suspend</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">WorkOrderSuspendRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SuspendWorkOrderCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">suspendedBy</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/resume&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Resume manufacturing&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">resume</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">WorkOrderResumeRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResumeWorkOrderCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">resumedBy</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/complete&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Complete manufacturing&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">WorkOrderCompleteRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CompleteWorkOrderCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">id</span><span class="p">,</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">completedQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">defectQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">operatorId</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/cancel&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cancel work order&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">WorkOrderCancelRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CancelWorkOrderCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Query Side (Read) ==========</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get a work order by ID&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">WorkOrderGetResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">WorkOrderGetResponse</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">entity</span><span class="p">)))</span>
<span class="w">                </span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">notFound</span><span class="p">().</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get all work orders&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">WorkOrderListResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">WorkOrderGetResponse</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderListResponse</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/status/{status}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get work orders by status&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">WorkOrderListResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getByStatus</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workOrderMapper</span><span class="p">.</span><span class="na">findByStatus</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">WorkOrderGetResponse</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderListResponse</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="422-requestresponse-dto">42.2 Request/Response DTO<a class="headerlink" href="#422-requestresponse-dto" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderCreateRequest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.inbound.rest.workorders.protocol</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotBlank</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Positive</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造指図作成リクエスト</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrderCreateRequest</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@NotBlank</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotBlank</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotNull</span><span class="w"> </span><span class="nd">@Positive</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotBlank</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotNull</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotNull</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotBlank</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotBlank</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: WorkOrderGetResponse.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.inbound.rest.workorders.protocol</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.adapter.outbound.persistence.entity.WorkOrderEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 製造指図取得レスポンス</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">WorkOrderGetResponse</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workOrderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">unitOfMeasure</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedStartDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">plannedEndDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">workCenterId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">releasedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">releasedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">operatorId</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualStartTime</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">actualEndTime</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">completedQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">defectQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">suspendReason</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">suspendedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">suspendedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">resumedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">resumedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">WorkOrderGetResponse</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">WorkOrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderGetResponse</span><span class="p">(</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getWorkOrderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getItemId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getItemName</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getOrderQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getUnitOfMeasure</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getPlannedStartDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getPlannedEndDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getWorkCenterId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getStatus</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCreatedBy</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCreatedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getReleasedBy</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getReleasedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getRejectionReason</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getRejectedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getOperatorId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getActualStartTime</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getActualEndTime</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCompletedQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getDefectQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getSuspendReason</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getSuspendedBy</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getSuspendedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getResumedBy</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getResumedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCancelledBy</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCancellationReason</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCancelledAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="423-api">42.3 API エンドポイント一覧<a class="headerlink" href="#423-api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>メソッド</th>
<th>パス</th>
<th>説明</th>
<th>種別</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/api/work-orders</code></td>
<td>製造指図作成</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/work-orders/{id}/start</code></td>
<td>製造開始</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/work-orders/{id}/suspend</code></td>
<td>製造中断</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/work-orders/{id}/resume</code></td>
<td>製造再開</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/work-orders/{id}/complete</code></td>
<td>製造完了</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/work-orders/{id}/cancel</code></td>
<td>キャンセル</td>
<td>Command</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/work-orders</code></td>
<td>製造指図一覧取得</td>
<td>Query</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/work-orders/{id}</code></td>
<td>製造指図詳細取得</td>
<td>Query</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/work-orders/status/{status}</code></td>
<td>ステータス別取得</td>
<td>Query</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="424-axon-test">42.4 Axon Test による単体テスト<a class="headerlink" href="#424-axon-test" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: WorkOrderAggregateTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.workorder.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.workorder.domain.model.aggregate.workorder.WorkOrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.AggregateTestFixture</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.FixtureConfiguration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.BeforeEach</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.DisplayName</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Nested</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">WorkOrderAggregateTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FixtureConfiguration</span><span class="o">&lt;</span><span class="n">WorkOrderAggregateAdapter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fixture</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AggregateTestFixture</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">WorkOrderAggregateAdapter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;製造指図作成&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CreateWorkOrder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;正常な製造指図を作成できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCreateWorkOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateWorkOrderCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;数量が0以下の場合はエラー&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRejectZeroQuantity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateWorkOrderCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;終了日が開始日より前の場合はエラー&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRejectInvalidDateRange</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateWorkOrderCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">minusDays</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;製造開始&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">StartWorkOrder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;リリース済みの製造指図を開始できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldStartReleasedWorkOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">releasedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderReleasedEvent</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;system&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">releasedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StartWorkOrderCommand</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;operator-1&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">WorkOrderStartedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;作成済みの製造指図は開始できない&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotStartCreatedWorkOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StartWorkOrderCommand</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;operator-1&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;製造完了&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CompleteWorkOrder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;製造中の製造指図を完了できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCompleteInProgressWorkOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">releasedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderReleasedEvent</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;system&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">startedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderStartedEvent</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;operator-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">releasedEvent</span><span class="p">,</span><span class="w"> </span><span class="n">startedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CompleteWorkOrderCommand</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">98</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;operator-1&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">WorkOrderCompletedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;製造指図キャンセル&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CancelWorkOrder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;作成済みの製造指図をキャンセルできる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCancelCreatedWorkOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CancelWorkOrderCommand</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Customer request&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">WorkOrderCancelledEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;完了済みの製造指図はキャンセルできない&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotCancelCompletedWorkOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;製品A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;EA&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusDays</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;wc-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">releasedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderReleasedEvent</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;system&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">startedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderStartedEvent</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;operator-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">completedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorkOrderCompletedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;item-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;operator-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">releasedEvent</span><span class="p">,</span><span class="w"> </span><span class="n">startedEvent</span><span class="p">,</span><span class="w"> </span><span class="n">completedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CancelWorkOrderCommand</span><span class="p">(</span><span class="s">&quot;wo-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Customer request&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="5">研究 5 のまとめ<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="_6">実装した機能一覧<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>章</th>
<th>内容</th>
<th>主要技術</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>第38章: 基礎</strong></td>
<td>CQRS/ES アーキテクチャの基礎</td>
<td>Axon Framework, Event Sourcing</td>
</tr>
<tr>
<td><strong>第39章: ドメイン設計</strong></td>
<td>イベント、コマンド、ドメインモデル</td>
<td>sealed interface, record</td>
</tr>
<tr>
<td><strong>第40章: Aggregate/Policy</strong></td>
<td>Aggregate Adapter, Choreography</td>
<td>@Aggregate, @EventHandler</td>
</tr>
<tr>
<td><strong>第41章: Projection</strong></td>
<td>Read Model の更新、最小限フィールド</td>
<td>@EventHandler, MyBatis</td>
</tr>
<tr>
<td><strong>第42章: REST API</strong></td>
<td>Inbound Adapter, テスト</td>
<td>CommandGateway, Axon Test</td>
</tr>
</tbody>
</table>
<h3 id="_7">アーキテクチャの特徴<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9Ijg3N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjA1cHg7aGVpZ2h0Ojg3N3B4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYwNSA4NzciIHdpZHRoPSI2MDVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iODc3IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjA1IiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgQ29tbWFuZCBTaWRlLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgaWQ9ImVudDAwMDIiPjxwYXRoIGQ9Ik04LjUsNiBMMTI3LjI3NjQsNiBBMy43NSwzLjc1IDAgMCAxIDEyOS43NzY0LDguNSBMMTM2Ljc3NjQsMjguMjk2OSBMNDI4LjUsMjguMjk2OSBBMi41LDIuNSAwIDAgMSA0MzEsMzAuNzk2OSBMNDMxLDQ3MC42OSBBMi41LDIuNSAwIDAgMSA0MjguNSw0NzMuMTkgTDguNSw0NzMuMTkgQTIuNSwyLjUgMCAwIDEgNiw0NzAuNjkgTDYsOC41IEEyLjUsMi41IDAgMCAxIDguNSw2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2IiB4Mj0iMTM2Ljc3NjQiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuNzc2NCIgeD0iMTAiIHk9IjIwLjk5NTEiPkNvbW1hbmQgU2lkZTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgUXVlcnkgU2lkZS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJRdWVyeSBTaWRlIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImVudDAwMDgiPjxwYXRoIGQ9Ik02Ny41LDUyMi4xOSBMMTU1LjE2Niw1MjIuMTkgQTMuNzUsMy43NSAwIDAgMSAxNTcuNjY2LDUyNC42OSBMMTY0LjY2Niw1NDQuNDg2OSBMMzg5LjUsNTQ0LjQ4NjkgQTIuNSwyLjUgMCAwIDEgMzkyLDU0Ni45ODY5IEwzOTIsODY4LjEzIEEyLjUsMi41IDAgMCAxIDM4OS41LDg3MC42MyBMNjcuNSw4NzAuNjMgQTIuNSwyLjUgMCAwIDEgNjUsODY4LjEzIEw2NSw1MjQuNjkgQTIuNSwyLjUgMCAwIDEgNjcuNSw1MjIuMTkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjY1IiB4Mj0iMTY0LjY2NiIgeTE9IjU0NC40ODY5IiB5Mj0iNTQ0LjQ4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuNjY2IiB4PSI2OSIgeT0iNTM3LjE4NTEiPlF1ZXJ5IFNpZGU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkMxLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlLlJDMSIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ5LjYzNDgiIHg9IjIyMC4xOCIgeT0iNDEiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMzQ5LjgxNDgiIHk9IjQ2Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIzNDcuODE0OCIgeT0iNDgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjM0Ny44MTQ4IiB5PSI1MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSIyMzUuMTgiIHk9IjczLjk5NTEiPlJFU1QgQ29udHJvbGxlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBDRy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZS5DRyIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczLjc5OTgiIHg9IjIwOC4xIiB5PSIxNjQuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIzNjEuODk5OCIgeT0iMTY5LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjM1OS44OTk4IiB5PSIxNzEuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzU5Ljg5OTgiIHk9IjE3NS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjc5OTgiIHg9IjIyMy4xIiB5PSIxOTcuMjk1MSI+Q29tbWFuZEdhdGV3YXk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQUEtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUuQUEiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDA1Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3My41MjY0IiB4PSI0OS4yNCIgeT0iMjg3LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjIwMi43NjY0IiB5PSIyOTIuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIwMC43NjY0IiB5PSIyOTQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIwMC43NjY0IiB5PSIyOTguNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMuNTI2NCIgeD0iNjQuMjQiIHk9IjMyMC41ODUxIj5BZ2dyZWdhdGUgQWRhcHRlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBETS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZS5ETSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgaWQ9ImVudDAwMDYiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwLjgwOTYiIHg9IjMyLjYiIHk9IjE2NC4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE1My40MDk2IiB5PSIxNjkuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTUxLjQwOTYiIHk9IjE3MS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNTEuNDA5NiIgeT0iMTc1LjMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDAuODA5NiIgeD0iNDcuNiIgeT0iMTk3LjI5NTEiPkRvbWFpbiBNb2RlbDwvdGV4dD48L2c+PCEtLWVudGl0eSBFUy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZS5FUyIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIxLjg2NzIiIHg9Ijc1LjA3IiB5PSI0MTAuODkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTc2LjkzNzIiIHk9IjQxNS44OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTc0LjkzNzIiIHk9IjQxNy44OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTc0LjkzNzIiIHk9IjQyMS44OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjkwLjA3IiB5PSI0NDMuODg1MSI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkMyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5SQzIiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDkuNjM0OCIgeD0iMjI2LjE4IiB5PSI1NTcuMTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMzU1LjgxNDgiIHk9IjU2Mi4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzUzLjgxNDgiIHk9IjU2NC4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzUzLjgxNDgiIHk9IjU2OC4xOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSIyNDEuMTgiIHk9IjU5MC4xODUxIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgTUItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJRdWVyeSBTaWRlLk1CIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImVudDAwMTAiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUyLjQ3MTciIHg9IjkzLjc2IiB5PSI2ODUuMDQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjI2LjIzMTciIHk9IjY5MC4wNCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjI0LjIzMTciIHk9IjY5Mi4wNCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjI0LjIzMTciIHk9IjY5Ni4wNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi40NzE3IiB4PSIxMDguNzYiIHk9IjcxOC4wMzUxIj5NeUJhdGlzIE1hcHBlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBEQi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUuREIiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDcuMTI2IiB4PSIxMDQuNDQiIHk9IjgwOC4zMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIyMzEuNTY2IiB5PSI4MTMuMzMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIyOS41NjYiIHk9IjgxNS4zMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjI5LjU2NiIgeT0iODE5LjMzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA3LjEyNiIgeD0iMTE5LjQ0IiB5PSI4NDEuMzI1MSI+UmVhZCBNb2RlbCBEQjwvdGV4dD48L2c+PCEtLWVudGl0eSBQLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5QIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA5Ljc4MTMiIHg9IjgxLjExIiB5PSI1NTcuMTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTcwLjg5MTMiIHk9IjU2Mi4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTY4Ljg5MTMiIHk9IjU2NC4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTY4Ljg5MTMiIHk9IjU2OC4xOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9Ijk2LjExIiB5PSI1OTAuMTg1MSI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMjMiIGRhdGEtc291cmNlLWxpbmU9IjMxIiBpZD0iZW50MDAyNCI+PHBhdGggZD0iTTQ0Ny41LDE2Ny4zMSBMNDQ3LjUsMjA3LjU3NTYgTDU5OC41MDAyLDIwNy41NzU2IEw1OTguNTAwMiwxNzcuMzEgTDU4OC41MDAyLDE2Ny4zMSBMNDQ3LjUsMTY3LjMxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTg4LjUwMDIsMTY3LjMxIEw1ODguNTAwMiwxNzcuMzEgTDU5OC41MDAyLDE3Ny4zMSBMNTg4LjUwMDIsMTY3LjMxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjQ1My41IiB5PSIxODQuMzc2OSI+JiMzMjAyMDsmIzMxODgzOyYjMTIzOTQ7JiMxMjQ4OTsmIzEyNTEzOyYjMTI0NTI7JiMxMjUzMTsmIzEyNTE0OyYjMTI0ODc7JiMxMjUyMzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0LjkxMTciIHg9IjQ1My41IiB5PSIxOTkuNTA5NyI+QXhvbiAmIzEyMzk1OyYjMjAzODE7JiMyMzM4NDsmIzEyMzc1OyYjMTIzOTQ7JiMxMjM1Njs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjI2IiBkYXRhLXNvdXJjZS1saW5lPSIzNiIgaWQ9ImVudDAwMjciPjxwYXRoIGQ9Ik00MTAuNzMsNTUyLjY0IEw0MTAuNzMsNjA4LjAzODQgTDU1MS4yNzU1LDYwOC4wMzg0IEw1NTEuMjc1NSw1NjIuNjQgTDU0MS4yNzU1LDU1Mi42NCBMNDEwLjczLDU1Mi42NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTU0MS4yNzU1LDU1Mi42NCBMNTQxLjI3NTUsNTYyLjY0IEw1NTEuMjc1NSw1NjIuNjQgTDU0MS4yNzU1LDU1Mi42NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4wMDAxIiB4PSI0MTYuNzMiIHk9IjU2OS43MDY5Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMTI0MzQ7JiMzNjA5MjsmIzM1NTAxOyYjMTIzNzU7JiMxMjM5MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuNDA4NyIgeD0iNDE2LjczIiB5PSI1ODQuODM5NyI+TXlCYXRpcyAmIzMyMDc2OyYjMzAwMDE7JiMxMjM5MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE5LjU0NTUiIHg9IjQxNi43MyIgeT0iNTk5Ljk3MjUiPlJlYWQgTW9kZWwgJiMxMjQzNDsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjwvZz48IS0tbGluayBSQzEgdG8gQ0ctLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE4IiBpZD0ibG5rMTMiPjxwYXRoIGQ9Ik0yOTUsODcuNjggQzI5NSwxMDkuNDcgMjk1LDEzNi4yOSAyOTUsMTU4LjA0IiBmaWxsPSJub25lIiBpZD0iUkMxLXRvLUNHIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyOTUsMTY0LjA0LDI5OSwxNTUuMDQsMjk1LDE1OS4wNCwyOTEsMTU1LjA0LDI5NSwxNjQuMDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDYuMjkxNSIgeD0iMjk2IiB5PSIxMzAuMzY2OSI+c2VuZChjb21tYW5kKTwvdGV4dD48L2c+PCEtLWxpbmsgQ0cgdG8gQUEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAwNSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE5IiBpZD0ibG5rMTQiPjxwYXRoIGQ9Ik0yNzguOTcsMjEwLjkzIEMyNjcuODEsMjI1LjQ5IDI1MS45NCwyNDQuMTYgMjM1LDI1Ny41OSBDMjIwLjY5LDI2OC45NCAyMDguODgxNiwyNzYuMjU3MyAxOTIuOTExNiwyODQuNDI3MyIgZmlsbD0ibm9uZSIgaWQ9IkNHLXRvLUFBIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxODcuNTcsMjg3LjE2LDE5Ny40MDQyLDI4Ni42MjIxLDE5Mi4wMjEzLDI4NC44ODI4LDE5My43NjA2LDI3OS40OTk5LDE4Ny41NywyODcuMTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzEuMDAyOSIgeD0iMjU0LjQ4IiB5PSIyNTMuNjU2OSI+QENvbW1hbmRIYW5kbGVyPC90ZXh0PjwvZz48IS0tbGluayBBQSB0byBETS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA2IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGlkPSJsbmsxNSI+PHBhdGggZD0iTTEyOS45LDI4Ny4zMyBDMTIzLjk5LDI2NS41OSAxMTYuNjM2MiwyMzguNTQ5MyAxMTAuNzA2MiwyMTYuNzY5MyIgZmlsbD0ibm9uZSIgaWQ9IkFBLXRvLURNIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDkuMTMsMjEwLjk4LDEwNy42MzQ4LDIyMC43MTQ3LDExMC40NDM1LDIxNS44MDQ0LDExNS4zNTM5LDIxOC42MTMxLDEwOS4xMywyMTAuOTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTIyLjQ4IiB5PSIyNTMuNjU2OSI+JiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48L2c+PCEtLWxpbmsgRE0gdG8gQUEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNiIgZGF0YS1lbnRpdHktMj0iZW50MDAwNSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIxIiBpZD0ibG5rMTYiPjxwYXRoIGQ9Ik04MS45NywyMTAuOTQgQzcxLjkzLDIyNC41IDYzLjU2LDI0Mi4wOSA3MSwyNTcuNTkgQzc2LjYzLDI2OS4zMyA4MS42MDE5LDI3NS41ODg5IDkxLjgyMTksMjgzLjUyODkiIGZpbGw9Im5vbmUiIGlkPSJETS10by1BQSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTYuNTYsMjg3LjIxLDkxLjkwNjksMjc4LjUyOTYsOTIuNjExNiwyODQuMTQyNCw4Ni45OTg4LDI4NC44NDcxLDk2LjU2LDI4Ny4yMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM3LjAyNTkiIHg9IjcyIiB5PSIyNTMuNjU2OSI+ZXZlbnQ8L3RleHQ+PC9nPjwhLS1saW5rIEFBIHRvIEVTLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgaWQ9ImxuazE3Ij48cGF0aCBkPSJNMTM2LDMzNC4yNyBDMTM2LDM1Ni4wNiAxMzYsMzgyLjg4IDEzNiw0MDQuNjMiIGZpbGw9Im5vbmUiIGlkPSJBQS10by1FUyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM2LDQxMC42MywxNDAsNDAxLjYzLDEzNiw0MDUuNjMsMTMyLDQwMS42MywxMzYsNDEwLjYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuOTQ0OCIgeD0iMTM3IiB5PSIzNzYuOTU2OSI+YXBwbHkoZXZlbnQpPC90ZXh0PjwvZz48IS0tbGluayBFUyB0byBQLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDciIGRhdGEtZW50aXR5LTI9ImVudDAwMTIiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgaWQ9ImxuazE4Ij48cGF0aCBkPSJNMTM2LDQ1Ny41OSBDMTM2LDQ4NC43IDEzNiw1MjMuOTEgMTM2LDU1MC45NSIgZmlsbD0ibm9uZSIgaWQ9IkVTLXRvLVAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNiw1NTYuOTUsMTQwLDU0Ny45NSwxMzYsNTUxLjk1LDEzMiw1NDcuOTUsMTM2LDU1Ni45NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMS40MjkyIiB4PSIxMzciIHk9IjUwMi4yNTY5Ij5ARXZlbnRIYW5kbGVyPC90ZXh0PjwvZz48IS0tbGluayBQIHRvIE1CLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTIiIGRhdGEtZW50aXR5LTI9ImVudDAwMTAiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyNCIgaWQ9ImxuazE5Ij48cGF0aCBkPSJNMTQyLjA4LDYwMy44NCBDMTQ4LjI3LDYyNi43NCAxNTYuMjM1Miw2NTYuMjQ3NiAxNjIuNDA1Miw2NzkuMDg3NiIgZmlsbD0ibm9uZSIgaWQ9IlAtdG8tTUIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2My45Nyw2ODQuODgsMTY1LjQ4NDUsNjc1LjE0ODMsMTYyLjY2Niw2ODAuMDUzLDE1Ny43NjEzLDY3Ny4yMzQ2LDE2My45Nyw2ODQuODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ny4yNDg1IiB4PSIxNTYuMDQiIHk9IjY1MS4xMDY5Ij5pbnNlcnQvdXBkYXRlPC90ZXh0PjwvZz48IS0tbGluayBNQiB0byBEQi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDEwIiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGlkPSJsbmsyMCI+PHBhdGggZD0iTTE0Ni4wOSw3MzEuNzcgQzEzNS4xNSw3NDQuOTIgMTI1Ljg1LDc2Mi4wNiAxMzIsNzc4LjMzIEMxMzYuMTgsNzg5LjQgMTM5Ljc5NjQsNzk1LjI3MjIgMTQ3LjcyNjQsODAzLjY5MjIiIGZpbGw9Im5vbmUiIGlkPSJNQi10by1EQiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTUxLjg0LDgwOC4wNiwxNDguNTgxNCw3OTguNzY1OCwxNDguNDEyLDgwNC40MjAxLDE0Mi43NTc2LDgwNC4yNTA3LDE1MS44NCw4MDguMDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNS43MjcxIiB4PSIxMzMiIHk9Ijc3NC4zOTY5Ij5TUUw8L3RleHQ+PC9nPjwhLS1saW5rIE1CIHRvIERCLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTAiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgaWQ9ImxuazIyIj48cGF0aCBkPSJNMTcxLjQ5LDczMS43MiBDMTcyLjkyLDc1My41IDE3NC42OTYyLDc4MC4zNDI5IDE3Ni4xMjYyLDgwMi4wODI5IiBmaWxsPSJub25lIiBpZD0iTUItdG8tREItMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc2LjUyLDgwOC4wNywxNzkuOTIwNyw3OTguODI2OSwxNzYuMTkxOCw4MDMuMDgwOCwxNzEuOTM3OSw3OTkuMzUxOSwxNzYuNTIsODA4LjA3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguOTQwNCIgeD0iMTc1LjQ4IiB5PSI3NzQuMzk2OSI+U0VMRUNUPC90ZXh0PjwvZz48IS0tbGluayBSQzIgdG8gTUItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOSIgZGF0YS1lbnRpdHktMj0iZW50MDAxMCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjI3IiBpZD0ibG5rMjEiPjxwYXRoIGQ9Ik0yODkuNCw2MDMuNzUgQzI4MC41OCw2MTkuMzUgMjY3LjM2LDYzOS45OCAyNTIsNjU1LjA0IEMyNDAuNTUsNjY2LjI1IDIzMS40MjE3LDY3My4xODgyIDIxOC4wMzE3LDY4MS40MTgyIiBmaWxsPSJub25lIiBpZD0iUkMyLXRvLU1CIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTIuOTIsNjg0LjU2LDIyMi42ODIsNjgzLjI1NSwyMTcuMTc5Nyw2ODEuOTQxOCwyMTguNDkyOSw2NzYuNDM5NSwyMTIuOTIsNjg0LjU2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzcuNTI3MyIgeD0iMjY3LjM5IiB5PSI2NTEuMTA2OSI+cXVlcnk8L3RleHQ+PC9nPjwhLS1saW5rIERNIHRvIEdNTjIzLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMjQiIGRhdGEtbGluay10eXBlPSJhc3NvY2lhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMzEiIGlkPSJsbmsyNSI+PHBhdGggZD0iTTEzMy4zNSwxNjMuODUgQzE1My40NCwxNDkuNzcgMTgxLjA2LDEzMy4yMyAyMDguNSwxMjUuOCBDMjk2LjQ0LDEwMS45OSAzMjUuMzcsMTAyLjY5IDQxMy41LDEyNS44IEM0NDMuODksMTMzLjc2IDQ3NC43NCwxNTIuMjcgNDk1LjkxLDE2Ni45NSIgZmlsbD0ibm9uZSIgaWQ9IkRNLUdNTjIzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PC9nPjwhLS1saW5rIFAgdG8gR01OMjYtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMiIgZGF0YS1lbnRpdHktMj0iZW50MDAyNyIgZGF0YS1saW5rLXR5cGU9ImFzc29jaWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIzNiIgaWQ9ImxuazI4Ij48cGF0aCBkPSJNMTUzLjEsNTU3LjA3IEMxNjkuNDEsNTM3LjA0IDE5NS45NSw1MDkuNTQgMjI2LjUsNDk3LjY5IEMyNTcuMTYsNDg1Ljc5IDM0My4zOSw0ODcuMDMgMzc0LjUsNDk3LjY5IEM0MDUuOTQsNTA4LjQ2IDQzNS4yNyw1MzIuNzEgNDU1LjE2LDU1Mi4xNyIgZmlsbD0ibm9uZSIgaWQ9IlAtR01OMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PD9wbGFudHVtbC1zcmMgWFA1RFF6SDA2Q1ZscHdUdWc5VnNLQ0dVRk9aUFJBbzcxakFjai0xWHQ4bmZSN09jSmhCZzhYd0k0UkpPTmhKdVdkWWVZNEJCdWFpaEE4WFZQaEpSWi00cGl4a3JVZjRtNDd4X3ZfYV9SekxjQmFnY00xLWxpenZjZmtIMGZCdWlmQzlwTG1CeDBQR2FpOHBaZDJfeFZJUElaRkVLcC00eklEUTJVMXJ6QU1lYll1QWhReVdnTkZDbEczQURONk9ybHlFNlpsbEJhN1hQZmRYNjRCc0tiVktxbV9DV3dTZS1vbU02Q2tNNVd6cUdhazBzNXBONmpMSlNpSTI2LXNWUU1Icm1EVm5WQ3FrR1hDQ0VnX0NBR3JRTUtudnNBOXdwVDU4R2t2cjlKUUFIYVpUdmh5d2JTMllvNU1hYU41b3lIMkZXSFFvdUlFVHhhX2FNVzkxTEY4LUtvekVmaHpBWjFlMldyUmVYUUtPX0RVck5ldFRDLXl0ZWFWbE5mbHEwZjl1UVMzbGxCMnM4WUwzN25OM1V5R0tXT2VOOGJkQWhjSE1BNzB5eDlFSVl1Z2UtRm9YSnNaOEdTWHJPOUx2VGlQQ2lfT2N6UFZWdFRxb200bFpoMDRCSVlMSVVSVEdlUnpYSlo4enNudnlWY3NSVncyc1p6cXB4cmtYM2V6eU9fVDNlMF8za0llNmNFVlp2dV9NbHFHbEpGQlVIcEdFV0xRN3ItalNuMGtWbXFmYXlDa3NKYXlGbDlfaVpiX1dFUGxTUVZ6YVV4dHVvcE5pdVNvZUFGZHZyVEZwaXV3ZHZSbTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_8">設計上の特徴<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>特徴</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ドメインモデルとフレームワークの分離</strong></td>
<td><code>WorkOrder.java</code> は純粋なドメインモデル、<code>WorkOrderAggregateAdapter.java</code> は Axon 用アダプター</td>
</tr>
<tr>
<td><strong>Choreography による疎結合</strong></td>
<td>各 Context は独立して動作、イベントを介した非同期連携</td>
</tr>
<tr>
<td><strong>sealed interface による型安全性</strong></td>
<td>イベントの網羅性チェック、switch 式でコンパイル時検証</td>
</tr>
<tr>
<td><strong>record によるイミュータブル設計</strong></td>
<td>状態変更は常に新しいインスタンスを生成</td>
</tr>
<tr>
<td><strong>最小限フィールドの原則</strong></td>
<td>ドメインモデルは状態遷移判定に必要な最小限のみ保持</td>
</tr>
<tr>
<td><strong>MyBatis による柔軟な SQL 制御</strong></td>
<td>Read Model の更新に MyBatis Mapper を使用</td>
</tr>
</tbody>
</table>
<h3 id="_9">技術スタック<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カテゴリ</th>
<th>技術</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>言語</strong></td>
<td>Java 21</td>
</tr>
<tr>
<td><strong>フレームワーク</strong></td>
<td>Spring Boot 3.4.1</td>
</tr>
<tr>
<td><strong>CQRS/ES</strong></td>
<td>Axon Framework 4.10.3</td>
</tr>
<tr>
<td><strong>ORM</strong></td>
<td>MyBatis 3.0.4</td>
</tr>
<tr>
<td><strong>データベース</strong></td>
<td>H2 / PostgreSQL</td>
</tr>
<tr>
<td><strong>テスト</strong></td>
<td>JUnit 5, Axon Test</td>
</tr>
</tbody>
</table>
<h3 id="cqrses">生産管理システムにおける CQRS/ES の利点<a class="headerlink" href="#cqrses" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>製造履歴の完全追跡</strong></td>
<td>製造指図の作成から完了までの全履歴を保持</td>
</tr>
<tr>
<td><strong>品質トレーサビリティ</strong></td>
<td>不良発生時に製造工程を遡及調査可能</td>
</tr>
<tr>
<td><strong>資材引当の厳密管理</strong></td>
<td>引当・払出・返却を厳密にイベントで追跡</td>
</tr>
<tr>
<td><strong>工程別進捗管理</strong></td>
<td>開始・中断・再開・完了を正確に記録</td>
</tr>
<tr>
<td><strong>原価計算への活用</strong></td>
<td>イベントから製造原価を正確に計算可能</td>
</tr>
</tbody>
</table>
<h3 id="api">API 形式の比較<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>REST API</th>
<th>gRPC</th>
<th>GraphQL</th>
<th>CQRS/ES</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>書き込みモデル</strong></td>
<td>同一</td>
<td>同一</td>
<td>同一</td>
<td>分離（Command）</td>
</tr>
<tr>
<td><strong>読み取りモデル</strong></td>
<td>同一</td>
<td>同一</td>
<td>同一</td>
<td>分離（Query）</td>
</tr>
<tr>
<td><strong>履歴保持</strong></td>
<td>別途実装</td>
<td>別途実装</td>
<td>別途実装</td>
<td>標準搭載</td>
</tr>
<tr>
<td><strong>監査証跡</strong></td>
<td>別途実装</td>
<td>別途実装</td>
<td>別途実装</td>
<td>標準搭載</td>
</tr>
<tr>
<td><strong>スケーラビリティ</strong></td>
<td>中</td>
<td>高</td>
<td>中</td>
<td>非常に高</td>
</tr>
<tr>
<td><strong>複雑性</strong></td>
<td>低</td>
<td>中</td>
<td>中</td>
<td>高</td>
</tr>
</tbody>
</table>
<h3 id="cqrses_1">CQRS/ES を選択する場面<a class="headerlink" href="#cqrses_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>製造履歴要件</strong>: すべての製造工程の履歴が必要</li>
<li><strong>品質トレーサビリティ</strong>: 製品の製造履歴を追跡したい</li>
<li><strong>複雑な業務フロー</strong>: 製造指図の多様な状態遷移を管理</li>
<li><strong>高いスケーラビリティ</strong>: MRP 計算と照会を独立してスケール</li>
<li><strong>原価計算</strong>: イベントから正確な製造原価を算出</li>
</ol>
<p>CQRS/ES は導入コストが高いですが、製造履歴の追跡や品質トレーサビリティが重要な生産管理システムでは、その恩恵は大きくなります。Axon Framework を使用することで、イベントソーシングと CQRS の複雑さを軽減し、ドメインロジックに集中できます。MyBatis を使用することで、Read Model の更新において柔軟な SQL 制御が可能になります。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>