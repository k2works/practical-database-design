
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../study4-2/">
      
      
        <link rel="next" href="../study4-4/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>研究3 gRPCサービスの実装 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-grpc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              研究3 gRPCサービスの実装
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" checked>
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        はじめに
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        第42章：gRPC サーバーの基礎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第42章：gRPC サーバーの基礎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.1 gRPC とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.2 4つの通信パターン
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.3 gRPC におけるヘキサゴナルアーキテクチャ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.4 ディレクトリ構成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#425" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.5 技術スタックの追加
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#386-protocol-buffers" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.6 Protocol Buffers 定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#387-api-controller" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.7 API サーバー版との Controller の違い
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        第43章：マスタ API の実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第43章：マスタ API の実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-proto" class="md-nav__link">
    <span class="md-ellipsis">
      
        43.1 Proto マッパーの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#432-grpc-tdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        43.2 品目 gRPC サービスの TDD 実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="43.2 品目 gRPC サービスの TDD 実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#red" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red: 失敗するテストを書く
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#green-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Green: gRPC サービスの実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#433-bom-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        43.3 BOM gRPC サービスの実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        第44章：トランザクション API の実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第44章：トランザクション API の実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        44.1 発注 gRPC サービス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442-mrp-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        44.2 MRP gRPC サービス
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45" class="md-nav__link">
    <span class="md-ellipsis">
      
        第45章：エラーハンドリングとストリーミング
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第45章：エラーハンドリングとストリーミング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#451-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        45.1 gRPC ステータスコード
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#452" class="md-nav__link">
    <span class="md-ellipsis">
      
        45.2 グローバルインターセプター
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#453" class="md-nav__link">
    <span class="md-ellipsis">
      
        45.3 ヘルスチェックの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#454" class="md-nav__link">
    <span class="md-ellipsis">
      
        45.4 設定ファイル
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#455-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        45.5 gRPC クライアントからの呼び出し
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        まとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="まとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        API サーバー版との比較
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        実装した gRPC サービス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        技術スタック
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpc_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        gRPC を選択すべき場面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="3-grpc">実践データベース設計：生産管理システム 研究 3 - gRPC サービスの実装<a class="headerlink" href="#3-grpc" title="Permanent link">&para;</a></h1>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本研究では、API サーバー構成（第32章）とは異なるアプローチとして、<strong>gRPC</strong> による生産管理システムを実装します。Protocol Buffers によるスキーマ駆動開発と HTTP/2 の双方向ストリーミングを活用した、高性能な API を構築します。</p>
<p>第32章で構築したヘキサゴナルアーキテクチャ（ドメイン層・アプリケーション層）はそのまま共有し、<strong>Input Adapter として gRPC サービス層のみを追加</strong>します。</p>
<hr />
<h2 id="42grpc">第42章：gRPC サーバーの基礎<a class="headerlink" href="#42grpc" title="Permanent link">&para;</a></h2>
<h3 id="421-grpc">42.1 gRPC とは<a class="headerlink" href="#421-grpc" title="Permanent link">&para;</a></h3>
<p>gRPC は Google が開発した高性能な RPC（Remote Procedure Call）フレームワークです。Protocol Buffers をインターフェース定義言語（IDL）として使用し、HTTP/2 上で動作します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9Ijc4NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTQ5cHg7aGVpZ2h0Ojc4NXB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDU0OSA3ODUiIHdpZHRoPSI1NDlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNzg1IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNTQ5IiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgZ1JQQyBBcmNoaXRlY3R1cmUgKD8/Pz8/Pz8/KS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJnUlBDIEFyY2hpdGVjdHVyZSAuLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0iZW50MDAwMiI+PHBhdGggZD0iTTguNSw2IEwyODMuNzMsNiBBMy43NSwzLjc1IDAgMCAxIDI4Ni4yMyw4LjUgTDI5My4yMywyOC4yOTY5IEw1MzkuNSwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDU0MiwzMC43OTY5IEw1NDIsNjczLjk1IEEyLjUsMi41IDAgMCAxIDUzOS41LDY3Ni40NSBMOC41LDY3Ni40NSBBMi41LDIuNSAwIDAgMSA2LDY3My45NSBMNiw4LjUgQTIuNSwyLjUgMCAwIDEgOC41LDYiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjYiIHgyPSIyOTMuMjMiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNzQuMjMiIHg9IjEwIiB5PSIyMC45OTUxIj5nUlBDIEFyY2hpdGVjdHVyZSAoJiMyOTk4MzsmIzI5OTg3OyYjMzE2NDk7JiMyOTcwMjsmIzEyNDcxOyYjMTI0NzM7JiMxMjQ4NjsmIzEyNTEyOyk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIENsaWVudCBTaWRlLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImdSUEMgQXJjaGl0ZWN0dXJlIC4uLi4uLi4uLi4uQ2xpZW50IFNpZGUiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDAzIj48cGF0aCBkPSJNMjE3LjUsNDkgTDMwMy43OTg4LDQ5IEEzLjc1LDMuNzUgMCAwIDEgMzA2LjI5ODgsNTEuNSBMMzEzLjI5ODgsNzEuMjk2OSBMNDU4LjUsNzEuMjk2OSBBMi41LDIuNSAwIDAgMSA0NjEsNzMuNzk2OSBMNDYxLDIwNC45OCBBMi41LDIuNSAwIDAgMSA0NTguNSwyMDcuNDggTDIxNy41LDIwNy40OCBBMi41LDIuNSAwIDAgMSAyMTUsMjA0Ljk4IEwyMTUsNTEuNSBBMi41LDIuNSAwIDAgMSAyMTcuNSw0OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjE1IiB4Mj0iMzEzLjI5ODgiIHkxPSI3MS4yOTY5IiB5Mj0iNzEuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NS4yOTg4IiB4PSIyMTkiIHk9IjYzLjk5NTEiPkNsaWVudCBTaWRlPC90ZXh0PjwvZz48IS0tY2x1c3RlciBTZXJ2ZXIgU2lkZS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJnUlBDIEFyY2hpdGVjdHVyZSAuLi4uLi4uLi4uLlNlcnZlciBTaWRlIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMDUiPjxwYXRoIGQ9Ik0zMi41LDI3MS40OCBMMTI0Ljc4MDMsMjcxLjQ4IEEzLjc1LDMuNzUgMCAwIDEgMTI3LjI4MDMsMjczLjk4IEwxMzQuMjgwMywyOTMuNzc2OSBMMzczLjUsMjkzLjc3NjkgQTIuNSwyLjUgMCAwIDEgMzc2LDI5Ni4yNzY5IEwzNzYsNDI3LjQ3IEEyLjUsMi41IDAgMCAxIDM3My41LDQyOS45NyBMMzIuNSw0MjkuOTcgQTIuNSwyLjUgMCAwIDEgMzAsNDI3LjQ3IEwzMCwyNzMuOTggQTIuNSwyLjUgMCAwIDEgMzIuNSwyNzEuNDgiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjMwIiB4Mj0iMTM0LjI4MDMiIHkxPSIyOTMuNzc2OSIgeTI9IjI5My43NzY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjI4MDMiIHg9IjM0IiB5PSIyODYuNDc1MSI+U2VydmVyIFNpZGU8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFNoYXJlZC0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJnUlBDIEFyY2hpdGVjdHVyZSAuLi4uLi4uLi4uLlNoYXJlZCIgZGF0YS1zb3VyY2UtbGluZT0iMjMiIGlkPSJlbnQwMDA3Ij48cGF0aCBkPSJNMjU5LjUsNDkzLjk3IEwzMTYuNDE4LDQ5My45NyBBMy43NSwzLjc1IDAgMCAxIDMxOC45MTgsNDk2LjQ3IEwzMjUuOTE4LDUxNi4yNjY5IEw0NjIuNSw1MTYuMjY2OSBBMi41LDIuNSAwIDAgMSA0NjUsNTE4Ljc2NjkgTDQ2NSw2NDkuOTUgQTIuNSwyLjUgMCAwIDEgNDYyLjUsNjUyLjQ1IEwyNTkuNSw2NTIuNDUgQTIuNSwyLjUgMCAwIDEgMjU3LDY0OS45NSBMMjU3LDQ5Ni40NyBBMi41LDIuNSAwIDAgMSAyNTkuNSw0OTMuOTciIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjI1NyIgeDI9IjMyNS45MTgiIHkxPSI1MTYuMjY2OSIgeTI9IjUxNi4yNjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1LjkxOCIgeD0iMjYxIiB5PSI1MDguOTY1MSI+U2hhcmVkPC90ZXh0PjwvZz48IS0tY2xhc3MgY2xpZW50LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iZ1JQQyBBcmNoaXRlY3R1cmUgLi4uLi4uLi4uLi5DbGllbnQgU2lkZS5jbGllbnQiIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJlbnQwMDA0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwNy40ODQ0IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMTQuMDM2MSIgeD0iMjMwLjk4IiB5PSI4NCIvPjxlbGxpcHNlIGN4PSIyNzkuMTMyMyIgY3k9IjEwNS4yOTY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0yODIuMTAxMSwxMTAuOTM3NSBRMjgxLjUyMywxMTEuMjM0NCAyODAuODgyMywxMTEuMzc1IFEyODAuMjQxNywxMTEuNTMxMyAyNzkuNTM4NiwxMTEuNTMxMyBRMjc3LjAzODYsMTExLjUzMTMgMjc1LjcxMDUsMTA5Ljg5MDYgUTI3NC4zOTgsMTA4LjIzNDQgMjc0LjM5OCwxMDUuMTA5NCBRMjc0LjM5OCwxMDEuOTg0NCAyNzUuNzEwNSwxMDAuMzI4MSBRMjc3LjAzODYsOTguNjcxOSAyNzkuNTM4Niw5OC42NzE5IFEyODAuMjQxNyw5OC42NzE5IDI4MC44ODIzLDk4LjgyODEgUTI4MS41Mzg2LDk4Ljk4NDQgMjgyLjEwMTEsOTkuMjgxMyBMMjgyLjEwMTEsMTAyIFEyODEuNDc2MSwxMDEuNDIxOSAyODAuODgyMywxMDEuMTU2MyBRMjgwLjI4ODYsMTAwLjg3NSAyNzkuNjYzNiwxMDAuODc1IFEyNzguMzE5OCwxMDAuODc1IDI3Ny42MzIzLDEwMS45NTMxIFEyNzYuOTQ0OCwxMDMuMDE1NiAyNzYuOTQ0OCwxMDUuMTA5NCBRMjc2Ljk0NDgsMTA3LjIwMzEgMjc3LjYzMjMsMTA4LjI4MTMgUTI3OC4zMTk4LDEwOS4zNDM4IDI3OS42NjM2LDEwOS4zNDM4IFEyODAuMjg4NiwxMDkuMzQzOCAyODAuODgyMywxMDkuMDc4MSBRMjgxLjQ3NjEsMTA4Ljc5NjkgMjgyLjEwMTEsMTA4LjIxODggTDI4Mi4xMDExLDExMC45Mzc1IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODEuODEyNSIgeD0iMzEzLjM0MTgiIHk9IjEwMS45OTUxIj5nUlBDIENsaWVudDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkuMjMxNCIgeD0iMjk5LjYzMjMiIHk9IjExOC4yOTIiPihKYXZhL0tvdGxpbi9Hbyk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjMxLjk4IiB4Mj0iNDQ0LjAxNjEiIHkxPSIxMjYuNTkzOCIgeTI9IjEyNi41OTM4Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyMzguOTgiIHk9IjEzNy4yNDIyIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNS43NDYxIiB4PSIyNTAuOTgiIHk9IjE0My41ODg5Ij5JdGVtU2VydmljZVN0dWI8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyMzguOTgiIHk9IjE1My41MzkxIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4OC4wMzYxIiB4PSIyNTAuOTgiIHk9IjE1OS44ODU3Ij5QdXJjaGFzZU9yZGVyU2VydmljZVN0dWI8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyMzguOTgiIHk9IjE2OS44MzU5Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMC41OTg2IiB4PSIyNTAuOTgiIHk9IjE3Ni4xODI2Ij5NcnBTZXJ2aWNlU3R1YjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMzEuOTgiIHgyPSI0NDQuMDE2MSIgeTE9IjE4My40ODQ0IiB5Mj0iMTgzLjQ4NDQiLz48L2c+PCEtLWNsYXNzIHNlcnZlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImdSUEMgQXJjaGl0ZWN0dXJlIC4uLi4uLi4uLi4uU2VydmVyIFNpZGUuc2VydmVyIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgaWQ9ImVudDAwMDYiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTA3LjQ4NDQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjMxMy44NTk0IiB4PSI0Ni4wNyIgeT0iMzA2LjQ4Ii8+PGVsbGlwc2UgY3g9IjYxLjA3IiBjeT0iMzI3Ljc3NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTY0LjAzODgsMzMzLjQxNzUgUTYzLjQ2MDYsMzMzLjcxNDQgNjIuODIsMzMzLjg1NSBRNjIuMTc5NCwzMzQuMDExMyA2MS40NzYzLDMzNC4wMTEzIFE1OC45NzYzLDMzNC4wMTEzIDU3LjY0ODEsMzMyLjM3MDYgUTU2LjMzNTYsMzMwLjcxNDQgNTYuMzM1NiwzMjcuNTg5NCBRNTYuMzM1NiwzMjQuNDY0NCA1Ny42NDgxLDMyMi44MDgxIFE1OC45NzYzLDMyMS4xNTE5IDYxLjQ3NjMsMzIxLjE1MTkgUTYyLjE3OTQsMzIxLjE1MTkgNjIuODIsMzIxLjMwODEgUTYzLjQ3NjMsMzIxLjQ2NDQgNjQuMDM4OCwzMjEuNzYxMyBMNjQuMDM4OCwzMjQuNDggUTYzLjQxMzgsMzIzLjkwMTkgNjIuODIsMzIzLjYzNjMgUTYyLjIyNjMsMzIzLjM1NSA2MS42MDEzLDMyMy4zNTUgUTYwLjI1NzUsMzIzLjM1NSA1OS41NywzMjQuNDMzMSBRNTguODgyNSwzMjUuNDk1NiA1OC44ODI1LDMyNy41ODk0IFE1OC44ODI1LDMyOS42ODMxIDU5LjU3LDMzMC43NjEzIFE2MC4yNTc1LDMzMS44MjM4IDYxLjYwMTMsMzMxLjgyMzggUTYyLjIyNjMsMzMxLjgyMzggNjIuODIsMzMxLjU1ODEgUTYzLjQxMzgsMzMxLjI3NjkgNjQuMDM4OCwzMzAuNjk4OCBMNjQuMDM4OCwzMzMuNDE3NSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg3LjE5MjQiIHg9IjE3Mi40MDM1IiB5PSIzMjQuNDc1MSI+Z1JQQyBTZXJ2ZXI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgxLjg1OTQiIHg9Ijc1LjA3IiB5PSIzNDAuNzcyIj4oU3ByaW5nIEJvb3QgKyBncnBjLXNwcmluZy1ib290LXN0YXJ0ZXIpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQ3LjA3IiB4Mj0iMzU4LjkyOTQiIHkxPSIzNDkuMDczOCIgeTI9IjM0OS4wNzM4Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI1NC4wNyIgeT0iMzU5LjcyMjIiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE2Ljc5ODgiIHg9IjY2LjA3IiB5PSIzNjYuMDY4OSI+SXRlbUdycGNTZXJ2aWNlPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFJJVkFURV9GSUVMRCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iNTQuMDciIHk9IjM3Ni4wMTkxIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4OS4wODg5IiB4PSI2Ni4wNyIgeT0iMzgyLjM2NTciPlB1cmNoYXNlT3JkZXJHcnBjU2VydmljZTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjU0LjA3IiB5PSIzOTIuMzE1OSIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEuNjUxNCIgeD0iNjYuMDciIHk9IjM5OC42NjI2Ij5NcnBHcnBjU2VydmljZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0Ny4wNyIgeDI9IjM1OC45Mjk0IiB5MT0iNDA1Ljk2NDQiIHkyPSI0MDUuOTY0NCIvPjwvZz48IS0tY2xhc3MgcHJvdG8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJnUlBDIEFyY2hpdGVjdHVyZSAuLi4uLi4uLi4uLlNoYXJlZC5wcm90byIgZGF0YS1zb3VyY2UtbGluZT0iMjQiIGlkPSJlbnQwMDA4Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwNy40ODQ0IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzYuODYyMyIgeD0iMjcyLjU3IiB5PSI1MjguOTciLz48ZWxsaXBzZSBjeD0iMzAyLjYxOTUiIGN5PSI1NTAuMjY2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMzA1LjU4ODMsNTU1LjkwNzUgUTMwNS4wMTAxLDU1Ni4yMDQ0IDMwNC4zNjk1LDU1Ni4zNDUgUTMwMy43Mjg5LDU1Ni41MDEzIDMwMy4wMjU4LDU1Ni41MDEzIFEzMDAuNTI1OCw1NTYuNTAxMyAyOTkuMTk3Niw1NTQuODYwNiBRMjk3Ljg4NTEsNTUzLjIwNDQgMjk3Ljg4NTEsNTUwLjA3OTQgUTI5Ny44ODUxLDU0Ni45NTQ0IDI5OS4xOTc2LDU0NS4yOTgxIFEzMDAuNTI1OCw1NDMuNjQxOSAzMDMuMDI1OCw1NDMuNjQxOSBRMzAzLjcyODksNTQzLjY0MTkgMzA0LjM2OTUsNTQzLjc5ODEgUTMwNS4wMjU4LDU0My45NTQ0IDMwNS41ODgzLDU0NC4yNTEzIEwzMDUuNTg4Myw1NDYuOTcgUTMwNC45NjMzLDU0Ni4zOTE5IDMwNC4zNjk1LDU0Ni4xMjYzIFEzMDMuNzc1OCw1NDUuODQ1IDMwMy4xNTA4LDU0NS44NDUgUTMwMS44MDcsNTQ1Ljg0NSAzMDEuMTE5NSw1NDYuOTIzMSBRMzAwLjQzMiw1NDcuOTg1NiAzMDAuNDMyLDU1MC4wNzk0IFEzMDAuNDMyLDU1Mi4xNzMxIDMwMS4xMTk1LDU1My4yNTEzIFEzMDEuODA3LDU1NC4zMTM4IDMwMy4xNTA4LDU1NC4zMTM4IFEzMDMuNzc1OCw1NTQuMzEzOCAzMDQuMzY5NSw1NTQuMDQ4MSBRMzA0Ljk2MzMsNTUzLjc2NjkgMzA1LjU4ODMsNTUzLjE4ODggTDMwNS41ODgzLDU1NS45MDc1IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjQxODkiIHg9IjMxOS45NjM4IiB5PSI1NDYuOTY1MSI+UHJvdG9jb2wgQnVmZmVyczwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NS43MDIxIiB4PSIzMzIuODIyMiIgeT0iNTYzLjI2MiI+KC5wcm90byBmaWxlcyk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjczLjU3IiB4Mj0iNDQ4LjQzMjMiIHkxPSI1NzEuNTYzOCIgeTI9IjU3MS41NjM4Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyODAuNTciIHk9IjU4Mi4yMTIyIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjczLjM0MjgiIHg9IjI5Mi41NyIgeT0iNTg4LjU1ODkiPml0ZW0ucHJvdG88L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyODAuNTciIHk9IjU5OC41MDkxIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MC44NjIzIiB4PSIyOTIuNTciIHk9IjYwNC44NTU3Ij5wdXJjaGFzZV9vcmRlci5wcm90bzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI4MC41NyIgeT0iNjE0LjgwNTkiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTkzMiIgeD0iMjkyLjU3IiB5PSI2MjEuMTUyNiI+bXJwLnByb3RvPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI3My41NyIgeDI9IjQ0OC40MzIzIiB5MT0iNjI4LjQ1NDQiIHkyPSI2MjguNDU0NCIvPjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4xMiIgZGF0YS1zb3VyY2UtbGluZT0iMzciIGlkPSJlbnQwMDEzIj48cGF0aCBkPSJNMjk4LjUsNzIzLjQ1IEwyOTguNSw3NzguODQ4NCBBMCwwIDAgMCAwIDI5OC41LDc3OC44NDg0IEw0MjMuNTAwMSw3NzguODQ4NCBBMCwwIDAgMCAwIDQyMy41MDAxLDc3OC44NDg0IEw0MjMuNTAwMSw3MzMuNDUgTDQxMy41MDAxLDcyMy40NSBMMzY1LDcyMy40NSBMMzYxLDYzNi44MyBMMzU3LDcyMy40NSBMMjk4LjUsNzIzLjQ1IEEwLDAgMCAwIDAgMjk4LjUsNzIzLjQ1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNDEzLjUwMDEsNzIzLjQ1IEw0MTMuNTAwMSw3MzMuNDUgTDQyMy41MDAxLDczMy40NSBMNDEzLjUwMDEsNzIzLjQ1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMzA0LjUiIHk9Ijc0MC41MTY5Ij4mIzEyNDczOyYjMTI0NjE7JiMxMjU0MDsmIzEyNTEwOyYjMzkzNjY7JiMyMTIwNTsmIzM4MjgzOyYjMzAzMzA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjMwNC41IiB5PSI3NTUuNjQ5NyI+JiMyMjQxMTsmIzIzNDMzOyYjMjA4NDA7JiMxMjM5NDsmIzM2ODkwOyYjMjA0NDk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIzMDQuNSIgeT0iNzcwLjc4MjUiPiYjMzUzMjg7JiMzNTQ4NjsmIzM4MjkxOyYjMzA0NTY7JiMyMDExNDsmIzM2OTM5OyYjMjk5OTI7JiMyNDYxNTs8L3RleHQ+PC9nPjwhLS1saW5rIGNsaWVudCB0byBwcm90by0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA4IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzIiIGlkPSJsbms5Ij48cGF0aCBjb2RlTGluZT0iMzIiIGQ9Ik00MDQuNjgsMTkxLjY5IEM0MTIuOTQsMjAxLjM0IDQyMC4xNiwyMTIuMDIgNDI1LDIyMy40OCBDNDY4LjIzLDMyNS45MyA0MjQuMjkxNyw0NTEuMzg1NiAzOTEuMDMxNyw1MjMuMTk1NiIgZmlsbD0ibm9uZSIgaWQ9ImNsaWVudC10by1wcm90byIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzg4LjUxLDUyOC42NCwzOTUuOTIyMSw1MjIuMTU0NSwzOTAuNjExNCw1MjQuMTAzLDM4OC42NjI5LDUxOC43OTIzLDM4OC41MSw1MjguNjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC44NDA0IiB4PSI0NDMuNDkiIHk9IjM1Ny4yODY5Ij4mIzI5OTgzOyYjMjUxMDQ7JiMxMjM3MzsmIzEyNDI4OyYjMTIzODM7U3R1YjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOSIgeD0iNDcxLjQxMDIiIHk9IjM3Mi40MTk3Ij4mIzEyNDM0OyYjMjAzNTE7JiMyOTk5Mjs8L3RleHQ+PC9nPjwhLS1saW5rIHNlcnZlciB0byBwcm90by0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA2IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA4IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzMiIGlkPSJsbmsxMCI+PHBhdGggY29kZUxpbmU9IjMzIiBkPSJNMjQxLjA1LDQxNC4zMiBDMjY1Ljg4LDQ0OC45OCAyOTQuNjg1MSw0ODkuMTcyOSAzMTkuNTE1MSw1MjMuODIyOSIgZmlsbD0ibm9uZSIgaWQ9InNlcnZlci10by1wcm90byIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzIzLjAxLDUyOC43LDMyMS4wMTkxLDUxOS4wNTQ1LDMyMC4wOTc2LDUyNC42MzU4LDMxNC41MTYzLDUyMy43MTQzLDMyMy4wMSw1MjguNyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMy4wNDU1IiB4PSIyODMiIHk9IjQ1OS4wMzY5Ij4mIzI5OTgzOyYjMjUxMDQ7JiMxMjM3MzsmIzEyNDI4OyYjMTIzODM7U2VydmljZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOSIgeD0iMzIwLjAyMjciIHk9IjQ3NC4xNjk3Ij4mIzEyNDM0OyYjMjM0NTU7JiMzNTAxMzs8L3RleHQ+PC9nPjwhLS1saW5rIGNsaWVudCB0byBzZXJ2ZXItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAwNiIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjM0IiBpZD0ibG5rMTEiPjxwYXRoIGNvZGVMaW5lPSIzNCIgZD0iTTI5Ni42NTQ0LDE5Ni40OTY3IEMyODkuNDc0NCwyMDYuOTU2NyAyODUuNTYsMjEzIDI3OSwyMjMuNDggQzI2Mi4zLDI1MC4xNSAyNDcuOTQ1MywyNzUuMzkzOCAyMzQuMTE1MywzMDAuNzIzOCIgZmlsbD0ibm9uZSIgaWQ9ImNsaWVudC1zZXJ2ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMwMC4wNSwxOTEuNTUsMjkxLjY1ODgsMTk2LjcwNjQsMjk3LjIyMDQsMTk1LjY3MjMsMjk4LjI1NDUsMjAxLjIzMzgsMzAwLjA1LDE5MS41NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjMxLjI0LDMwNS45OSwyMzkuMDYzNywzMDAuMDA3NiwyMzMuNjM2MSwzMDEuNjAxNSwyMzIuMDQyMiwyOTYuMTczOSwyMzEuMjQsMzA1Ljk5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDYuMTQ3NSIgeD0iMzI2Ljk5ODEiIHk9IjIzNi41NDY5Ij5IVFRQLzI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQwLjE0MzciIHg9IjI4MCIgeT0iMjUxLjY3OTciPigmIzIxNDUyOyYjMjYwNDE7JiMyMTUyMTsmIzEyNDczOyYjMTI0ODg7JiMxMjUyMjsmIzEyNTQwOyYjMTI1MTE7JiMxMjUzMTsmIzEyNDY0Oyk8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIFZQOUZRemltNkNSbC1YSVFUc2FQTmMzN0NHUGpvQkJfMnFzRVhRN09pY2xnTTRRTVVvYzVuQVFYOU9MYk5IaE8xaWJBM21zMVhTNEVNeWo2RnVwWUVGdU1hb3J0SkdDUmtpWkZlX1ZIeHR0YkVwZXNCMFYzWkxBbmpsUXdfQjg0REhqdjdXM1Vqa011WUE4NmgyRGpzd0o0VF9HWWlHYzVUdi1LcVdNMEFtbmFPZ1lPNnZLWU5BRlFiaU1tbmRvQXVLaFM2eVF6aXRYbzZkVlJGRloxV21pVWpkZHVQTE0xa21rTEhUbDIzZURMSXlVZlNLQ1hDd016d1FteUhwa2V5ODhtc3Q4QVBJOTJhMlQwaXpmVGVDOWQzM1VnY0V2TzZndW9sb3dLWVl6bWE4VlZLMXRKc3pPaHdZdUFVc0JUMEFLRWZseTRhaE8wZ2hoS1Nhb3VKV1kzencxOU5LdHJDYWNqMnFkcjZBOENLbWRnb1NuaHFCOHVkMENpV3p3czFFWVlpMEl3WElaTWJuV2hiMzJZNEhray11UTFnSVQweHhrZjFXdEJuZng0YUs5QTh2d2g4TnRudVVPV1JxYkF5YlRrSzNWVnhxYzJWRW9nLVpYRlVXV0x5VGdwV292bGRWM1dZQlU2d0xtdDdIdVNKdHpWblJzSDBsODlfQlQ2VGZjTEhQRlhfNm5Wa1J4Z0tMZ05IdVoyZnhMUWZWMTBqMVF6RXZockJ3QmstLXBsRWszWGM4VV9VM1phdU5TVVY1akwwNzA4bXgxRTYyQ0RJMG52RHFYRjFyLXBldUZhbDFyckpmOS05X3Z1MlE5MTl2ZVNIbGladFhlZHBLX0pnckNtN3BOZHVxN0lfbjFfX1pjekY0dlE3VDdGaDdhRWlBRjNERnFGPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<p><strong>REST API との比較：</strong></p>
<table>
<thead>
<tr>
<th>特徴</th>
<th>REST API</th>
<th>gRPC</th>
</tr>
</thead>
<tbody>
<tr>
<td>プロトコル</td>
<td>HTTP/1.1</td>
<td>HTTP/2</td>
</tr>
<tr>
<td>データ形式</td>
<td>JSON (テキスト)</td>
<td>Protocol Buffers (バイナリ)</td>
</tr>
<tr>
<td>スキーマ</td>
<td>OpenAPI (任意)</td>
<td>.proto (必須)</td>
</tr>
<tr>
<td>ストリーミング</td>
<td>WebSocket 別実装</td>
<td>ネイティブサポート</td>
</tr>
<tr>
<td>コード生成</td>
<td>手動/ツール</td>
<td>自動生成</td>
</tr>
<tr>
<td>パフォーマンス</td>
<td>標準</td>
<td>高速</td>
</tr>
</tbody>
</table>
<h3 id="422-4">42.2 4つの通信パターン<a class="headerlink" href="#422-4" title="Permanent link">&para;</a></h3>
<p>gRPC は 4 つの通信パターンをサポートします：</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjIxNXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTQ2NHB4O2hlaWdodDoyMTVweDtiYWNrZ3JvdW5kOiNGRUZFRkU7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNDY0IDIxNSIgd2lkdGg9IjE0NjRweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iMjE1IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTQ2NCIgeD0iMCIgeT0iMCIvPjwhLS1jbHVzdGVyIHVuYXJ5LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9InVuYXJ5IiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyMDIuMDkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIyMjciIHg9IjciIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjkzNTUiIHg9IjY5LjAzMjIiIHk9IjIxLjk5NTEiPjEuIFVuYXJ5IFJQQzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuNzk2OCIgeD0iMTAwLjEwMTYiIHk9IjM4LjI5MiI+KCYjMjEzMzY7JiMzODkxNzspPC90ZXh0PjwvZz48IS0tY2x1c3RlciBzZXJ2ZXJfc3RyZWFtLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9InNlcnZlcl9zdHJlYW0iIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJlbnQwMDA3Ij48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIwMi4wOSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjQ3NCIgeD0iMjU4IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OC44MTI1IiB4PSI0MTUuNTkzOCIgeT0iMjEuOTk1MSI+Mi4gU2VydmVyIFN0cmVhbWluZzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY2Ljc5NjIiIHg9IjQxMS42MDE5IiB5PSIzOC4yOTIiPigmIzEyNDY5OyYjMTI1NDA7JiMxMjQ5NjsmIzEyNTQwOyYjMTI0NzM7JiMxMjQ4ODsmIzEyNTIyOyYjMTI1NDA7JiMxMjUxMTsmIzEyNTMxOyYjMTI0NjQ7KTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgY2xpZW50X3N0cmVhbS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJjbGllbnRfc3RyZWFtIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjAyLjA5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNDU1IiB4PSI3NTYiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUyLjgzMTEiIHg9IjkwNy4wODQ1IiB5PSIyMS45OTUxIj4zLiBDbGllbnQgU3RyZWFtaW5nPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTQuNzk2MSIgeD0iODg2LjEwMiIgeT0iMzguMjkyIj4oJiMxMjQ2MzsmIzEyNTIxOyYjMTI0NTI7JiMxMjQ1MDsmIzEyNTMxOyYjMTI0ODg7JiMxMjQ3MzsmIzEyNDg4OyYjMTI1MjI7JiMxMjU0MDsmIzEyNTExOyYjMTI1MzE7JiMxMjQ2NDspPC90ZXh0PjwvZz48IS0tY2x1c3RlciBiaWRpLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImJpZGkiIGRhdGEtc291cmNlLWxpbmU9IjIyIiBpZD0iZW50MDAyMSI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyMDIuMDkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIyMjMiIHg9IjEyMzUiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjA3LjExNTIiIHg9IjEyNDIuOTQyNCIgeT0iMjEuOTk1MSI+NC4gQmlkaXJlY3Rpb25hbCBTdHJlYW1pbmc8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi43OTYzIiB4PSIxMjcwLjEwMTkiIHk9IjM4LjI5MiI+KCYjMjE0NTI7JiMyNjA0MTsmIzIxNTIxOyYjMTI0NzM7JiMxMjQ4ODsmIzEyNTIyOyYjMTI1NDA7JiMxMjUxMTsmIzEyNTMxOyYjMTI0NjQ7KTwvdGV4dD48L2c+PCEtLWVudGl0eSBDbGllbnQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJ1bmFyeS5DbGllbnQiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAzIj48ZWxsaXBzZSBjeD0iMTA0Ljk5OTIiIGN5PSI3Mi41MjM2IiBmaWxsPSIjRjFGMUYxIiByeD0iMzEuNjU5MiIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjUzMDMiIHg9Ijg0LjczNDEiIHk9Ijc3LjE3MjEiPkNsaWVudDwvdGV4dD48L2c+PCEtLWVudGl0eSBTZXJ2ZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJ1bmFyeS5TZXJ2ZXIiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDA0Ij48ZWxsaXBzZSBjeD0iMTA1LjAwMzQiIGN5PSIxNzguNTczNiIgZmlsbD0iI0YxRjFGMSIgcng9IjM1LjQ2MzQiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NS45MTAyIiB4PSI4Mi4wNDgzIiB5PSIxODMuMjIyMSI+U2VydmVyPC90ZXh0PjwvZz48IS0tZW50aXR5IENsaWVudDItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJzZXJ2ZXJfc3RyZWFtLkNsaWVudDIiIGRhdGEtc291cmNlLWxpbmU9IjkiIGlkPSJlbnQwMDA4Ij48ZWxsaXBzZSBjeD0iNDYxLjk5NzYiIGN5PSI3Mi41MjM2IiBmaWxsPSIjRjFGMUYxIiByeD0iMzcuOTU3NiIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5LjQzNzUiIHg9IjQzNy4yNzg4IiB5PSI3Ny4xNzIxIj5DbGllbnQyPC90ZXh0PjwvZz48IS0tZW50aXR5IFNlcnZlcjItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJzZXJ2ZXJfc3RyZWFtLlNlcnZlcjIiIGRhdGEtc291cmNlLWxpbmU9IjkiIGlkPSJlbnQwMDA5Ij48ZWxsaXBzZSBjeD0iNDYyLjAwMTciIGN5PSIxNzguNTczNiIgZmlsbD0iI0YxRjFGMSIgcng9IjQxLjc2MTciIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NC44MTc0IiB4PSI0MzQuNTkzMSIgeT0iMTgzLjIyMjEiPlNlcnZlcjI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQ2xpZW50My0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImNsaWVudF9zdHJlYW0uQ2xpZW50MyIgZGF0YS1zb3VyY2UtbGluZT0iMTYiIGlkPSJlbnQwMDE1Ij48ZWxsaXBzZSBjeD0iOTY2Ljk5NzYiIGN5PSI3Mi41MjM2IiBmaWxsPSIjRjFGMUYxIiByeD0iMzcuOTU3NiIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5LjQzNzUiIHg9Ijk0Mi4yNzg4IiB5PSI3Ny4xNzIxIj5DbGllbnQzPC90ZXh0PjwvZz48IS0tZW50aXR5IFNlcnZlcjMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJjbGllbnRfc3RyZWFtLlNlcnZlcjMiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBpZD0iZW50MDAxNiI+PGVsbGlwc2UgY3g9Ijk2Ny4wMDE3IiBjeT0iMTc4LjU3MzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSI0MS43NjE3IiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuODE3NCIgeD0iOTM5LjU5MzEiIHk9IjE4My4yMjIxIj5TZXJ2ZXIzPC90ZXh0PjwvZz48IS0tZW50aXR5IENsaWVudDQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJiaWRpLkNsaWVudDQiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0iZW50MDAyMiI+PGVsbGlwc2UgY3g9IjEzMzMuOTk3NiIgY3k9IjcyLjUyMzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSIzNy45NTc2IiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDkuNDM3NSIgeD0iMTMwOS4yNzg4IiB5PSI3Ny4xNzIxIj5DbGllbnQ0PC90ZXh0PjwvZz48IS0tZW50aXR5IFNlcnZlcjQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJiaWRpLlNlcnZlcjQiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0iZW50MDAyMyI+PGVsbGlwc2UgY3g9IjEzMzguMDAxNyIgY3k9IjE3OC41NzM2IiBmaWxsPSIjRjFGMUYxIiByeD0iNDEuNzYxNyIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU0LjgxNzQiIHg9IjEzMTAuNTkzMSIgeT0iMTgzLjIyMjEiPlNlcnZlcjQ8L3RleHQ+PC9nPjwhLS1saW5rIENsaWVudCB0byBTZXJ2ZXItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJsbms1Ij48cGF0aCBkPSJNODUuODYsODQuMzYgQzc0LjU5LDkxLjkxIDYxLjM0LDEwMy4xMSA1NSwxMTcuMDQgQzQ2LjA4LDEzNi42NCA2Mi4xNjUxLDE1MS44NTIxIDc5LjY1NTEsMTYzLjExMjEiIGZpbGw9Im5vbmUiIGlkPSJDbGllbnQtdG8tU2VydmVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4NC43LDE2Ni4zNiw3OS4yOTc5LDE1OC4xMjQ5LDgwLjQ5NTksMTYzLjY1MzQsNzQuOTY3NCwxNjQuODUxNCw4NC43LDE2Ni4zNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzLjM5MDEiIHg9IjU2IiB5PSIxMzAuMTA2OSI+UmVxdWVzdDwvdGV4dD48L2c+PCEtLWxpbmsgU2VydmVyIHRvIENsaWVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDAzIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImxuazYiPjxwYXRoIGQ9Ik0xMDkuMDYsMTYzLjY3IEMxMTIuMTYsMTUxLjQzIDExNS42NCwxMzMuMTEgMTE0LDExNy4wNCBDMTEyLjk2LDEwNi45MSAxMTEuOTk1NiwxMDEuNDk1NCAxMDkuOTU1Niw5Mi45NjU0IiBmaWxsPSJub25lIiBpZD0iU2VydmVyLXRvLUNsaWVudCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTA4LjU2LDg3LjEzLDEwNi43NjMxLDk2LjgxMzUsMTA5LjcyMyw5MS45OTI5LDExNC41NDM3LDk0Ljk1MjgsMTA4LjU2LDg3LjEzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMuMDE5NSIgeD0iMTE1LjQyIiB5PSIxMzAuMTA2OSI+UmVzcG9uc2U8L3RleHQ+PC9nPjwhLS1saW5rIENsaWVudDIgdG8gU2VydmVyMi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA5IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImxuazEwIj48cGF0aCBkPSJNNDI0LjI1LDc1LjA5IEMzNjguNDEsNzguODMgMjczLjY4LDkxLjQ3IDMwNiwxMzQuMDQgQzMyMC4yLDE1Mi43NCAzNzYuMzM1OCwxNjQuNjE5MSA0MTcuNzY1OCwxNzEuMjY5MSIgZmlsbD0ibm9uZSIgaWQ9IkNsaWVudDItdG8tU2VydmVyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDIzLjY5LDE3Mi4yMiw0MTUuNDM3NywxNjYuODQ0Miw0MTguNzUzMiwxNzEuNDI3Niw0MTQuMTY5OCwxNzQuNzQzMSw0MjMuNjksMTcyLjIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTMuMzkwMSIgeD0iMzA3IiB5PSIxMzAuMTA2OSI+UmVxdWVzdDwvdGV4dD48L2c+PCEtLWxpbmsgU2VydmVyMiB0byBDbGllbnQyLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDkiIGRhdGEtZW50aXR5LTI9ImVudDAwMDgiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMCIgaWQ9ImxuazExIj48cGF0aCBkPSJNNDM2LjU5LDE2Ni41NyBDNDIzLjQsMTU5LjM5IDQwOC41LDE0OC42MiA0MDEsMTM0LjA0IEMzOTAuMTQsMTEyLjk1IDQxMC45NDMsOTcuNDEyMyA0MzIuMzMzLDg2LjYyMjMiIGZpbGw9Im5vbmUiIGlkPSJTZXJ2ZXIyLXRvLUNsaWVudDIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQzNy42OSw4My45Miw0MjcuODUyOSw4NC40MDIxLDQzMy4yMjU4LDg2LjE3MTksNDMxLjQ1Niw5MS41NDQ4LDQzNy42OSw4My45MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc1LjQyMjkiIHg9IjQwMiIgeT0iMTMwLjEwNjkiPlJlc3BvbnNlIDE8L3RleHQ+PC9nPjwhLS1saW5rIFNlcnZlcjIgdG8gQ2xpZW50Mi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA5IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA4IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTEiIGlkPSJsbmsxMiI+PHBhdGggZD0iTTQ3MC43MywxNjQuMzMgQzQ3Ny42NiwxNTIuMjEgNDg1LjY0LDEzMy42OSA0ODIsMTE3LjA0IEM0NzkuNjksMTA2LjQ4IDQ3Ny40MTQ2LDEwMC43MDI4IDQ3Mi45MzQ2LDkyLjM4MjgiIGZpbGw9Im5vbmUiIGlkPSJTZXJ2ZXIyLXRvLUNsaWVudDItMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDcwLjA5LDg3LjEsNDcwLjgzNSw5Ni45MjA2LDQ3Mi40NjA1LDkxLjUwMjQsNDc3Ljg3ODgsOTMuMTI3OCw0NzAuMDksODcuMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc1LjQyMjkiIHg9IjQ4My45MSIgeT0iMTMwLjEwNjkiPlJlc3BvbnNlIDI8L3RleHQ+PC9nPjwhLS1saW5rIFNlcnZlcjIgdG8gQ2xpZW50Mi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA5IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA4IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGlkPSJsbmsxMyI+PHBhdGggZD0iTTQ5OC42NywxNzEuMzcgQzUzNi41OSwxNjMuMjQgNTg3LjcxLDE0Ni40NCA1NjgsMTE3LjA0IEM1NTIuNDQsOTMuODMgNTI3LjkwNDIsODQuMjAyMyA1MDMuNjM0Miw3OS4xNTIzIiBmaWxsPSJub25lIiBpZD0iU2VydmVyMi10by1DbGllbnQyLTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ5Ny43Niw3Ny45Myw1MDUuNzU2NCw4My42Nzk1LDUwMi42NTUyLDc4Ljk0ODYsNTA3LjM4NjEsNzUuODQ3Myw0OTcuNzYsNzcuOTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Ni44NzY1IiB4PSI1NzMuMzciIHk9IjEzMC4xMDY5Ij5SZXNwb25zZSBOPC90ZXh0PjwvZz48IS0tbGluayBDbGllbnQzIHRvIFNlcnZlcjMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxNSIgZGF0YS1lbnRpdHktMj0iZW50MDAxNiIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBpZD0ibG5rMTciPjxwYXRoIGQ9Ik05MzEuMiw3OCBDODg4LjA1LDg0LjIxIDgxOS4zOSw5Ny4wMSA4MDQsMTE3LjA0IEM3NzAuNTQsMTYwLjYxIDg2MS4wNTAyLDE3Mi40NzA0IDkxOS42NDAyLDE3NS44OTA0IiBmaWxsPSJub25lIiBpZD0iQ2xpZW50My10by1TZXJ2ZXIzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5MjUuNjMsMTc2LjI0LDkxNi44Nzg0LDE3MS43MjIzLDkyMC42Mzg1LDE3NS45NDg2LDkxNi40MTIyLDE3OS43MDg3LDkyNS42MywxNzYuMjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS43OTM1IiB4PSI4MDUiIHk9IjEzMC4xMDY5Ij5SZXF1ZXN0IDE8L3RleHQ+PC9nPjwhLS1saW5rIENsaWVudDMgdG8gU2VydmVyMy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDE1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDE2IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTciIGlkPSJsbmsxOCI+PHBhdGggZD0iTTk0NC40OCw4NC40OSBDOTMyLjE1LDkxLjgzIDkxNy45OCwxMDIuNzggOTExLDExNy4wNCBDOTAxLjE4LDEzNy4xIDkxOC45MTc0LDE1Mi4yMTg3IDkzOC4zMzc0LDE2My4yODg3IiBmaWxsPSJub25lIiBpZD0iQ2xpZW50My10by1TZXJ2ZXIzLTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk0My41NSwxNjYuMjYsOTM3LjcxMiwxNTguMzI3OSw5MzkuMjA2MiwxNjMuNzgzOSw5MzMuNzUwMiwxNjUuMjc4MSw5NDMuNTUsMTY2LjI2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuNzkzNSIgeD0iOTEyIiB5PSIxMzAuMTA2OSI+UmVxdWVzdCAyPC90ZXh0PjwvZz48IS0tbGluayBDbGllbnQzIHRvIFNlcnZlcjMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxNSIgZGF0YS1lbnRpdHktMj0iZW50MDAxNiIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE4IiBpZD0ibG5rMTkiPjxwYXRoIGQ9Ik05NzMuNTYsODYuODYgQzk3OC43Nyw5OS4wNCA5ODQuNzUsMTE3LjYgOTgyLDEzNC4wNCBDOTgwLjI4LDE0NC4yOSA5NzguNjY2MSwxNDkuNzc4MiA5NzUuMzA2MSwxNTguMTg4MiIgZmlsbD0ibm9uZSIgaWQ9IkNsaWVudDMtdG8tU2VydmVyMy0yIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5NzMuMDgsMTYzLjc2LDk4MC4xMzM2LDE1Ni44ODY0LDk3NC45MzUsMTU5LjExNjksOTcyLjcwNDYsMTUzLjkxODMsOTczLjA4LDE2My43NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY3LjI0NzEiIHg9Ijk4My42OSIgeT0iMTMwLjEwNjkiPlJlcXVlc3QgTjwvdGV4dD48L2c+PCEtLWxpbmsgU2VydmVyMyB0byBDbGllbnQzLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTYiIGRhdGEtZW50aXR5LTI9ImVudDAwMTUiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxOSIgaWQ9ImxuazIwIj48cGF0aCBkPSJNMTAwMi45LDE3MC42NiBDMTAyMy40MSwxNjQuNjggMTA0Ny40NywxNTMuNzUgMTA2MCwxMzQuMDQgQzEwNzcuMjcsMTA2LjkgMTAzOC4yMjc0LDkwLjk1NjEgMTAwNC45Njc0LDgyLjA4NjEiIGZpbGw9Im5vbmUiIGlkPSJTZXJ2ZXIzLXRvLUNsaWVudDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk5OS4xNyw4MC41NCwxMDA2LjgzNTMsODYuNzI0LDEwMDQuMDAxMiw4MS44Mjg0LDEwMDguODk2OCw3OC45OTQyLDk5OS4xNyw4MC41NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYzLjAxOTUiIHg9IjEwNjQuODMiIHk9IjEzMC4xMDY5Ij5SZXNwb25zZTwvdGV4dD48L2c+PCEtLWxpbmsgQ2xpZW50NCB0byBTZXJ2ZXI0LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMjIiIGRhdGEtZW50aXR5LTI9ImVudDAwMjMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgaWQ9ImxuazI0Ij48cGF0aCBkPSJNMTMzNC43NTI4LDkzLjExNTUgQzEzMzUuNTIyOCwxMTIuOTQ1NSAxMzM2LjQ1OTQsMTM3LjYxNDQgMTMzNy4yMjk0LDE1Ny42MzQ0IiBmaWxsPSJub25lIiBpZD0iQ2xpZW50NC1TZXJ2ZXI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzM0LjUyLDg3LjEyLDEzMzAuODcyMiw5Ni4yNjg0LDEzMzQuNzE0LDkyLjExNjIsMTMzOC44NjYyLDk1Ljk1OCwxMzM0LjUyLDg3LjEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzM3LjQ2LDE2My42MywxMzQxLjExMTEsMTU0LjQ4MjksMTMzNy4yNjc4LDE1OC42MzM3LDEzMzMuMTE3MSwxNTQuNzkwNCwxMzM3LjQ2LDE2My42MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYzLjc0OTUiIHg9IjEzMzcuMjQiIHk9IjEzMC4xMDY5Ij5NZXNzYWdlczwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgWlA0bkl5RDA2OFJ0LW5LVlRLYzYxZGg5OUU5V3FDcVlCTXcyTkRDWlhBUU5VZlM4OGJxSTEwVjVrZVlSOFl3d0E4WDNtTnpwSEYxVmM0bEc5NUxoRUJaWF9Ud054dHR1bkNYWjR5Qjk2MFI0NlJheVlEWkczbG8wbXloTWZkZThTVWc0WEJhLVhMUjdXNXI2LTE3cVRrbXpmZ05kcm4tdDl0ZUJZODBlcnUtSFBsaVVQUTRFeFZPd1E3dEEzb2ROT0hMd3oyMlk4YUpWS1p4X0Nna3ZjMEhDSzNJalJTRzY1MDdlWHZvSWlTVlNSQjZDTnNObzlmRVAta0V2SjR2YnlmV2hEcDl2YVY1cHFLZGFvTnNIOXlqa2s1T0VfejhFci1oWFFaX2VEMzdYOWdSazBnamZHNjVSTzdzSW9PRUN4c0x5Zi0wb3JoLTlkSnBfV3pZaTRQaUxPZU5waG1TdHk3SEhnTFE4cElNdGpHcE95OFFVS2hvMDRSLTZkTHdTbExfRHF6ZGI0amYxYll1WEJIdE1Ba3Fpak5jUjJhNVNBajNxNG0wMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>用途：</strong></p>
<ol>
<li><strong>Unary RPC</strong>: 通常の API 呼び出し（CRUD 操作）</li>
<li><strong>Server Streaming</strong>: 大量データの配信（MRP 実行結果）</li>
<li><strong>Client Streaming</strong>: バッチ登録（複数品目の一括登録）</li>
<li><strong>Bidirectional Streaming</strong>: リアルタイム通信（進捗監視）</li>
</ol>
<h3 id="423-grpc">42.3 gRPC におけるヘキサゴナルアーキテクチャ<a class="headerlink" href="#423-grpc" title="Permanent link">&para;</a></h3>
<p>gRPC を導入しても、第32章で構築したヘキサゴナルアーキテクチャ（ドメイン層・アプリケーション層）はそのまま共有し、<strong>Input Adapter として gRPC サービス層のみを追加</strong>します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjY1MXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzE0cHg7aGVpZ2h0OjY1MXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDcxNCA2NTEiIHdpZHRoPSI3MTRweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEhleGFnb25hbCBBcmNoaXRlY3R1cmUgKGdSUEM/KS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5nUlBDLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNMjE2LjIsNiBMNDc2Ljk3MjQsNiBBMy43NSwzLjc1IDAgMCAxIDQ3OS40NzI0LDguNSBMNDg2LjQ3MjQsMjguMjk2OSBMNDg2LjIsMjguMjk2OSBBMi41LDIuNSAwIDAgMSA0ODguNywzMC43OTY5IEw0ODguNyw2NDIuNDQgQTIuNSwyLjUgMCAwIDEgNDg2LjIsNjQ0Ljk0IEwyMTYuMiw2NDQuOTQgQTIuNSwyLjUgMCAwIDEgMjEzLjcsNjQyLjQ0IEwyMTMuNyw4LjUgQTIuNSwyLjUgMCAwIDEgMjE2LjIsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjEzLjciIHgyPSI0ODYuNDcyNCIgeTE9IjI4LjI5NjkiIHkyPSIyOC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1OS43NzI0IiB4PSIyMTcuNyIgeT0iMjAuOTk1MSI+SGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAoZ1JQQyYjMjkyNTY7KTwvdGV4dD48L2c+PCEtLWNsYXNzIGNvcmUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5nUlBDLi4uY29yZSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTcyLjY3MTkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5MC4wNCIgeD0iMjczLjY4IiB5PSIyNTYuNzgiLz48ZWxsaXBzZSBjeD0iMjg4LjY4IiBjeT0iMjc4LjA3NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTI5MS42NDg4LDI4My43MTc1IFEyOTEuMDcwNiwyODQuMDE0NCAyOTAuNDMsMjg0LjE1NSBRMjg5Ljc4OTQsMjg0LjMxMTMgMjg5LjA4NjMsMjg0LjMxMTMgUTI4Ni41ODYzLDI4NC4zMTEzIDI4NS4yNTgxLDI4Mi42NzA2IFEyODMuOTQ1NiwyODEuMDE0NCAyODMuOTQ1NiwyNzcuODg5NCBRMjgzLjk0NTYsMjc0Ljc2NDQgMjg1LjI1ODEsMjczLjEwODEgUTI4Ni41ODYzLDI3MS40NTE5IDI4OS4wODYzLDI3MS40NTE5IFEyODkuNzg5NCwyNzEuNDUxOSAyOTAuNDMsMjcxLjYwODEgUTI5MS4wODYzLDI3MS43NjQ0IDI5MS42NDg4LDI3Mi4wNjEzIEwyOTEuNjQ4OCwyNzQuNzggUTI5MS4wMjM4LDI3NC4yMDE5IDI5MC40MywyNzMuOTM2MyBRMjg5LjgzNjMsMjczLjY1NSAyODkuMjExMywyNzMuNjU1IFEyODcuODY3NSwyNzMuNjU1IDI4Ny4xOCwyNzQuNzMzMSBRMjg2LjQ5MjUsMjc1Ljc5NTYgMjg2LjQ5MjUsMjc3Ljg4OTQgUTI4Ni40OTI1LDI3OS45ODMxIDI4Ny4xOCwyODEuMDYxMyBRMjg3Ljg2NzUsMjgyLjEyMzggMjg5LjIxMTMsMjgyLjEyMzggUTI4OS44MzYzLDI4Mi4xMjM4IDI5MC40MywyODEuODU4MSBRMjkxLjAyMzgsMjgxLjU3NjkgMjkxLjY0ODgsMjgwLjk5ODggTDI5MS42NDg4LDI4My43MTc1IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE1LjM4MzgiIHg9IjMyNC4wMDgxIiB5PSIyNzQuNzc1MSI+QXBwbGljYXRpb24gQ29yZTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTguMDQiIHg9IjMwMi42OCIgeT0iMjkxLjA3MiI+KERvbWFpbiArIFVzZSBDYXNlcyk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjc0LjY4IiB4Mj0iNDYyLjcyIiB5MT0iMjk5LjM3MzgiIHkyPSIyOTkuMzczOCIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFJJVkFURV9GSUVMRCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjgxLjY4IiB5PSIzMTAuMDIyMiIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Mi4yODUyIiB4PSIyOTMuNjgiIHk9IjMxNi4zNjg5Ij5JdGVtVXNlQ2FzZTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI4MS42OCIgeT0iMzI2LjMxOTEiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAwLjQ0NzMiIHg9IjI5My42OCIgeT0iMzMyLjY2NTciPk9yZGVyVXNlQ2FzZTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI4MS42OCIgeT0iMzQyLjYxNTkiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3LjI4NTIiIHg9IjI5My42OCIgeT0iMzQ4Ljk2MjYiPkludmVudG9yeVVzZUNhc2U8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjc0LjY4IiB4Mj0iNDYyLjcyIiB5MT0iMzU2LjI2NDQiIHkyPSIzNTYuMjY0NCIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFJJVkFURV9NRVRIT0QiPjxyZWN0IGZpbGw9IiNGMjRENUMiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI4MS42OCIgeT0iMzY2LjkxMjgiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzUuMjQzIiB4PSIyOTMuNjgiIHk9IjM3My4yNTk1Ij5JdGVtICgmIzIxNjk3OyYjMzA0NDY7KTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfTUVUSE9EIj48cmVjdCBmaWxsPSIjRjI0RDVDIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyODEuNjgiIHk9IjM4My4yMDk3Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4xODEzIiB4PSIyOTMuNjgiIHk9IjM4OS41NTY0Ij5Cb20gKCYjMzcwOTY7JiMyMTY5NzsmIzI3MDgzOyYjMjUxMDQ7JiMzNDkyMDspPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFJJVkFURV9NRVRIT0QiPjxyZWN0IGZpbGw9IiNGMjRENUMiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI4MS42OCIgeT0iMzk5LjUwNjYiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuNDA1MSIgeD0iMjkzLjY4IiB5PSI0MDUuODUzMiI+T3JkZXIgKCYjMTI0NTg7JiMxMjU0MDsmIzEyNDgwOyk8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX01FVEhPRCI+PHJlY3QgZmlsbD0iI0YyNEQ1QyIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjgxLjY4IiB5PSI0MTUuODAzNCIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Mi4xMiIgeD0iMjkzLjY4IiB5PSI0MjIuMTUwMSI+U3RvY2sgKCYjMjIzMTI7JiMyNDIzNTspPC90ZXh0PjwvZz48IS0tY2xhc3MgaW5wdXQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5nUlBDLi4uaW5wdXQiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBpZD0iZW50MDAwNCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMjMuNzgxMyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjAzLjAyMzEiIHg9IjI2Ny4xOSIgeT0iNDEiLz48ZWxsaXBzZSBjeD0iMzEyLjU1OTkiIGN5PSI2Mi4yOTY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMTUuNTI4Nyw2Ny45Mzc1IFEzMTQuOTUwNiw2OC4yMzQ0IDMxNC4zMDk5LDY4LjM3NSBRMzEzLjY2OTMsNjguNTMxMyAzMTIuOTY2Miw2OC41MzEzIFEzMTAuNDY2Miw2OC41MzEzIDMwOS4xMzgxLDY2Ljg5MDYgUTMwNy44MjU2LDY1LjIzNDQgMzA3LjgyNTYsNjIuMTA5NCBRMzA3LjgyNTYsNTguOTg0NCAzMDkuMTM4MSw1Ny4zMjgxIFEzMTAuNDY2Miw1NS42NzE5IDMxMi45NjYyLDU1LjY3MTkgUTMxMy42NjkzLDU1LjY3MTkgMzE0LjMwOTksNTUuODI4MSBRMzE0Ljk2NjIsNTUuOTg0NCAzMTUuNTI4Nyw1Ni4yODEzIEwzMTUuNTI4Nyw1OSBRMzE0LjkwMzcsNTguNDIxOSAzMTQuMzA5OSw1OC4xNTYzIFEzMTMuNzE2Miw1Ny44NzUgMzEzLjA5MTIsNTcuODc1IFEzMTEuNzQ3NCw1Ny44NzUgMzExLjA1OTksNTguOTUzMSBRMzEwLjM3MjQsNjAuMDE1NiAzMTAuMzcyNCw2Mi4xMDk0IFEzMTAuMzcyNCw2NC4yMDMxIDMxMS4wNTk5LDY1LjI4MTMgUTMxMS43NDc0LDY2LjM0MzggMzEzLjA5MTIsNjYuMzQzOCBRMzEzLjcxNjIsNjYuMzQzOCAzMTQuMzA5OSw2Ni4wNzgxIFEzMTQuOTAzNyw2NS43OTY5IDMxNS41Mjg3LDY1LjIxODggTDMxNS41Mjg3LDY3LjkzNzUgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDMuNzgzMiIgeD0iMzMzLjA1OTkiIHk9IjU4Ljk5NTEiPklucHV0IEFkYXB0ZXJzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAxMDciIHg9IjMzNi45NDYyIiB5PSI3NS4yOTIiPihEcml2aW5nIFNpZGUpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI2OC4xOSIgeDI9IjQ2OS4yMTMxIiB5MT0iODMuNTkzOCIgeTI9IjgzLjU5MzgiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI3NS4xOSIgeT0iOTQuMjQyMiIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjUuNjM0NSIgeD0iMjg3LjE5IiB5PSIxMDAuNTg4OSI+UkVTVCBDb250cm9sbGVyJiM2NTI4ODsmIzI2MDgyOyYjMjMzODQ7JiM2NTI4OTs8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyNzUuMTkiIHk9IjExMC41MzkxIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3Ny4wMjMxIiB4PSIyODcuMTkiIHk9IjExNi44ODU3Ij5nUlBDIFNlcnZpY2UmIzY1Mjg4OyYjMjYwMzI7JiMzNTIxNTsmIzM2ODYxOyYjMjExNTI7JiM2NTI4OTs8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyNzUuMTkiIHk9IjEyNi44MzU5Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk0LjA2OTMiIHg9IjI4Ny4xOSIgeT0iMTMzLjE4MjYiPlByb3RvIE1hcHBlcjwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI3NS4xOSIgeT0iMTQzLjEzMjgiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzcuODY4MiIgeD0iMjg3LjE5IiB5PSIxNDkuNDc5NSI+SW50ZXJjZXB0b3I8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjY4LjE5IiB4Mj0iNDY5LjIxMzEiIHkxPSIxNTYuNzgxMyIgeTI9IjE1Ni43ODEzIi8+PC9nPjwhLS1jbGFzcyBvdXRwdXQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5nUlBDLi4ub3V0cHV0IiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTA3LjQ4NDQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2MC43NDMyIiB4PSIyODcuMzMiIHk9IjUyMS40NiIvPjxlbGxpcHNlIGN4PSIzMDcuOTkxIiBjeT0iNTQyLjc1NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTMxMC45NTk4LDU0OC4zOTc1IFEzMTAuMzgxNyw1NDguNjk0NCAzMDkuNzQxLDU0OC44MzUgUTMwOS4xMDA0LDU0OC45OTEzIDMwOC4zOTczLDU0OC45OTEzIFEzMDUuODk3Myw1NDguOTkxMyAzMDQuNTY5Miw1NDcuMzUwNiBRMzAzLjI1NjcsNTQ1LjY5NDQgMzAzLjI1NjcsNTQyLjU2OTQgUTMwMy4yNTY3LDUzOS40NDQ0IDMwNC41NjkyLDUzNy43ODgxIFEzMDUuODk3Myw1MzYuMTMxOSAzMDguMzk3Myw1MzYuMTMxOSBRMzA5LjEwMDQsNTM2LjEzMTkgMzA5Ljc0MSw1MzYuMjg4MSBRMzEwLjM5NzMsNTM2LjQ0NDQgMzEwLjk1OTgsNTM2Ljc0MTMgTDMxMC45NTk4LDUzOS40NiBRMzEwLjMzNDgsNTM4Ljg4MTkgMzA5Ljc0MSw1MzguNjE2MyBRMzA5LjE0NzMsNTM4LjMzNSAzMDguNTIyMyw1MzguMzM1IFEzMDcuMTc4NSw1MzguMzM1IDMwNi40OTEsNTM5LjQxMzEgUTMwNS44MDM1LDU0MC40NzU2IDMwNS44MDM1LDU0Mi41Njk0IFEzMDUuODAzNSw1NDQuNjYzMSAzMDYuNDkxLDU0NS43NDEzIFEzMDcuMTc4NSw1NDYuODAzOCAzMDguNTIyMyw1NDYuODAzOCBRMzA5LjE0NzMsNTQ2LjgwMzggMzA5Ljc0MSw1NDYuNTM4MSBRMzEwLjMzNDgsNTQ2LjI1NjkgMzEwLjk1OTgsNTQ1LjY3ODggTDMxMC45NTk4LDU0OC4zOTc1IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE2LjE2MzEiIHg9IjMyMy4yNDkiIHk9IjUzOS40NTUxIj5PdXRwdXQgQWRhcHRlcnM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuODQ3NyIgeD0iMzM1LjQwNjgiIHk9IjU1NS43NTIiPihEcml2ZW4gU2lkZSk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjg4LjMzIiB4Mj0iNDQ3LjA3MzIiIHkxPSI1NjQuMDUzOCIgeTI9IjU2NC4wNTM4Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOTUuMzMiIHk9IjU3NC43MDIyIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNC43NDMyIiB4PSIzMDcuMzMiIHk9IjU4MS4wNDg5Ij5NeUJhdGlzIFJlcG9zaXRvcnk8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOTUuMzMiIHk9IjU5MC45OTkxIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOS40MjM4IiB4PSIzMDcuMzMiIHk9IjU5Ny4zNDU3Ij5EYXRhYmFzZSBBY2Nlc3M8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOTUuMzMiIHk9IjYwNy4yOTU5Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNS40MDMzIiB4PSIzMDcuMzMiIHk9IjYxMy42NDI2Ij5FbnRpdHkgTWFwcGluZzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyODguMzMiIHgyPSI0NDcuMDczMiIgeTE9IjYyMC45NDQ0IiB5Mj0iNjIwLjk0NDQiLz48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OOCIgZGF0YS1zb3VyY2UtbGluZT0iMzMiIGlkPSJlbnQwMDA5Ij48cGF0aCBkPSJNNTA1LjUzLDc1LjE5IEw1MDUuNTMsMTMwLjU4ODQgQTAsMCAwIDAgMCA1MDUuNTMsMTMwLjU4ODQgTDU3NS44NiwxMzAuNTg4NCBMNDU0LjM4LDI1Ni4zNiBMNTgzLjg2LDEzMC41ODg0IEw3MDcuODYzNywxMzAuNTg4NCBBMCwwIDAgMCAwIDcwNy44NjM3LDEzMC41ODg0IEw3MDcuODYzNyw4NS4xOSBMNjk3Ljg2MzcsNzUuMTkgTDUwNS41Myw3NS4xOSBBMCwwIDAgMCAwIDUwNS41Myw3NS4xOSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTY5Ny44NjM3LDc1LjE5IEw2OTcuODYzNyw4NS4xOSBMNzA3Ljg2MzcsODUuMTkgTDY5Ny44NjM3LDc1LjE5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuMDAwMiIgeD0iNTExLjUzIiB5PSI5Mi4yNTY5Ij4mIzI2MDgyOyYjMjMzODQ7JiMxMjM5ODsmIzEyNDk5OyYjMTI0NzI7JiMxMjQ5MzsmIzEyNDczOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1My4yNzA2IiB4PSI1MTEuNTMiIHk9IjEwNy4zODk3Ij5SRVNUIEFQSSAmIzI5MjU2OyYjMTIzOTI7JiMyMzQzNjsmIzIwODQwOyYjMTIzOTU7JiMyMDg0OTsmIzI2Mzc3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODEuMzMzNyIgeD0iNTExLjUzIiB5PSIxMjIuNTIyNSI+Z1JQQyAmIzIyMjY2OyYjMjYzNzc7JiMxMjM5ODsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsmIzEyMzk5OyYjMjE1NDc7JiMxMjQxNDsmIzEyMzk0OyYjMTIzNTY7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4xMSIgZGF0YS1zb3VyY2UtbGluZT0iMzkiIGlkPSJlbnQwMDEyIj48cGF0aCBkPSJNNiw3NS4xOSBMNiwxMzAuNTg4NCBBMCwwIDAgMCAwIDYsMTMwLjU4ODQgTDE5Ny40MDMsMTMwLjU4ODQgQTAsMCAwIDAgMCAxOTcuNDAzLDEzMC41ODg0IEwxOTcuNDAzLDEwNi44OSBMMjY2LjgxLDEwMi44OSBMMTk3LjQwMyw5OC44OSBMMTk3LjQwMyw4NS4xOSBMMTg3LjQwMyw3NS4xOSBMNiw3NS4xOSBBMCwwIDAgMCAwIDYsNzUuMTkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xODcuNDAzLDc1LjE5IEwxODcuNDAzLDg1LjE5IEwxOTcuNDAzLDg1LjE5IEwxODcuNDAzLDc1LjE5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDMuMzMzNiIgeD0iMTIiIHk9IjkyLjI1NjkiPmdSUEMgJiMxMjQ2OTsmIzEyNTQwOyYjMTI0OTk7JiMxMjQ3MzsmIzEyNDM0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTguNzI5NiIgeD0iMTIiIHk9IjEwNy4zODk3Ij5JbnB1dCBBZGFwdGVyICYjMTIzOTI7JiMxMjM3NTsmIzEyMzkwOyYjMzY4NjE7JiMyMTE1Mjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTcwLjQwMyIgeD0iMTIiIHk9IjEyMi41MjI1Ij4mIzI2MDgyOyYjMjMzODQ7JiMxMjM5ODsgUkVTVCBBUEkgJiMxMjM5MjsmIzIwODQ5OyYjMjMzODQ7JiMyMTQ4NzsmIzMzMDIxOzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMTQiIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBpZD0iZW50MDAxNSI+PHBhdGggZD0iTTUwNC4yMSw1NDcuNSBMNTA0LjIxLDU3MS4yIEw0NDguNDQsNTc1LjIgTDUwNC4yMSw1NzkuMiBMNTA0LjIxLDYwMi44OTg0IEEwLDAgMCAwIDAgNTA0LjIxLDYwMi44OTg0IEw2NTUuMTg0Nyw2MDIuODk4NCBBMCwwIDAgMCAwIDY1NS4xODQ3LDYwMi44OTg0IEw2NTUuMTg0Nyw1NTcuNSBMNjQ1LjE4NDcsNTQ3LjUgTDUwNC4yMSw1NDcuNSBBMCwwIDAgMCAwIDUwNC4yMSw1NDcuNSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTY0NS4xODQ3LDU0Ny41IEw2NDUuMTg0Nyw1NTcuNSBMNjU1LjE4NDcsNTU3LjUgTDY0NS4xODQ3LDU0Ny41IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjkuOTc0NyIgeD0iNTEwLjIxIiB5PSI1NjQuNTY2OSI+JiMyNjA4MjsmIzIzMzg0OyYjMTIzOTg7IFJlcG9zaXRvcnkgJiMxMjQzNDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iNTEwLjIxIiB5PSI1NzkuNjk5NyI+JiMxMjM4MTsmIzEyMzk4OyYjMTI0MTQ7JiMxMjQxNDsmIzIwMzUxOyYjMjk5OTI7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjUxMC4yMSIgeT0iNTk0LjgzMjUiPiYjMjI3OTM7JiMyNjM1NjsmIzE5OTgxOyYjMzUyMDE7PC90ZXh0PjwvZz48IS0tbGluayBpbnB1dCB0byBjb3JlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDQiIGRhdGEtZW50aXR5LTI9ImVudDAwMDMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyOSIgaWQ9ImxuazYiPjxwYXRoIGNvZGVMaW5lPSIyOSIgZD0iTTM2OC43LDE2NS4yNCBDMzY4LjcsMTkyLjk1IDM2OC43LDIyMC4xNyAzNjguNywyNTAuMjkiIGZpbGw9Im5vbmUiIGlkPSJpbnB1dC10by1jb3JlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNjguNywyNTYuMjksMzcyLjcsMjQ3LjI5LDM2OC43LDI1MS4yOSwzNjQuNywyNDcuMjksMzY4LjcsMjU2LjI5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuODAxOCIgeD0iMzcyLjg3MzgiIHk9IjIwNy44NDY5Ij5JbnB1dCBQb3J0czwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Ny4xNDk0IiB4PSIzNjkuNyIgeT0iMjIyLjk3OTciPihVc2UgQ2FzZXMpPC90ZXh0PjwvZz48IS0tbGluayBjb3JlIHRvIG91dHB1dC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzAiIGlkPSJsbms3Ij48cGF0aCBjb2RlTGluZT0iMzAiIGQ9Ik0zNjguMzMsNDI5Ljc5IEMzNjguMiw0NjAuNDYgMzY4LjA3NjYsNDg4LjEwMDEgMzY3Ljk1NjYsNTE1LjIwMDEiIGZpbGw9Im5vbmUiIGlkPSJjb3JlLXRvLW91dHB1dCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzY3LjkzLDUyMS4yLDM3MS45Njk4LDUxMi4yMTc4LDM2Ny45NTIxLDUxNi4yLDM2My45Njk5LDUxMi4xODI0LDM2Ny45Myw1MjEuMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgyLjI5NzQiIHg9IjQwMi41MDE1IiB5PSI0NzIuNTI2OSI+T3V0cHV0IFBvcnRzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0OC45NjA0IiB4PSIzNjkuMTciIHk9IjQ4Ny42NTk3Ij4oUmVwb3NpdG9yeSBJbnRlcmZhY2VzKTwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgUlBCVkpYRDE1Q1Jsem9jRU5CS25WRzRrSjRmZmo4YjhxLUFURC1Gc2o0bWVDdmxQZVI0bjlrd2s5NUdiNDM1WTBZUGczM09xVzRIRGExSHVjNjdSVWlLaEUzRlJGcTJ5Y3BicHBsYi10cGJwZnU5TG9YMUEtVG4yemo3elh0Ym13eUp0N1NTWnhYQWY4S216bTZVYW5YY2ZHclF1WXJJWUFyUzRHZ2ZNQWtSd2hSTnE1M250ZDRkdkxEUnB3akdiYWQ4NkVJeG0yS2xEeWNMMjZUbzVucHYyWmxaZXdvaFlXd2tWVE5LNjJYQU44SExsMVZzVG14SS1wdDF6X0hrclRRSnRfS3JsUk5GbWZNdFl5d0EyMGI4Z3Q1VEhMcUtsSlFtaWtSa2FZdFZSeU1hZEZNb2NYT3BFZzZIb0JSMDZDaWI1U25Id1NHRS1tQm1MMlRhQXlJR0F0dzBCc2cyaTFjTFFtR0lRc1hIM05TZ041eEg1OVdNbHJyNVNUVFR3c3JfWld1ek50UFAtRFZFMUNlZTZUVDR5VlZXbnNEaU9OOXA1aHB5ZDJLTjE5T1N2dWRhZUI5Y01URDdKU0JVV3ZiVmFWd1lHTk9GWUlPZ1hjY2xFd0U3eEs0QUYtekhPclM1UDhpYkpSSFVvaGVqd2xIZDhDcWJicXlmaFZyZkhRb1JNQ2ZieG9NUWNIX0NlU1k2RHhCTnJFSlIzZjB3YmZ5VVNlLW05R0VBakliblJ3SjBrNElKdFc1VWphOUVDSkdNN0FqZkl1T2NBcmJOdUhxSzd6WG9meUNZbmV5dU0ydzFfZDBoUXlVN1JVQk1qV2F3eVVqcFJSSmJzcmw3RWdKd1JCazVGLXB0cS1JWlV4QVpXTjBOeEFkWmI4QWswNEh5WXJCNGczT0VyZFZIR3VNelJrY0swbWRWRVpWeTBNYmE1c29oT0l6T3V1T09uZHU1UkZUUkhVRURlNDl0VGJYSXFqY1dyYXdiVHhwMlBiWDVNbUlWWm5BMlZOdnZUekQtdGRWWFJneFZwd185YVZSME5aRmwtMG0wMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>gRPC でもヘキサゴナルアーキテクチャを維持する理由：</strong></p>
<ol>
<li><strong>再利用性</strong>: 既存の UseCase/Repository をそのまま活用</li>
<li><strong>並行運用</strong>: REST API と gRPC API の両方を提供可能</li>
<li><strong>テスト容易性</strong>: ドメインロジックは通信プロトコルに依存しない</li>
<li><strong>移行容易性</strong>: 段階的に REST から gRPC へ移行可能</li>
</ol>
<h3 id="424">42.4 ディレクトリ構成<a class="headerlink" href="#424" title="Permanent link">&para;</a></h3>
<p>既存の構成に <code>infrastructure/grpc/</code> を追加するだけです。</p>
<div class="highlight"><pre><span></span><code>src/main/java/com/example/production/
├── domain/                     # ドメイン層（API版と共通）
│   ├── model/
│   │   ├── item/
│   │   ├── bom/
│   │   ├── order/
│   │   └── inventory/
│   └── exception/
│
├── application/               # アプリケーション層（API版と共通）
│   ├── port/
│   │   ├── in/               # Input Port（ユースケース）
│   │   └── out/              # Output Port（リポジトリ）
│   └── service/
│
├── infrastructure/
│   ├── persistence/          # Output Adapter（DB実装）- 既存
│   │   ├── mapper/
│   │   └── repository/
│   ├── rest/                 # Input Adapter（REST実装）- 既存
│   │   ├── controller/
│   │   ├── dto/
│   │   └── exception/
│   └── grpc/                 # Input Adapter（gRPC実装）- 新規追加
│       ├── service/          # gRPC Service 実装
│       ├── mapper/           # Proto ⇔ Domain 変換
│       └── interceptor/      # 共通処理（ログ、エラー等）
│
├── config/
│
└── src/main/proto/            # Protocol Buffers 定義
    ├── common.proto
    ├── item.proto
    ├── bom.proto
    ├── purchase_order.proto
    └── mrp.proto
</code></pre></div>
<h3 id="425">42.5 技術スタックの追加<a class="headerlink" href="#425" title="Permanent link">&para;</a></h3>
<p>既存の <code>build.gradle.kts</code> に gRPC 関連の依存関係を追加します。</p>
<details>
<summary>build.gradle.kts（差分）</summary>

<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">com.google.protobuf.gradle.*</span>

<span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 既存のプラグイン...</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.protobuf&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;0.9.4&quot;</span><span class="w">  </span><span class="c1">// 追加</span>
<span class="p">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 既存の依存関係（Spring Boot, MyBatis, PostgreSQL等）はそのまま</span>

<span class="w">    </span><span class="c1">// gRPC 関連を追加</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;net.devh:grpc-spring-boot-starter:3.0.0.RELEASE&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.grpc:grpc-protobuf:1.60.0&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.grpc:grpc-stub:1.60.0&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.grpc:grpc-services:1.60.0&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Health check, Reflection</span>

<span class="w">    </span><span class="c1">// Protocol Buffers</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.google.protobuf:protobuf-java:3.25.1&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.google.protobuf:protobuf-java-util:3.25.1&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;io.grpc:grpc-testing:1.60.0&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Protocol Buffers コンパイル設定</span>
<span class="n">protobuf</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">protoc</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">artifact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.google.protobuf:protoc:3.25.1&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;grpc&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">artifact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;io.grpc:protoc-gen-grpc-java:1.60.0&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">generateProtoTasks</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">all</span><span class="p">().</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">task</span><span class="p">.</span><span class="na">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;grpc&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>追加パッケージの説明：</strong></p>
<table>
<thead>
<tr>
<th>パッケージ</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>grpc-spring-boot-starter</td>
<td>Spring Boot との統合</td>
</tr>
<tr>
<td>grpc-protobuf</td>
<td>Protocol Buffers サポート</td>
</tr>
<tr>
<td>grpc-services</td>
<td>ヘルスチェック、リフレクション</td>
</tr>
<tr>
<td>protobuf-java-util</td>
<td>JSON ⇔ Proto 変換</td>
</tr>
</tbody>
</table>
<h3 id="386-protocol-buffers">38.6 Protocol Buffers 定義<a class="headerlink" href="#386-protocol-buffers" title="Permanent link">&para;</a></h3>
<details>
<summary>src/main/proto/common.proto</summary>

<div class="highlight"><pre><span></span><code><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="kn">package</span><span class="w"> </span><span class="nn">production</span><span class="p">;</span>

<span class="k">option</span><span class="w"> </span><span class="na">java_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.example.production.grpc&quot;</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_multiple_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="c1">// 共通メッセージ</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">Empty</span><span class="w"> </span><span class="p">{}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">Timestamp</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int64</span><span class="w"> </span><span class="na">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">nanos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">Date</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">Decimal</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// 文字列で精度を維持</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">PageRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">PageResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">total_elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">total_pages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">current_page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// エラーレスポンス</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">ErrorDetail</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="kd">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">map</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">&gt;</span><span class="w"> </span><span class="na">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>src/main/proto/item.proto</summary>

<div class="highlight"><pre><span></span><code><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="kn">package</span><span class="w"> </span><span class="nn">production</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s">&quot;common.proto&quot;</span><span class="p">;</span>

<span class="k">option</span><span class="w"> </span><span class="na">java_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.example.production.grpc&quot;</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_multiple_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="c1">// 品目区分</span>
<span class="kd">enum</span><span class="w"> </span><span class="n">ItemCategory</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">ITEM_CATEGORY_UNSPECIFIED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="na">PRODUCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">      </span><span class="c1">// 製品</span>
<span class="w">  </span><span class="na">SEMI_PRODUCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// 半製品</span>
<span class="w">  </span><span class="na">PART</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">         </span><span class="c1">// 部品</span>
<span class="w">  </span><span class="na">MATERIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">     </span><span class="c1">// 材料</span>
<span class="p">}</span>

<span class="c1">// 品目メッセージ</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">Item</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">Date</span><span class="w"> </span><span class="na">effective_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">ItemCategory</span><span class="w"> </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_group_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">unit_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">location_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">lead_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">safety_stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// リクエスト/レスポンス</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">GetItemRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">GetItemsRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ItemCategory</span><span class="w"> </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// optional filter</span>
<span class="w">  </span><span class="n">PageRequest</span><span class="w"> </span><span class="na">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">GetItemsResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="na">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">PageResponse</span><span class="w"> </span><span class="na">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">CreateItemRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">ItemCategory</span><span class="w"> </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_group_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">unit_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">location_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">lead_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">safety_stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">UpdateItemRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">ItemCategory</span><span class="w"> </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">lead_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">safety_stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">DeleteItemRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">BatchCreateResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">success_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">failed_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="na">failed_codes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 品目サービス</span>
<span class="kd">service</span><span class="w"> </span><span class="n">ItemService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Unary RPC</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">GetItem</span><span class="p">(</span><span class="n">GetItemRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Item</span><span class="p">);</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">CreateItem</span><span class="p">(</span><span class="n">CreateItemRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Item</span><span class="p">);</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">UpdateItem</span><span class="p">(</span><span class="n">UpdateItemRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Item</span><span class="p">);</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">DeleteItem</span><span class="p">(</span><span class="n">DeleteItemRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Empty</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Server Streaming - 品目一覧のストリーム配信</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">StreamItems</span><span class="p">(</span><span class="n">GetItemsRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">stream</span><span class="w"> </span><span class="n">Item</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Client Streaming - バッチ登録</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">BatchCreateItems</span><span class="p">(</span><span class="n">stream</span><span class="w"> </span><span class="n">CreateItemRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">BatchCreateResponse</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="387-api-controller">38.7 API サーバー版との Controller の違い<a class="headerlink" href="#387-api-controller" title="Permanent link">&para;</a></h3>
<p><strong>API サーバー版（REST Controller）</strong></p>
<div class="highlight"><pre><span></span><code><span class="nd">@RestController</span><span class="w">  </span><span class="c1">// JSON を返す</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/items&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemApiController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 共有</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/{itemCode}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ItemResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getItem</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemByCode</span><span class="p">(</span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">ItemResponse</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>gRPC 版（gRPC Service）</strong></p>
<div class="highlight"><pre><span></span><code><span class="nd">@GrpcService</span><span class="w">  </span><span class="c1">// gRPC サービスとして公開</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemGrpcService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ItemServiceGrpc</span><span class="p">.</span><span class="na">ItemServiceImplBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 共有（同じインスタンス）</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getItem</span><span class="p">(</span><span class="n">GetItemRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                        </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 同じ UseCase を呼び出し</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemByCode</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>
<span class="w">        </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProto</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">        </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>共通点と相違点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>REST Controller</th>
<th>gRPC Service</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>UseCase</strong></td>
<td>共有（同一インスタンス）</td>
<td>共有（同一インスタンス）</td>
</tr>
<tr>
<td><strong>アノテーション</strong></td>
<td><code>@RestController</code></td>
<td><code>@GrpcService</code></td>
</tr>
<tr>
<td><strong>リクエスト</strong></td>
<td>DTO（JSON）</td>
<td>Proto Message</td>
</tr>
<tr>
<td><strong>レスポンス</strong></td>
<td><code>ResponseEntity&lt;T&gt;</code></td>
<td><code>StreamObserver&lt;T&gt;</code></td>
</tr>
<tr>
<td><strong>変換</strong></td>
<td>DTO ⇔ Domain</td>
<td>Proto ⇔ Domain</td>
</tr>
<tr>
<td><strong>エラー処理</strong></td>
<td>例外ハンドラ</td>
<td><code>Status</code> + <code>onError</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="43-api">第43章：マスタ API の実装<a class="headerlink" href="#43-api" title="Permanent link">&para;</a></h2>
<h3 id="431-proto">43.1 Proto マッパーの実装<a class="headerlink" href="#431-proto" title="Permanent link">&para;</a></h3>
<p>既存のドメインモデルと Protocol Buffers メッセージ間の変換を行います。</p>
<details>
<summary>ProtoMapper.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.ItemCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.grpc.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * ドメインモデルと Protocol Buffers メッセージ間の変換</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProtoMapper</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ========== Item ==========</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="w"> </span><span class="nf">toProto</span><span class="p">(</span><span class="n">Item</span><span class="w"> </span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setEffectiveDate</span><span class="p">(</span><span class="n">toProtoDate</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getEffectiveDate</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemName</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setCategory</span><span class="p">(</span><span class="n">toProtoCategory</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemGroupCode</span><span class="p">(</span><span class="n">nullToEmpty</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemGroupCode</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setUnitCode</span><span class="p">(</span><span class="n">nullToEmpty</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getUnitCode</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setLocationCode</span><span class="p">(</span><span class="n">nullToEmpty</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getLocationCode</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setLeadTime</span><span class="p">(</span><span class="n">nullToZero</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getLeadTime</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setSafetyStock</span><span class="p">(</span><span class="n">nullToZero</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getSafetyStock</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="nf">toDomain</span><span class="p">(</span><span class="n">CreateItemRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Item</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">effectiveDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">toDomainCategory</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemGroupCode</span><span class="p">(</span><span class="n">emptyToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemGroupCode</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">unitCode</span><span class="p">(</span><span class="n">emptyToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getUnitCode</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">locationCode</span><span class="p">(</span><span class="n">emptyToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getLocationCode</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">leadTime</span><span class="p">(</span><span class="n">zeroToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getLeadTime</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">safetyStock</span><span class="p">(</span><span class="n">zeroToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getSafetyStock</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Date ==========</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="nf">toProtoDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">date</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Date</span><span class="p">.</span><span class="na">getDefaultInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Date</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setYear</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">getYear</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setMonth</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">getMonthValue</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setDay</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">getDayOfMonth</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="nf">toDomainDate</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="n">protoDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">protoDate</span><span class="p">.</span><span class="na">getYear</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">            </span><span class="n">protoDate</span><span class="p">.</span><span class="na">getYear</span><span class="p">(),</span>
<span class="w">            </span><span class="n">protoDate</span><span class="p">.</span><span class="na">getMonth</span><span class="p">(),</span>
<span class="w">            </span><span class="n">protoDate</span><span class="p">.</span><span class="na">getDay</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Decimal ==========</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Decimal</span><span class="w"> </span><span class="nf">toProtoDecimal</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Decimal</span><span class="p">.</span><span class="na">getDefaultInstance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Decimal</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">toPlainString</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">toDomainDecimal</span><span class="p">(</span><span class="n">Decimal</span><span class="w"> </span><span class="n">protoDecimal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">protoDecimal</span><span class="p">.</span><span class="na">getValue</span><span class="p">().</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="n">protoDecimal</span><span class="p">.</span><span class="na">getValue</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== ItemCategory ==========</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="w"> </span><span class="nf">toProtoCategory</span><span class="p">(</span><span class="n">ItemCategory</span><span class="w"> </span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">domain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">ITEM_CATEGORY_UNSPECIFIED</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">PRODUCT</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">SEMI_PRODUCT</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">SEMI_PRODUCT</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">PART</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">PART</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MATERIAL</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">MATERIAL</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ItemCategory</span><span class="w"> </span><span class="nf">toDomainCategory</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="w"> </span><span class="n">proto</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">proto</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">PRODUCT</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">SEMI_PRODUCT</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">SEMI_PRODUCT</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">PART</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PART</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MATERIAL</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">MATERIAL</span><span class="p">;</span>
<span class="w">            </span><span class="k">default</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Utility ==========</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">nullToEmpty</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">emptyToNull</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">nullToZero</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">zeroToNull</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="432-grpc-tdd">43.2 品目 gRPC サービスの TDD 実装<a class="headerlink" href="#432-grpc-tdd" title="Permanent link">&para;</a></h3>
<h4 id="red">Red: 失敗するテストを書く<a class="headerlink" href="#red" title="Permanent link">&para;</a></h4>
<details>
<summary>ItemGrpcServiceTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.ItemCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.grpc.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.persistence.mapper.ItemMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.ManagedChannel</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.ManagedChannelBuilder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.StatusRuntimeException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertyRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertySource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.containers.PostgreSQLContainer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Container</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Testcontainers</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Iterator</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CountDownLatch</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.TimeUnit</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;grpc.server.port=9090&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;grpc.server.in-process-name=test&quot;</span>
<span class="p">})</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;品目 gRPC サービス&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">ItemGrpcServiceTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:16&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withDatabaseName</span><span class="p">(</span><span class="s">&quot;production_test&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withUsername</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withPassword</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@DynamicPropertySource</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureProperties</span><span class="p">(</span><span class="n">DynamicPropertyRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getJdbcUrl</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.username&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getUsername</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getPassword</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ItemMapper</span><span class="w"> </span><span class="n">itemMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ManagedChannel</span><span class="w"> </span><span class="n">channel</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ItemServiceGrpc</span><span class="p">.</span><span class="na">ItemServiceBlockingStub</span><span class="w"> </span><span class="n">blockingStub</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ItemServiceGrpc</span><span class="p">.</span><span class="na">ItemServiceStub</span><span class="w"> </span><span class="n">asyncStub</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ManagedChannelBuilder</span><span class="p">.</span><span class="na">forAddress</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9090</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">usePlaintext</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">blockingStub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ItemServiceGrpc</span><span class="p">.</span><span class="na">newBlockingStub</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
<span class="w">        </span><span class="n">asyncStub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ItemServiceGrpc</span><span class="p">.</span><span class="na">newStub</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// テストデータをクリア</span>
<span class="w">        </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@AfterEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">channel</span><span class="p">.</span><span class="na">shutdownNow</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;GetItem (Unary)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">GetItemTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;品目コードで品目を取得できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetItemByCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;テスト製品&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetItemRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blockingStub</span><span class="p">.</span><span class="na">getItem</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getItemName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;テスト製品&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getCategory</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;存在しない品目はNOT_FOUNDを返す&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldThrowNotFoundForNonExistentItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetItemRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="s">&quot;NOT-EXIST&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">blockingStub</span><span class="p">.</span><span class="na">getItem</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">StatusRuntimeException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;NOT_FOUND&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;StreamItems (Server Streaming)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">StreamItemsTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;品目一覧をストリームで取得できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldStreamItems</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;ITEM-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%03d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;品目&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetItemsRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="o">=</span>
<span class="w">                </span><span class="n">blockingStub</span><span class="p">.</span><span class="na">streamItems</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="n">iterator</span><span class="p">.</span><span class="na">forEachRemaining</span><span class="p">(</span><span class="n">items</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>

<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">items</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;BatchCreateItems (Client Streaming)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">BatchCreateItemsTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;バッチで品目を登録できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldBatchCreateItems</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">CountDownLatch</span><span class="w"> </span><span class="n">latch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">BatchCreateResponse</span><span class="o">[]</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BatchCreateResponse</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">requestObserver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asyncStub</span><span class="p">.</span><span class="na">batchCreateItems</span><span class="p">(</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">io</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">stub</span><span class="p">.</span><span class="na">StreamObserver</span><span class="o">&lt;</span><span class="n">BatchCreateResponse</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nd">@Override</span>
<span class="w">                    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onNext</span><span class="p">(</span><span class="n">BatchCreateResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">result</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>

<span class="w">                    </span><span class="nd">@Override</span>
<span class="w">                    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onError</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
<span class="w">                    </span><span class="p">}</span>

<span class="w">                    </span><span class="nd">@Override</span>
<span class="w">                    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCompleted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">});</span>

<span class="w">            </span><span class="c1">// Act - 3件の品目を送信</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">requestObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">CreateItemRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="s">&quot;BATCH-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%03d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setItemName</span><span class="p">(</span><span class="s">&quot;バッチ品目&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setCategory</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">requestObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">latch</span><span class="p">.</span><span class="na">await</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">)).</span><span class="na">isTrue</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">getSuccessCount</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">insertTestItem</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="w"> </span><span class="n">category</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">effectiveDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="green-grpc">Green: gRPC サービスの実装<a class="headerlink" href="#green-grpc" title="Permanent link">&para;</a></h4>
<details>
<summary>ItemGrpcService.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.port.in.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.exception.DuplicateItemException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.exception.ItemNotFoundException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.grpc.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.mapper.ProtoMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.Status</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.stub.StreamObserver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">net.devh.boot.grpc.server.service.GrpcService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 品目 gRPC サービス実装</span>
<span class="cm"> * 既存の ItemUseCase を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@GrpcService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemGrpcService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ItemServiceGrpc</span><span class="p">.</span><span class="na">ItemServiceImplBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存の UseCase を注入</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ItemGrpcService</span><span class="p">(</span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">,</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">itemUseCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目取得（Unary RPC）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getItem</span><span class="p">(</span><span class="n">GetItemRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                        </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 既存の UseCase を呼び出し</span>
<span class="w">            </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemByCode</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProto</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ItemNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">NOT_FOUND</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目登録（Unary RPC）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createItem</span><span class="p">(</span><span class="n">CreateItemRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                           </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Proto → Command 変換</span>
<span class="w">            </span><span class="n">CreateItemCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateItemCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainCategory</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemGroupCode</span><span class="p">(</span><span class="n">emptyToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemGroupCode</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">unitCode</span><span class="p">(</span><span class="n">emptyToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getUnitCode</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">locationCode</span><span class="p">(</span><span class="n">emptyToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getLocationCode</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">leadTime</span><span class="p">(</span><span class="n">zeroToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getLeadTime</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">safetyStock</span><span class="p">(</span><span class="n">zeroToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getSafetyStock</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// 既存の UseCase を呼び出し</span>
<span class="w">            </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">createItem</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProto</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DuplicateItemException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">ALREADY_EXISTS</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目更新（Unary RPC）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateItem</span><span class="p">(</span><span class="n">UpdateItemRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                           </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UpdateItemCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UpdateItemCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">emptyToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemName</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainCategory</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">leadTime</span><span class="p">(</span><span class="n">zeroToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getLeadTime</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">safetyStock</span><span class="p">(</span><span class="n">zeroToNull</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getSafetyStock</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">updateItem</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProto</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ItemNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">NOT_FOUND</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目削除（Unary RPC）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteItem</span><span class="p">(</span><span class="n">DeleteItemRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                           </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">Empty</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">deleteItem</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">Empty</span><span class="p">.</span><span class="na">getDefaultInstance</span><span class="p">());</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ItemNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">NOT_FOUND</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目一覧のストリーム配信（Server Streaming RPC）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">streamItems</span><span class="p">(</span><span class="n">GetItemsRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                            </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span>
<span class="w">                    </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">ItemCategory</span><span class="p">.</span><span class="na">ITEM_CATEGORY_UNSPECIFIED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemsByCategory</span><span class="p">(</span>
<span class="w">                    </span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainCategory</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()));</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getAllItems</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// ストリーミング配信</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProto</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * バッチ登録（Client Streaming RPC）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">CreateItemRequest</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">batchCreateItems</span><span class="p">(</span>
<span class="w">            </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">BatchCreateResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StreamObserver</span><span class="o">&lt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">successCodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">failedCodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onNext</span><span class="p">(</span><span class="n">CreateItemRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">CreateItemCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateItemCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainCategory</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">                    </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">createItem</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">                    </span><span class="n">successCodes</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">failedCodes</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onError</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                    </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCompleted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">BatchCreateResponse</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setSuccessCount</span><span class="p">(</span><span class="n">successCodes</span><span class="p">.</span><span class="na">size</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setFailedCount</span><span class="p">(</span><span class="n">failedCodes</span><span class="p">.</span><span class="na">size</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">addAllFailedCodes</span><span class="p">(</span><span class="n">failedCodes</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">emptyToNull</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">zeroToNull</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="433-bom-grpc">43.3 BOM gRPC サービスの実装<a class="headerlink" href="#433-bom-grpc" title="Permanent link">&para;</a></h3>
<details>
<summary>BomGrpcService.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.BomNode</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.BomService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.WhereUsedResult</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.grpc.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.mapper.ProtoMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.Status</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.stub.StreamObserver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">net.devh.boot.grpc.server.service.GrpcService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * BOM gRPC サービス実装</span>
<span class="cm"> * 既存の BomService を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@GrpcService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BomGrpcService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">BomServiceGrpc</span><span class="p">.</span><span class="na">BomServiceImplBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BomService</span><span class="w"> </span><span class="n">bomService</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存のサービスを注入</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">BomGrpcService</span><span class="p">(</span><span class="n">BomService</span><span class="w"> </span><span class="n">bomService</span><span class="p">,</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bomService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bomService</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 部品展開（Server Streaming）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">explodeBom</span><span class="p">(</span><span class="n">ExplodeBomRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                           </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">BomNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">BomNode</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bomService</span><span class="p">.</span><span class="na">explodeBom</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>

<span class="w">            </span><span class="c1">// 深さ優先でストリーミング配信</span>
<span class="w">            </span><span class="n">streamBomNode</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">);</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">streamBomNode</span><span class="p">(</span><span class="n">BomNode</span><span class="w"> </span><span class="n">node</span><span class="p">,</span>
<span class="w">                               </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">BomNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">observer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">observer</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">toProtoBomNode</span><span class="p">(</span><span class="n">node</span><span class="p">));</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="na">getChildren</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">BomNode</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="na">getChildren</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">streamBomNode</span><span class="p">(</span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">observer</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">BomNode</span><span class="w"> </span><span class="nf">toProtoBomNode</span><span class="p">(</span><span class="n">BomNode</span><span class="w"> </span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">BomNode</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemName</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setRequiredQuantity</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getRequiredQuantity</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getLevel</span><span class="p">());</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getChildren</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">BomNode</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">domain</span><span class="p">.</span><span class="na">getChildren</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">builder</span><span class="p">.</span><span class="na">addChildren</span><span class="p">(</span><span class="n">toProtoBomNode</span><span class="p">(</span><span class="n">child</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 使用先照会</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">whereUsed</span><span class="p">(</span><span class="n">WhereUsedRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                          </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">WhereUsedResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WhereUsedResult</span><span class="o">&gt;</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bomService</span><span class="p">.</span><span class="na">whereUsed</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WhereUsedResponse</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">();</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">WhereUsedResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">response</span><span class="p">.</span><span class="na">addResults</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">WhereUsedResult</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setParentItemCode</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getParentItemCode</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setItemName</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setRequiredQuantity</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getRequiredQuantity</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="44-api">第44章：トランザクション API の実装<a class="headerlink" href="#44-api" title="Permanent link">&para;</a></h2>
<h3 id="441-grpc">44.1 発注 gRPC サービス<a class="headerlink" href="#441-grpc" title="Permanent link">&para;</a></h3>
<details>
<summary>src/main/proto/purchase_order.proto</summary>

<div class="highlight"><pre><span></span><code><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="kn">package</span><span class="w"> </span><span class="nn">production</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s">&quot;common.proto&quot;</span><span class="p">;</span>

<span class="k">option</span><span class="w"> </span><span class="na">java_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.example.production.grpc&quot;</span><span class="p">;</span>
<span class="k">option</span><span class="w"> </span><span class="na">java_multiple_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="c1">// 発注ステータス</span>
<span class="kd">enum</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">ORDER_STATUS_UNSPECIFIED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="na">DRAFT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="na">CONFIRMED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="na">CANCELLED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="na">COMPLETED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 発注ヘッダ</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">PurchaseOrder</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">order_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">supplier_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">Date</span><span class="w"> </span><span class="na">order_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">OrderStatus</span><span class="w"> </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">PurchaseOrderDetail</span><span class="w"> </span><span class="na">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">total_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 発注明細</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">PurchaseOrderDetail</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">line_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">order_quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">unit_price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="n">Date</span><span class="w"> </span><span class="na">delivery_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">received_quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// リクエスト</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">GetOrderRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">order_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">GetOrdersRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">OrderStatus</span><span class="w"> </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">PageRequest</span><span class="w"> </span><span class="na">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">CreateOrderRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">supplier_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">CreateOrderDetailRequest</span><span class="w"> </span><span class="na">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">CreateOrderDetailRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">item_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">order_quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">unit_price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">Date</span><span class="w"> </span><span class="na">delivery_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">ConfirmOrderRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">order_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 入荷登録（双方向ストリーミング）</span>
<span class="kd">message</span><span class="w"> </span><span class="nc">RecordReceivingRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">order_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">line_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">received_quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">Date</span><span class="w"> </span><span class="na">receiving_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">RecordReceivingResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">order_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">line_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">Decimal</span><span class="w"> </span><span class="na">total_received</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="na">is_completed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 発注サービス</span>
<span class="kd">service</span><span class="w"> </span><span class="n">PurchaseOrderService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">GetOrder</span><span class="p">(</span><span class="n">GetOrderRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">PurchaseOrder</span><span class="p">);</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">StreamOrders</span><span class="p">(</span><span class="n">GetOrdersRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">stream</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="p">);</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">CreateOrder</span><span class="p">(</span><span class="n">CreateOrderRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">PurchaseOrder</span><span class="p">);</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">ConfirmOrder</span><span class="p">(</span><span class="n">ConfirmOrderRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">PurchaseOrder</span><span class="p">);</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">CancelOrder</span><span class="p">(</span><span class="n">GetOrderRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">Empty</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// 入荷登録（双方向ストリーミング）</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">RecordReceiving</span><span class="p">(</span><span class="n">stream</span><span class="w"> </span><span class="n">RecordReceivingRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">stream</span><span class="w"> </span><span class="n">RecordReceivingResponse</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>PurchaseOrderGrpcService.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.port.in.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.purchase.PurchaseOrder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.grpc.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.mapper.ProtoMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.Status</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.stub.StreamObserver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">net.devh.boot.grpc.server.service.GrpcService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 発注 gRPC サービス実装</span>
<span class="cm"> * 既存の PurchaseOrderUseCase を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@GrpcService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PurchaseOrderGrpcService</span>
<span class="w">        </span><span class="kd">extends</span><span class="w"> </span><span class="n">PurchaseOrderServiceGrpc</span><span class="p">.</span><span class="na">PurchaseOrderServiceImplBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">PurchaseOrderUseCase</span><span class="w"> </span><span class="n">useCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存の UseCase</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">PurchaseOrderGrpcService</span><span class="p">(</span><span class="n">PurchaseOrderUseCase</span><span class="w"> </span><span class="n">useCase</span><span class="p">,</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">useCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">(</span><span class="n">GetOrderRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                         </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">PurchaseOrder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">getOrder</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">());</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">toProto</span><span class="p">(</span><span class="n">order</span><span class="p">));</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">NOT_FOUND</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">streamOrders</span><span class="p">(</span><span class="n">GetOrdersRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                             </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">PurchaseOrder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PurchaseOrder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">getAllOrders</span><span class="p">();</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">orders</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">toProto</span><span class="p">(</span><span class="n">order</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span><span class="n">CreateOrderRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                            </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">PurchaseOrder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">CreatePurchaseOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePurchaseOrderCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">details</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getDetailsList</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">CreatePurchaseOrderCommand</span><span class="p">.</span><span class="na">PurchaseOrderDetailCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDecimal</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getOrderQuantity</span><span class="p">()))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDecimal</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">()))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">deliveryDate</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDate</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getDeliveryDate</span><span class="p">()))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">toList</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">createOrder</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">toProto</span><span class="p">(</span><span class="n">order</span><span class="p">));</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 入荷登録（双方向ストリーミング）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">RecordReceivingRequest</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">recordReceiving</span><span class="p">(</span>
<span class="w">            </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">RecordReceivingResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StreamObserver</span><span class="o">&lt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onNext</span><span class="p">(</span><span class="n">RecordReceivingRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">recordReceiving</span><span class="p">(</span>
<span class="w">                        </span><span class="n">request</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">request</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDecimal</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getReceivedQuantity</span><span class="p">()),</span>
<span class="w">                        </span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getReceivingDate</span><span class="p">())</span>
<span class="w">                    </span><span class="p">);</span>

<span class="w">                    </span><span class="c1">// 即座にレスポンス</span>
<span class="w">                    </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">RecordReceivingResponse</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setOrderNumber</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setLineNumber</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setTotalReceived</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getTotalReceived</span><span class="p">()))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setIsCompleted</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">isCompleted</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">RecordReceivingResponse</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setOrderNumber</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setLineNumber</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">())</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setIsCompleted</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onError</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                    </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCompleted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">PurchaseOrder</span><span class="w"> </span><span class="nf">toProto</span><span class="p">(</span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">PurchaseOrder</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setOrderNumber</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setSupplierCode</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setOrderDate</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDate</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getOrderDate</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">toProtoStatus</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setTotalAmount</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">()));</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getDetails</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">domain</span><span class="p">.</span><span class="na">getDetails</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">builder</span><span class="p">.</span><span class="na">addDetails</span><span class="p">(</span><span class="n">PurchaseOrderDetail</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setLineNumber</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setOrderQuantity</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getOrderQuantity</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setUnitPrice</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setDeliveryDate</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDate</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getDeliveryDate</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setReceivedQuantity</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getReceivedQuantity</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="nf">toProtoStatus</span><span class="p">(</span>
<span class="w">            </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">domain</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">purchase</span><span class="p">.</span><span class="na">OrderStatus</span><span class="w"> </span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">DRAFT</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">CONFIRMED</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">CANCELLED</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">COMPLETED</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">COMPLETED</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="442-mrp-grpc">44.2 MRP gRPC サービス<a class="headerlink" href="#442-mrp-grpc" title="Permanent link">&para;</a></h3>
<details>
<summary>MrpGrpcService.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.MrpService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.grpc.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.mapper.ProtoMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.stub.StreamObserver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">net.devh.boot.grpc.server.service.GrpcService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletableFuture</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.Executors</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * MRP gRPC サービス実装</span>
<span class="cm"> * 既存の MrpService を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@GrpcService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MrpGrpcService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">MrpServiceGrpc</span><span class="p">.</span><span class="na">MrpServiceImplBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MrpService</span><span class="w"> </span><span class="n">mrpService</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存のサービス</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MrpGrpcService</span><span class="p">(</span><span class="n">MrpService</span><span class="w"> </span><span class="n">mrpService</span><span class="p">,</span><span class="w"> </span><span class="n">ProtoMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mrpService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrpService</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * MRP 実行（進捗をストリーミング）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">executeMrp</span><span class="p">(</span><span class="n">ExecuteMrpRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                           </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newSingleThreadExecutor</span><span class="p">();</span>

<span class="w">        </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">runAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// フェーズ1: 需要取得</span>
<span class="w">                </span><span class="n">sendProgress</span><span class="p">(</span><span class="n">responseObserver</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;需要取得&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;基準生産計画から需要を取得中...&quot;</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// フェーズ2: BOM 展開</span>
<span class="w">                </span><span class="n">sendProgress</span><span class="p">(</span><span class="n">responseObserver</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;BOM展開&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;部品構成表を展開中...&quot;</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// フェーズ3: 正味所要量計算</span>
<span class="w">                </span><span class="n">sendProgress</span><span class="p">(</span><span class="n">responseObserver</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;正味所要量計算&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;在庫と照合して正味所要量を計算中...&quot;</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// フェーズ4: 計画オーダ生成</span>
<span class="w">                </span><span class="n">sendProgress</span><span class="p">(</span><span class="n">responseObserver</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;計画オーダ生成&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;ロットサイズを考慮して計画オーダを生成中...&quot;</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// 実際の MRP 実行</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">startDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getStartDate</span><span class="p">());</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">endDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getEndDate</span><span class="p">());</span>
<span class="w">                </span><span class="n">mrpService</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span><span class="w"> </span><span class="n">endDate</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// 完了</span>
<span class="w">                </span><span class="n">sendProgress</span><span class="p">(</span><span class="n">responseObserver</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;完了&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;MRP 実行が完了しました&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                    </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="n">executor</span><span class="p">).</span><span class="na">whenComplete</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="na">shutdown</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendProgress</span><span class="p">(</span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;</span><span class="w"> </span><span class="n">observer</span><span class="p">,</span>
<span class="w">                              </span><span class="n">String</span><span class="w"> </span><span class="n">phase</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">current</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">observer</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">MrpProgress</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setPhase</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">setCurrent</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">setTotal</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * MRP 実行（同期）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">executeMrpSync</span><span class="p">(</span><span class="n">ExecuteMrpRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                               </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">MrpResult</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">startDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getStartDate</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">endDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toDomainDate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getEndDate</span><span class="p">());</span>

<span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrpService</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span><span class="w"> </span><span class="n">endDate</span><span class="p">);</span>
<span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">executionTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span><span class="p">;</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MrpResult</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">setPeriodStart</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getStartDate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">setPeriodEnd</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getEndDate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">setStatistics</span><span class="p">(</span><span class="n">MrpStatistics</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setTotalItemsProcessed</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getPlannedOrders</span><span class="p">().</span><span class="na">size</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setShortageItemCount</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getShortageItems</span><span class="p">().</span><span class="na">size</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">setExecutionTimeMs</span><span class="p">(</span><span class="n">executionTime</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">getPlannedOrders</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">response</span><span class="p">.</span><span class="na">addPlannedOrders</span><span class="p">(</span><span class="n">toProtoPlannedOrder</span><span class="p">(</span><span class="n">order</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">getShortageItems</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">response</span><span class="p">.</span><span class="na">addShortageItems</span><span class="p">(</span><span class="n">toProtoShortageItem</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="na">grpc</span><span class="p">.</span><span class="na">Status</span><span class="p">.</span><span class="na">INTERNAL</span>
<span class="w">                </span><span class="p">.</span><span class="na">withDescription</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">asRuntimeException</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PlannedOrder</span><span class="w"> </span><span class="nf">toProtoPlannedOrder</span><span class="p">(</span>
<span class="w">            </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">application</span><span class="p">.</span><span class="na">service</span><span class="p">.</span><span class="na">PlannedOrder</span><span class="w"> </span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PlannedOrder</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemName</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setQuantity</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setDueDate</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDate</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getDueDate</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ShortageItem</span><span class="w"> </span><span class="nf">toProtoShortageItem</span><span class="p">(</span>
<span class="w">            </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">production</span><span class="p">.</span><span class="na">application</span><span class="p">.</span><span class="na">service</span><span class="p">.</span><span class="na">ShortageItem</span><span class="w"> </span><span class="n">domain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ShortageItem</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemCode</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setItemName</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">setShortageQuantity</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDecimal</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getShortageQuantity</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">setRecommendedOrderDate</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">toProtoDate</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getRecommendedOrderDate</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="45">第45章：エラーハンドリングとストリーミング<a class="headerlink" href="#45" title="Permanent link">&para;</a></h2>
<h3 id="451-grpc">45.1 gRPC ステータスコード<a class="headerlink" href="#451-grpc" title="Permanent link">&para;</a></h3>
<p>gRPC は標準化されたステータスコードを使用します：</p>
<table>
<thead>
<tr>
<th>コード</th>
<th>説明</th>
<th>使用例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OK</code></td>
<td>成功</td>
<td>正常完了</td>
</tr>
<tr>
<td><code>INVALID_ARGUMENT</code></td>
<td>無効な引数</td>
<td>バリデーションエラー</td>
</tr>
<tr>
<td><code>NOT_FOUND</code></td>
<td>見つからない</td>
<td>品目が存在しない</td>
</tr>
<tr>
<td><code>ALREADY_EXISTS</code></td>
<td>既に存在</td>
<td>品目コード重複</td>
</tr>
<tr>
<td><code>FAILED_PRECONDITION</code></td>
<td>前提条件エラー</td>
<td>発注確定済みの取消</td>
</tr>
<tr>
<td><code>INTERNAL</code></td>
<td>内部エラー</td>
<td>サーバー側エラー</td>
</tr>
</tbody>
</table>
<h3 id="452">45.2 グローバルインターセプター<a class="headerlink" href="#452" title="Permanent link">&para;</a></h3>
<details>
<summary>LoggingInterceptor.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.interceptor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">net.devh.boot.grpc.server.interceptor.GrpcGlobalServerInterceptor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Duration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Instant</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * ロギング &amp; エラーハンドリングインターセプター</span>
<span class="cm"> */</span>
<span class="nd">@GrpcGlobalServerInterceptor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoggingInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ServerInterceptor</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">LoggingInterceptor</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ReqT</span><span class="p">,</span><span class="w"> </span><span class="n">RespT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ServerCall</span><span class="p">.</span><span class="na">Listener</span><span class="o">&lt;</span><span class="n">ReqT</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">interceptCall</span><span class="p">(</span>
<span class="w">            </span><span class="n">ServerCall</span><span class="o">&lt;</span><span class="n">ReqT</span><span class="p">,</span><span class="w"> </span><span class="n">RespT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="p">,</span>
<span class="w">            </span><span class="n">Metadata</span><span class="w"> </span><span class="n">headers</span><span class="p">,</span>
<span class="w">            </span><span class="n">ServerCallHandler</span><span class="o">&lt;</span><span class="n">ReqT</span><span class="p">,</span><span class="w"> </span><span class="n">RespT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">methodName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="na">getMethodDescriptor</span><span class="p">().</span><span class="na">getFullMethodName</span><span class="p">();</span>
<span class="w">        </span><span class="n">Instant</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>

<span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;gRPC Request: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">methodName</span><span class="p">);</span>

<span class="w">        </span><span class="n">ServerCall</span><span class="o">&lt;</span><span class="n">ReqT</span><span class="p">,</span><span class="w"> </span><span class="n">RespT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">wrappedCall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ForwardingServerCall</span>
<span class="w">                </span><span class="p">.</span><span class="na">SimpleForwardingServerCall</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">call</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nd">@Override</span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="n">Status</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="w"> </span><span class="n">trailers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Duration</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">between</span><span class="p">(</span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;gRPC Response: {} - Status: {} - Duration: {}ms&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">methodName</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="na">getCode</span><span class="p">(),</span><span class="w"> </span><span class="n">duration</span><span class="p">.</span><span class="na">toMillis</span><span class="p">());</span>
<span class="w">                </span><span class="kd">super</span><span class="p">.</span><span class="na">close</span><span class="p">(</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">trailers</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">next</span><span class="p">.</span><span class="na">startCall</span><span class="p">(</span><span class="n">wrappedCall</span><span class="p">,</span><span class="w"> </span><span class="n">headers</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="453">45.3 ヘルスチェックの実装<a class="headerlink" href="#453" title="Permanent link">&para;</a></h3>
<details>
<summary>HealthGrpcService.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.grpc.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.health.v1.HealthCheckRequest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.health.v1.HealthCheckResponse</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.health.v1.HealthGrpc</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.grpc.stub.StreamObserver</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">net.devh.boot.grpc.server.service.GrpcService</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Connection</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * gRPC ヘルスチェックサービス</span>
<span class="cm"> */</span>
<span class="nd">@GrpcService</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HealthGrpcService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">HealthGrpc</span><span class="p">.</span><span class="na">HealthImplBase</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">HealthGrpcService</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="n">HealthCheckRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                      </span><span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">HealthCheckResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">responseObserver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">HealthCheckResponse</span><span class="p">.</span><span class="na">ServingStatus</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkHealth</span><span class="p">()</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">HealthCheckResponse</span><span class="p">.</span><span class="na">ServingStatus</span><span class="p">.</span><span class="na">SERVING</span>
<span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="n">HealthCheckResponse</span><span class="p">.</span><span class="na">ServingStatus</span><span class="p">.</span><span class="na">NOT_SERVING</span><span class="p">;</span>

<span class="w">        </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">HealthCheckResponse</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">        </span><span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">checkHealth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">isValid</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="454">45.4 設定ファイル<a class="headerlink" href="#454" title="Permanent link">&para;</a></h3>
<details>
<summary>application.yml（gRPC 追加設定）</summary>

<div class="highlight"><pre><span></span><code><span class="nt">grpc</span><span class="p">:</span>
<span class="w">  </span><span class="nt">server</span><span class="p">:</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<span class="w">    </span><span class="nt">reflection-service-enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># 開発時にリフレクション有効化</span>

<span class="c1"># 既存の設定はそのまま</span>
<span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">datasource</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdbc:postgresql://localhost:5432/production</span>
<span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>

<span class="nt">mybatis</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mapper-locations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">classpath:mapper/*.xml</span>
</code></pre></div>

</details>

<h3 id="455-grpc">45.5 gRPC クライアントからの呼び出し<a class="headerlink" href="#455-grpc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># サービス一覧</span>
grpcurl<span class="w"> </span>-plaintext<span class="w"> </span>localhost:9090<span class="w"> </span>list

<span class="c1"># 品目取得</span>
grpcurl<span class="w"> </span>-plaintext<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;item_code&quot;: &quot;PROD-001&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>localhost:9090<span class="w"> </span>production.ItemService/GetItem

<span class="c1"># 品目一覧（ストリーミング）</span>
grpcurl<span class="w"> </span>-plaintext<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>localhost:9090<span class="w"> </span>production.ItemService/StreamItems
</code></pre></div>
<hr />
<h2 id="_2">まとめ<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>本研究では、gRPC による生産管理システム API を実装しました。</p>
<h3 id="api">API サーバー版との比較<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>REST API（第32章）</th>
<th>gRPC（本研究）</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>プロトコル</strong></td>
<td>HTTP/1.1 + JSON</td>
<td>HTTP/2 + Protobuf</td>
</tr>
<tr>
<td><strong>スキーマ</strong></td>
<td>OpenAPI（任意）</td>
<td>.proto（必須）</td>
</tr>
<tr>
<td><strong>ストリーミング</strong></td>
<td>WebSocket 別実装</td>
<td>ネイティブ</td>
</tr>
<tr>
<td><strong>パフォーマンス</strong></td>
<td>標準</td>
<td>高速</td>
</tr>
<tr>
<td><strong>ドメイン層</strong></td>
<td>共有</td>
<td>共有</td>
</tr>
<tr>
<td><strong>アプリケーション層</strong></td>
<td>共有</td>
<td>共有</td>
</tr>
<tr>
<td><strong>Input Adapter</strong></td>
<td>REST Controller</td>
<td>gRPC Service</td>
</tr>
</tbody>
</table>
<h3 id="grpc">実装した gRPC サービス<a class="headerlink" href="#grpc" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>サービス</th>
<th>メソッド</th>
<th>パターン</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ItemService</strong></td>
<td>GetItem, CreateItem, UpdateItem, DeleteItem</td>
<td>Unary</td>
</tr>
<tr>
<td></td>
<td>StreamItems</td>
<td>Server Streaming</td>
</tr>
<tr>
<td></td>
<td>BatchCreateItems</td>
<td>Client Streaming</td>
</tr>
<tr>
<td><strong>BomService</strong></td>
<td>ExplodeBom</td>
<td>Server Streaming</td>
</tr>
<tr>
<td></td>
<td>WhereUsed</td>
<td>Unary</td>
</tr>
<tr>
<td><strong>PurchaseOrderService</strong></td>
<td>GetOrder, CreateOrder, ConfirmOrder</td>
<td>Unary</td>
</tr>
<tr>
<td></td>
<td>StreamOrders</td>
<td>Server Streaming</td>
</tr>
<tr>
<td></td>
<td>RecordReceiving</td>
<td>Bidirectional</td>
</tr>
<tr>
<td><strong>MrpService</strong></td>
<td>ExecuteMrp</td>
<td>Server Streaming</td>
</tr>
<tr>
<td></td>
<td>ExecuteMrpSync</td>
<td>Unary</td>
</tr>
</tbody>
</table>
<h3 id="_3">技術スタック<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>grpc-spring-boot-starter</strong>: Spring Boot 統合</li>
<li><strong>Protocol Buffers 3</strong>: スキーマ定義</li>
<li><strong>io.grpc</strong>: gRPC Java 実装</li>
<li><strong>gRPC Health Check</strong>: ヘルスチェック</li>
</ul>
<h3 id="grpc_1">gRPC を選択すべき場面<a class="headerlink" href="#grpc_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>マイクロサービス間通信</strong>: 高パフォーマンスが必要</li>
<li><strong>リアルタイム通信</strong>: 進捗通知、チャット等</li>
<li><strong>大量データ転送</strong>: ストリーミングで効率的に</li>
<li><strong>多言語クライアント</strong>: Proto からコード生成</li>
<li><strong>型安全性重視</strong>: スキーマ駆動開発</li>
</ol>
<hr />
<p><a href="../../">目次へ戻る</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>