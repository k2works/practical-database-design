
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../study4-3/">
      
      
        <link rel="next" href="../../part3-orm/chapter14-orm/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>研究4 GraphQLサービスの実装 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-graphql" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              研究4 GraphQLサービスの実装
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" checked>
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        はじめに
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        第46章：GraphQL サーバーの基礎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第46章：GraphQL サーバーの基礎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#461-graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        46.1 GraphQL とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#462-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        46.2 3つの操作タイプ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#463-graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        46.3 GraphQL におけるヘキサゴナルアーキテクチャ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#464" class="md-nav__link">
    <span class="md-ellipsis">
      
        46.4 ディレクトリ構成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#465" class="md-nav__link">
    <span class="md-ellipsis">
      
        46.5 技術スタックの追加
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#426-graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.6 GraphQL スキーマ定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#427-api-controller" class="md-nav__link">
    <span class="md-ellipsis">
      
        42.7 API サーバー版との Controller の違い
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#47-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        第47章：マスタ API の実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第47章：マスタ API の実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#471" class="md-nav__link">
    <span class="md-ellipsis">
      
        47.1 カスタムスカラーの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#472-graphql-tdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        47.2 品目 GraphQL リゾルバの TDD 実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="47.2 品目 GraphQL リゾルバの TDD 実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#red" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red: 失敗するテストを書く
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#green-graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        Green: GraphQL リゾルバの実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#473-n1-dataloader" class="md-nav__link">
    <span class="md-ellipsis">
      
        47.3 N+1 問題対策（DataLoader）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#474-bom-graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        47.4 BOM GraphQL リゾルバ
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#48-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        第48章：トランザクション API の実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第48章：トランザクション API の実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#481-graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        48.1 発注 GraphQL リゾルバ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#482-mrp-graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        48.2 MRP GraphQL リゾルバ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#483-subscription" class="md-nav__link">
    <span class="md-ellipsis">
      
        48.3 Subscription（リアルタイム更新）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#49" class="md-nav__link">
    <span class="md-ellipsis">
      
        第49章：エラーハンドリングとベストプラクティス
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第49章：エラーハンドリングとベストプラクティス">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#491" class="md-nav__link">
    <span class="md-ellipsis">
      
        49.1 グローバル例外ハンドラ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#492" class="md-nav__link">
    <span class="md-ellipsis">
      
        49.2 入力バリデーション
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#493" class="md-nav__link">
    <span class="md-ellipsis">
      
        49.3 設定ファイル
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#494-graphql-playground" class="md-nav__link">
    <span class="md-ellipsis">
      
        49.4 GraphQL Playground からの呼び出し
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#495-graphql-vs-rest-vs-grpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        49.5 GraphQL vs REST vs gRPC の使い分け
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        まとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="まとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        API サーバー版との比較
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphql" class="md-nav__link">
    <span class="md-ellipsis">
      
        実装した GraphQL 操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        技術スタック
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphql_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        GraphQL を選択すべき場面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="4-graphql">実践データベース設計：生産管理システム 研究 4 - GraphQL サービスの実装<a class="headerlink" href="#4-graphql" title="Permanent link">&para;</a></h1>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本研究では、API サーバー構成（第32章）とは異なるアプローチとして、<strong>GraphQL</strong> による生産管理システムを実装します。クライアントが必要なデータを正確に指定できる柔軟なクエリと、リアルタイム更新を実現する Subscription を活用します。</p>
<p>第32章で構築したヘキサゴナルアーキテクチャ（ドメイン層・アプリケーション層）はそのまま共有し、<strong>Input Adapter として GraphQL リゾルバ層のみを追加</strong>します。</p>
<hr />
<h2 id="46graphql">第46章：GraphQL サーバーの基礎<a class="headerlink" href="#46graphql" title="Permanent link">&para;</a></h2>
<h3 id="461-graphql">46.1 GraphQL とは<a class="headerlink" href="#461-graphql" title="Permanent link">&para;</a></h3>
<p>GraphQL は Facebook が開発したクエリ言語および実行エンジンです。クライアントが必要なデータの形状を指定でき、Over-fetching や Under-fetching を防ぎます。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjgwMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDU1cHg7aGVpZ2h0OjgwMnB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQ1NSA4MDIiIHdpZHRoPSI0NTVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iODAyIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNDU1IiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgR3JhcGhRTCBBcmNoaXRlY3R1cmUgKD8/Pz8/Pz8/KS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iR3JhcGhRTCBBcmNoaXRlY3R1cmUgLi4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNSIgZGF0YS11aWQ9ImVudDAwMDIiIGlkPSJjbHVzdGVyX0dyYXBoUUwgQXJjaGl0ZWN0dXJlIC4uLi4uLi4uLi4iPjxwYXRoIGQ9Ik04LjUsNiBMMzExLjA0NjQsNiBBMy43NSwzLjc1IDAgMCAxIDMxMy41NDY0LDguNSBMMzIwLjU0NjQsMjguMjk2OSBMNDM4LjUsMjguMjk2OSBBMi41LDIuNSAwIDAgMSA0NDEsMzAuNzk2OSBMNDQxLDY5MC4yNSBBMi41LDIuNSAwIDAgMSA0MzguNSw2OTIuNzUgTDguNSw2OTIuNzUgQTIuNSwyLjUgMCAwIDEgNiw2OTAuMjUgTDYsOC41IEEyLjUsMi41IDAgMCAxIDguNSw2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2IiB4Mj0iMzIwLjU0NjQiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMDEuNTQ2NCIgeD0iMTAiIHk9IjIwLjk5NTEiPkdyYXBoUUwgQXJjaGl0ZWN0dXJlICgmIzI5OTgzOyYjMjk5ODc7JiMzMTY0OTsmIzI5NzAyOyYjMTI0NzE7JiMxMjQ3MzsmIzEyNDg2OyYjMTI1MTI7KTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQ2xpZW50IFNpZGUtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1lbnRpdHk9IkNsaWVudCBTaWRlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImNsdXN0ZXJfQ2xpZW50IFNpZGUiPjxwYXRoIGQ9Ik0xMDMuNSw0OSBMMTg5Ljc5ODgsNDkgQTMuNzUsMy43NSAwIDAgMSAxOTIuMjk4OCw1MS41IEwxOTkuMjk4OCw3MS4yOTY5IEwzNDIuNSw3MS4yOTY5IEEyLjUsMi41IDAgMCAxIDM0NSw3My43OTY5IEwzNDUsMjA0Ljk5IEEyLjUsMi41IDAgMCAxIDM0Mi41LDIwNy40OSBMMTAzLjUsMjA3LjQ5IEEyLjUsMi41IDAgMCAxIDEwMSwyMDQuOTkgTDEwMSw1MS41IEEyLjUsMi41IDAgMCAxIDEwMy41LDQ5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMDEiIHgyPSIxOTkuMjk4OCIgeTE9IjcxLjI5NjkiIHkyPSI3MS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg1LjI5ODgiIHg9IjEwNSIgeT0iNjMuOTk1MSI+Q2xpZW50IFNpZGU8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFNlcnZlciBTaWRlLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJTZXJ2ZXIgU2lkZSIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iY2x1c3Rlcl9TZXJ2ZXIgU2lkZSI+PHBhdGggZD0iTTMyLjUsMjcxLjQ5IEwxMjQuNzgwMywyNzEuNDkgQTMuNzUsMy43NSAwIDAgMSAxMjcuMjgwMywyNzMuOTkgTDEzNC4yODAzLDI5My43ODY5IEwyNDkuNSwyOTMuNzg2OSBBMi41LDIuNSAwIDAgMSAyNTIsMjk2LjI4NjkgTDI1Miw0MjcuNDcgQTIuNSwyLjUgMCAwIDEgMjQ5LjUsNDI5Ljk3IEwzMi41LDQyOS45NyBBMi41LDIuNSAwIDAgMSAzMCw0MjcuNDcgTDMwLDI3My45OSBBMi41LDIuNSAwIDAgMSAzMi41LDI3MS40OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzAiIHgyPSIxMzQuMjgwMyIgeTE9IjI5My43ODY5IiB5Mj0iMjkzLjc4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMjgwMyIgeD0iMzQiIHk9IjI4Ni40ODUxIj5TZXJ2ZXIgU2lkZTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgU2hhcmVkLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJTaGFyZWQiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBkYXRhLXVpZD0iZW50MDAwNyIgaWQ9ImNsdXN0ZXJfU2hhcmVkIj48cGF0aCBkPSJNMTA5LjUsNDkzLjk3IEwxNjYuNDE4LDQ5My45NyBBMy43NSwzLjc1IDAgMCAxIDE2OC45MTgsNDk2LjQ3IEwxNzUuOTE4LDUxNi4yNjY5IEwzMzYuNSw1MTYuMjY2OSBBMi41LDIuNSAwIDAgMSAzMzksNTE4Ljc2NjkgTDMzOSw2NjYuMjUgQTIuNSwyLjUgMCAwIDEgMzM2LjUsNjY4Ljc1IEwxMDkuNSw2NjguNzUgQTIuNSwyLjUgMCAwIDEgMTA3LDY2Ni4yNSBMMTA3LDQ5Ni40NyBBMi41LDIuNSAwIDAgMSAxMDkuNSw0OTMuOTciIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjEwNyIgeDI9IjE3NS45MTgiIHkxPSI1MTYuMjY2OSIgeTI9IjUxNi4yNjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1LjkxOCIgeD0iMTExIiB5PSI1MDguOTY1MSI+U2hhcmVkPC90ZXh0PjwvZz48IS0tY2xhc3MgY2xpZW50LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9ImNsaWVudCIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJlbnRpdHlfY2xpZW50Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwNy40ODQ0IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyMTIuMzYxIiB4PSIxMTYuODIiIHk9Ijg0Ii8+PGVsbGlwc2UgY3g9IjE1NC4zNzgzIiBjeT0iMTA1LjI5NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE1Ny4zNDcsMTEwLjkzNzUgUTE1Ni43Njg5LDExMS4yMzQ0IDE1Ni4xMjgzLDExMS4zNzUgUTE1NS40ODc3LDExMS41MzEzIDE1NC43ODQ1LDExMS41MzEzIFExNTIuMjg0NSwxMTEuNTMxMyAxNTAuOTU2NCwxMDkuODkwNiBRMTQ5LjY0MzksMTA4LjIzNDQgMTQ5LjY0MzksMTA1LjEwOTQgUTE0OS42NDM5LDEwMS45ODQ0IDE1MC45NTY0LDEwMC4zMjgxIFExNTIuMjg0NSw5OC42NzE5IDE1NC43ODQ1LDk4LjY3MTkgUTE1NS40ODc3LDk4LjY3MTkgMTU2LjEyODMsOTguODI4MSBRMTU2Ljc4NDUsOTguOTg0NCAxNTcuMzQ3LDk5LjI4MTMgTDE1Ny4zNDcsMTAyIFExNTYuNzIyLDEwMS40MjE5IDE1Ni4xMjgzLDEwMS4xNTYzIFExNTUuNTM0NSwxMDAuODc1IDE1NC45MDk1LDEwMC44NzUgUTE1My41NjU4LDEwMC44NzUgMTUyLjg3ODMsMTAxLjk1MzEgUTE1Mi4xOTA4LDEwMy4wMTU2IDE1Mi4xOTA4LDEwNS4xMDk0IFExNTIuMTkwOCwxMDcuMjAzMSAxNTIuODc4MywxMDguMjgxMyBRMTUzLjU2NTgsMTA5LjM0MzggMTU0LjkwOTUsMTA5LjM0MzggUTE1NS41MzQ1LDEwOS4zNDM4IDE1Ni4xMjgzLDEwOS4wNzgxIFExNTYuNzIyLDEwOC43OTY5IDE1Ny4zNDcsMTA4LjIxODggTDE1Ny4zNDcsMTEwLjkzNzUgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDYuNzQzMiIgeD0iMTg1LjEzNTQiIHk9IjEwMS45OTUxIj5HcmFwaFFMIENsaWVudDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuMjMxNCIgeD0iMTczLjM5MTIiIHk9IjExOC4yOTIiPihBcG9sbG8vUmVsYXkvdXJxbCk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTE3LjgyIiB4Mj0iMzI4LjE4MSIgeTE9IjEyNi41OTM4IiB5Mj0iMTI2LjU5MzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTcuODIiIHgyPSIzMjguMTgxIiB5MT0iMTM0LjU5MzgiIHkyPSIxMzQuNTkzOCIvPjxyZWN0IGZpbGw9IiNGMjRENUMiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjEyNC44MiIgeT0iMTQ1LjI0MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTMuOTIwNyIgeD0iMTM2LjgyIiB5PSIxNTEuNTg4OSI+UXVlcnkgKCYjMzU1MDE7JiMxMjQxNTsmIzIxNDYyOyYjMTI0MjY7KTwvdGV4dD48cmVjdCBmaWxsPSIjRjI0RDVDIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIxMjQuODIiIHk9IjE2MS41MzkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjIxMTciIHg9IjEzNi44MiIgeT0iMTY3Ljg4NTciPk11dGF0aW9uICgmIzI2MzYwOyYjMTIzNjU7JiMzNjc5NjsmIzEyNDE1Oyk8L3RleHQ+PHJlY3QgZmlsbD0iI0YyNEQ1QyIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMTI0LjgyIiB5PSIxNzcuODM1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4Ni4zNjEiIHg9IjEzNi44MiIgeT0iMTg0LjE4MjYiPlN1YnNjcmlwdGlvbiAoJiMxMjUyMjsmIzEyNDUwOyYjMTI1MjM7JiMxMjQ3OTsmIzEyNDUyOyYjMTI1MTI7KTwvdGV4dD48L2c+PCEtLWNsYXNzIHNlcnZlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJzZXJ2ZXIiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImVudGl0eV9zZXJ2ZXIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTA3LjQ4NDQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5MC45MDMzIiB4PSI0NS41NSIgeT0iMzA2LjQ5Ii8+PGVsbGlwc2UgY3g9IjY2LjM0OTUiIGN5PSIzMjcuNzg2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNjkuMzE4MiwzMzMuNDI3NSBRNjguNzQwMSwzMzMuNzI0NCA2OC4wOTk1LDMzMy44NjUgUTY3LjQ1ODgsMzM0LjAyMTIgNjYuNzU1NywzMzQuMDIxMiBRNjQuMjU1NywzMzQuMDIxMiA2Mi45Mjc2LDMzMi4zODA2IFE2MS42MTUxLDMzMC43MjQ0IDYxLjYxNTEsMzI3LjU5OTQgUTYxLjYxNTEsMzI0LjQ3NDQgNjIuOTI3NiwzMjIuODE4MSBRNjQuMjU1NywzMjEuMTYxOSA2Ni43NTU3LDMyMS4xNjE5IFE2Ny40NTg4LDMyMS4xNjE5IDY4LjA5OTUsMzIxLjMxODEgUTY4Ljc1NTcsMzIxLjQ3NDQgNjkuMzE4MiwzMjEuNzcxMiBMNjkuMzE4MiwzMjQuNDkgUTY4LjY5MzIsMzIzLjkxMTkgNjguMDk5NSwzMjMuNjQ2MiBRNjcuNTA1NywzMjMuMzY1IDY2Ljg4MDcsMzIzLjM2NSBRNjUuNTM3LDMyMy4zNjUgNjQuODQ5NSwzMjQuNDQzMSBRNjQuMTYyLDMyNS41MDU2IDY0LjE2MiwzMjcuNTk5NCBRNjQuMTYyLDMyOS42OTMxIDY0Ljg0OTUsMzMwLjc3MTIgUTY1LjUzNywzMzEuODMzNyA2Ni44ODA3LDMzMS44MzM3IFE2Ny41MDU3LDMzMS44MzM3IDY4LjA5OTUsMzMxLjU2ODEgUTY4LjY5MzIsMzMxLjI4NjkgNjkuMzE4MiwzMzAuNzA4NyBMNjkuMzE4MiwzMzMuNDI3NSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi4xMjMiIHg9Ijk4LjU4NDUiIHk9IjMyNC40ODUxIj5HcmFwaFFMIFNlcnZlcjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDYuMDE1NiIgeD0iODEuNjM4MiIgeT0iMzQwLjc4MiI+KFNwcmluZyBmb3IgR3JhcGhRTCk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDYuNTUiIHgyPSIyMzUuNDUzMyIgeTE9IjM0OS4wODM3IiB5Mj0iMzQ5LjA4MzciLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI1My41NSIgeT0iMzU5LjczMjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Mi42MTMzIiB4PSI2NS41NSIgeT0iMzY2LjA3ODkiPkl0ZW1SZXNvbHZlcjwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSI1My41NSIgeT0iMzc2LjAyOTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjQuOTAzMyIgeD0iNjUuNTUiIHk9IjM4Mi4zNzU3Ij5QdXJjaGFzZU9yZGVyUmVzb2x2ZXI8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iNTMuNTUiIHk9IjM5Mi4zMjU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODcuNDY1OCIgeD0iNjUuNTUiIHk9IjM5OC42NzI2Ij5NcnBSZXNvbHZlcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0Ni41NSIgeDI9IjIzNS40NTMzIiB5MT0iNDA1Ljk3NDQiIHkyPSI0MDUuOTc0NCIvPjwvZz48IS0tY2xhc3Mgc2NoZW1hLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9InNjaGVtYSIgZGF0YS1zb3VyY2UtbGluZT0iMjQiIGRhdGEtdWlkPSJlbnQwMDA4IiBpZD0iZW50aXR5X3NjaGVtYSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMjMuNzgxMyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjAwLjY1MTQiIHg9IjEyMi42NyIgeT0iNTI4Ljk3Ii8+PGVsbGlwc2UgY3g9IjE1OC40MzgxIiBjeT0iNTUwLjI2NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE2MS40MDY5LDU1NS45MDc1IFExNjAuODI4Nyw1NTYuMjA0NCAxNjAuMTg4MSw1NTYuMzQ1IFExNTkuNTQ3NSw1NTYuNTAxMiAxNTguODQ0NCw1NTYuNTAxMiBRMTU2LjM0NDQsNTU2LjUwMTIgMTU1LjAxNjIsNTU0Ljg2MDYgUTE1My43MDM3LDU1My4yMDQ0IDE1My43MDM3LDU1MC4wNzk0IFExNTMuNzAzNyw1NDYuOTU0NCAxNTUuMDE2Miw1NDUuMjk4MSBRMTU2LjM0NDQsNTQzLjY0MTkgMTU4Ljg0NDQsNTQzLjY0MTkgUTE1OS41NDc1LDU0My42NDE5IDE2MC4xODgxLDU0My43OTgxIFExNjAuODQ0NCw1NDMuOTU0NCAxNjEuNDA2OSw1NDQuMjUxMiBMMTYxLjQwNjksNTQ2Ljk3IFExNjAuNzgxOSw1NDYuMzkxOSAxNjAuMTg4MSw1NDYuMTI2MiBRMTU5LjU5NDQsNTQ1Ljg0NSAxNTguOTY5NCw1NDUuODQ1IFExNTcuNjI1Niw1NDUuODQ1IDE1Ni45MzgxLDU0Ni45MjMxIFExNTYuMjUwNiw1NDcuOTg1NiAxNTYuMjUwNiw1NTAuMDc5NCBRMTU2LjI1MDYsNTUyLjE3MzEgMTU2LjkzODEsNTUzLjI1MTIgUTE1Ny42MjU2LDU1NC4zMTM3IDE1OC45Njk0LDU1NC4zMTM3IFExNTkuNTk0NCw1NTQuMzEzNyAxNjAuMTg4MSw1NTQuMDQ4MSBRMTYwLjc4MTksNTUzLjc2NjkgMTYxLjQwNjksNTUzLjE4ODcgTDE2MS40MDY5LDU1NS45MDc1IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIyLjUiIHg9IjE3Ny4wNTMzIiB5PSI1NDYuOTY1MSI+R3JhcGhRTCBTY2hlbWE8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjQ5MTIiIHg9IjE4My41NTc2IiB5PSI1NjMuMjYyIj4oLmdyYXBocWxzIGZpbGVzKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMjMuNjciIHgyPSIzMjIuMzIxNCIgeTE9IjU3MS41NjM3IiB5Mj0iNTcxLjU2MzciLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIxMzAuNjciIHk9IjU4Mi4yMTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIwLjE5NjMiIHg9IjE0Mi42NyIgeT0iNTg4LjU1ODkiPnNjaGVtYS5ncmFwaHFsczwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIxMzAuNjciIHk9IjU5OC41MDkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuMTMxOCIgeD0iMTQyLjY3IiB5PSI2MDQuODU1NyI+aXRlbS5ncmFwaHFsczwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIxMzAuNjciIHk9IjYxNC44MDU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc0LjY1MTQiIHg9IjE0Mi42NyIgeT0iNjIxLjE1MjYiPnB1cmNoYXNlX29yZGVyLmdyYXBocWxzPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjEzMC42NyIgeT0iNjMxLjEwMjgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5My43ODIyIiB4PSIxNDIuNjciIHk9IjYzNy40NDk1Ij5tcnAuZ3JhcGhxbHM8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTIzLjY3IiB4Mj0iMzIyLjMyMTQiIHkxPSI2NDQuNzUxMiIgeTI9IjY0NC43NTEyIi8+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJHTU4xMiIgZGF0YS1zb3VyY2UtbGluZT0iMzgiIGRhdGEtdWlkPSJlbnQwMDEzIiBpZD0iZW50aXR5X0dNTjEyIj48cGF0aCBkPSJNMTIxLjUsNzM5Ljc1IEwxMjEuNSw3OTUuMTQ4NCBBMCwwIDAgMCAwIDEyMS41LDc5NS4xNDg0IEwzMjQuNTAwMiw3OTUuMTQ4NCBBMCwwIDAgMCAwIDMyNC41MDAyLDc5NS4xNDg0IEwzMjQuNTAwMiw3NDkuNzUgTDMxNC41MDAyLDczOS43NSBMMjI3LDczOS43NSBMMjIzLDY1Mi45MiBMMjE5LDczOS43NSBMMTIxLjUsNzM5Ljc1IEEwLDAgMCAwIDAgMTIxLjUsNzM5Ljc1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzE0LjUwMDIsNzM5Ljc1IEwzMTQuNTAwMiw3NDkuNzUgTDMyNC41MDAyLDc0OS43NSBMMzE0LjUwMDIsNzM5Ljc1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTI3LjUiIHk9Ijc1Ni44MTY5Ij4mIzEyNDczOyYjMTI0NjE7JiMxMjU0MDsmIzEyNTEwOyYjMzkzNjY7JiMyMTIwNTsmIzM4MjgzOyYjMzAzMzA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4Mi4wMDAyIiB4PSIxMjcuNSIgeT0iNzcxLjk0OTciPiYjMTI0NjM7JiMxMjUyMTsmIzEyNDUyOyYjMTI0NTA7JiMxMjUzMTsmIzEyNDg4OyYjMjAwMjc7JiMyMzU2NjsmIzEyMzk4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMjE0NjI7JiMyNDQ3MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzYuNjk4OCIgeD0iMTI3LjUiIHk9Ijc4Ny4wODI1Ij4mIzIyNDExOyYjMjM0MzM7JiMyMDg0MDsmIzEyMzk0OyBBUEk8L3RleHQ+PC9nPjwhLS1saW5rIGNsaWVudCB0byBzY2hlbWEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iY2xpZW50IiBkYXRhLWVudGl0eS0yPSJzY2hlbWEiIGRhdGEtc291cmNlLWxpbmU9IjMzIiBkYXRhLXVpZD0ibG5rOSIgaWQ9ImxpbmtfY2xpZW50X3NjaGVtYSI+PHBhdGggY29kZUxpbmU9IjMzIiBkPSJNMjgyLjExLDE5MS41NyBDMjg5LjgyLDIwMS4zNiAyOTYuNTcsMjEyLjEyIDMwMSwyMjMuNDkgQzM0Mi4xMSwzMjguODUgMzM0LjksMzcwLjA3IDMwMSw0NzcuOTcgQzI5NS40Myw0OTUuNyAyODkuMjg4OCw1MDguMTAxNSAyNzguODA4OCw1MjMuNjgxNSIgZmlsbD0ibm9uZSIgaWQ9ImNsaWVudC10by1zY2hlbWEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI3NS40Niw1MjguNjYsMjgzLjgwMjIsNTIzLjQyNDgsMjc4LjI1MDcsNTI0LjUxMTMsMjc3LjE2NDIsNTE4Ljk1OTcsMjc1LjQ2LDUyOC42NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4wMDAxIiB4PSIzMzAuMTkiIHk9IjM1Ny4yOTY5Ij4mIzEyNDczOyYjMTI0NjE7JiMxMjU0MDsmIzEyNTEwOyYjMTIzOTU7JiMyMjUyMjsmIzEyMzg5OyYjMTIzNTY7JiMxMjM5MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMzQ5LjY5IiB5PSIzNzIuNDI5NyI+JiMxMjQ2MzsmIzEyNDU2OyYjMTI1MjI7JiMxMjQzNDsmIzI3MDgzOyYjMzE2ODk7PC90ZXh0PjwvZz48IS0tbGluayBzZXJ2ZXIgdG8gc2NoZW1hLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9InNlcnZlciIgZGF0YS1lbnRpdHktMj0ic2NoZW1hIiBkYXRhLXNvdXJjZS1saW5lPSIzNCIgZGF0YS11aWQ9ImxuazEwIiBpZD0ibGlua19zZXJ2ZXJfc2NoZW1hIj48cGF0aCBjb2RlTGluZT0iMzQiIGQ9Ik0xNTYuOTIsNDE0LjQgQzE2My4xNyw0MzQuNDQgMTcwLjYsNDU3LjM2IDE3OCw0NzcuOTcgQzE4My45NCw0OTQuNTIgMTg4LjU5NCw1MDYuNjkyMiAxOTUuMTY0LDUyMy4wNTIyIiBmaWxsPSJub25lIiBpZD0ic2VydmVyLXRvLXNjaGVtYSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTk3LjQsNTI4LjYyLDE5Ny43NTc5LDUxOC43Nzc2LDE5NS41MzY3LDUyMy45ODAyLDE5MC4zMzQyLDUyMS43NTg5LDE5Ny40LDUyOC42MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4wMDAxIiB4PSIxNzkiIHk9IjQ1OS4wMzY5Ij4mIzEyNDczOyYjMTI0NjE7JiMxMjU0MDsmIzEyNTEwOyYjMTIzOTU7JiMyMjUyMjsmIzEyMzg5OyYjMTIzNTY7JiMxMjM5MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMTkyIiB5PSI0NzQuMTY5NyI+JiMxMjUyMjsmIzEyNDc4OyYjMTI1MjM7JiMxMjQ5NjsmIzEyNDM0OyYjMjM0NTU7JiMzNTAxMzs8L3RleHQ+PC9nPjwhLS1saW5rIGNsaWVudCB0byBzZXJ2ZXItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iY2xpZW50IiBkYXRhLWVudGl0eS0yPSJzZXJ2ZXIiIGRhdGEtc291cmNlLWxpbmU9IjM1IiBkYXRhLXVpZD0ibG5rMTEiIGlkPSJsaW5rX2NsaWVudF9zZXJ2ZXIiPjxwYXRoIGNvZGVMaW5lPSIzNSIgZD0iTTE5NS43NzUyLDE5Ny4yMTI2IEMxOTEuMTg1MiwyMDcuNjUyNiAxODksMjEzLjEgMTg1LDIyMy40OSBDMTc0LjYzLDI1MC40MiAxNjYuMzczNSwyNzUuMjIxMiAxNTguNTAzNSwzMDAuNTAxMiIgZmlsbD0ibm9uZSIgaWQ9ImNsaWVudC1zZXJ2ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5OC4xOSwxOTEuNzIsMTkwLjkwNiwxOTguMzQ5LDE5Ni4xNzc2LDE5Ni4yOTcyLDE5OC4yMjk1LDIwMS41Njg4LDE5OC4xOSwxOTEuNzIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE1Ni43MiwzMDYuMjMsMTYzLjIxNDQsMjk4LjgyNTgsMTU4LjIwNjIsMzAxLjQ1NiwxNTUuNTc2LDI5Ni40NDc4LDE1Ni43MiwzMDYuMjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuOTU3IiB4PSIxODYiIHk9IjIzNi41NTY5Ij5IVFRQL1dlYlNvY2tldDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0Mi4xODY1IiB4PSIyMjAuMzg1MyIgeT0iMjUxLjY4OTciPihKU09OKTwvdGV4dD48L2c+PCEtLVNSQz1bYlBCVlF6REc1Q1ZWeHJ6blpJX2pHLXN4WTUxQWRQRnp3OWcyQm1EOWF6aXNEQ2REUlg5WFozcWFTVExQcjI1cDhpQWdKanRpTTJWdXU5b1otc0VFTVJoX21ka1JoMnMyV2pvTlV5eHR0a192U0N3dmZmNndSWDVTQUhNaFhPTVBrSDlNM1NMbjQ3OVFrY0toSjM1bkpMNVIzS096SW9qSVdwOXlfS3Y5NzhIaUJZV0RXZ0tQZmpaRGZKYlNPNmZKVHVkZ1VlcFdKQnBUWlJWdHVseHhVQWlEbU5TOFZhM09YbDFUTGk5aEt2LUJYYXVpNXlrd0hlR20wSGRSOVktTWhLcDFmZVAxeW5MWUFBanZad3FPdDRmbkVGNzhPR3RieTk5N3MyaEUzN2o3dTl6N0J0T1dVOWhid05kRkxMb1RNWlhweVZPNF82VjNtSGROWEk5eERLVGJrZnNlNEZPVy0wM1g4R0pkNDdtS2k2WVRkbWNqSkRYM21sdjVjeHBXakJCRFRBazF3eG5iZ1BSV0VlYzVtOXJyWUxhWDNaTHVXZVRiWnBUR1NTV1lxbVlSb2l5cFVucHpXVERLNkQ3LUhnOHNZUWJtYVhpRGFMYW43NXBOM1VBYTYyRHJYOTVTbnd6dVhhX0hkOHhqYkVtMTVNWkpZaWRpSVJZVXVBSzNvVUxrTnJNdllJS25fLTA4bVpDOFR5NF9aQmdkdTd5Ml9uN3VkdlNqMjh1WEUxWXJfLU41VllTLXRmSEdzZ1ZfU0g3XzFzOXl1SE90WWxoVHVUdzZUOExwUS1JS2M3QWRrekxnRU4tVnI2SWdqZVpPaGRsb3VhOU1HaVlZQmk0cndoaEtuQklVcmFSSlhJX3RzcjdkclVMRTl0dnBZV0h3LTRMaVl6WVNSbjAtIC1OTm9DX2h3N0ZtLVg4XzVYcTFpT1pIdVpRQlRKakpWWjNPRW1FX1hHZGFNNEtsM2VqbmxdLS0+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>REST API / gRPC との比較：</strong></p>
<table>
<thead>
<tr>
<th>特徴</th>
<th>REST API</th>
<th>gRPC</th>
<th>GraphQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>プロトコル</td>
<td>HTTP/1.1</td>
<td>HTTP/2</td>
<td>HTTP/1.1 or HTTP/2</td>
</tr>
<tr>
<td>データ形式</td>
<td>JSON</td>
<td>Protocol Buffers</td>
<td>JSON</td>
</tr>
<tr>
<td>スキーマ</td>
<td>OpenAPI (任意)</td>
<td>.proto (必須)</td>
<td>.graphqls (必須)</td>
</tr>
<tr>
<td>データ取得</td>
<td>固定レスポンス</td>
<td>固定レスポンス</td>
<td>クライアント指定</td>
</tr>
<tr>
<td>エンドポイント</td>
<td>複数</td>
<td>複数</td>
<td>単一</td>
</tr>
<tr>
<td>リアルタイム</td>
<td>WebSocket 別実装</td>
<td>ストリーミング</td>
<td>Subscription</td>
</tr>
<tr>
<td>主な用途</td>
<td>汎用 API</td>
<td>マイクロサービス</td>
<td>フロントエンド向け</td>
</tr>
</tbody>
</table>
<h3 id="462-3">46.2 3つの操作タイプ<a class="headerlink" href="#462-3" title="Permanent link">&para;</a></h3>
<p>GraphQL は 3 つの操作タイプをサポートします：</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjIxNXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTUwNnB4O2hlaWdodDoyMTVweDtiYWNrZ3JvdW5kOiNGRUZFRkU7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNTA2IDIxNSIgd2lkdGg9IjE1MDZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iMjE1IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTUwNiIgeD0iMCIgeT0iMCIvPjwhLS1jbHVzdGVyIHF1ZXJ5LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJxdWVyeSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgZGF0YS11aWQ9ImVudDAwMDIiIGlkPSJjbHVzdGVyX3F1ZXJ5Ij48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIwMi4wOSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjM2NSIgeD0iNyIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2Ny4zMjcxIiB4PSIxNTUuODM2NCIgeT0iMjEuOTk1MSI+MS4gUXVlcnk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY4Ljc5NjYiIHg9IjE1NS4xMDE3IiB5PSIzOC4yOTIiPigmIzM1NTAxOyYjMTI0MTU7JiMyMTQ2MjsmIzEyNDI2Oyk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIG11dGF0aW9uLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJtdXRhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iOCIgZGF0YS11aWQ9ImVudDAwMDciIGlkPSJjbHVzdGVyX211dGF0aW9uIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIwMi4wOSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjQyNSIgeD0iMzk2IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjA0NzkiIHg9IjU2Mi45NzYxIiB5PSIyMS45OTUxIj4yLiBNdXRhdGlvbjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjguNzk2NiIgeD0iNTc0LjEwMTciIHk9IjM4LjI5MiI+KCYjMjYzNjA7JiMxMjM2NTsmIzM2Nzk2OyYjMTI0MTU7KTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgc3Vic2NyaXB0aW9uLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtZW50aXR5PSJzdWJzY3JpcHRpb24iIGRhdGEtc291cmNlLWxpbmU9IjEzIiBkYXRhLXVpZD0iZW50MDAxMiIgaWQ9ImNsdXN0ZXJfc3Vic2NyaXB0aW9uIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIwMi4wOSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjY1NSIgeD0iODQ1IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOS40Mzc1IiB4PSIxMTEyLjc4MTMiIHk9IjIxLjk5NTEiPjMuIFN1YnNjcmlwdGlvbjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTYuNzk2NSIgeD0iMTEyNC4xMDE3IiB5PSIzOC4yOTIiPigmIzEyNTIyOyYjMTI0NTA7JiMxMjUyMzsmIzEyNDc5OyYjMTI0NTI7JiMxMjUxMjspPC90ZXh0PjwvZz48IS0tZW50aXR5IENsaWVudC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJDbGllbnQiIGRhdGEtc291cmNlLWxpbmU9IjQiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iZW50aXR5X0NsaWVudCI+PGVsbGlwc2UgY3g9IjE1OS45OTkyIiBjeT0iNzIuNTIzNiIgZmlsbD0iI0YxRjFGMSIgcng9IjMxLjY1OTIiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MC41MzAzIiB4PSIxMzkuNzM0MSIgeT0iNzcuMTcyMSI+Q2xpZW50PC90ZXh0PjwvZz48IS0tZW50aXR5IFNlcnZlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJTZXJ2ZXIiIGRhdGEtc291cmNlLWxpbmU9IjQiIGRhdGEtdWlkPSJlbnQwMDA0IiBpZD0iZW50aXR5X1NlcnZlciI+PGVsbGlwc2UgY3g9IjE2MC4wMDM0IiBjeT0iMTc4LjU3MzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSIzNS40NjM0IiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDUuOTEwMiIgeD0iMTM3LjA0ODMiIHk9IjE4My4yMjIxIj5TZXJ2ZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQ2xpZW50Mi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJDbGllbnQyIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAwOCIgaWQ9ImVudGl0eV9DbGllbnQyIj48ZWxsaXBzZSBjeD0iNTU5Ljk5NzYiIGN5PSI3Mi41MjM2IiBmaWxsPSIjRjFGMUYxIiByeD0iMzcuOTU3NiIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5LjQzNzUiIHg9IjUzNS4yNzg4IiB5PSI3Ny4xNzIxIj5DbGllbnQyPC90ZXh0PjwvZz48IS0tZW50aXR5IFNlcnZlcjItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iU2VydmVyMiIgZGF0YS1zb3VyY2UtbGluZT0iOSIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJlbnRpdHlfU2VydmVyMiI+PGVsbGlwc2UgY3g9IjU2Mi4wMDE3IiBjeT0iMTc4LjU3MzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSI0MS43NjE3IiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuODE3NCIgeD0iNTM0LjU5MzEiIHk9IjE4My4yMjIxIj5TZXJ2ZXIyPC90ZXh0PjwvZz48IS0tZW50aXR5IENsaWVudDMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQ2xpZW50MyIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJlbnQwMDEzIiBpZD0iZW50aXR5X0NsaWVudDMiPjxlbGxpcHNlIGN4PSIxMTM1Ljk5NzYiIGN5PSI3Mi41MjM2IiBmaWxsPSIjRjFGMUYxIiByeD0iMzcuOTU3NiIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5LjQzNzUiIHg9IjExMTEuMjc4OCIgeT0iNzcuMTcyMSI+Q2xpZW50MzwvdGV4dD48L2c+PCEtLWVudGl0eSBTZXJ2ZXIzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IlNlcnZlcjMiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBkYXRhLXVpZD0iZW50MDAxNCIgaWQ9ImVudGl0eV9TZXJ2ZXIzIj48ZWxsaXBzZSBjeD0iMTEzNi4wMDE3IiBjeT0iMTc4LjU3MzYiIGZpbGw9IiNGMUYxRjEiIHJ4PSI0MS43NjE3IiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuODE3NCIgeD0iMTEwOC41OTMxIiB5PSIxODMuMjIyMSI+U2VydmVyMzwvdGV4dD48L2c+PCEtLWxpbmsgQ2xpZW50IHRvIFNlcnZlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJDbGllbnQiIGRhdGEtZW50aXR5LTI9IlNlcnZlciIgZGF0YS1zb3VyY2UtbGluZT0iNCIgZGF0YS11aWQ9ImxuazUiIGlkPSJsaW5rX0NsaWVudF9TZXJ2ZXIiPjxwYXRoIGQ9Ik0xMjkuMzYsNzcuMDcgQzEwNC42Niw4MS43MiA3MS40NCw5Mi40MyA1NSwxMTcuMDQgQzM0Ljc4LDE0Ny4zMSA4My45NjQ4LDE2My4wOTI0IDEyMS43OTQ4LDE3MC45MzI0IiBmaWxsPSJub25lIiBpZD0iQ2xpZW50LXRvLVNlcnZlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI3LjY3LDE3Mi4xNSwxMTkuNjY5LDE2Ni40MDY5LDEyMi43NzQsMTcxLjEzNTMsMTE4LjA0NTUsMTc0LjI0MDQsMTI3LjY3LDE3Mi4xNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2Mi4yMzk3IiB4PSI1NiIgeT0iMTMwLjEwNjkiPnsgaXRlbXMgeyBjb2RlIG5hbWUgfSB9PC90ZXh0PjwvZz48IS0tbGluayBTZXJ2ZXIgdG8gQ2xpZW50LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IlNlcnZlciIgZGF0YS1lbnRpdHktMj0iQ2xpZW50IiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0ibG5rNiIgaWQ9ImxpbmtfU2VydmVyX0NsaWVudCI+PHBhdGggZD0iTTE4NC4yOSwxNjcuNzYgQzE5OC4zNSwxNjAuNjcgMjE0Ljg1LDE0OS41OCAyMjMsMTM0LjA0IEMyMzQuNTUsMTEyLjAyIDIxMC44Nzg1LDk1LjkyNTYgMTg4LjQ2ODUsODUuMzc1NiIgZmlsbD0ibm9uZSIgaWQ9IlNlcnZlci10by1DbGllbnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE4My4wNCw4Mi44MiwxODkuNDc5MSw5MC4yNzI0LDE4Ny41NjM4LDg0Ljk0OTcsMTkyLjg4NjUsODMuMDM0NCwxODMuMDQsODIuODIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Mi4wMDI5IiB4PSIyMjYuNjIiIHk9IjEzMC4xMDY5Ij57IGl0ZW1zOiBbLi4uXSB9PC90ZXh0PjwvZz48IS0tbGluayBDbGllbnQyIHRvIFNlcnZlcjItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQ2xpZW50MiIgZGF0YS1lbnRpdHktMj0iU2VydmVyMiIgZGF0YS1zb3VyY2UtbGluZT0iOSIgZGF0YS11aWQ9ImxuazEwIiBpZD0ibGlua19DbGllbnQyX1NlcnZlcjIiPjxwYXRoIGQ9Ik01MjQuNiw3OC4yNSBDNDgyLjc2LDg1LjQgNDIxLjQ2LDEwMS43MSA0NDQsMTM0LjA0IEM0NjEuNDIsMTU5LjAzIDQ4OC45NzM5LDE2OC43MSA1MTUuODMzOSwxNzMuMjUiIGZpbGw9Im5vbmUiIGlkPSJDbGllbnQyLXRvLVNlcnZlcjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUyMS43NSwxNzQuMjUsNTEzLjU0MjUsMTY4LjgwNiw1MTYuODE5OSwxNzMuNDE2Nyw1MTIuMjA5MiwxNzYuNjk0MSw1MjEuNzUsMTc0LjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgxLjQ5MjIiIHg9IjQ0NSIgeT0iMTMwLjEwNjkiPm11dGF0aW9uIHsgY3JlYXRlSXRlbSguLi4pIH08L3RleHQ+PC9nPjwhLS1saW5rIFNlcnZlcjIgdG8gQ2xpZW50Mi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJTZXJ2ZXIyIiBkYXRhLWVudGl0eS0yPSJDbGllbnQyIiBkYXRhLXNvdXJjZS1saW5lPSIxMCIgZGF0YS11aWQ9ImxuazExIiBpZD0ibGlua19TZXJ2ZXIyX0NsaWVudDIiPjxwYXRoIGQ9Ik01OTAsMTY3LjQxIEM2MTQuMTMsMTU2LjkyIDY0My4zLDEzOS4wMSA2MzEsMTE3LjA0IEM2MjEuNzUsMTAwLjUyIDYwOC44NzY3LDkxLjg5MjUgNTkzLjEzNjcsODUuMDgyNSIgZmlsbD0ibm9uZSIgaWQ9IlNlcnZlcjItdG8tQ2xpZW50MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTg3LjYzLDgyLjcsNTk0LjMwMTcsODkuOTQ0OSw1OTIuMjE4OSw4NC42ODU0LDU5Ny40Nzg0LDgyLjYwMjYsNTg3LjYzLDgyLjciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMuNDAyMyIgeD0iNjM0LjkxIiB5PSIxMzAuMTA2OSI+eyBjcmVhdGVJdGVtOiB7Li4ufSB9PC90ZXh0PjwvZz48IS0tbGluayBDbGllbnQzIHRvIFNlcnZlcjMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQ2xpZW50MyIgZGF0YS1lbnRpdHktMj0iU2VydmVyMyIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJsbmsxNSIgaWQ9ImxpbmtfQ2xpZW50M19TZXJ2ZXIzIj48cGF0aCBkPSJNMTA5OC4xNiw3NC42IEMxMDM2LjUyLDc3LjI1IDkxOC43Miw4Ni4zMSA4OTMsMTE3LjA0IEM4ODguMTUsMTIyLjg0IDg4OC4xNSwxMjguMjUgODkzLDEzNC4wNCBDOTE4LjIsMTY0LjE2IDEwMjUuODQ2MywxNzMuMTg1OSAxMDg4LjM5NjMsMTc2LjA0NTkiIGZpbGw9Im5vbmUiIGlkPSJDbGllbnQzLXRvLVNlcnZlcjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEwOTQuMzksMTc2LjMyLDEwODUuNTgyMSwxNzEuOTEzMSwxMDg5LjM5NTIsMTc2LjA5MTYsMTA4NS4yMTY3LDE3OS45MDQ3LDEwOTQuMzksMTc2LjMyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk4LjQ1OTUiIHg9Ijg5NCIgeT0iMTMwLjEwNjkiPnN1YnNjcmlwdGlvbiB7IG9yZGVyVXBkYXRlZCB9PC90ZXh0PjwvZz48IS0tbGluayBTZXJ2ZXIzIHRvIENsaWVudDMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iU2VydmVyMyIgZGF0YS1lbnRpdHktMj0iQ2xpZW50MyIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJsbmsxNiIgaWQ9ImxpbmtfU2VydmVyM19DbGllbnQzIj48cGF0aCBkPSJNMTEzNC44MSwxNjMuODYgQzExMzQuMTMsMTU1LjI5IDExMzMuMzQsMTQ0LjAzIDExMzMsMTM0LjA0IEMxMTMyLjQ1LDExOC4wNiAxMTMzLjEwNzcsMTA1LjY5ODkgMTEzNC4xMzc3LDkzLjQzODkiIGZpbGw9Im5vbmUiIGlkPSJTZXJ2ZXIzLXRvLUNsaWVudDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjExMzQuNjQsODcuNDYsMTEyOS45MDA2LDk2LjA5MzUsMTEzNC4yMjE0LDkyLjQ0MjQsMTEzNy44NzI1LDk2Ljc2MzMsMTEzNC42NCw4Ny40NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi40ODM0IiB4PSIxMTM0IiB5PSIxMzAuMTA2OSI+eyBvcmRlclVwZGF0ZWQ6IHsuLi59IH08L3RleHQ+PC9nPjwhLS1saW5rIFNlcnZlcjMgdG8gQ2xpZW50My0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJTZXJ2ZXIzIiBkYXRhLWVudGl0eS0yPSJDbGllbnQzIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImxuazE3IiBpZD0ibGlua19TZXJ2ZXIzX0NsaWVudDMiPjxwYXRoIGQ9Ik0xMTc3LjE4LDE3NS42OSBDMTIzMy4wMiwxNzEuNTcgMTMyMi40MSwxNTguNDggMTI5MSwxMTcuMDQgQzEyNzYuNTcsOTggMTIxOC4xODUzLDg1LjkyMzggMTE3Ny4wNjUzLDc5LjM3MzgiIGZpbGw9Im5vbmUiIGlkPSJTZXJ2ZXIzLXRvLUNsaWVudDMtMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTE3MS4xNCw3OC40MywxMTc5LjM5ODcsODMuNzk2LDExNzYuMDc3Nyw3OS4yMTY1LDExODAuNjU3Miw3NS44OTU2LDExNzEuMTQsNzguNDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTIuNDgzNCIgeD0iMTI5OC41MSIgeT0iMTMwLjEwNjkiPnsgb3JkZXJVcGRhdGVkOiB7Li4ufSB9PC90ZXh0PjwvZz48IS0tU1JDPVtkU3VuSXlEMDYwUldGUl9ZOG94OXEwRUpCT0RCS04xbWFFQWEzalZhZXVHc1RfNW80SUhhUUI4OXVrUlk4azlLU05TRy1zRUVJZC02YnBJUTc2eG9aVF94eVp4UEY2T2Y1SkkxQUd0ZEN5NXA1ZXR2V1dsT0VwZmlwaDg0WGZBb3NHQjF0WVRtY2dFdWtNM0VUbE1jYmtsRF9PRWdSYnFSUTBQTnBHU0FvbmFsT2NKSVhUN2UwOW05WWNpS0JXSFc1bjFCSjM4ZThFR0gwZ0M5R1djYlJWczZzaVBGbE15NFM0dThrTW9ZZlU3bjI5cGFhaWdPQ3F0d1Vkbk5veGxqdnVVNnhLWDl6LW5MZGk3b3NmSy0xUTUwQWw1T1pwZndxSHRXRjRGZFRSbS03cTJYNi1MVmVxeldhYS1wS0NIZnZySnJJYk5GZ2R2THJMZkxCd2Ytc2NjcEdRbU4tdVJPUnVWRDk3MEhlSlhCOHFzOTFjSlY4RmlUVUhXVWVGX0pBUnkxXS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<p><strong>用途：</strong></p>
<ol>
<li><strong>Query</strong>: データ取得（品目一覧、BOM 展開）</li>
<li><strong>Mutation</strong>: データ更新（品目登録、発注確定）</li>
<li><strong>Subscription</strong>: リアルタイム通知（MRP 進捗、在庫変動）</li>
</ol>
<h3 id="463-graphql">46.3 GraphQL におけるヘキサゴナルアーキテクチャ<a class="headerlink" href="#463-graphql" title="Permanent link">&para;</a></h3>
<p>GraphQL を導入しても、第32章で構築したヘキサゴナルアーキテクチャ（ドメイン層・アプリケーション層）はそのまま共有し、<strong>Input Adapter として GraphQL リゾルバ層のみを追加</strong>します。</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjY2OHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzgwcHg7aGVpZ2h0OjY2OHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc4MCA2NjgiIHdpZHRoPSI3ODBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1jbHVzdGVyIEhleGFnb25hbCBBcmNoaXRlY3R1cmUgKEdyYXBoUUw/KS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLWVudGl0eT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuR3JhcGhRTC4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImNsdXN0ZXJfSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuR3JhcGhRTC4uIj48cGF0aCBkPSJNMjMwLjE0LDYgTDUxOC4yMjg4LDYgQTMuNzUsMy43NSAwIDAgMSA1MjAuNzI4OCw4LjUgTDUyNy43Mjg4LDI4LjI5NjkgTDUyOC4xNCwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDUzMC42NCwzMC43OTY5IEw1MzAuNjQsNjU4LjczIEEyLjUsMi41IDAgMCAxIDUyOC4xNCw2NjEuMjMgTDIzMC4xNCw2NjEuMjMgQTIuNSwyLjUgMCAwIDEgMjI3LjY0LDY1OC43MyBMMjI3LjY0LDguNSBBMi41LDIuNSAwIDAgMSAyMzAuMTQsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjI3LjY0IiB4Mj0iNTI3LjcyODgiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyODcuMDg4OCIgeD0iMjMxLjY0IiB5PSIyMC45OTUxIj5IZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIChHcmFwaFFMJiMyOTI1NjspPC90ZXh0PjwvZz48IS0tY2xhc3MgY29yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJjb3JlIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMyIgaWQ9ImVudGl0eV9jb3JlIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE3Mi42NzE5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxOTAuMDQiIHg9IjI5OS42MiIgeT0iMjczLjA3Ii8+PGVsbGlwc2UgY3g9IjMxNC42MiIgY3k9IjI5NC4zNjY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMTcuNTg4OCwzMDAuMDA3NSBRMzE3LjAxMDYsMzAwLjMwNDQgMzE2LjM3LDMwMC40NDUgUTMxNS43Mjk0LDMwMC42MDEzIDMxNS4wMjYzLDMwMC42MDEzIFEzMTIuNTI2MywzMDAuNjAxMyAzMTEuMTk4MSwyOTguOTYwNiBRMzA5Ljg4NTYsMjk3LjMwNDQgMzA5Ljg4NTYsMjk0LjE3OTQgUTMwOS44ODU2LDI5MS4wNTQ0IDMxMS4xOTgxLDI4OS4zOTgxIFEzMTIuNTI2MywyODcuNzQxOSAzMTUuMDI2MywyODcuNzQxOSBRMzE1LjcyOTQsMjg3Ljc0MTkgMzE2LjM3LDI4Ny44OTgxIFEzMTcuMDI2MywyODguMDU0NCAzMTcuNTg4OCwyODguMzUxMyBMMzE3LjU4ODgsMjkxLjA3IFEzMTYuOTYzOCwyOTAuNDkxOSAzMTYuMzcsMjkwLjIyNjMgUTMxNS43NzYzLDI4OS45NDUgMzE1LjE1MTMsMjg5Ljk0NSBRMzEzLjgwNzUsMjg5Ljk0NSAzMTMuMTIsMjkxLjAyMzEgUTMxMi40MzI1LDI5Mi4wODU2IDMxMi40MzI1LDI5NC4xNzk0IFEzMTIuNDMyNSwyOTYuMjczMSAzMTMuMTIsMjk3LjM1MTMgUTMxMy44MDc1LDI5OC40MTM4IDMxNS4xNTEzLDI5OC40MTM4IFEzMTUuNzc2MywyOTguNDEzOCAzMTYuMzcsMjk4LjE0ODEgUTMxNi45NjM4LDI5Ny44NjY5IDMxNy41ODg4LDI5Ny4yODg4IEwzMTcuNTg4OCwzMDAuMDA3NSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNS4zODM4IiB4PSIzNDkuOTQ4MSIgeT0iMjkxLjA2NTEiPkFwcGxpY2F0aW9uIENvcmU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU4LjA0IiB4PSIzMjguNjIiIHk9IjMwNy4zNjIiPihEb21haW4gKyBVc2UgQ2FzZXMpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMwMC42MiIgeDI9IjQ4OC42NiIgeTE9IjMxNS42NjM4IiB5Mj0iMzE1LjY2MzgiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIzMDcuNjIiIHk9IjMyNi4zMTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTIuMjg1MiIgeD0iMzE5LjYyIiB5PSIzMzIuNjU4OSI+SXRlbVVzZUNhc2U8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMzA3LjYyIiB5PSIzNDIuNjA5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC40NDczIiB4PSIzMTkuNjIiIHk9IjM0OC45NTU3Ij5PcmRlclVzZUNhc2U8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMzA3LjYyIiB5PSIzNTguOTA1OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNy4yODUyIiB4PSIzMTkuNjIiIHk9IjM2NS4yNTI2Ij5JbnZlbnRvcnlVc2VDYXNlPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMwMC42MiIgeDI9IjQ4OC42NiIgeTE9IjM3Mi41NTQ0IiB5Mj0iMzcyLjU1NDQiLz48cmVjdCBmaWxsPSIjRjI0RDVDIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIzMDcuNjIiIHk9IjM4My4yMDI4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzUuMjQzIiB4PSIzMTkuNjIiIHk9IjM4OS41NDk1Ij5JdGVtICgmIzIxNjk3OyYjMzA0NDY7KTwvdGV4dD48cmVjdCBmaWxsPSIjRjI0RDVDIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIzMDcuNjIiIHk9IjM5OS40OTk3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjE4MTMiIHg9IjMxOS42MiIgeT0iNDA1Ljg0NjQiPkJvbSAoJiMzNzA5NjsmIzIxNjk3OyYjMjcwODM7JiMyNTEwNDsmIzM0OTIwOyk8L3RleHQ+PHJlY3QgZmlsbD0iI0YyNEQ1QyIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMzA3LjYyIiB5PSI0MTUuNzk2NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3LjQwNTEiIHg9IjMxOS42MiIgeT0iNDIyLjE0MzIiPk9yZGVyICgmIzEyNDU4OyYjMTI1NDA7JiMxMjQ4MDspPC90ZXh0PjxyZWN0IGZpbGw9IiNGMjRENUMiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjMwNy42MiIgeT0iNDMyLjA5MzQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Mi4xMiIgeD0iMzE5LjYyIiB5PSI0MzguNDQwMSI+U3RvY2sgKCYjMjIzMTI7JiMyNDIzNTspPC90ZXh0PjwvZz48IS0tY2xhc3MgaW5wdXQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iaW5wdXQiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9pbnB1dCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxNDAuMDc4MSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjM2Ljk1NjciIHg9IjI3Ni4xNiIgeT0iNDEiLz48ZWxsaXBzZSBjeD0iMzM4LjQ5NjciIGN5PSI2Mi4yOTY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zNDEuNDY1NSw2Ny45Mzc1IFEzNDAuODg3NCw2OC4yMzQ0IDM0MC4yNDY3LDY4LjM3NSBRMzM5LjYwNjEsNjguNTMxMyAzMzguOTAzLDY4LjUzMTMgUTMzNi40MDMsNjguNTMxMyAzMzUuMDc0OSw2Ni44OTA2IFEzMzMuNzYyNCw2NS4yMzQ0IDMzMy43NjI0LDYyLjEwOTQgUTMzMy43NjI0LDU4Ljk4NDQgMzM1LjA3NDksNTcuMzI4MSBRMzM2LjQwMyw1NS42NzE5IDMzOC45MDMsNTUuNjcxOSBRMzM5LjYwNjEsNTUuNjcxOSAzNDAuMjQ2Nyw1NS44MjgxIFEzNDAuOTAzLDU1Ljk4NDQgMzQxLjQ2NTUsNTYuMjgxMyBMMzQxLjQ2NTUsNTkgUTM0MC44NDA1LDU4LjQyMTkgMzQwLjI0NjcsNTguMTU2MyBRMzM5LjY1Myw1Ny44NzUgMzM5LjAyOCw1Ny44NzUgUTMzNy42ODQyLDU3Ljg3NSAzMzYuOTk2Nyw1OC45NTMxIFEzMzYuMzA5Miw2MC4wMTU2IDMzNi4zMDkyLDYyLjEwOTQgUTMzNi4zMDkyLDY0LjIwMzEgMzM2Ljk5NjcsNjUuMjgxMyBRMzM3LjY4NDIsNjYuMzQzOCAzMzkuMDI4LDY2LjM0MzggUTMzOS42NTMsNjYuMzQzOCAzNDAuMjQ2Nyw2Ni4wNzgxIFEzNDAuODQwNSw2NS43OTY5IDM0MS40NjU1LDY1LjIxODggTDM0MS40NjU1LDY3LjkzNzUgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDMuNzgzMiIgeD0iMzU4Ljk5NjciIHk9IjU4Ljk5NTEiPklucHV0IEFkYXB0ZXJzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAxMDciIHg9IjM2Mi44ODMiIHk9Ijc1LjI5MiI+KERyaXZpbmcgU2lkZSk8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjc3LjE2IiB4Mj0iNTEyLjExNjciIHkxPSI4My41OTM4IiB5Mj0iODMuNTkzOCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI4NC4xNiIgeT0iOTQuMjQyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NS42MzQ1IiB4PSIyOTYuMTYiIHk9IjEwMC41ODg5Ij5SRVNUIENvbnRyb2xsZXImIzY1Mjg4OyYjMjYwODI7JiMyMzM4NDsmIzY1Mjg5OzwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyODQuMTYiIHk9IjExMC41MzkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ5LjAyMzIiIHg9IjI5Ni4xNiIgeT0iMTE2Ljg4NTciPmdSUEMgU2VydmljZSYjNjUyODg7JiMyNjA4MjsmIzIzMzg0OyYjNjUyODk7PC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjI4NC4xNiIgeT0iMTI2LjgzNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMTAuOTU2NyIgeD0iMjk2LjE2IiB5PSIxMzMuMTgyNiI+R3JhcGhRTCBSZXNvbHZlciYjNjUyODg7JiMyNjAzMjsmIzM1MjE1OyYjMzY4NjE7JiMyMTE1MjsmIzY1Mjg5OzwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyODQuMTYiIHk9IjE0My4xMzI4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuNTIyNSIgeD0iMjk2LjE2IiB5PSIxNDkuNDc5NSI+RGF0YUZldGNoZXI8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjg0LjE2IiB5PSIxNTkuNDI5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjYyNzkiIHg9IjI5Ni4xNiIgeT0iMTY1Ljc3NjQiPkRhdGFMb2FkZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjc3LjE2IiB4Mj0iNTEyLjExNjciIHkxPSIxNzMuMDc4MSIgeTI9IjE3My4wNzgxIi8+PC9nPjwhLS1jbGFzcyBvdXRwdXQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0ib3V0cHV0IiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgZGF0YS11aWQ9ImVudDAwMDUiIGlkPSJlbnRpdHlfb3V0cHV0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwNy40ODQ0IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjAuNzQzMiIgeD0iMzE2LjI3IiB5PSI1MzcuNzUiLz48ZWxsaXBzZSBjeD0iMzM2LjkzMSIgY3k9IjU1OS4wNDY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zMzkuODk5OCw1NjQuNjg3NSBRMzM5LjMyMTcsNTY0Ljk4NDQgMzM4LjY4MSw1NjUuMTI1IFEzMzguMDQwNCw1NjUuMjgxMyAzMzcuMzM3Myw1NjUuMjgxMyBRMzM0LjgzNzMsNTY1LjI4MTMgMzMzLjUwOTIsNTYzLjY0MDYgUTMzMi4xOTY3LDU2MS45ODQ0IDMzMi4xOTY3LDU1OC44NTk0IFEzMzIuMTk2Nyw1NTUuNzM0NCAzMzMuNTA5Miw1NTQuMDc4MSBRMzM0LjgzNzMsNTUyLjQyMTkgMzM3LjMzNzMsNTUyLjQyMTkgUTMzOC4wNDA0LDU1Mi40MjE5IDMzOC42ODEsNTUyLjU3ODEgUTMzOS4zMzczLDU1Mi43MzQ0IDMzOS44OTk4LDU1My4wMzEzIEwzMzkuODk5OCw1NTUuNzUgUTMzOS4yNzQ4LDU1NS4xNzE5IDMzOC42ODEsNTU0LjkwNjMgUTMzOC4wODczLDU1NC42MjUgMzM3LjQ2MjMsNTU0LjYyNSBRMzM2LjExODUsNTU0LjYyNSAzMzUuNDMxLDU1NS43MDMxIFEzMzQuNzQzNSw1NTYuNzY1NiAzMzQuNzQzNSw1NTguODU5NCBRMzM0Ljc0MzUsNTYwLjk1MzEgMzM1LjQzMSw1NjIuMDMxMyBRMzM2LjExODUsNTYzLjA5MzggMzM3LjQ2MjMsNTYzLjA5MzggUTMzOC4wODczLDU2My4wOTM4IDMzOC42ODEsNTYyLjgyODEgUTMzOS4yNzQ4LDU2Mi41NDY5IDMzOS44OTk4LDU2MS45Njg4IEwzMzkuODk5OCw1NjQuNjg3NSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNi4xNjMxIiB4PSIzNTIuMTg5IiB5PSI1NTUuNzQ1MSI+T3V0cHV0IEFkYXB0ZXJzPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjg0NzciIHg9IjM2NC4zNDY4IiB5PSI1NzIuMDQyIj4oRHJpdmVuIFNpZGUpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMxNy4yNyIgeDI9IjQ3Ni4wMTMyIiB5MT0iNTgwLjM0MzgiIHkyPSI1ODAuMzQzOCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjMyNC4yNyIgeT0iNTkwLjk5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzQuNzQzMiIgeD0iMzM2LjI3IiB5PSI1OTcuMzM4OSI+TXlCYXRpcyBSZXBvc2l0b3J5PC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjMyNC4yNyIgeT0iNjA3LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuNDIzOCIgeD0iMzM2LjI3IiB5PSI2MTMuNjM1NyI+RGF0YWJhc2UgQWNjZXNzPC90ZXh0PjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjMyNC4yNyIgeT0iNjIzLjU4NTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDUuNDAzMyIgeD0iMzM2LjI3IiB5PSI2MjkuOTMyNiI+RW50aXR5IE1hcHBpbmc8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzE3LjI3IiB4Mj0iNDc2LjAxMzIiIHkxPSI2MzcuMjM0NCIgeTI9IjYzNy4yMzQ0Ii8+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJHTU44IiBkYXRhLXNvdXJjZS1saW5lPSIzNCIgZGF0YS11aWQ9ImVudDAwMDkiIGlkPSJlbnRpdHlfR01OOCI+PHBhdGggZD0iTTU0Ny45LDgzLjM0IEw1NDcuOSwxMzguNzM4NCBBMCwwIDAgMCAwIDU0Ny45LDEzOC43Mzg0IEw2MjcuNDIsMTM4LjczODQgTDQ4Ny4xMiwyNzIuNzYgTDYzNS40MiwxMzguNzM4NCBMNzczLjM4MzYsMTM4LjczODQgQTAsMCAwIDAgMCA3NzMuMzgzNiwxMzguNzM4NCBMNzczLjM4MzYsOTMuMzQgTDc2My4zODM2LDgzLjM0IEw1NDcuOSw4My4zNCBBMCwwIDAgMCAwIDU0Ny45LDgzLjM0IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNzYzLjM4MzYsODMuMzQgTDc2My4zODM2LDkzLjM0IEw3NzMuMzgzNiw5My4zNCBMNzYzLjM4MzYsODMuMzQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0My4wMDAyIiB4PSI1NTMuOSIgeT0iMTAwLjQwNjkiPiYjMjYwODI7JiMyMzM4NDsmIzEyMzk4OyYjMTI0OTk7JiMxMjQ3MjsmIzEyNDkzOyYjMTI0NzM7JiMxMjUyNTsmIzEyNDcyOyYjMTI0ODM7JiMxMjQ2Mzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjAwLjExNjMiIHg9IjU1My45IiB5PSIxMTUuNTM5NyI+UkVTVCBBUEkgLyBnUlBDICYjMjkyNTY7JiMxMjM5MjsmIzIzNDM2OyYjMjA4NDA7JiMxMjM5NTsmIzIwODQ5OyYjMjYzNzc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwNC40ODM2IiB4PSI1NTMuOSIgeT0iMTMwLjY3MjUiPkdyYXBoUUwgJiMyMjI2NjsmIzI2Mzc3OyYjMTIzOTg7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7JiMxMjM5OTsmIzIxNTQ3OyYjMTI0MTQ7JiMxMjM5NDsmIzEyMzU2OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkdNTjExIiBkYXRhLXNvdXJjZS1saW5lPSI0MCIgZGF0YS11aWQ9ImVudDAwMTIiIGlkPSJlbnRpdHlfR01OMTEiPjxwYXRoIGQ9Ik02LDgzLjM0IEw2LDEzOC43Mzg0IEEwLDAgMCAwIDAgNiwxMzguNzM4NCBMMjExLjI4NTMsMTM4LjczODQgQTAsMCAwIDAgMCAyMTEuMjg1MywxMzguNzM4NCBMMjExLjI4NTMsMTE1LjAzIEwyNzYuMDIsMTExLjAzIEwyMTEuMjg1MywxMDcuMDMgTDIxMS4yODUzLDkzLjM0IEwyMDEuMjg1Myw4My4zNCBMNiw4My4zNCBBMCwwIDAgMCAwIDYsODMuMzQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yMDEuMjg1Myw4My4zNCBMMjAxLjI4NTMsOTMuMzQgTDIxMS4yODUzLDkzLjM0IEwyMDEuMjg1Myw4My4zNCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI2LjQ4MzUiIHg9IjEyIiB5PSIxMDAuNDA2OSI+R3JhcGhRTCAmIzEyNTIyOyYjMTI0Nzg7JiMxMjUyMzsmIzEyNDk2OyYjMTI0MzQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OC43Mjk2IiB4PSIxMiIgeT0iMTE1LjUzOTciPklucHV0IEFkYXB0ZXIgJiMxMjM5MjsmIzEyMzc1OyYjMTIzOTA7JiMzNjg2MTsmIzIxMTUyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODQuMjg1MyIgeD0iMTIiIHk9IjEzMC42NzI1Ij4mIzI2MDgyOyYjMjMzODQ7JiMxMjM5ODsgUkVTVC9nUlBDICYjMTIzOTI7JiMyMDg0OTsmIzIzMzg0OyYjMjE0ODc7JiMzMzAyMTs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJHTU4xNCIgZGF0YS1zb3VyY2UtbGluZT0iNDYiIGRhdGEtdWlkPSJlbnQwMDE1IiBpZD0iZW50aXR5X0dNTjE0Ij48cGF0aCBkPSJNNTQ2LjE2LDU2My43OSBMNTQ2LjE2LDU4Ny40OSBMNDc3LjUsNTkxLjQ5IEw1NDYuMTYsNTk1LjQ5IEw1NDYuMTYsNjE5LjE4ODQgQTAsMCAwIDAgMCA1NDYuMTYsNjE5LjE4ODQgTDY5Ny4xMzQ3LDYxOS4xODg0IEEwLDAgMCAwIDAgNjk3LjEzNDcsNjE5LjE4ODQgTDY5Ny4xMzQ3LDU3My43OSBMNjg3LjEzNDcsNTYzLjc5IEw1NDYuMTYsNTYzLjc5IEEwLDAgMCAwIDAgNTQ2LjE2LDU2My43OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTY4Ny4xMzQ3LDU2My43OSBMNjg3LjEzNDcsNTczLjc5IEw2OTcuMTM0Nyw1NzMuNzkgTDY4Ny4xMzQ3LDU2My43OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI5Ljk3NDciIHg9IjU1Mi4xNiIgeT0iNTgwLjg1NjkiPiYjMjYwODI7JiMyMzM4NDsmIzEyMzk4OyBSZXBvc2l0b3J5ICYjMTI0MzQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjU1Mi4xNiIgeT0iNTk1Ljk4OTciPiYjMTIzODE7JiMxMjM5ODsmIzEyNDE0OyYjMTI0MTQ7JiMyMDM1MTsmIzI5OTkyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSI1NTIuMTYiIHk9IjYxMS4xMjI1Ij4mIzIyNzkzOyYjMjYzNTY7JiMxOTk4MTsmIzM1MjAxOzwvdGV4dD48L2c+PCEtLWxpbmsgaW5wdXQgdG8gY29yZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJpbnB1dCIgZGF0YS1lbnRpdHktMj0iY29yZSIgZGF0YS1zb3VyY2UtbGluZT0iMzAiIGRhdGEtdWlkPSJsbms2IiBpZD0ibGlua19pbnB1dF9jb3JlIj48cGF0aCBjb2RlTGluZT0iMzAiIGQ9Ik0zOTQuNjQsMTgxLjMyIEMzOTQuNjQsMjA5Ljc4IDM5NC42NCwyMzcuMDMgMzk0LjY0LDI2Ni45OSIgZmlsbD0ibm9uZSIgaWQ9ImlucHV0LXRvLWNvcmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM5NC42NCwyNzIuOTksMzk4LjY0LDI2My45OSwzOTQuNjQsMjY3Ljk5LDM5MC42NCwyNjMuOTksMzk0LjY0LDI3Mi45OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwLjgwMTgiIHg9IjM5OC44MTM4IiB5PSIyMjQuMTM2OSI+SW5wdXQgUG9ydHM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzcuMTQ5NCIgeD0iMzk1LjY0IiB5PSIyMzkuMjY5NyI+KFVzZSBDYXNlcyk8L3RleHQ+PC9nPjwhLS1saW5rIGNvcmUgdG8gb3V0cHV0LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImNvcmUiIGRhdGEtZW50aXR5LTI9Im91dHB1dCIgZGF0YS1zb3VyY2UtbGluZT0iMzEiIGRhdGEtdWlkPSJsbms3IiBpZD0ibGlua19jb3JlX291dHB1dCI+PHBhdGggY29kZUxpbmU9IjMxIiBkPSJNMzk1LjM5LDQ0Ni4wOCBDMzk1LjY1LDQ3Ni43NSAzOTUuODk5MSw1MDQuMzkwMiAzOTYuMTI5MSw1MzEuNDkwMiIgZmlsbD0ibm9uZSIgaWQ9ImNvcmUtdG8tb3V0cHV0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzOTYuMTgsNTM3LjQ5LDQwMC4xMDM1LDUyOC40NTY0LDM5Ni4xMzc2LDUzMi40OTAyLDM5Mi4xMDM4LDUyOC41MjQzLDM5Ni4xOCw1MzcuNDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Mi4yOTc0IiB4PSI0MzAuMjExNSIgeT0iNDg4LjgxNjkiPk91dHB1dCBQb3J0czwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDguOTYwNCIgeD0iMzk2Ljg4IiB5PSI1MDMuOTQ5NyI+KFJlcG9zaXRvcnkgSW50ZXJmYWNlcyk8L3RleHQ+PC9nPjwhLS1TUkM9W1JQOTFKbkQxNUNWbC1vY1VkNGZDbXZzM0lJYUxjdTFXWXBTbHVfUXJkUjNDUjZRN0hjOUN0NXI5QTRlV09pRzRKREdPUjZYZTlOZjBxaUE3NlJSSzRyXzFjVHNNMGw0c1ItUXp6Xy16X3ZqeDlJbkpYYjM4UEhTcFpzVGNTczB4bkZDaW9vTnM0Z2FXWjN0MjV3SjI2TjRXOC1tZ2JNWkI1TzZHY1g3NGhKd1BsUW9sWnVfMUl5aVFUSFpCa0F2M1JJOGZQdjNiMGYtbnIzSFY5ZkoxVk5aZzhNSTlYdndrOFh4Ty1iYk5mbzRsU0hiSXFPdl9rVFNRcl80S3ItN1ZpQTVsVVpfVXpqUXQtcnlSdmR2VWI1MTBJV003QWtvZXlCTXZBcWZrQi1kWV9LUHFzWG1WREREMkhjVE9DV2hwaDhQQ1NoNHdsN2ZyMnB4RnQxSzljSDluOUdoRmUwalFld20ySExoMjE5aDZBT1F3YTJpa3dYNlA1RG5uSzVucnJka3h0d0FaSnJVVGtkd2o1MVFvSzRISGVwUlVVSGd1MW1OcWs1REJBWl8teDF6aXpTLXhxU1FOOTZjUUlGOEdmTHI1Q09YY0VUNnB0MjZVTnY3X0dLUHNXdldkQUdQdlJkTEFSeVJKb1l4dGdGNVhxRmt2elc4b2plcndfTWQ4Q0tkYkFpbUhyek4zUXFNamNTb1RKWno4clpPdkQ2azEyc2JhUi1wTVlaREN3YTF3eWZmcGMzcTJxMmxIdTZMWW52S011bjkxU1hUdUVIUW80a0VLdHJCWFpXZkVMQllmV1p5Z0Y4aEZlR2hRTGhvN3A0OFU5WEJKelF6S1ZZRGdsT2xNNmlmbEhjbDdsVnN3REpHenNabExlVWFOXzhmX2FKd3RlLXNjeWktS1Z3WnlEblFvNFhZQzBPbzNQTWJlT1dFa3N3Wm1LMExkQWNvZ1M1aTV4d3JSRm1VcWxsOXRiTi1HUjdHcUhGbmY5YzlDbXhYc2hBLVpoTk9feER3TDVSSElaTktKM3MtczY3YmRiOU5fc0tuWnlDeWtra1VON25mTXpCdFVzX2p6U1JCUEZfMmwtX3UzXS0tPjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<p><strong>GraphQL でもヘキサゴナルアーキテクチャを維持する理由：</strong></p>
<ol>
<li><strong>再利用性</strong>: 既存の UseCase/Repository をそのまま活用</li>
<li><strong>並行運用</strong>: REST API、gRPC、GraphQL を同時提供可能</li>
<li><strong>テスト容易性</strong>: ドメインロジックは通信プロトコルに依存しない</li>
<li><strong>移行容易性</strong>: 段階的に API 形式を追加・変更可能</li>
</ol>
<h3 id="464">46.4 ディレクトリ構成<a class="headerlink" href="#464" title="Permanent link">&para;</a></h3>
<p>既存の構成に <code>infrastructure/graphql/</code> を追加するだけです。</p>
<div class="highlight"><pre><span></span><code>src/main/java/com/example/production/
├── domain/                     # ドメイン層（API版と共通）
│   ├── model/
│   │   ├── item/
│   │   ├── bom/
│   │   ├── order/
│   │   └── inventory/
│   └── exception/
│
├── application/               # アプリケーション層（API版と共通）
│   ├── port/
│   │   ├── in/               # Input Port（ユースケース）
│   │   └── out/              # Output Port（リポジトリ）
│   └── service/
│
├── infrastructure/
│   ├── persistence/          # Output Adapter（DB実装）- 既存
│   │   ├── mapper/
│   │   └── repository/
│   ├── rest/                 # Input Adapter（REST実装）- 既存
│   ├── grpc/                 # Input Adapter（gRPC実装）- 既存
│   └── graphql/              # Input Adapter（GraphQL実装）- 新規追加
│       ├── resolver/         # Query/Mutation リゾルバ
│       ├── dataloader/       # N+1 問題対策
│       ├── scalar/           # カスタムスカラー型
│       └── subscription/     # Subscription ハンドラ
│
├── config/
│
└── src/main/resources/
    └── graphql/              # GraphQL スキーマ定義
        ├── schema.graphqls
        ├── item.graphqls
        ├── bom.graphqls
        ├── purchase_order.graphqls
        └── mrp.graphqls
</code></pre></div>
<h3 id="465">46.5 技術スタックの追加<a class="headerlink" href="#465" title="Permanent link">&para;</a></h3>
<p>既存の <code>build.gradle.kts</code> に GraphQL 関連の依存関係を追加します。</p>
<details>
<summary>build.gradle.kts（差分）</summary>

<div class="highlight"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 既存の依存関係（Spring Boot, MyBatis, PostgreSQL等）はそのまま</span>

<span class="w">    </span><span class="c1">// GraphQL 関連を追加</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-graphql&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-websocket&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Subscription 用</span>

<span class="w">    </span><span class="c1">// GraphQL 拡張</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.graphql-java:graphql-java-extended-scalars:21.0&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.springframework.graphql:spring-graphql-test&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>追加パッケージの説明：</strong></p>
<table>
<thead>
<tr>
<th>パッケージ</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>spring-boot-starter-graphql</td>
<td>Spring Boot GraphQL 統合</td>
</tr>
<tr>
<td>spring-boot-starter-websocket</td>
<td>Subscription (WebSocket)</td>
</tr>
<tr>
<td>graphql-java-extended-scalars</td>
<td>DateTime, BigDecimal 等のスカラー型</td>
</tr>
<tr>
<td>spring-graphql-test</td>
<td>GraphQL テストサポート</td>
</tr>
</tbody>
</table>
<h3 id="426-graphql">42.6 GraphQL スキーマ定義<a class="headerlink" href="#426-graphql" title="Permanent link">&para;</a></h3>
<details>
<summary>src/main/resources/graphql/schema.graphqls</summary>

<div class="highlight"><pre><span></span><code><span class="c"># ルートスキーマ</span>
<span class="k">type</span><span class="w"> </span><span class="err">Query</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c"># 品目</span>
<span class="w">    </span><span class="n">item</span><span class="p">(</span><span class="n">itemCode</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">Item</span>
<span class="w">    </span><span class="n">items</span><span class="p">(</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="no">ItemCategory</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">:</span><span class="w"> </span><span class="no">Int</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="no">Int</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">ItemConnection</span><span class="err">!</span>

<span class="w">    </span><span class="c"># BOM</span>
<span class="w">    </span><span class="n">bomTree</span><span class="p">(</span><span class="n">itemCode</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">BomNode</span>
<span class="w">    </span><span class="n">whereUsed</span><span class="p">(</span><span class="n">itemCode</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="err">[</span><span class="n">WhereUsedResult</span><span class="err">!]!</span>

<span class="w">    </span><span class="c"># 発注</span>
<span class="w">    </span><span class="n">purchaseOrder</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">PurchaseOrder</span>
<span class="w">    </span><span class="n">purchaseOrders</span><span class="p">(</span><span class="n">status</span><span class="p">:</span><span class="w"> </span><span class="no">OrderStatus</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">:</span><span class="w"> </span><span class="no">Int</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="no">Int</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">PurchaseOrderConnection</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">Mutation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c"># 品目</span>
<span class="w">    </span><span class="n">createItem</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="no">CreateItemInput</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">Item</span><span class="err">!</span>
<span class="w">    </span><span class="n">updateItem</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="no">UpdateItemInput</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">Item</span><span class="err">!</span>
<span class="w">    </span><span class="n">deleteItem</span><span class="p">(</span><span class="n">itemCode</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">Boolean</span><span class="err">!</span>

<span class="w">    </span><span class="c"># 発注</span>
<span class="w">    </span><span class="n">createPurchaseOrder</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="no">CreatePurchaseOrderInput</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="err">!</span>
<span class="w">    </span><span class="n">confirmPurchaseOrder</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="err">!</span>
<span class="w">    </span><span class="n">cancelPurchaseOrder</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">Boolean</span><span class="err">!</span>
<span class="w">    </span><span class="n">recordReceiving</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="no">RecordReceivingInput</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">ReceivingResult</span><span class="err">!</span>

<span class="w">    </span><span class="c"># MRP</span>
<span class="w">    </span><span class="n">executeMrp</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="no">ExecuteMrpInput</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">MrpResult</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">Subscription</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c"># MRP 進捗</span>
<span class="w">    </span><span class="n">mrpProgress</span><span class="p">(</span><span class="n">executionId</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="err">!</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">MrpProgress</span><span class="err">!</span>

<span class="w">    </span><span class="c"># 発注ステータス変更</span>
<span class="w">    </span><span class="n">orderStatusChanged</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="err">!</span>

<span class="w">    </span><span class="c"># 在庫変動</span>
<span class="w">    </span><span class="n">stockChanged</span><span class="p">(</span><span class="n">itemCode</span><span class="p">:</span><span class="w"> </span><span class="no">ID</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">StockChange</span><span class="err">!</span>
<span class="p">}</span>

<span class="c"># ページネーション</span>
<span class="k">type</span><span class="w"> </span><span class="err">PageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">hasNextPage</span><span class="p">:</span><span class="w"> </span><span class="n">Boolean</span><span class="err">!</span>
<span class="w">    </span><span class="nl">hasPreviousPage</span><span class="p">:</span><span class="w"> </span><span class="n">Boolean</span><span class="err">!</span>
<span class="w">    </span><span class="nl">totalElements</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">totalPages</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>src/main/resources/graphql/item.graphqls</summary>

<div class="highlight"><pre><span></span><code><span class="c"># 品目区分</span>
<span class="k">enum</span><span class="w"> </span><span class="err">ItemCategory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PRODUCT</span><span class="w">      </span><span class="c"># 製品</span>
<span class="w">    </span><span class="n">SEMI_PRODUCT</span><span class="w"> </span><span class="c"># 半製品</span>
<span class="w">    </span><span class="n">PART</span><span class="w">         </span><span class="c"># 部品</span>
<span class="w">    </span><span class="n">MATERIAL</span><span class="w">     </span><span class="c"># 材料</span>
<span class="p">}</span>

<span class="c"># 品目</span>
<span class="k">type</span><span class="w"> </span><span class="err">Item</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">effectiveDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">category</span><span class="p">:</span><span class="w"> </span><span class="n">ItemCategory</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemGroupCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="nl">unitCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="nl">locationCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="nl">leadTime</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">    </span><span class="nl">safetyStock</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>

<span class="w">    </span><span class="c"># 関連データ（必要な場合のみ取得）</span>
<span class="w">    </span><span class="nl">bom</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">BomEntry</span><span class="err">!]!</span>
<span class="w">    </span><span class="nl">stock</span><span class="p">:</span><span class="w"> </span><span class="n">Stock</span>
<span class="w">    </span><span class="nl">purchaseOrders</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">PurchaseOrder</span><span class="err">!]!</span>
<span class="p">}</span>

<span class="c"># 品目一覧（ページネーション付き）</span>
<span class="k">type</span><span class="w"> </span><span class="err">ItemConnection</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">edges</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">ItemEdge</span><span class="err">!]!</span>
<span class="w">    </span><span class="nl">pageInfo</span><span class="p">:</span><span class="w"> </span><span class="n">PageInfo</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">ItemEdge</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">node</span><span class="p">:</span><span class="w"> </span><span class="n">Item</span><span class="err">!</span>
<span class="w">    </span><span class="nl">cursor</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="p">}</span>

<span class="c"># 入力型</span>
<span class="k">input</span><span class="w"> </span><span class="err">CreateItemInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">category</span><span class="p">:</span><span class="w"> </span><span class="n">ItemCategory</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemGroupCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="nl">unitCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="nl">locationCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="nl">leadTime</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">    </span><span class="nl">safetyStock</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="p">}</span>

<span class="k">input</span><span class="w"> </span><span class="err">UpdateItemInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span>
<span class="w">    </span><span class="nl">category</span><span class="p">:</span><span class="w"> </span><span class="n">ItemCategory</span>
<span class="w">    </span><span class="nl">leadTime</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">    </span><span class="nl">safetyStock</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="p">}</span>

<span class="c"># カスタムスカラー</span>
<span class="k">scalar</span><span class="w"> </span><span class="err">Date</span>
<span class="k">scalar</span><span class="w"> </span><span class="err">DateTime</span>
<span class="k">scalar</span><span class="w"> </span><span class="err">BigDecimal</span>
</code></pre></div>

</details>

<details>
<summary>src/main/resources/graphql/bom.graphqls</summary>

<div class="highlight"><pre><span></span><code><span class="c"># BOM エントリ</span>
<span class="k">type</span><span class="w"> </span><span class="err">BomEntry</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">parentItemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">childItemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">requiredQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">effectiveFrom</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">effectiveTo</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span>

<span class="w">    </span><span class="c"># 子品目の詳細</span>
<span class="w">    </span><span class="nl">childItem</span><span class="p">:</span><span class="w"> </span><span class="n">Item</span><span class="err">!</span>
<span class="p">}</span>

<span class="c"># BOM ツリーノード</span>
<span class="k">type</span><span class="w"> </span><span class="err">BomNode</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">requiredQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">level</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">children</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">BomNode</span><span class="err">!]!</span>
<span class="p">}</span>

<span class="c"># 逆展開（使用先照会）</span>
<span class="k">type</span><span class="w"> </span><span class="err">WhereUsedResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">parentItemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">requiredQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">level</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>src/main/resources/graphql/purchase_order.graphqls</summary>

<div class="highlight"><pre><span></span><code><span class="c"># 発注ステータス</span>
<span class="k">enum</span><span class="w"> </span><span class="err">OrderStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DRAFT</span>
<span class="w">    </span><span class="n">CONFIRMED</span>
<span class="w">    </span><span class="n">CANCELLED</span>
<span class="w">    </span><span class="n">COMPLETED</span>
<span class="p">}</span>

<span class="c"># 発注</span>
<span class="k">type</span><span class="w"> </span><span class="err">PurchaseOrder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">orderNumber</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">supplierCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">orderDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">status</span><span class="p">:</span><span class="w"> </span><span class="n">OrderStatus</span><span class="err">!</span>
<span class="w">    </span><span class="nl">totalAmount</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">details</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">PurchaseOrderDetail</span><span class="err">!]!</span>

<span class="w">    </span><span class="c"># 関連データ</span>
<span class="w">    </span><span class="nl">supplier</span><span class="p">:</span><span class="w"> </span><span class="n">Supplier</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">PurchaseOrderDetail</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">lineNumber</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">orderQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">unitPrice</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">deliveryDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">receivedQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>

<span class="w">    </span><span class="c"># 関連データ</span>
<span class="w">    </span><span class="nl">item</span><span class="p">:</span><span class="w"> </span><span class="n">Item</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">PurchaseOrderConnection</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">edges</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">PurchaseOrderEdge</span><span class="err">!]!</span>
<span class="w">    </span><span class="nl">pageInfo</span><span class="p">:</span><span class="w"> </span><span class="n">PageInfo</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">PurchaseOrderEdge</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">node</span><span class="p">:</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="err">!</span>
<span class="w">    </span><span class="nl">cursor</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="p">}</span>

<span class="c"># 入力型</span>
<span class="k">input</span><span class="w"> </span><span class="err">CreatePurchaseOrderInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">supplierCode</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">details</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">CreateOrderDetailInput</span><span class="err">!]!</span>
<span class="p">}</span>

<span class="k">input</span><span class="w"> </span><span class="err">CreateOrderDetailInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">orderQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">unitPrice</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">deliveryDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">input</span><span class="w"> </span><span class="err">RecordReceivingInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">orderNumber</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">lineNumber</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">receivedQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">receivingDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">ReceivingResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">orderNumber</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">lineNumber</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">totalReceived</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">isCompleted</span><span class="p">:</span><span class="w"> </span><span class="n">Boolean</span><span class="err">!</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>src/main/resources/graphql/mrp.graphqls</summary>

<div class="highlight"><pre><span></span><code><span class="c"># MRP 入力</span>
<span class="k">input</span><span class="w"> </span><span class="err">ExecuteMrpInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">startDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">endDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="p">}</span>

<span class="c"># MRP 結果</span>
<span class="k">type</span><span class="w"> </span><span class="err">MrpResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">executionId</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">periodStart</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">periodEnd</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">plannedOrders</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">PlannedOrder</span><span class="err">!]!</span>
<span class="w">    </span><span class="nl">shortageItems</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">ShortageItem</span><span class="err">!]!</span>
<span class="w">    </span><span class="nl">statistics</span><span class="p">:</span><span class="w"> </span><span class="n">MrpStatistics</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">PlannedOrder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">quantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">dueDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="w">    </span><span class="nl">orderType</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">ShortageItem</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">itemCode</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">itemName</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">shortageQuantity</span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="err">!</span>
<span class="w">    </span><span class="nl">recommendedOrderDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">type</span><span class="w"> </span><span class="err">MrpStatistics</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">totalItemsProcessed</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">purchaseOrderCount</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">productionOrderCount</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">shortageItemCount</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">executionTimeMs</span><span class="p">:</span><span class="w"> </span><span class="n">Long</span><span class="err">!</span>
<span class="p">}</span>

<span class="c"># MRP 進捗（Subscription）</span>
<span class="k">type</span><span class="w"> </span><span class="err">MrpProgress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">executionId</span><span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="err">!</span>
<span class="w">    </span><span class="nl">phase</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="w">    </span><span class="nl">current</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">total</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">!</span>
<span class="w">    </span><span class="nl">message</span><span class="p">:</span><span class="w"> </span><span class="n">String</span><span class="err">!</span>
<span class="p">}</span>

<span class="k">scalar</span><span class="w"> </span><span class="err">Long</span>
</code></pre></div>

</details>

<h3 id="427-api-controller">42.7 API サーバー版との Controller の違い<a class="headerlink" href="#427-api-controller" title="Permanent link">&para;</a></h3>
<p><strong>API サーバー版（REST Controller）</strong></p>
<div class="highlight"><pre><span></span><code><span class="nd">@RestController</span><span class="w">  </span><span class="c1">// JSON を返す</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/items&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemApiController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 共有</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/{itemCode}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ItemResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getItem</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemByCode</span><span class="p">(</span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">ItemResponse</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">item</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>GraphQL 版（QueryResolver）</strong></p>
<div class="highlight"><pre><span></span><code><span class="nd">@Controller</span><span class="w">  </span><span class="c1">// Spring for GraphQL</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemResolver</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 共有（同じインスタンス）</span>

<span class="w">    </span><span class="nd">@QueryMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="nf">item</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 同じ UseCase を呼び出し</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemByCode</span><span class="p">(</span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>共通点と相違点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>REST Controller</th>
<th>GraphQL Resolver</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>UseCase</strong></td>
<td>共有（同一インスタンス）</td>
<td>共有（同一インスタンス）</td>
</tr>
<tr>
<td><strong>アノテーション</strong></td>
<td><code>@RestController</code></td>
<td><code>@Controller</code></td>
</tr>
<tr>
<td><strong>メソッド</strong></td>
<td><code>@GetMapping</code> 等</td>
<td><code>@QueryMapping</code> / <code>@MutationMapping</code></td>
</tr>
<tr>
<td><strong>引数</strong></td>
<td><code>@PathVariable</code> / <code>@RequestBody</code></td>
<td><code>@Argument</code></td>
</tr>
<tr>
<td><strong>レスポンス</strong></td>
<td>DTO に変換</td>
<td>ドメインモデル直接（推奨）</td>
</tr>
<tr>
<td><strong>データ形式</strong></td>
<td>固定 JSON</td>
<td>クライアント指定</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="47-api">第47章：マスタ API の実装<a class="headerlink" href="#47-api" title="Permanent link">&para;</a></h2>
<h3 id="471">47.1 カスタムスカラーの実装<a class="headerlink" href="#471" title="Permanent link">&para;</a></h3>
<details>
<summary>ScalarConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.scalar</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.scalars.ExtendedScalars</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.execution.RuntimeWiringConfigurer</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * カスタムスカラー設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ScalarConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RuntimeWiringConfigurer</span><span class="w"> </span><span class="nf">runtimeWiringConfigurer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">wiringBuilder</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">wiringBuilder</span>
<span class="w">            </span><span class="p">.</span><span class="na">scalar</span><span class="p">(</span><span class="n">ExtendedScalars</span><span class="p">.</span><span class="na">Date</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">scalar</span><span class="p">(</span><span class="n">ExtendedScalars</span><span class="p">.</span><span class="na">DateTime</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">scalar</span><span class="p">(</span><span class="n">ExtendedScalars</span><span class="p">.</span><span class="na">GraphQLBigDecimal</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">scalar</span><span class="p">(</span><span class="n">ExtendedScalars</span><span class="p">.</span><span class="na">GraphQLLong</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="472-graphql-tdd">47.2 品目 GraphQL リゾルバの TDD 実装<a class="headerlink" href="#472-graphql-tdd" title="Permanent link">&para;</a></h3>
<h4 id="red">Red: 失敗するテストを書く<a class="headerlink" href="#red" title="Permanent link">&para;</a></h4>
<details>
<summary>ItemResolverTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.resolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.ItemCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.persistence.mapper.ItemMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.autoconfigure.graphql.tester.AutoConfigureGraphQlTester</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.test.tester.GraphQlTester</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertyRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertySource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.containers.PostgreSQLContainer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Container</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Testcontainers</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureGraphQlTester</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;品目 GraphQL リゾルバ&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">ItemResolverTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:16&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withDatabaseName</span><span class="p">(</span><span class="s">&quot;production_test&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withUsername</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withPassword</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@DynamicPropertySource</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureProperties</span><span class="p">(</span><span class="n">DynamicPropertyRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getJdbcUrl</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.username&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getUsername</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getPassword</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">GraphQlTester</span><span class="w"> </span><span class="n">graphQlTester</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ItemMapper</span><span class="w"> </span><span class="n">itemMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Query: item&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ItemQueryTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;品目コードで品目を取得できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetItemByCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;テスト製品&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Act &amp; Assert</span>
<span class="w">            </span><span class="n">graphQlTester</span><span class="p">.</span><span class="na">document</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    query {</span>
<span class="s">                        item(itemCode: &quot;PROD-001&quot;) {</span>
<span class="s">                            itemCode</span>
<span class="s">                            itemName</span>
<span class="s">                            category</span>
<span class="s">                        }</span>
<span class="s">                    }</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;item.itemCode&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;item.itemName&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;テスト製品&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;item.category&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;PRODUCT&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;存在しない品目は null を返す&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldReturnNullForNonExistentItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">graphQlTester</span><span class="p">.</span><span class="na">document</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    query {</span>
<span class="s">                        item(itemCode: &quot;NOT-EXIST&quot;) {</span>
<span class="s">                            itemCode</span>
<span class="s">                        }</span>
<span class="s">                    }</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;item&quot;</span><span class="p">).</span><span class="na">valueIsNull</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;関連データを同時に取得できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetItemWithRelatedData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;テスト製品&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>

<span class="w">            </span><span class="n">graphQlTester</span><span class="p">.</span><span class="na">document</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    query {</span>
<span class="s">                        item(itemCode: &quot;PROD-001&quot;) {</span>
<span class="s">                            itemCode</span>
<span class="s">                            itemName</span>
<span class="s">                            bom {</span>
<span class="s">                                childItemCode</span>
<span class="s">                                requiredQuantity</span>
<span class="s">                            }</span>
<span class="s">                            stock {</span>
<span class="s">                                quantity</span>
<span class="s">                            }</span>
<span class="s">                        }</span>
<span class="s">                    }</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;item.itemCode&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;item.bom&quot;</span><span class="p">).</span><span class="na">entityList</span><span class="p">(</span><span class="n">Object</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Query: items&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ItemsQueryTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;品目一覧を取得できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetItems</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;ITEM-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%03d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;品目&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">graphQlTester</span><span class="p">.</span><span class="na">document</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    query {</span>
<span class="s">                        items(page: 0, size: 10) {</span>
<span class="s">                            edges {</span>
<span class="s">                                node {</span>
<span class="s">                                    itemCode</span>
<span class="s">                                    itemName</span>
<span class="s">                                }</span>
<span class="s">                            }</span>
<span class="s">                            pageInfo {</span>
<span class="s">                                totalElements</span>
<span class="s">                            }</span>
<span class="s">                        }</span>
<span class="s">                    }</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;items.edges&quot;</span><span class="p">).</span><span class="na">entityList</span><span class="p">(</span><span class="n">Object</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;items.pageInfo.totalElements&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;カテゴリでフィルタリングできる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldFilterByCategory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;PROD-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;製品1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>
<span class="w">            </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;PART-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;部品1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PART</span><span class="p">);</span>
<span class="w">            </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;PROD-002&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;製品2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>

<span class="w">            </span><span class="n">graphQlTester</span><span class="p">.</span><span class="na">document</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    query {</span>
<span class="s">                        items(category: PRODUCT, page: 0, size: 10) {</span>
<span class="s">                            edges {</span>
<span class="s">                                node {</span>
<span class="s">                                    itemCode</span>
<span class="s">                                }</span>
<span class="s">                            }</span>
<span class="s">                            pageInfo {</span>
<span class="s">                                totalElements</span>
<span class="s">                            }</span>
<span class="s">                        }</span>
<span class="s">                    }</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;items.pageInfo.totalElements&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Mutation: createItem&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CreateItemMutationTests</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;品目を登録できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCreateItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">graphQlTester</span><span class="p">.</span><span class="na">document</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    mutation {</span>
<span class="s">                        createItem(input: {</span>
<span class="s">                            itemCode: &quot;NEW-001&quot;</span>
<span class="s">                            itemName: &quot;新規品目&quot;</span>
<span class="s">                            category: PRODUCT</span>
<span class="s">                            leadTime: 5</span>
<span class="s">                        }) {</span>
<span class="s">                            itemCode</span>
<span class="s">                            itemName</span>
<span class="s">                            category</span>
<span class="s">                            leadTime</span>
<span class="s">                        }</span>
<span class="s">                    }</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;createItem.itemCode&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;NEW-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;createItem.itemName&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;新規品目&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;createItem.category&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;PRODUCT&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;createItem.leadTime&quot;</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// DB に保存されていることを確認</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">findByCode</span><span class="p">(</span><span class="s">&quot;NEW-001&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">saved</span><span class="p">).</span><span class="na">isNotNull</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">saved</span><span class="p">.</span><span class="na">getItemName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;新規品目&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;重複する品目コードはエラーになる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldFailForDuplicateCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">insertTestItem</span><span class="p">(</span><span class="s">&quot;DUP-001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;既存品目&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PRODUCT</span><span class="p">);</span>

<span class="w">            </span><span class="n">graphQlTester</span><span class="p">.</span><span class="na">document</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    mutation {</span>
<span class="s">                        createItem(input: {</span>
<span class="s">                            itemCode: &quot;DUP-001&quot;</span>
<span class="s">                            itemName: &quot;重複品目&quot;</span>
<span class="s">                            category: PRODUCT</span>
<span class="s">                        }) {</span>
<span class="s">                            itemCode</span>
<span class="s">                        }</span>
<span class="s">                    }</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">errors</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">satisfy</span><span class="p">(</span><span class="n">errors</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">assertThat</span><span class="p">(</span><span class="n">errors</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">insertTestItem</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">ItemCategory</span><span class="w"> </span><span class="n">category</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">effectiveDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="green-graphql">Green: GraphQL リゾルバの実装<a class="headerlink" href="#green-graphql" title="Permanent link">&para;</a></h4>
<details>
<summary>ItemResolver.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.resolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.port.in.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.exception.DuplicateItemException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.exception.ItemNotFoundException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.ItemCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.GraphQLError</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.GraphqlErrorBuilder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.schema.DataFetchingEnvironment</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.execution.ErrorType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 品目 GraphQL リゾルバ実装</span>
<span class="cm"> * 既存の ItemUseCase を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemResolver</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存の UseCase を注入</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ItemResolver</span><span class="p">(</span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">itemUseCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Query ==========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@QueryMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="nf">item</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemByCode</span><span class="p">(</span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ItemNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span><span class="c1">// GraphQL では null を返す</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目一覧（ページネーション付き）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@QueryMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ItemConnection</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Argument</span><span class="w"> </span><span class="n">ItemCategory</span><span class="w"> </span><span class="n">category</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Argument</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">page</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Argument</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pageNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pageSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">totalElements</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">category</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemsByCategory</span><span class="p">(</span><span class="n">category</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getAllItems</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">totalElements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ページング処理</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pageNum</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pageSize</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pageSize</span><span class="p">,</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pagedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="na">subList</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ItemConnection</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">edges</span><span class="p">(</span><span class="n">pagedItems</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ItemEdge</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">node</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">cursor</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">pageInfo</span><span class="p">(</span><span class="n">PageInfo</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">hasNextPage</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">totalElements</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">hasPreviousPage</span><span class="p">(</span><span class="n">pageNum</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalElements</span><span class="p">(</span><span class="n">totalElements</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalPages</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">ceil</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">totalElements</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pageSize</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Mutation ==========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目登録</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="nf">createItem</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">CreateItemInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CreateItemCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateItemCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getCategory</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemGroupCode</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getItemGroupCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">unitCode</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getUnitCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">locationCode</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getLocationCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">leadTime</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getLeadTime</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">safetyStock</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getSafetyStock</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">createItem</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目更新</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="nf">updateItem</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">UpdateItemInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UpdateItemCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UpdateItemCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getItemName</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">category</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getCategory</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">leadTime</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getLeadTime</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">safetyStock</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getSafetyStock</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">updateItem</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 品目削除</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">deleteItem</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">deleteItem</span><span class="p">(</span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ItemNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== 例外ハンドリング ==========</span>

<span class="w">    </span><span class="nd">@GraphQlExceptionHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">GraphQLError</span><span class="w"> </span><span class="nf">handleDuplicateItem</span><span class="p">(</span><span class="n">DuplicateItemException</span><span class="w"> </span><span class="n">ex</span><span class="p">,</span><span class="w"> </span><span class="n">DataFetchingEnvironment</span><span class="w"> </span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GraphQlExceptionHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">GraphQLError</span><span class="w"> </span><span class="nf">handleItemNotFound</span><span class="p">(</span><span class="n">ItemNotFoundException</span><span class="w"> </span><span class="n">ex</span><span class="p">,</span><span class="w"> </span><span class="n">DataFetchingEnvironment</span><span class="w"> </span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>補助クラス（ItemConnection, PageInfo 等）</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.resolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.ItemCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemConnection</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ItemEdge</span><span class="o">&gt;</span><span class="w"> </span><span class="n">edges</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PageInfo</span><span class="w"> </span><span class="n">pageInfo</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemEdge</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cursor</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasNextPage</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasPreviousPage</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalElements</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalPages</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Data</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CreateItemInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ItemCategory</span><span class="w"> </span><span class="n">category</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemGroupCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">unitCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">locationCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">leadTime</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">safetyStock</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Data</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UpdateItemInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ItemCategory</span><span class="w"> </span><span class="n">category</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">leadTime</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">safetyStock</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="473-n1-dataloader">47.3 N+1 問題対策（DataLoader）<a class="headerlink" href="#473-n1-dataloader" title="Permanent link">&para;</a></h3>
<p>GraphQL では関連データの取得時に N+1 問題が発生しやすいため、DataLoader を使用します。</p>
<details>
<summary>DataLoaderConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.dataloader</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.port.in.ItemUseCase</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.dataloader.DataLoader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.dataloader.DataLoaderFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.execution.BatchLoaderRegistry</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.function.Function</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Collectors</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * DataLoader 設定</span>
<span class="cm"> * N+1 問題を解決するためのバッチローディング</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DataLoaderConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DataLoaderConfig</span><span class="p">(</span><span class="n">ItemUseCase</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">itemUseCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BatchLoaderRegistry</span><span class="w"> </span><span class="nf">batchLoaderRegistry</span><span class="p">(</span><span class="n">BatchLoaderRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 品目 DataLoader</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">forTypePair</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">registerBatchLoader</span><span class="p">((</span><span class="n">itemCodes</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// バッチで品目を取得（1回のクエリで複数取得）</span>
<span class="w">                </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemUseCase</span><span class="p">.</span><span class="na">getItemsByCodes</span><span class="p">(</span><span class="n">itemCodes</span><span class="p">);</span>

<span class="w">                </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">itemMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toMap</span><span class="p">(</span><span class="n">Item</span><span class="p">::</span><span class="n">getItemCode</span><span class="p">,</span><span class="w"> </span><span class="n">Function</span><span class="p">.</span><span class="na">identity</span><span class="p">()));</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">reactor</span><span class="p">.</span><span class="na">core</span><span class="p">.</span><span class="na">publisher</span><span class="p">.</span><span class="na">Flux</span><span class="p">.</span><span class="na">fromIterable</span><span class="p">(</span><span class="n">itemCodes</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">code</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">itemMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">code</span><span class="p">));</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">registry</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>PurchaseOrderDetailResolver.java（DataLoader 使用）</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.resolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.purchase.PurchaseOrderDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.dataloader.DataLoader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.SchemaMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletableFuture</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 発注明細リゾルバ</span>
<span class="cm"> * DataLoader を使って品目を効率的に取得</span>
<span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PurchaseOrderDetailResolver</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 発注明細から品目を取得（DataLoader 使用）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@SchemaMapping</span><span class="p">(</span><span class="n">typeName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PurchaseOrderDetail&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;item&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">item</span><span class="p">(</span>
<span class="w">            </span><span class="n">PurchaseOrderDetail</span><span class="w"> </span><span class="n">detail</span><span class="p">,</span>
<span class="w">            </span><span class="n">DataLoader</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">itemDataLoader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// DataLoader 経由で取得（バッチ処理される）</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">itemDataLoader</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="474-bom-graphql">47.4 BOM GraphQL リゾルバ<a class="headerlink" href="#474-bom-graphql" title="Permanent link">&para;</a></h3>
<details>
<summary>BomResolver.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.resolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.BomNode</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.BomService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.WhereUsedResult</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.Argument</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.QueryMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * BOM GraphQL リゾルバ実装</span>
<span class="cm"> * 既存の BomService を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BomResolver</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BomService</span><span class="w"> </span><span class="n">bomService</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存のサービスを注入</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">BomResolver</span><span class="p">(</span><span class="n">BomService</span><span class="w"> </span><span class="n">bomService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">bomService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bomService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 部品展開（BOM ツリー）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@QueryMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BomNode</span><span class="w"> </span><span class="nf">bomTree</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bomService</span><span class="p">.</span><span class="na">explodeBom</span><span class="p">(</span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 使用先照会</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@QueryMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WhereUsedResult</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">whereUsed</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bomService</span><span class="p">.</span><span class="na">whereUsed</span><span class="p">(</span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="48-api">第48章：トランザクション API の実装<a class="headerlink" href="#48-api" title="Permanent link">&para;</a></h2>
<h3 id="481-graphql">48.1 発注 GraphQL リゾルバ<a class="headerlink" href="#481-graphql" title="Permanent link">&para;</a></h3>
<details>
<summary>PurchaseOrderResolver.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.resolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.port.in.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.purchase.PurchaseOrder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 発注 GraphQL リゾルバ実装</span>
<span class="cm"> * 既存の PurchaseOrderUseCase を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PurchaseOrderResolver</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">PurchaseOrderUseCase</span><span class="w"> </span><span class="n">useCase</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存の UseCase</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">PurchaseOrderResolver</span><span class="p">(</span><span class="n">PurchaseOrderUseCase</span><span class="w"> </span><span class="n">useCase</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">useCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Query ==========</span>

<span class="w">    </span><span class="nd">@QueryMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="nf">purchaseOrder</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">getOrder</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@QueryMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PurchaseOrderConnection</span><span class="w"> </span><span class="nf">purchaseOrders</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Argument</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">page</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Argument</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PurchaseOrder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">getAllOrders</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ページネーション処理（省略）</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PurchaseOrderConnection</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">edges</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PurchaseOrderEdge</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">node</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">cursor</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">pageInfo</span><span class="p">(</span><span class="n">PageInfo</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalElements</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="na">size</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Mutation ==========</span>

<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="nf">createPurchaseOrder</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">CreatePurchaseOrderInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CreatePurchaseOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePurchaseOrderCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">details</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getDetails</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">CreatePurchaseOrderCommand</span><span class="p">.</span><span class="na">PurchaseOrderDetailCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getOrderQuantity</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">deliveryDate</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="na">getDeliveryDate</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">createOrder</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="nf">confirmPurchaseOrder</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">confirmOrder</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">cancelPurchaseOrder</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">useCase</span><span class="p">.</span><span class="na">cancelOrder</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReceivingResult</span><span class="w"> </span><span class="nf">recordReceiving</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">RecordReceivingInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useCase</span><span class="p">.</span><span class="na">recordReceiving</span><span class="p">(</span>
<span class="w">            </span><span class="n">input</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">(),</span>
<span class="w">            </span><span class="n">input</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">(),</span>
<span class="w">            </span><span class="n">input</span><span class="p">.</span><span class="na">getReceivedQuantity</span><span class="p">(),</span>
<span class="w">            </span><span class="n">input</span><span class="p">.</span><span class="na">getReceivingDate</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ReceivingResult</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">orderNumber</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getOrderNumber</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">totalReceived</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getTotalReceived</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">isCompleted</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">isCompleted</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 入力型</span>
<span class="nd">@lombok.Data</span>
<span class="kd">class</span> <span class="nc">CreatePurchaseOrderInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CreateOrderDetailInput</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="kd">class</span> <span class="nc">CreateOrderDetailInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">deliveryDate</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="kd">class</span> <span class="nc">RecordReceivingInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">receivedQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">receivingDate</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="nd">@lombok.Builder</span>
<span class="kd">class</span> <span class="nc">ReceivingResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalReceived</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isCompleted</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="482-mrp-graphql">48.2 MRP GraphQL リゾルバ<a class="headerlink" href="#482-mrp-graphql" title="Permanent link">&para;</a></h3>
<details>
<summary>MrpResolver.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.resolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.application.service.MrpService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * MRP GraphQL リゾルバ実装</span>
<span class="cm"> * 既存の MrpService を Input Adapter として呼び出す</span>
<span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MrpResolver</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MrpService</span><span class="w"> </span><span class="n">mrpService</span><span class="p">;</span><span class="w">  </span><span class="c1">// 既存のサービス</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MrpResolver</span><span class="p">(</span><span class="n">MrpService</span><span class="w"> </span><span class="n">mrpService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mrpService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrpService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * MRP 実行</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@MutationMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MrpResult</span><span class="w"> </span><span class="nf">executeMrp</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">ExecuteMrpInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">executionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>

<span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrpService</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getStartDate</span><span class="p">(),</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">getEndDate</span><span class="p">());</span>
<span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">executionTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MrpResult</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">executionId</span><span class="p">(</span><span class="n">executionId</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">periodStart</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getStartDate</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">periodEnd</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getEndDate</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">plannedOrders</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getPlannedOrders</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">shortageItems</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getShortageItems</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">statistics</span><span class="p">(</span><span class="n">MrpStatistics</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalItemsProcessed</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getPlannedOrders</span><span class="p">().</span><span class="na">size</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">shortageItemCount</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getShortageItems</span><span class="p">().</span><span class="na">size</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">executionTimeMs</span><span class="p">(</span><span class="n">executionTime</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="kd">class</span> <span class="nc">ExecuteMrpInput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">startDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">endDate</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="nd">@lombok.Builder</span>
<span class="kd">class</span> <span class="nc">MrpResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">executionId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">periodStart</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">periodEnd</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">List</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">plannedOrders</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">List</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">shortageItems</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MrpStatistics</span><span class="w"> </span><span class="n">statistics</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="nd">@lombok.Builder</span>
<span class="kd">class</span> <span class="nc">MrpStatistics</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalItemsProcessed</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">purchaseOrderCount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">productionOrderCount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">shortageItemCount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">executionTimeMs</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="483-subscription">48.3 Subscription（リアルタイム更新）<a class="headerlink" href="#483-subscription" title="Permanent link">&para;</a></h3>
<details>
<summary>SubscriptionResolver.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.subscription</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.model.purchase.PurchaseOrder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.Argument</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.SubscriptionMapping</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">reactor.core.publisher.Flux</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Duration</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * GraphQL Subscription リゾルバ</span>
<span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SubscriptionResolver</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderEventPublisher</span><span class="w"> </span><span class="n">orderEventPublisher</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MrpProgressPublisher</span><span class="w"> </span><span class="n">mrpProgressPublisher</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SubscriptionResolver</span><span class="p">(</span>
<span class="w">            </span><span class="n">OrderEventPublisher</span><span class="w"> </span><span class="n">orderEventPublisher</span><span class="p">,</span>
<span class="w">            </span><span class="n">MrpProgressPublisher</span><span class="w"> </span><span class="n">mrpProgressPublisher</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">orderEventPublisher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderEventPublisher</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mrpProgressPublisher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrpProgressPublisher</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * MRP 進捗の購読</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@SubscriptionMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">mrpProgress</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">executionId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mrpProgressPublisher</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">executionId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 発注ステータス変更の購読</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@SubscriptionMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">PurchaseOrder</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">orderStatusChanged</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orderEventPublisher</span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span><span class="n">orderNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 在庫変動の購読</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@SubscriptionMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">StockChange</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">stockChanged</span><span class="p">(</span><span class="nd">@Argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ダミー実装（5秒ごとに在庫変動をシミュレート）</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Flux</span><span class="p">.</span><span class="na">interval</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">StockChange</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">itemCode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">itemCode</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ITEM-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">changeType</span><span class="p">(</span><span class="s">&quot;RECEIVE&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">math</span><span class="p">.</span><span class="na">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="nd">@lombok.Builder</span>
<span class="kd">class</span> <span class="nc">StockChange</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">changeType</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">math</span><span class="p">.</span><span class="na">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>MrpProgressPublisher.java（イベントパブリッシャー）</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.subscription</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">reactor.core.publisher.Flux</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">reactor.core.publisher.Sinks</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * MRP 進捗イベントパブリッシャー</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MrpProgressPublisher</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Sinks</span><span class="p">.</span><span class="na">Many</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">sinks</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 進捗を購読</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">executionId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Sinks</span><span class="p">.</span><span class="na">Many</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinks</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span>
<span class="w">            </span><span class="n">executionId</span><span class="p">,</span>
<span class="w">            </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Sinks</span><span class="p">.</span><span class="na">many</span><span class="p">().</span><span class="na">multicast</span><span class="p">().</span><span class="na">onBackpressureBuffer</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sink</span><span class="p">.</span><span class="na">asFlux</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 進捗を発行</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">publish</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">executionId</span><span class="p">,</span><span class="w"> </span><span class="n">MrpProgress</span><span class="w"> </span><span class="n">progress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Sinks</span><span class="p">.</span><span class="na">Many</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinks</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">executionId</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sink</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">sink</span><span class="p">.</span><span class="na">tryEmitNext</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 完了</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">executionId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Sinks</span><span class="p">.</span><span class="na">Many</span><span class="o">&lt;</span><span class="n">MrpProgress</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinks</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">executionId</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sink</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">sink</span><span class="p">.</span><span class="na">tryEmitComplete</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@lombok.Data</span>
<span class="nd">@lombok.Builder</span>
<span class="kd">class</span> <span class="nc">MrpProgress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">executionId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">phase</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">current</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">total</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="49">第49章：エラーハンドリングとベストプラクティス<a class="headerlink" href="#49" title="Permanent link">&para;</a></h2>
<h3 id="491">49.1 グローバル例外ハンドラ<a class="headerlink" href="#491" title="Permanent link">&para;</a></h3>
<details>
<summary>GraphQLExceptionHandler.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.production.domain.exception.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.GraphQLError</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.GraphqlErrorBuilder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.schema.DataFetchingEnvironment</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.execution.DataFetcherExceptionResolverAdapter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.execution.ErrorType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * GraphQL グローバル例外ハンドラ</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GraphQLExceptionHandler</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DataFetcherExceptionResolverAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">GraphQLError</span><span class="w"> </span><span class="nf">resolveToSingleError</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">ex</span><span class="p">,</span><span class="w"> </span><span class="n">DataFetchingEnvironment</span><span class="w"> </span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ItemNotFoundException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">DuplicateItemException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">OrderAlreadyConfirmedException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 未知のエラー</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">INTERNAL_ERROR</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="s">&quot;内部エラーが発生しました&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="492">49.2 入力バリデーション<a class="headerlink" href="#492" title="Permanent link">&para;</a></h3>
<details>
<summary>ValidationExceptionHandler.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.production.infrastructure.graphql.validation</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.GraphQLError</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.GraphqlErrorBuilder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphql.schema.DataFetchingEnvironment</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.data.method.annotation.GraphQlExceptionHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.graphql.execution.ErrorType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.ConstraintViolation</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.ConstraintViolationException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Collectors</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * バリデーション例外ハンドラ</span>
<span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ValidationExceptionHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@GraphQlExceptionHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">GraphQLError</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">handleValidation</span><span class="p">(</span>
<span class="w">            </span><span class="n">ConstraintViolationException</span><span class="w"> </span><span class="n">ex</span><span class="p">,</span>
<span class="w">            </span><span class="n">DataFetchingEnvironment</span><span class="w"> </span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getConstraintViolations</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">violation</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">toGraphQLError</span><span class="p">(</span><span class="n">violation</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">GraphQLError</span><span class="w"> </span><span class="nf">toGraphQLError</span><span class="p">(</span>
<span class="w">            </span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">violation</span><span class="p">,</span>
<span class="w">            </span><span class="n">DataFetchingEnvironment</span><span class="w"> </span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">GraphqlErrorBuilder</span><span class="p">.</span><span class="na">newError</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">errorType</span><span class="p">(</span><span class="n">ErrorType</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">message</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s: %s&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">violation</span><span class="p">.</span><span class="na">getPropertyPath</span><span class="p">(),</span>
<span class="w">                </span><span class="n">violation</span><span class="p">.</span><span class="na">getMessage</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="493">49.3 設定ファイル<a class="headerlink" href="#493" title="Permanent link">&para;</a></h3>
<details>
<summary>application.yml（GraphQL 追加設定）</summary>

<div class="highlight"><pre><span></span><code><span class="nt">spring</span><span class="p">:</span>
<span class="w">  </span><span class="nt">graphql</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/graphql</span>
<span class="w">    </span><span class="nt">graphiql</span><span class="p">:</span>
<span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">              </span><span class="c1"># 開発時に GraphiQL UI を有効化</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/graphiql</span>
<span class="w">    </span><span class="nt">websocket</span><span class="p">:</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/graphql</span><span class="w">             </span><span class="c1"># Subscription 用 WebSocket</span>
<span class="w">    </span><span class="nt">schema</span><span class="p">:</span>
<span class="w">      </span><span class="nt">locations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">classpath:graphql/</span>
<span class="w">      </span><span class="nt">printer</span><span class="p">:</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">            </span><span class="c1"># スキーマ出力</span>

<span class="c1"># 既存の設定はそのまま</span>
<span class="w">  </span><span class="nt">datasource</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jdbc:postgresql://localhost:5432/production</span>
<span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>

<span class="nt">mybatis</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mapper-locations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">classpath:mapper/*.xml</span>
</code></pre></div>

</details>

<h3 id="494-graphql-playground">49.4 GraphQL Playground からの呼び出し<a class="headerlink" href="#494-graphql-playground" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># 品目取得</span>
<span class="k">query</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">item</span><span class="p">(</span><span class="n">itemCode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PROD-001&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">itemCode</span>
<span class="w">    </span><span class="n">itemName</span>
<span class="w">    </span><span class="n">category</span>
<span class="w">    </span><span class="n">leadTime</span>
<span class="w">    </span><span class="n">bom</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">childItemCode</span>
<span class="w">      </span><span class="n">requiredQuantity</span>
<span class="w">      </span><span class="n">childItem</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">itemName</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c"># 品目一覧（ページネーション）</span>
<span class="k">query</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">items</span><span class="p">(</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="no">PRODUCT</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">edges</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">itemCode</span>
<span class="w">        </span><span class="n">itemName</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">pageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">totalElements</span>
<span class="w">      </span><span class="n">hasNextPage</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c"># 品目登録</span>
<span class="k">mutation</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">createItem</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">itemCode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NEW-001&quot;</span>
<span class="w">    </span><span class="n">itemName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;新規製品&quot;</span>
<span class="w">    </span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="no">PRODUCT</span>
<span class="w">    </span><span class="n">leadTime</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
<span class="w">  </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">itemCode</span>
<span class="w">    </span><span class="n">itemName</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c"># MRP 進捗購読</span>
<span class="k">subscription</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">mrpProgress</span><span class="p">(</span><span class="n">executionId</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exec-123&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">phase</span>
<span class="w">    </span><span class="n">current</span>
<span class="w">    </span><span class="n">total</span>
<span class="w">    </span><span class="n">message</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="495-graphql-vs-rest-vs-grpc">49.5 GraphQL vs REST vs gRPC の使い分け<a class="headerlink" href="#495-graphql-vs-rest-vs-grpc" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>用途</th>
<th>推奨</th>
<th>理由</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>フロントエンド API</strong></td>
<td>GraphQL</td>
<td>柔軟なデータ取得、Over-fetching 防止</td>
</tr>
<tr>
<td><strong>モバイルアプリ</strong></td>
<td>GraphQL</td>
<td>帯域制限、必要なデータのみ取得</td>
</tr>
<tr>
<td><strong>マイクロサービス間</strong></td>
<td>gRPC</td>
<td>高パフォーマンス、型安全</td>
</tr>
<tr>
<td><strong>サードパーティ連携</strong></td>
<td>REST</td>
<td>広く普及、シンプル</td>
</tr>
<tr>
<td><strong>リアルタイム更新</strong></td>
<td>GraphQL Subscription / gRPC Streaming</td>
<td>ネイティブサポート</td>
</tr>
<tr>
<td><strong>バッチ処理</strong></td>
<td>gRPC</td>
<td>ストリーミング効率</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="_2">まとめ<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>本研究では、GraphQL による生産管理システム API を実装しました。</p>
<h3 id="api">API サーバー版との比較<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>REST API（第32章）</th>
<th>gRPC（研究2）</th>
<th>GraphQL（本研究）</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>プロトコル</strong></td>
<td>HTTP/1.1 + JSON</td>
<td>HTTP/2 + Protobuf</td>
<td>HTTP + JSON</td>
</tr>
<tr>
<td><strong>スキーマ</strong></td>
<td>OpenAPI（任意）</td>
<td>.proto（必須）</td>
<td>.graphqls（必須）</td>
</tr>
<tr>
<td><strong>データ取得</strong></td>
<td>固定レスポンス</td>
<td>固定レスポンス</td>
<td>クライアント指定</td>
</tr>
<tr>
<td><strong>エンドポイント</strong></td>
<td>複数</td>
<td>複数</td>
<td>単一</td>
</tr>
<tr>
<td><strong>リアルタイム</strong></td>
<td>WebSocket 別実装</td>
<td>ストリーミング</td>
<td>Subscription</td>
</tr>
<tr>
<td><strong>ドメイン層</strong></td>
<td>共有</td>
<td>共有</td>
<td>共有</td>
</tr>
<tr>
<td><strong>アプリケーション層</strong></td>
<td>共有</td>
<td>共有</td>
<td>共有</td>
</tr>
<tr>
<td><strong>Input Adapter</strong></td>
<td>REST Controller</td>
<td>gRPC Service</td>
<td>GraphQL Resolver</td>
</tr>
</tbody>
</table>
<h3 id="graphql">実装した GraphQL 操作<a class="headerlink" href="#graphql" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>操作タイプ</th>
<th>操作名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Query</strong></td>
<td>item, items</td>
<td>品目取得</td>
</tr>
<tr>
<td></td>
<td>bomTree, whereUsed</td>
<td>BOM 展開・逆展開</td>
</tr>
<tr>
<td></td>
<td>purchaseOrder, purchaseOrders</td>
<td>発注取得</td>
</tr>
<tr>
<td><strong>Mutation</strong></td>
<td>createItem, updateItem, deleteItem</td>
<td>品目 CRUD</td>
</tr>
<tr>
<td></td>
<td>createPurchaseOrder, confirmPurchaseOrder</td>
<td>発注操作</td>
</tr>
<tr>
<td></td>
<td>recordReceiving</td>
<td>入荷登録</td>
</tr>
<tr>
<td></td>
<td>executeMrp</td>
<td>MRP 実行</td>
</tr>
<tr>
<td><strong>Subscription</strong></td>
<td>mrpProgress</td>
<td>MRP 進捗通知</td>
</tr>
<tr>
<td></td>
<td>orderStatusChanged</td>
<td>発注ステータス変更</td>
</tr>
<tr>
<td></td>
<td>stockChanged</td>
<td>在庫変動</td>
</tr>
</tbody>
</table>
<h3 id="_3">技術スタック<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Spring for GraphQL</strong>: Spring Boot 統合</li>
<li><strong>GraphQL Java</strong>: GraphQL 実行エンジン</li>
<li><strong>Extended Scalars</strong>: Date, BigDecimal 等のカスタム型</li>
<li><strong>DataLoader</strong>: N+1 問題対策</li>
<li><strong>WebSocket</strong>: Subscription サポート</li>
</ul>
<h3 id="graphql_1">GraphQL を選択すべき場面<a class="headerlink" href="#graphql_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>フロントエンド主導の開発</strong>: クライアントがデータ形状を決定</li>
<li><strong>モバイルアプリ</strong>: 帯域制限下での効率的なデータ取得</li>
<li><strong>複雑な関連データ</strong>: 1回のクエリで関連データを取得</li>
<li><strong>リアルタイム更新</strong>: Subscription でプッシュ通知</li>
<li><strong>API 統合</strong>: 複数のバックエンドを単一エンドポイントで提供</li>
</ol>
<hr />
<p><a href="../../">目次へ戻る</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>