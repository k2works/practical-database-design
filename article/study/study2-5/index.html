
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../study2-4/">
      
      
        <link rel="next" href="../study3-1/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>研究5 AxonCQRS/ESの実装 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#5-axon-cqrses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              研究5 AxonCQRS/ESの実装
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-setup-instruction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    プロジェクトセットアップ手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" checked>
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        はじめに
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18axon-cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        第18章：Axon CQRS/ES アーキテクチャの基礎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第18章：Axon CQRS/ES アーキテクチャの基礎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#181-cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1 CQRS とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#182-event-sourcing" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2 Event Sourcing とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#183" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3 ヘキサゴナルアーキテクチャとの統合
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#184" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.4 技術スタック
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.4 技術スタック">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildgradlekts" class="md-nav__link">
    <span class="md-ellipsis">
      
        build.gradle.kts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#185" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.5 ディレクトリ構造
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#186-axon" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.6 Axon 設定クラス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#187-mybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.7 MyBatis 設定クラス
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#19" class="md-nav__link">
    <span class="md-ellipsis">
      
        第19章：ドメインモデルとイベント設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第19章：ドメインモデルとイベント設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#191-order-bounded-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        19.1 Order Bounded Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="19.1 Order Bounded Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        状態遷移図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント一覧
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#192-api-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        19.2 イベント定義（API Layer）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="19.2 イベント定義（API Layer）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sealed-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        sealed interface によるイベントの型安全性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#record" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント record の実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#193-domain-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        19.3 コマンド定義（Domain Layer）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#194-java" class="md-nav__link">
    <span class="md-ellipsis">
      
        19.4 ドメインモデル（純粋な Java）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#195-inventory-bounded-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        19.5 Inventory Bounded Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="19.5 Inventory Bounded Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        ドメインモデル
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20aggregate-adapter-policy-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        第20章：Aggregate Adapter と Policy Handler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第20章：Aggregate Adapter と Policy Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#201-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1 Aggregate Adapter パターン
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#202-order-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.2 Order Aggregate Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#203-stock-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3 Stock Aggregate Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#204-policy-handlerchoreography" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.4 Policy Handler（Choreography パターン）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#205-ordereventhandlerinventory-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.5 OrderEventHandler（Inventory Context 内）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#206-stockeventhandlerorder-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.6 StockEventHandler（Order Context 内）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#21projection-read-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        第21章：Projection と Read Model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第21章：Projection と Read Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-projection" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1 Projection の役割
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-order-projectionmybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.2 Order Projection（MyBatis 版）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-read-model-entity" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.3 Read Model Entity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-mybatis-mapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4 MyBatis Mapper インターフェース
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-mybatis-mapper-xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5 MyBatis Mapper XML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216-read-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.6 Read Model スキーマ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.7 最小限フィールドの原則
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        第22章：REST API と統合テスト
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第22章：REST API と統合テスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-rest-controllerinbound-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.1 REST Controller（Inbound Adapter）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-requestresponse-dto" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2 Request/Response DTO
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.3 API エンドポイント一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-axon-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4 Axon Test による単体テスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-10-f" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 10-F のまとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 10-F のまとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        実装した機能一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        アーキテクチャの特徴
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        設計上の特徴
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        技術スタック
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        API 形式の比較
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        CQRS/ES を選択する場面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter22-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 Axon CQRS/ESの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_18" >
        
          
          <label class="md-nav__link" for="__nav_1_18" id="__nav_1_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（FAS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（PMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="5-axon-cqrses">実践データベース設計：販売管理システム 研究 5 - Axon CQRS/ES の実装<a class="headerlink" href="#5-axon-cqrses" title="Permanent link">&para;</a></h1>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本研究では、REST API（第10部-A）、gRPC（研究 3）、GraphQL（研究 4）とは異なるアプローチとして、<strong>CQRS（Command Query Responsibility Segregation）</strong> と <strong>Event Sourcing</strong> による販売管理システムを実装します。Axon Framework を使用し、コマンド（書き込み）とクエリ（読み取り）を分離し、すべての状態変更をイベントとして記録するアーキテクチャを構築します。</p>
<p>研究 1 で構築したヘキサゴナルアーキテクチャの考え方を踏襲しつつ、<strong>ドメインモデルをフレームワークから分離</strong>し、Axon Aggregate Adapter を介して連携させます。Read Model の永続化には <strong>MyBatis</strong> を使用します。</p>
<hr />
<h2 id="18axon-cqrses">第18章：Axon CQRS/ES アーキテクチャの基礎<a class="headerlink" href="#18axon-cqrses" title="Permanent link">&para;</a></h2>
<h3 id="181-cqrs">18.1 CQRS とは<a class="headerlink" href="#181-cqrs" title="Permanent link">&para;</a></h3>
<p>CQRS（Command Query Responsibility Segregation）は、コマンド（書き込み）とクエリ（読み取り）の責務を分離するアーキテクチャパターンです。従来の CRUD 操作を単一のモデルで処理するのではなく、書き込み用のモデルと読み取り用のモデルを分けることで、それぞれに最適化された設計が可能になります。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjU5NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzMycHg7aGVpZ2h0OjU5NnB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMzMiA1OTYiIHdpZHRoPSIzMzJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTk2IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzMyIiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgQ29tbWFuZCBTaWRlIChXcml0ZSktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4iIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNOC41LDYgTDE4OC4yODAzLDYgQTMuNzUsMy43NSAwIDAgMSAxOTAuNzgwMyw4LjUgTDE5Ny43ODAzLDI4LjI5NjkgTDE5Ny41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgMjAwLDMwLjc5NjkgTDIwMCwzNzkuNjkgQTIuNSwyLjUgMCAwIDEgMTk3LjUsMzgyLjE5IEw4LjUsMzgyLjE5IEEyLjUsMi41IDAgMCAxIDYsMzc5LjY5IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE5Ny43ODAzIiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc4Ljc4MDMiIHg9IjEwIiB5PSIyMC45OTUxIj5Db21tYW5kIFNpZGUgKFdyaXRlKTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgUXVlcnkgU2lkZSAoUmVhZCktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZSAuUmVhZC4iIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0iZW50MDAxMCI+PHBhdGggZD0iTTM4LjUsNDA2LjE5IEwxODMuNTgxMSw0MDYuMTkgQTMuNzUsMy43NSAwIDAgMSAxODYuMDgxMSw0MDguNjkgTDE5My4wODExLDQyOC40ODY5IEwzMjIuNSw0MjguNDg2OSBBMi41LDIuNSAwIDAgMSAzMjUsNDMwLjk4NjkgTDMyNSw1ODcuMjggQTIuNSwyLjUgMCAwIDEgMzIyLjUsNTg5Ljc4IEwzOC41LDU4OS43OCBBMi41LDIuNSAwIDAgMSAzNiw1ODcuMjggTDM2LDQwOC42OSBBMi41LDIuNSAwIDAgMSAzOC41LDQwNi4xOSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzYiIHgyPSIxOTMuMDgxMSIgeTE9IjQyOC40ODY5IiB5Mj0iNDI4LjQ4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ0LjA4MTEiIHg9IjQwIiB5PSI0MjEuMTg1MSI+UXVlcnkgU2lkZSAoUmVhZCk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkVTVCBDb250cm9sbGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4uUkVTVCBDb250cm9sbGVyIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkuNjM0OCIgeD0iNDQuMTgiIHk9IjQxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjU0LjE4IiB5PSI2My45OTUxIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQ29tbWFuZEdhdGV3YXktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUgLldyaXRlLi5Db21tYW5kR2F0ZXdheSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUzLjc5OTgiIHg9IjI2LjEiIHk9IjEzNy4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjc5OTgiIHg9IjM2LjEiIHk9IjE2MC4yOTUxIj5Db21tYW5kR2F0ZXdheTwvdGV4dD48L2c+PCEtLWVudGl0eSBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUgLldyaXRlLi5BZ2dyZWdhdGUiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDA2Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkzLjI4ODEiIHg9IjUyLjM2IiB5PSIyMzMuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My4yODgxIiB4PSI2Mi4zNiIgeT0iMjU2LjU4NTEiPkFnZ3JlZ2F0ZTwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSAuV3JpdGUuLkV2ZW50IFN0b3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwOCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDEuODY3MiIgeD0iNDcuMDciIHk9IjMyOS44OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjU3LjA3IiB5PSIzNTIuODg1MSI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuLlByb2plY3Rpb24iIGRhdGEtc291cmNlLWxpbmU9IjExIiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS43ODEzIiB4PSI1Mi4xMSIgeT0iNDQxLjE5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuNzgxMyIgeD0iNjIuMTEiIHk9IjQ2NC4xODUxIj5Qcm9qZWN0aW9uPC90ZXh0PjwvZz48IS0tZW50aXR5IFJlYWQgTW9kZWwgREItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJRdWVyeSBTaWRlIC5SZWFkLi5SZWFkIE1vZGVsIERCIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMTMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI3LjEyNiIgeD0iMTE1LjQ0IiB5PSI1MzcuNDgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuMTI2IiB4PSIxMjUuNDQiIHk9IjU2MC40NzUxIj5SZWFkIE1vZGVsIERCPC90ZXh0PjwvZz48IS0tZW50aXR5IE15QmF0aXMgTWFwcGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZSAuUmVhZC4uTXlCYXRpcyBNYXBwZXIiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAxNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzIuNDcxNyIgeD0iMTc2Ljc2IiB5PSI0NDEuMTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMTg2Ljc2IiB5PSI0NjQuMTg1MSI+TXlCYXRpcyBNYXBwZXI8L3RleHQ+PC9nPjwhLS1saW5rIFJFU1QgQ29udHJvbGxlciB0byBDb21tYW5kR2F0ZXdheS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA0IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImxuazUiPjxwYXRoIGQ9Ik0xMDcuOSw3Ny40NCBDMTA2LjgyLDk0LjM1IDEwNS41NzA5LDExMy45NzIxIDEwNC40OTA5LDEzMC45NTIxIiBmaWxsPSJub25lIiBpZD0iUkVTVCBDb250cm9sbGVyLXRvLUNvbW1hbmRHYXRld2F5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDQuMTEsMTM2Ljk0LDEwOC42NzMyLDEyOC4yMTIxLDEwNC40Mjc0LDEzMS45NTAxLDEwMC42ODk0LDEyNy43MDQyLDEwNC4xMSwxMzYuOTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQ29tbWFuZEdhdGV3YXkgdG8gQWdncmVnYXRlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDQiIGRhdGEtZW50aXR5LTI9ImVudDAwMDYiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0ibG5rNyI+PHBhdGggZD0iTTEwMi4yNywxNzMuNzQgQzEwMS41NSwxOTAuNjUgMTAwLjcxNDIsMjEwLjI2NTQgOTkuOTk0MiwyMjcuMjQ1NCIgZmlsbD0ibm9uZSIgaWQ9IkNvbW1hbmRHYXRld2F5LXRvLUFnZ3JlZ2F0ZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTkuNzQsMjMzLjI0LDEwNC4xMTc3LDIyNC40MTc1LDk5Ljk1MTgsMjI4LjI0NDUsOTYuMTI0OSwyMjQuMDc4Niw5OS43NCwyMzMuMjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQWdncmVnYXRlIHRvIEV2ZW50IFN0b3JlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMDgiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0ibG5rOSI+PHBhdGggZD0iTTk4LjgyLDI3MC4wNCBDOTguNjQsMjg2Ljk0IDk4LjQzMzYsMzA2LjU1MDMgOTguMjUzNiwzMjMuNTMwMyIgZmlsbD0ibm9uZSIgaWQ9IkFnZ3JlZ2F0ZS10by1FdmVudCBTdG9yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTguMTksMzI5LjUzLDEwMi4yODUyLDMyMC41NzI5LDk4LjI0MywzMjQuNTMwMyw5NC4yODU2LDMyMC40ODgxLDk4LjE5LDMyOS41MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBFdmVudCBTdG9yZSB0byBQcm9qZWN0aW9uLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDgiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImxuazEyIj48cGF0aCBkPSJNOTcuODQsMzY2LjYgQzk3LjY1LDM4Ni45OSA5Ny40MDU5LDQxNC40NDAzIDk3LjIxNTksNDM0LjgyMDMiIGZpbGw9Im5vbmUiIGlkPSJFdmVudCBTdG9yZS10by1Qcm9qZWN0aW9uIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5Ny4xNiw0NDAuODIsMTAxLjI0MzcsNDMxLjg1NzcsOTcuMjA2Niw0MzUuODIwMiw5My4yNDQxLDQzMS43ODMxLDk3LjE2LDQ0MC44MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBQcm9qZWN0aW9uIHRvIFJlYWQgTW9kZWwgREItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMSIgZGF0YS1lbnRpdHktMj0iZW50MDAxMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0ibG5rMTQiPjxwYXRoIGQ9Ik0xMTIuMDQsNDc3LjYzIEMxMjYuNzQsNDk0LjU0IDE0NS4wNzIyLDUxNS42MjMgMTU5Ljg0MjIsNTMyLjYwMyIgZmlsbD0ibm9uZSIgaWQ9IlByb2plY3Rpb24tdG8tUmVhZCBNb2RlbCBEQiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTYzLjc4LDUzNy4xMywxNjAuODkxMyw1MjcuNzE0MywxNjAuNDk4NSw1MzMuMzU3NSwxNTQuODU1Myw1MzIuOTY0NywxNjMuNzgsNTM3LjEzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFJFU1QgQ29udHJvbGxlciB0byBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDE1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJsbmsxNiI+PHBhdGggZD0iTTEzOC4wNiw3Ny42MiBDMTU4LjA0LDkxLjI2IDE4My4zNSwxMTIuMTEgMTk3LDEzNy4zIEMyNTMuMzQsMjQxLjI1IDI0OC42MzUxLDM4NC43MDU4IDI0NC45NzUxLDQzNS4wNDU4IiBmaWxsPSJub25lIiBpZD0iUkVTVCBDb250cm9sbGVyLXRvLU15QmF0aXMgTWFwcGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDQuNTQsNDQxLjAzLDI0OS4xODIxLDQzMi4zNDM4LDI0NC45MDI2LDQzNi4wNDMyLDI0MS4yMDMyLDQzMS43NjM2LDI0NC41NCw0NDEuMDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgTXlCYXRpcyBNYXBwZXIgdG8gUmVhZCBNb2RlbCBEQi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDE1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEzIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJsbmsxNyI+PHBhdGggZD0iTTIzMS4yNiw0NzcuNjMgQzIxOS43OSw0OTQuNTQgMjA1Ljc2ODYsNTE1LjE4NDkgMTk0LjI0ODYsNTMyLjE2NDkiIGZpbGw9Im5vbmUiIGlkPSJNeUJhdGlzIE1hcHBlci10by1SZWFkIE1vZGVsIERCIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxOTAuODgsNTM3LjEzLDE5OS4yNDMsNTMxLjkyOCwxOTMuNjg3MSw1MzIuOTkyNCwxOTIuNjIyOCw1MjcuNDM2NiwxOTAuODgsNTM3LjEzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjw/cGxhbnR1bWwtc3JjIFRPejFRbThuNDhObC1ITTNsVFkzVnE2ZXN6TkpXaGc1N2NHRnVzTzhTUkVQQzFqUjVsNl9EbkFuWXhKYUNkZGxjeVVSZVJDLWU2MEZCVlUxRlZiT256NEgyQktIbE42YVhXVG9uQk9wbWNVbDJ0T2l5QjhrUnEtZmEwbXExQkUyLW53elhqZmdXbGNkczRZbEN4WWVteHdpRncxVzd1TVQ4c2JXaUxaMnVPdmxDRDh0WmVydzVaQnJQZW9HSUw4MlZrVmliTC1mQ1RJSDlSZE5JUEZUY01JeXp6V0p3Ym5aWWtVMGhWMGZkTWhQZl9KOTl4a3RKUVhPYXVGdExWRlY2VE11bWNXN2czMjQ5QWZkdVMtaXdteTA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<p><strong>CQRS の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>スケーラビリティ</strong></td>
<td>読み取りと書き込みを独立してスケール可能</td>
</tr>
<tr>
<td><strong>パフォーマンス</strong></td>
<td>読み取りに最適化されたモデルで高速クエリ</td>
</tr>
<tr>
<td><strong>複雑性の分離</strong></td>
<td>書き込みロジックと読み取りロジックを独立して開発</td>
</tr>
<tr>
<td><strong>監査対応</strong></td>
<td>Event Sourcing と組み合わせて完全な履歴を保持</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="182-event-sourcing">18.2 Event Sourcing とは<a class="headerlink" href="#182-event-sourcing" title="Permanent link">&para;</a></h3>
<p>Event Sourcing は、アプリケーションの状態をイベントの連続として保存するパターンです。現在の状態を直接保存するのではなく、状態変更を表すイベントを記録し、必要に応じてイベントを再生して現在の状態を再構築します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUwMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDIycHg7aGVpZ2h0OjUwMnB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQyMiA1MDIiIHdpZHRoPSI0MjJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTAyIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNDIyIiB4PSIwIiB5PSIwIi8+PCEtLWVudGl0eSBDb21tYW5kLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTEuOTU1MSIgeD0iOTcuNDMiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MS45NTUxIiB4PSIxMDcuNDMiIHk9IjI5Ljk5NTEiPkNvbW1hbmQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQWdncmVnYXRlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQWdncmVnYXRlIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5My4yODgxIiB4PSI5Ni43NiIgeT0iMTIwLjI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuMjg4MSIgeD0iMTA2Ljc2IiB5PSIxNDMuMjg1MSI+QWdncmVnYXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBNb2RlbCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIwLjgwOTYiIHg9IjciIHk9IjIzMy41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC44MDk2IiB4PSIxNyIgeT0iMjU2LjU4NTEiPkRvbWFpbiBNb2RlbDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2MC4xMDY0IiB4PSI2NC4zNSIgeT0iMzQ2Ljg5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTA2NCIgeD0iNzQuMzUiIHk9IjM2OS44ODUxIj5FdmVudDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IFN0b3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDEuODY3MiIgeD0iMTExLjQ3IiB5PSI0NjAuMTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxMjEuNDciIHk9IjQ4My4xNzUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PCEtLWxpbmsgQ29tbWFuZCB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJsbms0Ij48cGF0aCBkPSJNMTQzLjQsNDMuNTMgQzE0My40LDY0LjMyIDE0My40LDkyLjkxIDE0My40LDExMy44MSIgZmlsbD0ibm9uZSIgaWQ9IkNvbW1hbmQtdG8tQWdncmVnYXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDMuNCwxMTkuODEsMTQ3LjQsMTEwLjgxLDE0My40LDExNC44MSwxMzkuNCwxMTAuODEsMTQzLjQsMTE5LjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuNTM1NyIgeD0iMTQ0LjQiIHk9Ijg2LjM1NjkiPjEuICYjMTI0Njc7JiMxMjUxMDsmIzEyNTMxOyYjMTI0ODk7JiMyMTQ2MzsmIzIwNDQ5OzwvdGV4dD48L2c+PCEtLWxpbmsgQWdncmVnYXRlIHRvIERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImxuazYiPjxwYXRoIGQ9Ik05Ni41LDE1My40MiBDODAuNjEsMTYwLjY1IDY0LjU4LDE3MS4yNyA1NS40LDE4Ni41OSBDNDYuOTEsMjAwLjc4IDQ5LjYwNTEsMjE0LjE1MzEgNTUuNTU1MSwyMjcuNzUzMSIgZmlsbD0ibm9uZSIgaWQ9IkFnZ3JlZ2F0ZS10by1Eb21haW4gTW9kZWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Ljk2LDIzMy4yNSw1OC4wMTczLDIyMy40MDEzLDU1Ljk1NTksMjI4LjY2OTIsNTAuNjg4LDIyNi42MDc5LDU3Ljk2LDIzMy4yNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni41MzU4IiB4PSI1Ni40IiB5PSIxOTkuNjU2OSI+Mi4gJiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOyYjMjM0NTU7JiMzNDg5Mjs8L3RleHQ+PC9nPjwhLS1saW5rIERvbWFpbiBNb2RlbCB0byBFdmVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImxuazgiPjxwYXRoIGQ9Ik03MS42MiwyNzAuMTMgQzc2LjY3LDI5MC45MSA4My42NDU1LDMxOS42NjkxIDg4LjcxNTUsMzQwLjU2OTEiIGZpbGw9Im5vbmUiIGlkPSJEb21haW4gTW9kZWwtdG8tRXZlbnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjkwLjEzLDM0Ni40LDkxLjg5NTUsMzM2LjcxMDcsODguOTUxMywzNDEuNTQwOSw4NC4xMjEsMzM4LjU5NjcsOTAuMTMsMzQ2LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC41MzU3IiB4PSI4My41MiIgeT0iMzEyLjk1NjkiPjMuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyOTk4MzsmIzI1MTA0OzwvdGV4dD48L2c+PCEtLWxpbmsgRXZlbnQgdG8gRXZlbnQgU3RvcmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNyIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJsbmsxMCI+PHBhdGggZD0iTTkwLjIzLDM4My40MSBDODcuOTIsMzk2Ljk0IDg2Ljg2LDQxNS43OCA5NC40LDQzMC4xOCBDMTAwLjkzLDQ0Mi42NiAxMDcuMzU1Miw0NDkuMjg5IDExOS4wNTUyLDQ1Ni42NjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudC10by1FdmVudCBTdG9yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI0LjEzLDQ1OS44NywxMTguNjUxOCw0NTEuNjg1MywxMTkuOTAxLDQ1Ny4yMDI1LDExNC4zODM4LDQ1OC40NTE3LDEyNC4xMyw0NTkuODciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuNTM1OCIgeD0iOTUuNCIgeT0iNDI2LjI0NjkiPjQuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyNzcwNDsmIzMyMTU0OyYjMjEyNzA7PC90ZXh0PjwvZz48IS0tbGluayBFdmVudCBTdG9yZSB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOSIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJsbmsxMSI+PHBhdGggZD0iTTE4NS4xLDQ2MC4wOSBDMTkzLjgyLDQ1Mi4wNyAyMDIuNzgsNDQxLjc0IDIwNy40LDQzMC4xOCBDMjQ3LjY3LDMyOS42OCAyNTYuMjQsMjgzLjIyIDIwNy40LDE4Ni41OSBDMjAxLjE4LDE3NC4yNyAxOTUuMDQ4NCwxNjcuNjk5IDE4My43OTg0LDE2MC4yMjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudCBTdG9yZS10by1BZ2dyZWdhdGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3OC44LDE1Ni45MSwxODQuMDg1LDE2NS4yMjA3LDE4Mi45NjU0LDE1OS42NzU4LDE4OC41MTAzLDE1OC41NTYyLDE3OC44LDE1Ni45MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3Mi41MzU4IiB4PSIyNDEuODkiIHk9IjMxMi45NTY5Ij41LiAmIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA4Nzc7JiMyOTk4MzsmIzY1Mjg4OyYjMjkzNjY7JiMyNDkwNzsmIzI0NDg5OyYjMjA4MDM7JiM2NTI4OTs8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIEF5eEVwMmo4QjRoQ0xLWkVwb3Q4cHFsREFtYWtnU245TElYQUpJdjlwNGxGSVVLZ1hZajlJYXBFSllfQUJ5ckJTU3hGb0l6SUs3UHAxSzRraGNaZF9EcFNuQm9LTTBMVE5KazVRQ1ZxekFCS3pDSUlyNVc1QW1MM0ZPTjdKUGlWRHl6eHQwbWFFdl9zSnQtb1ZvNE5pWGdtN2ZWeXRDSkNGME5WXzlKSzc5MHM4dzJzdmljRmN0T3lSa3Z6dEJKcFNWRFFDQmx2U1RGd2YtbGNsclpPbXVNYzFNb0FRbmRHMG8zam5ZMVJicG5rZFdjc2pVRnZiRmRGRVlQbW1VR0hRWE0ySV9BQm1FdXFHVE5uUkNFRXZ6amNGVXNQbmVNZzRERTNmZ1dRZHhScjBjcnhsd1ZaVVRVc1B3dFRKX1VqVkRoUV83dkY5bTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<p><strong>Event Sourcing の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>完全な履歴</strong></td>
<td>すべての状態変更が記録される</td>
</tr>
<tr>
<td><strong>監査証跡</strong></td>
<td>いつ、誰が、何を変更したかが明確</td>
</tr>
<tr>
<td><strong>時間旅行</strong></td>
<td>過去の任意の時点の状態を再構築可能</td>
</tr>
<tr>
<td><strong>イベント駆動</strong></td>
<td>他システムとの連携が容易</td>
</tr>
<tr>
<td><strong>デバッグ</strong></td>
<td>問題発生時にイベントを追跡可能</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="183">18.3 ヘキサゴナルアーキテクチャとの統合<a class="headerlink" href="#183" title="Permanent link">&para;</a></h3>
<p>本実装では、ヘキサゴナルアーキテクチャ（Ports &amp; Adapters）を採用し、ビジネスロジックを外部依存から分離します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjQ4NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTY0OHB4O2hlaWdodDo0ODZweDtiYWNrZ3JvdW5kOiNGRUZFRkU7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNjQ4IDQ4NiIgd2lkdGg9IjE2NDhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNDg2IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTY0OCIgeD0iMCIgeT0iMCIvPjwhLS1jbHVzdGVyIEhleGFnb25hbCBBcmNoaXRlY3R1cmUgKENRUlMvRVMgPyktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLiIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxwYXRoIGQ9Ik01MTMuMTYsNiBMODA1LjI2ODMsNiBBMy43NSwzLjc1IDAgMCAxIDgwNy43NjgzLDguNSBMODE0Ljc2ODMsMjguMjk2OSBMMTYzOS4xNiwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDE2NDEuNjYsMzAuNzk2OSBMMTY0MS42Niw0NzcuMzkgQTIuNSwyLjUgMCAwIDEgMTYzOS4xNiw0NzkuODkgTDUxMy4xNiw0NzkuODkgQTIuNSwyLjUgMCAwIDEgNTEwLjY2LDQ3Ny4zOSBMNTEwLjY2LDguNSBBMi41LDIuNSAwIDAgMSA1MTMuMTYsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTEwLjY2IiB4Mj0iODE0Ljc2ODMiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOTEuMTA4MyIgeD0iNTE0LjY2IiB5PSIyMC45OTUxIj5IZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIChDUVJTL0VTICYjMjkyNTY7KTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgSW5ib3VuZCBBZGFwdGVycy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkluYm91bmQgQWRhcHRlcnMiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDAzIj48cGF0aCBkPSJNNTczLjE2LDQ5IEw3MTUuNTU0NSw0OSBBMy43NSwzLjc1IDAgMCAxIDcxOC4wNTQ1LDUxLjUgTDcyNS4wNTQ1LDcxLjI5NjkgTDc1MC4xNiw3MS4yOTY5IEEyLjUsMi41IDAgMCAxIDc1Mi42Niw3My43OTY5IEw3NTIuNjYsMTQzLjggQTIuNSwyLjUgMCAwIDEgNzUwLjE2LDE0Ni4zIEw1NzMuMTYsMTQ2LjMgQTIuNSwyLjUgMCAwIDEgNTcwLjY2LDE0My44IEw1NzAuNjYsNTEuNSBBMi41LDIuNSAwIDAgMSA1NzMuMTYsNDkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjU3MC42NiIgeDI9IjcyNS4wNTQ1IiB5MT0iNzEuMjk2OSIgeTI9IjcxLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQxLjM5NDUiIHg9IjU3NC42NiIgeT0iNjMuOTk1MSI+SW5ib3VuZCBBZGFwdGVyczwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gQ29yZS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0iZW50MDAwNSI+PHBhdGggZD0iTTUzNy4xNiwxNzAuMyBMNjY4LjYyMzksMTcwLjMgQTMuNzUsMy43NSAwIDAgMSA2NzEuMTIzOSwxNzIuOCBMNjc4LjEyMzksMTkyLjU5NjkgTDEyNTAuMTYsMTkyLjU5NjkgQTIuNSwyLjUgMCAwIDEgMTI1Mi42NiwxOTUuMDk2OSBMMTI1Mi42Niw0NTMuMzkgQTIuNSwyLjUgMCAwIDEgMTI1MC4xNiw0NTUuODkgTDUzNy4xNiw0NTUuODkgQTIuNSwyLjUgMCAwIDEgNTM0LjY2LDQ1My4zOSBMNTM0LjY2LDE3Mi44IEEyLjUsMi41IDAgMCAxIDUzNy4xNiwxNzAuMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTM0LjY2IiB4Mj0iNjc4LjEyMzkiIHkxPSIxOTIuNTk2OSIgeTI9IjE5Mi41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC40NjM5IiB4PSI1MzguNjYiIHk9IjE4NS4yOTUxIj5BcHBsaWNhdGlvbiBDb3JlPC90ZXh0PjwvZz48IS0tY2x1c3RlciBBcHBsaWNhdGlvbiBMYXllci0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuQXBwbGljYXRpb24gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjExIiBpZD0iZW50MDAwNiI+PHBhdGggZD0iTTU2MS4xNiwyMTMuMyBMNzAwLjIyNTQsMjEzLjMgQTMuNzUsMy43NSAwIDAgMSA3MDIuNzI1NCwyMTUuOCBMNzA5LjcyNTQsMjM1LjU5NjkgTDEwODIuMTYsMjM1LjU5NjkgQTIuNSwyLjUgMCAwIDEgMTA4NC42NiwyMzguMDk2OSBMMTA4NC42NiwzMDguMDkgQTIuNSwyLjUgMCAwIDEgMTA4Mi4xNiwzMTAuNTkgTDU2MS4xNiwzMTAuNTkgQTIuNSwyLjUgMCAwIDEgNTU4LjY2LDMwOC4wOSBMNTU4LjY2LDIxNS44IEEyLjUsMi41IDAgMCAxIDU2MS4xNiwyMTMuMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTU4LjY2IiB4Mj0iNzA5LjcyNTQiIHkxPSIyMzUuNTk2OSIgeTI9IjIzNS41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOC4wNjU0IiB4PSI1NjIuNjYiIHk9IjIyOC4yOTUxIj5BcHBsaWNhdGlvbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgRG9tYWluIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5Eb21haW4gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjE3IiBpZD0iZW50MDAxMCI+PHBhdGggZD0iTTU2OS4xNiwzMzQuNTkgTDY3OC45Njc2LDMzNC41OSBBMy43NSwzLjc1IDAgMCAxIDY4MS40Njc2LDMzNy4wOSBMNjg4LjQ2NzYsMzU2Ljg4NjkgTDEwNjIuMTYsMzU2Ljg4NjkgQTIuNSwyLjUgMCAwIDEgMTA2NC42NiwzNTkuMzg2OSBMMTA2NC42Niw0MjkuMzkgQTIuNSwyLjUgMCAwIDEgMTA2Mi4xNiw0MzEuODkgTDU2OS4xNiw0MzEuODkgQTIuNSwyLjUgMCAwIDEgNTY2LjY2LDQyOS4zOSBMNTY2LjY2LDMzNy4wOSBBMi41LDIuNSAwIDAgMSA1NjkuMTYsMzM0LjU5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1NjYuNjYiIHgyPSI2ODguNDY3NiIgeTE9IjM1Ni44ODY5IiB5Mj0iMzU2Ljg4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjgwNzYiIHg9IjU3MC42NiIgeT0iMzQ5LjU4NTEiPkRvbWFpbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQVBJIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5BUEkgTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0iZW50MDAxNCI+PHBhdGggZD0iTTExMTEuMTYsMjEzLjMgTDExODcuMjMyMywyMTMuMyBBMy43NSwzLjc1IDAgMCAxIDExODkuNzMyMywyMTUuOCBMMTE5Ni43MzIzLDIzNS41OTY5IEwxMjI2LjE2LDIzNS41OTY5IEEyLjUsMi41IDAgMCAxIDEyMjguNjYsMjM4LjA5NjkgTDEyMjguNjYsMzA4LjA5IEEyLjUsMi41IDAgMCAxIDEyMjYuMTYsMzEwLjU5IEwxMTExLjE2LDMxMC41OSBBMi41LDIuNSAwIDAgMSAxMTA4LjY2LDMwOC4wOSBMMTEwOC42NiwyMTUuOCBBMi41LDIuNSAwIDAgMSAxMTExLjE2LDIxMy4zIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMTA4LjY2IiB4Mj0iMTE5Ni43MzIzIiB5MT0iMjM1LjU5NjkiIHkyPSIyMzUuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NS4wNzIzIiB4PSIxMTEyLjY2IiB5PSIyMjguMjk1MSI+QVBJIExheWVyPC90ZXh0PjwvZz48IS0tY2x1c3RlciBPdXRib3VuZCBBZGFwdGVycy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLk91dGJvdW5kIEFkYXB0ZXJzIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgaWQ9ImVudDAwMTYiPjxwYXRoIGQ9Ik0xMjc5LjE2LDMzNC41OSBMMTQzNC45MzkzLDMzNC41OSBBMy43NSwzLjc1IDAgMCAxIDE0MzcuNDM5MywzMzcuMDkgTDE0NDQuNDM5MywzNTYuODg2OSBMMTYxNS4xNiwzNTYuODg2OSBBMi41LDIuNSAwIDAgMSAxNjE3LjY2LDM1OS4zODY5IEwxNjE3LjY2LDQyOS4zOSBBMi41LDIuNSAwIDAgMSAxNjE1LjE2LDQzMS44OSBMMTI3OS4xNiw0MzEuODkgQTIuNSwyLjUgMCAwIDEgMTI3Ni42Niw0MjkuMzkgTDEyNzYuNjYsMzM3LjA5IEEyLjUsMi41IDAgMCAxIDEyNzkuMTYsMzM0LjU5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMjc2LjY2IiB4Mj0iMTQ0NC40MzkzIiB5MT0iMzU2Ljg4NjkiIHkyPSIzNTYuODg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTQuNzc5MyIgeD0iMTI4MC42NiIgeT0iMzQ5LjU4NTEiPk91dGJvdW5kIEFkYXB0ZXJzPC90ZXh0PjwvZz48IS0tZW50aXR5IFJFU1QgQ29udHJvbGxlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uSW5ib3VuZCBBZGFwdGVycy5SRVNUIENvbnRyb2xsZXIiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDA0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0OS42MzQ4IiB4PSI1ODYuODQiIHk9Ijg0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjcxNi40NzQ4IiB5PSI4OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNzE0LjQ3NDgiIHk9IjkxIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI3MTQuNDc0OCIgeT0iOTUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkuNjM0OCIgeD0iNjAxLjg0IiB5PSIxMTYuOTk1MSI+UkVTVCBDb250cm9sbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IEFnZ3JlZ2F0ZSBBZGFwdGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkFwcGxpY2F0aW9uIExheWVyLkFnZ3JlZ2F0ZSBBZGFwdGVyIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczLjUyNjQiIHg9IjU3NC45IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI3MjguNDI2NCIgeT0iMjUzLjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcyNi40MjY0IiB5PSIyNTUuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNzI2LjQyNjQiIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjUyNjQiIHg9IjU4OS45IiB5PSIyODEuMjk1MSI+QWdncmVnYXRlIEFkYXB0ZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5BcHBsaWNhdGlvbiBMYXllci5Qcm9qZWN0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA5Ljc4MTMiIHg9Ijc4My43NyIgeT0iMjQ4LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iODczLjU1MTMiIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI4NzEuNTUxMyIgeT0iMjU1LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijg3MS41NTEzIiB5PSIyNTkuMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9Ijc5OC43NyIgeT0iMjgxLjI5NTEiPlByb2plY3Rpb248L3RleHQ+PC9nPjwhLS1lbnRpdHkgUG9saWN5IEhhbmRsZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuQXBwbGljYXRpb24gTGF5ZXIuUG9saWN5IEhhbmRsZXIiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDAuMzQ0NyIgeD0iOTI4LjQ5IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxMDQ4LjgzNDciIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDQ2LjgzNDciIHk9IjI1NS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDQ2LjgzNDciIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAwLjM0NDciIHg9Ijk0My40OSIgeT0iMjgxLjI5NTEiPlBvbGljeSBIYW5kbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5Eb21haW4gTGF5ZXIuRG9tYWluIE1vZGVsIiBkYXRhLXNvdXJjZS1saW5lPSIxOCIgaWQ9ImVudDAwMTEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwLjgwOTYiIHg9IjU4Mi4yNiIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjcwMy4wNjk2IiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcwMS4wNjk2IiB5PSIzNzYuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcwMS4wNjk2IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDAuODA5NiIgeD0iNTk3LjI2IiB5PSI0MDIuNTg1MSI+RG9tYWluIE1vZGVsPC90ZXh0PjwvZz48IS0tZW50aXR5IENvbW1hbmRzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkRvbWFpbiBMYXllci5Db21tYW5kcyIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGlkPSJlbnQwMDEyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExOS4yNDkiIHg9Ijc1OC4wNCIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9Ijg1Ny4yODkiIHk9IjM3NC41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iODU1LjI4OSIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI4NTUuMjg5IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OS4yNDkiIHg9Ijc3My4wNCIgeT0iNDAyLjU4NTEiPkNvbW1hbmRzPC90ZXh0PjwvZz48IS0tZW50aXR5IFZhbHVlIE9iamVjdHMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuRG9tYWluIExheWVyLlZhbHVlIE9iamVjdHMiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBpZD0iZW50MDAxMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzYuODcyMSIgeD0iOTEyLjIyIiB5PSIzNjkuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTAyOS4wOTIxIiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjEwMjcuMDkyMSIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDI3LjA5MjEiIHk9IjM4MC41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2Ljg3MjEiIHg9IjkyNy4yMiIgeT0iNDAyLjU4NTEiPlZhbHVlIE9iamVjdHM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgRXZlbnRzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkFQSSBMYXllci5FdmVudHMiIGRhdGEtc291cmNlLWxpbmU9IjI0IiBpZD0iZW50MDAxNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4Ny40MDA0IiB4PSIxMTI0Ljk2IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxMTkyLjM2MDQiIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkwLjM2MDQiIHk9IjI1NS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkwLjM2MDQiIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDcuNDAwNCIgeD0iMTEzOS45NiIgeT0iMjgxLjI5NTEiPkV2ZW50czwvdGV4dD48L2c+PCEtLWVudGl0eSBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uT3V0Ym91bmQgQWRhcHRlcnMuTXlCYXRpcyBNYXBwZXIiIGRhdGEtc291cmNlLWxpbmU9IjI5IiBpZD0iZW50MDAxNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTIuNDcxNyIgeD0iMTI5Mi40MiIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE0MjQuODkxNyIgeT0iMzc0LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNDIyLjg5MTciIHk9IjM3Ni41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTQyMi44OTE3IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMTMwNy40MiIgeT0iNDAyLjU4NTEiPk15QmF0aXMgTWFwcGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IEV2ZW50IFN0b3JlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5PdXRib3VuZCBBZGFwdGVycy5FdmVudCBTdG9yZSIgZGF0YS1zb3VyY2UtbGluZT0iMzAiIGlkPSJlbnQwMDE4Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMS44NjcyIiB4PSIxNDc5LjczIiB5PSIzNjkuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTU4MS41OTcyIiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE1NzkuNTk3MiIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNTc5LjU5NzIiIHk9IjM4MC41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjE0OTQuNzMiIHk9IjQwMi41ODUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMjIiIGRhdGEtc291cmNlLWxpbmU9IjM5IiBpZD0iZW50MDAyMyI+PHBhdGggZD0iTTI4Mi4xOCwyNDMuNzUgTDI4Mi4xOCwyOTkuMTQ4NCBBMCwwIDAgMCAwIDI4Mi4xOCwyOTkuMTQ4NCBMNDQ0LjU3LDI5OS4xNDg0IEw2MDIuNzQsMzY5LjE4IEw0NTIuNTcsMjk5LjE0ODQgTDQ5NS4xMzMyLDI5OS4xNDg0IEEwLDAgMCAwIDAgNDk1LjEzMzIsMjk5LjE0ODQgTDQ5NS4xMzMyLDI1My43NSBMNDg1LjEzMzIsMjQzLjc1IEwyODIuMTgsMjQzLjc1IEEwLDAgMCAwIDAgMjgyLjE4LDI0My43NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTQ4NS4xMzMyLDI0My43NSBMNDg1LjEzMzIsMjUzLjc1IEw0OTUuMTMzMiwyNTMuNzUgTDQ4NS4xMzMyLDI0My43NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjI4OC4xOCIgeT0iMjYwLjgxNjkiPiYjMzIwMjA7JiMzMTg4MzsmIzEyMzk0OyYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjUxNDsmIzEyNDg3OyYjMTI1MjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5MS45NTMyIiB4PSIyODguMTgiIHk9IjI3NS45NDk3Ij5BeG9uIEZyYW1ld29yayAmIzEyMzk1OyYjMjAzODE7JiMyMzM4NDsmIzEyMzc1OyYjMTIzOTQ7JiMxMjM1Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjI4OC4xOCIgeT0iMjkxLjA4MjUiPiYjMTI0OTk7JiMxMjQ3MjsmIzEyNDkzOyYjMTI0NzM7JiMxMjUyNTsmIzEyNDcyOyYjMTI0ODM7JiMxMjQ2MzsmIzEyMzk4OyYjMTI0MTU7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4yNSIgZGF0YS1zb3VyY2UtbGluZT0iNDUiIGlkPSJlbnQwMDI2Ij48cGF0aCBkPSJNNiwyNDMuNzUgTDYsMjk5LjE0ODQgTDI0Ny4zMjA4LDI5OS4xNDg0IEwyNDcuMzIwOCwyNTMuNzUgTDIzNy4zMjA4LDI0My43NSBMNiwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yMzcuMzIwOCwyNDMuNzUgTDIzNy4zMjA4LDI1My43NSBMMjQ3LjMyMDgsMjUzLjc1IEwyMzcuMzIwOCwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTQuOTExNyIgeD0iMTIiIHk9IjI2MC44MTY5Ij5BeG9uICYjMjk5OTI7JiMxMjQ1MDsmIzEyNDgwOyYjMTI1MDM7JiMxMjQ3OTsmIzEyNTQwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjAuMzIwOCIgeD0iMTIiIHk9IjI3NS45NDk3Ij5AQWdncmVnYXRlLCBAQ29tbWFuZEhhbmRsZXI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU2LjAwMDIiIHg9IjEyIiB5PSIyOTEuMDgyNSI+JiMxMjUwMTsmIzEyNTI0OyYjMTI1NDA7JiMxMjUxMjsmIzEyNTI3OyYjMTI1NDA7JiMxMjQ2MzsmIzIwMzgxOyYjMjMzODQ7JiMxMjQzNDsmIzIxNTYwOyYjMjE0NTQ7PC90ZXh0PjwvZz48IS0tbGluayBSRVNUIENvbnRyb2xsZXIgdG8gQWdncmVnYXRlIEFkYXB0ZXItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAwNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjM0IiBpZD0ibG5rMTkiPjxwYXRoIGQ9Ik02NjEuNjYsMTMwLjcxIEM2NjEuNjYsMTYxLjYzIDY2MS42NiwyMTAuODUgNjYxLjY2LDI0MS44MSIgZmlsbD0ibm9uZSIgaWQ9IlJFU1QgQ29udHJvbGxlci10by1BZ2dyZWdhdGUgQWRhcHRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjYxLjY2LDI0Ny44MSw2NjUuNjYsMjM4LjgxLDY2MS42NiwyNDIuODEsNjU3LjY2LDIzOC44MSw2NjEuNjYsMjQ3LjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEFnZ3JlZ2F0ZSBBZGFwdGVyIHRvIERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA3IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzUiIGlkPSJsbmsyMCI+PHBhdGggZD0iTTY1OS45NywyOTQuODggQzY1OC4zNiwzMTYuMjEgNjU2LjM5OTYsMzQyLjEyNjkgNjU0Ljc5OTYsMzYzLjQxNjkiIGZpbGw9Im5vbmUiIGlkPSJBZ2dyZWdhdGUgQWRhcHRlci10by1Eb21haW4gTW9kZWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY1NC4zNSwzNjkuNCw2NTkuMDEzMiwzNjAuNzI1MSw2NTQuNzI0NywzNjQuNDE0MSw2NTEuMDM1NywzNjAuMTI1NSw2NTQuMzUsMzY5LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUHJvamVjdGlvbiB0byBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDE3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzYiIGlkPSJsbmsyMSI+PHBhdGggZD0iTTg2Ni4zNSwyOTQuOTkgQzg3OS4wNywzMDQuMDQgODk0LjgzLDMxMy41MSA5MTAuNjYsMzE4LjU5IEM5NDMuMjksMzI5LjA4IDEwMzAuNjksMzIyLjEgMTA2NC42NiwzMjYuNTkgQzExNDIuOTIsMzM2Ljk0IDEyMjUuMTU0MiwzNTUuMjk0NSAxMjg2LjI3NDIsMzcwLjM1NDUiIGZpbGw9Im5vbmUiIGlkPSJQcm9qZWN0aW9uLXRvLU15QmF0aXMgTWFwcGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMjkyLjEsMzcxLjc5LDEyODQuMzE4MywzNjUuNzUzLDEyODcuMjQ1MiwzNzAuNTkzOCwxMjgyLjQwNDQsMzczLjUyMDYsMTI5Mi4xLDM3MS43OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBHTU4yNSB0byBBZ2dyZWdhdGUgQWRhcHRlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDI2IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iYXNzb2NpYXRpb24iIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBpZD0ibG5rMjciPjxwYXRoIGQ9Ik0xNTQuMjEsMjQzLjQ0IEMxODAuMzgsMjE4LjQ2IDIyMS45NiwxODIuNzYgMjY0LjY2LDE2Mi4zIEMyNzEuODYsMTU4Ljg1IDI3NC4yMywxNTkuMTkgMjgyLjE2LDE1OC4zIEMzMjkuMiwxNTIuOTkgNDQ4LjEzLDE1Mi45OSA0OTUuMTYsMTU4LjMgQzU1Ni44LDE2NS4yNSA2MTMuMDEsMjE2Ljk2IDY0MS42OCwyNDguMDEiIGZpbGw9Im5vbmUiIGlkPSJHTU4yNS1BZ2dyZWdhdGUgQWRhcHRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48P3BsYW50dW1sLXNyYyBSTEJUUWpIMDVCd1ZmcFpNNm1NQlJvMkRRVmUzTkxqdFlwVWI1eEY5UjhteEVuQ2NpemY1MTlDSFIxNV9xNGd6QVFYdThUUXdlNXZLNEZpbW5zTFZtdmJpQjY1dG9TdDlkRV9sZDliQjRVaWFXYTRweUJVek13aVIwT0lTUFhkOWtlYjhnUTh6UURFbTZvbFA1djRsa0xIbVVJTG03bzZmUlQyT21TOFFzd0VuNTlJM2Z5QXhZTVFYeFlpNkxfcFJwVFJyZTBOWldfc2gyXzJtbmJXTlJJUzhOYUhKcExKY2tabERlQktEbFhIUUlTd1BzWU1GUVdtbEpOYUlLZnI4T0o2QUVTUlN2V09UQzVOZ1VONmlNNG1yLXMtcEl0UXNiQm5kdXJjVy12Nk1ETzByQWc4UGxzTlBlcWJUaEpmZW84WG5vX0xiaHNUdmNJdGxLRHZkaURic21qYkt3Z3RyY2FIbWR1YTllZXhQeEVpdm9zV0NSamZ2Q2NaR0Qyc0pic0hlUUpqeGZKMnBDNVhTbDA1cG52dXpjczJkWGdmalB6QVZKYTY0ajFmUWZZMHhxLXBucHlGbnpzVU9WcTVwV0VPMzVmX0dfNDNwNFNySkQyVjRzeEVOaXM4VjU3aVdMSFNtRl9keHZ0WHEtV3hwOHlWOWRuMHFSeDB1R19DU1lyemVKaWxRTzM3NF8xbGN2dUpQNUpkeEFXSGQ3THNjYzNEbHdKSy1fOG81VE4tQ3ZXWUJTcElfb1Q4NXpYZWlMSlRPdFJ2clZ1bGNncU1YVU96Y3c4ZllNNEtpTmV6VWRPclVsaFo4eTB5MD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>設計原則：</strong></p>
<ol>
<li><strong>ドメインモデルの純粋性</strong>: ドメインモデルは Axon に依存しない純粋な Java コード</li>
<li><strong>Aggregate Adapter</strong>: Axon Framework 用のアダプターを Application Layer に配置</li>
<li><strong>イベントは公開 API</strong>: イベントは他の Context から参照される公開 API として定義</li>
</ol>
<hr />
<h3 id="184">18.4 技術スタック<a class="headerlink" href="#184" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カテゴリ</th>
<th>技術</th>
<th>バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td>言語</td>
<td>Java</td>
<td>21</td>
</tr>
<tr>
<td>フレームワーク</td>
<td>Spring Boot</td>
<td>3.4.1</td>
</tr>
<tr>
<td>CQRS/ES</td>
<td>Axon Framework</td>
<td>4.10.3</td>
</tr>
<tr>
<td>ORM</td>
<td>MyBatis</td>
<td>3.0.4</td>
</tr>
<tr>
<td>API ドキュメント</td>
<td>SpringDoc OpenAPI</td>
<td>2.7.0</td>
</tr>
<tr>
<td>データベース</td>
<td>H2 (開発) / PostgreSQL (本番)</td>
<td>-</td>
</tr>
</tbody>
</table>
<h4 id="buildgradlekts">build.gradle.kts<a class="headerlink" href="#buildgradlekts" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: build.gradle.kts</summary>

<div class="highlight"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Spring Boot</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-validation&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Axon Framework</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-spring-boot-starter:4.10.3&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exclude</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;org.axonframework&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;axon-server-connector&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// MyBatis</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.4&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// OpenAPI</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springdoc:springdoc-openapi-starter-webmvc-ui:2.7.0&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Database</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;com.h2database:h2&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;org.postgresql:postgresql&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-test:4.10.3&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.mybatis.spring.boot:mybatis-spring-boot-starter-test:3.0.4&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="185">18.5 ディレクトリ構造<a class="headerlink" href="#185" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: ディレクトリ構成</summary>

<div class="highlight"><pre><span></span><code>src/main/java/com/example/sales/
├── app/                              # アプリケーション共通
│   └── RootController.java
├── config/                           # 設定クラス
│   ├── AxonConfig.java
│   ├── MyBatisConfig.java
│   └── OpenApiConfig.java
├── order/                            # Order Bounded Context
│   ├── api/
│   │   └── events/                   # 公開イベント API
│   │       ├── OrderEvent.java       # sealed interface
│   │       ├── OrderCreatedEvent.java
│   │       ├── OrderConfirmedEvent.java
│   │       └── OrderCancelledEvent.java
│   ├── adapter/
│   │   ├── inbound/rest/orders/      # Inbound Adapter (REST)
│   │   │   ├── OrdersController.java
│   │   │   └── protocol/             # Request/Response DTO
│   │   └── outbound/persistence/     # Outbound Adapter (MyBatis)
│   │       ├── entity/
│   │       │   └── OrderEntity.java
│   │       └── mapper/
│   │           └── OrderMapper.java
│   ├── application/
│   │   ├── aggregate/                # Axon Aggregate Adapter
│   │   │   └── OrderAggregateAdapter.java
│   │   ├── policy/                   # イベントハンドラー（Choreography）
│   │   │   └── StockEventHandler.java
│   │   └── query/                    # Projection
│   │       └── OrderProjection.java
│   └── domain/
│       └── model/aggregate/order/    # 純粋なドメインモデル
│           ├── Order.java
│           ├── OrderCommands.java
│           └── OrderStatus.java
└── inventory/                        # Inventory Bounded Context
    ├── api/events/
    │   ├── StockEvent.java
    │   ├── StockReservedEvent.java
    │   └── StockReservationFailedEvent.java
    ├── application/
    │   ├── aggregate/
    │   │   └── StockAggregateAdapter.java
    │   └── policy/
    │       └── OrderEventHandler.java
    └── domain/model/aggregate/stock/
        ├── Stock.java
        └── StockCommands.java

src/main/resources/
├── application.yml
├── schema.sql                        # Read Model スキーマ
└── mapper/
    └── OrderMapper.xml               # MyBatis マッパー XML
</code></pre></div>

</details>

<hr />
<h3 id="186-axon">18.6 Axon 設定クラス<a class="headerlink" href="#186-axon" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: AxonConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EmbeddedEventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.Serializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.json.JacksonSerializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Axon Framework 設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AxonConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JDBC ベースの Event Storage Engine</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="nf">eventStorageEngine</span><span class="p">(</span>
<span class="w">            </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">,</span>
<span class="w">            </span><span class="n">Serializer</span><span class="w"> </span><span class="n">serializer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JdbcEventStorageEngine</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">snapshotSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">eventSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">dataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Event Store</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStore</span><span class="w"> </span><span class="nf">eventStore</span><span class="p">(</span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="n">eventStorageEngine</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EmbeddedEventStore</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">storageEngine</span><span class="p">(</span><span class="n">eventStorageEngine</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JSON シリアライザー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Serializer</span><span class="w"> </span><span class="nf">eventSerializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JacksonSerializer</span><span class="p">.</span><span class="na">defaultSerializer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="187-mybatis">18.7 MyBatis 設定クラス<a class="headerlink" href="#187-mybatis" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: MyBatisConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.session.SqlSessionFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.SqlSessionFactoryBean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.annotation.MapperScan</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.core.io.support.PathMatchingResourcePatternResolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * MyBatis 設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@MapperScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;com.example.sales.order.adapter.outbound.persistence.mapper&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;com.example.sales.inventory.adapter.outbound.persistence.mapper&quot;</span>
<span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyBatisConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">sqlSessionFactory</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SqlSessionFactoryBean</span><span class="w"> </span><span class="n">factoryBean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBean</span><span class="p">();</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setMapperLocations</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">PathMatchingResourcePatternResolver</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">getResources</span><span class="p">(</span><span class="s">&quot;classpath:mapper/**/*.xml&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setTypeAliasesPackage</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;com.example.sales.order.adapter.outbound.persistence.entity,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;com.example.sales.inventory.adapter.outbound.persistence.entity&quot;</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">session</span><span class="p">.</span><span class="na">Configuration</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">session</span><span class="p">.</span><span class="na">Configuration</span><span class="p">();</span>
<span class="w">        </span><span class="n">configuration</span><span class="p">.</span><span class="na">setMapUnderscoreToCamelCase</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setConfiguration</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">getObject</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="19">第19章：ドメインモデルとイベント設計<a class="headerlink" href="#19" title="Permanent link">&para;</a></h2>
<h3 id="191-order-bounded-context">19.1 Order Bounded Context<a class="headerlink" href="#191-order-bounded-context" title="Permanent link">&para;</a></h3>
<p>注文の作成から配送完了までのライフサイクルを管理します。</p>
<h4 id="_2">状態遷移図<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNUQVRFIiBoZWlnaHQ9IjY2N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTg2cHg7aGVpZ2h0OjY2N3B4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDU4NiA2NjciIHdpZHRoPSI1ODZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNjY3IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNTg2IiB4PSIwIiB5PSIwIi8+PGVsbGlwc2UgY3g9IjM1MS42NyIgY3k9IjE2IiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODMuOTkxMiIgeD0iMzA5LjY3IiB5PSIxMDMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzMDkuNjciIHgyPSIzOTMuNjYxMiIgeTE9IjEyOS4yOTY5IiB5Mj0iMTI5LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2My45OTEyIiB4PSIzMTkuNjciIHk9IjEyMC45OTUxIj5QRU5ESU5HPC90ZXh0PjwvZz48Zz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwNC44ODE4IiB4PSIxNTMuMjIiIHk9IjIzMCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE1My4yMiIgeDI9IjI1OC4xMDE4IiB5MT0iMjU2LjI5NjkiIHkyPSIyNTYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0Ljg4MTgiIHg9IjE2My4yMiIgeT0iMjQ3Ljk5NTEiPkNPTkZJUk1FRDwvdGV4dD48L2c+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS41MDEiIHg9IjMwNi45MiIgeT0iMjMwIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzA2LjkyIiB4Mj0iMzk2LjQyMSIgeTE9IjI1Ni4yOTY5IiB5Mj0iMjU2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS41MDEiIHg9IjMxNi45MiIgeT0iMjQ3Ljk5NTEiPlJFSkVDVEVEPC90ZXh0PjwvZz48Zz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwIiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwMy42NzE5IiB4PSIyNjIuODMiIHk9IjQ4NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI2Mi44MyIgeDI9IjM2Ni41MDE5IiB5MT0iNTEwLjI5NjkiIHkyPSI1MTAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjY3MTkiIHg9IjI3Mi44MyIgeT0iNTAxLjk5NTEiPkNBTkNFTExFRDwvdGV4dD48L2c+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzAuMDYyNSIgeD0iNzMuNjMiIHk9IjM1NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjczLjYzIiB4Mj0iMjQzLjY5MjUiIHkxPSIzODMuMjk2OSIgeTI9IjM4My4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUwLjA2MjUiIHg9IjgzLjYzIiB5PSIzNzQuOTk1MSI+QVdBSVRJTkdfU0hJUE1FTlQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDUzNyIgeD0iMTYuNjQiIHk9IjQ4NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE2LjY0IiB4Mj0iOTYuNjkzNyIgeTE9IjUxMC4yOTY5IiB5Mj0iNTEwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wNTM3IiB4PSIyNi42NCIgeT0iNTAxLjk5NTEiPlNISVBQRUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTkuMzMxMSIgeD0iNyIgeT0iNjExIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNyIgeDI9IjEwNi4zMzExIiB5MT0iNjM3LjI5NjkiIHkyPSI2MzcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc5LjMzMTEiIHg9IjE3IiB5PSI2MjguOTk1MSI+REVMSVZFUkVEPC90ZXh0PjwvZz48IS0tbGluayAqc3RhcnQqIHRvIFBFTkRJTkctLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJsbms0Ij48cGF0aCBkPSJNMzUxLjY3LDI2LjM4IEMzNTEuNjcsNDMuMTEgMzUxLjY3LDcyLjU5IDM1MS42Nyw5Ni42MyIgZmlsbD0ibm9uZSIgaWQ9IipzdGFydCotdG8tUEVORElORyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzUxLjY3LDEwMi42MywzNTUuNjcsOTMuNjMsMzUxLjY3LDk3LjYzLDM0Ny42Nyw5My42MywzNTEuNjcsMTAyLjYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODguOTA1MyIgeD0iMzUyLjY3IiB5PSI2OS4wNjY5Ij5PcmRlckNyZWF0ZWQ8L3RleHQ+PC9nPjwhLS1saW5rIFBFTkRJTkcgdG8gQ09ORklSTUVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDUiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0ibG5rNiI+PHBhdGggZD0iTTMwOS40MywxNDAgQzI4NC44NSwxNDguMjggMjU0Ljg0LDE2MS45IDIzNC42NywxODMgQzIyMi4zMywxOTUuODkgMjE2LjU5NDUsMjA4Ljk2NDEgMjEyLjM2NDUsMjI0LjAwNDEiIGZpbGw9Im5vbmUiIGlkPSJQRU5ESU5HLXRvLUNPTkZJUk1FRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjEwLjc0LDIyOS43OCwyMTcuMDI3MywyMjIuMTk5MSwyMTIuMDkzNywyMjQuOTY2NywyMDkuMzI2MSwyMjAuMDMzMiwyMTAuNzQsMjI5Ljc4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0Ljg4ODciIHg9IjIzNS42NyIgeT0iMTk2LjA2NjkiPk9yZGVyQ29uZmlybWVkPC90ZXh0PjwvZz48IS0tbGluayBQRU5ESU5HIHRvIFJFSkVDVEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0ibG5rOCI+PHBhdGggZD0iTTM1MC4wMiwxNTMuNDUgQzM0OS40NywxNjIuNyAzNDguOTMsMTczLjMzIDM0OC42NywxODMgQzM0OC4yMywxOTguNTQgMzQ4LjU3ODcsMjA5Ljk5MTUgMzQ5LjQyODcsMjIzLjcwMTUiIGZpbGw9Im5vbmUiIGlkPSJQRU5ESU5HLXRvLVJFSkVDVEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNDkuOCwyMjkuNjksMzUzLjIzNTQsMjIwLjQ1OTcsMzQ5LjQ5MDYsMjI0LjY5OTYsMzQ1LjI1MDcsMjIwLjk1NDgsMzQ5LjgsMjI5LjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuMzA3MSIgeD0iMzQ5LjY3IiB5PSIxOTYuMDY2OSI+T3JkZXJSZWplY3RlZDwvdGV4dD48L2c+PCEtLWxpbmsgUEVORElORyB0byBDQU5DRUxMRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJsbmsxMCI+PHBhdGggZD0iTTM5NC4wMywxNDEuMzQgQzQxNC4zNSwxNDkuNjIgNDM2LjgsMTYyLjgxIDQ0OC42NywxODMgQzQ2MS42OCwyMDUuMTUgNTc5LjA4LDExNyA0MzEuNjcsNDA3IEM0MTUuMTMsNDM5LjUzIDM4OC4xMjMzLDQ2Mi42NTgzIDM2MS43NzMzLDQ4MC4zMjgzIiBmaWxsPSJub25lIiBpZD0iUEVORElORy10by1DQU5DRUxMRUQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM1Ni43OSw0ODMuNjcsMzY2LjQ5MjcsNDgxLjk3OTYsMzYwLjk0MjcsNDgwLjg4NTIsMzYyLjAzNzEsNDc1LjMzNTIsMzU2Ljc5LDQ4My42NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMS4wNzM3IiB4PSI0NzcuNzQiIHk9IjMyMy4wNjY5Ij5PcmRlckNhbmNlbGxlZDwvdGV4dD48L2c+PCEtLWxpbmsgQ09ORklSTUVEIHRvIEFXQUlUSU5HX1NISVBNRU5ULS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0ibG5rMTIiPjxwYXRoIGQ9Ik0xNzUuOTQsMjgwLjM0IEMxNjcuNzgsMjg4Ljc5IDE2MCwyOTguOTQgMTU1LjY3LDMxMCBDMTQ5LjksMzI0LjcgMTQ5LjcyNzgsMzM2LjUyMTMgMTUxLjkxNzgsMzUwLjYwMTMiIGZpbGw9Im5vbmUiIGlkPSJDT05GSVJNRUQtdG8tQVdBSVRJTkdfU0hJUE1FTlQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE1Mi44NCwzNTYuNTMsMTU1LjQwOTIsMzQ3LjAyMjIsMTUyLjA3MTUsMzUxLjU4OTQsMTQ3LjUwNDMsMzQ4LjI1MTcsMTUyLjg0LDM1Ni41MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS45OTMyIiB4PSIxNTYuNjciIHk9IjMyMy4wNjY5Ij5TaGlwbWVudFJlcXVlc3RlZDwvdGV4dD48L2c+PCEtLWxpbmsgQ09ORklSTUVEIHRvIENBTkNFTExFRC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA5IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImxuazEzIj48cGF0aCBkPSJNMjU4LjU2LDI3OC40MyBDMjcxLjcyLDI4Ni40OSAyODQuNDEsMjk2LjkyIDI5Mi42NywzMTAgQzMyNi45MSwzNjQuMjYgMzIzLjc4NjUsNDM3Ljg5MTcgMzE5LjA3NjUsNDc3LjYxMTciIGZpbGw9Im5vbmUiIGlkPSJDT05GSVJNRUQtdG8tQ0FOQ0VMTEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTguMzcsNDgzLjU3LDMyMy40MDIsNDc1LjEwMzYsMzE4Ljk1ODgsNDc4LjYwNDgsMzE1LjQ1NzYsNDc0LjE2MTYsMzE4LjM3LDQ4My41NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMS4wNzM3IiB4PSIzMjEuNDUiIHk9IjM4Ni41NjY5Ij5PcmRlckNhbmNlbGxlZDwvdGV4dD48L2c+PCEtLWxpbmsgQVdBSVRJTkdfU0hJUE1FTlQgdG8gU0hJUFBFRC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDExIiBkYXRhLWVudGl0eS0yPSJlbnQwMDE0IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImxuazE1Ij48cGF0aCBkPSJNODUuMjksNDA3LjM4IEM3Mi43LDQxNC44OSA2MS4yNSw0MjQuNTggNTMuNjcsNDM3IEM0NS4yNSw0NTAuOCA0NS4wMzA4LDQ2My4xODExIDQ4LjAwMDgsNDc3Ljc0MTEiIGZpbGw9Im5vbmUiIGlkPSJBV0FJVElOR19TSElQTUVOVC10by1TSElQUEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OS4yLDQ4My42Miw1MS4zMjA1LDQ3NC4wMDIxLDQ4LjIwMDcsNDc4LjcyMDksNDMuNDgxOSw0NzUuNjAxMSw0OS4yLDQ4My42MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkwLjAyODgiIHg9IjU0LjY3IiB5PSI0NTAuMDY2OSI+T3JkZXJTaGlwcGVkPC90ZXh0PjwvZz48IS0tbGluayBBV0FJVElOR19TSElQTUVOVCB0byBDQU5DRUxMRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMSIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0ibG5rMTYiPjxwYXRoIGQ9Ik0xNjIuODUsNDA3LjM1IEMxNjYuNTYsNDIyLjQ0IDE3My4zOCw0NDEuMyAxODUuNjcsNDU0IEMyMDYuMjYsNDc1LjI5IDIzMC43ODc3LDQ4Ni43Nzc5IDI1Ni44Mjc3LDQ5NC44Mjc5IiBmaWxsPSJub25lIiBpZD0iQVdBSVRJTkdfU0hJUE1FTlQtdG8tQ0FOQ0VMTEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNjIuNTYsNDk2LjYsMjU1LjE0MjksNDkwLjEyMDMsMjU3Ljc4MzEsNDk1LjEyMzMsMjUyLjc4MDEsNDk3Ljc2MzQsMjYyLjU2LDQ5Ni42IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAxLjA3MzciIHg9IjE4Ni42NyIgeT0iNDUwLjA2NjkiPk9yZGVyQ2FuY2VsbGVkPC90ZXh0PjwvZz48IS0tbGluayBTSElQUEVEIHRvIERFTElWRVJFRC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDE0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDE3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTEiIGlkPSJsbmsxOCI+PHBhdGggZD0iTTU2LjY3LDUzNC40IEM1Ni42Nyw1NTYuNDIgNTYuNjcsNTgyLjY2IDU2LjY3LDYwNC42NiIgZmlsbD0ibm9uZSIgaWQ9IlNISVBQRUQtdG8tREVMSVZFUkVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1Ni42Nyw2MTAuNjYsNjAuNjcsNjAxLjY2LDU2LjY3LDYwNS42Niw1Mi42Nyw2MDEuNjYsNTYuNjcsNjEwLjY2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTkuNjg5OSIgeD0iNTcuNjciIHk9IjU3Ny4wNjY5Ij5PcmRlckRlbGl2ZXJlZDwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgVlNyMTJ1OG02Q1Jua3Z6WXEydG0ydEc4UEJ4TUdmU2lnS0Q0QjdxaEt3VER4VkZkM2hMOFlmcXNWaXpfUlA2aEhjZlBhUERDWXVra1V2TkhrZ21yY0dIV1prRmlmbVZZa2RDSTBfU1BOdjBQTVVpQ0RUS2VFeW9TcnhDWFRDcTM5WUJtdHdYTXZybk5OcXAwMmNYWWJTMFJmZ0VNbm9jNHVLVEJnWEpCU2MzczZtRXpkU1VJT05OU0I1YVMwSy02bVVRUURuTWdKazJ6bnhPUlJWeDRucGFwQzlWT1NqRGxWazhfekxWN0MxejJqV0xYY096Yl9hMkRzSEMwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_3">イベント一覧<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>イベント</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OrderCreatedEvent</code></td>
<td>注文が作成された</td>
</tr>
<tr>
<td><code>OrderConfirmedEvent</code></td>
<td>注文が確定された（在庫確保成功）</td>
</tr>
<tr>
<td><code>OrderRejectedEvent</code></td>
<td>注文が拒否された（在庫確保失敗）</td>
</tr>
<tr>
<td><code>ShipmentRequestedEvent</code></td>
<td>出荷が依頼された</td>
</tr>
<tr>
<td><code>OrderShippedEvent</code></td>
<td>注文が出荷された</td>
</tr>
<tr>
<td><code>OrderDeliveredEvent</code></td>
<td>注文が配達された</td>
</tr>
<tr>
<td><code>OrderCancelledEvent</code></td>
<td>注文がキャンセルされた</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="192-api-layer">19.2 イベント定義（API Layer）<a class="headerlink" href="#192-api-layer" title="Permanent link">&para;</a></h3>
<h4 id="sealed-interface">sealed interface によるイベントの型安全性<a class="headerlink" href="#sealed-interface" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: OrderEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order イベントの sealed interface</span>
<span class="cm"> * すべての Order イベントの親インターフェース</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderEvent</span><span class="w"> </span><span class="n">permits</span>
<span class="w">        </span><span class="n">OrderCreatedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">OrderConfirmedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">OrderRejectedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">ShipmentRequestedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">OrderShippedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">OrderDeliveredEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">OrderCancelledEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">orderId</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>sealed interface の利点：</strong></p>
<ul>
<li><strong>網羅性チェック</strong>: switch 式でコンパイル時に全ケースをチェック</li>
<li><strong>型安全性</strong>: 許可されたクラスのみが実装可能</li>
<li><strong>ドキュメント</strong>: 存在するイベントが一目でわかる</li>
</ul>
<h4 id="record">イベント record の実装<a class="headerlink" href="#record" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: OrderCreatedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 注文作成イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">OrderCreatedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: OrderConfirmedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 注文確定イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">OrderConfirmedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">confirmedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: OrderCancelledEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 注文キャンセルイベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">OrderCancelledEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrderEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="193-domain-layer">19.3 コマンド定義（Domain Layer）<a class="headerlink" href="#193-domain-layer" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderCommands.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.TargetAggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order 集約へのコマンド定義</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderCommands</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">OrderCommands</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 注文作成コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CreateOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 注文確定コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ConfirmOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 注文拒否コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">RejectOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 出荷依頼コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">RequestShipmentCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 出荷コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ShipOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">trackingNumber</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 配達完了コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">DeliverOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセルコマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CancelOrderCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>@TargetAggregateIdentifier の役割：</strong></p>
<ul>
<li>Axon がコマンドをどの集約インスタンスにルーティングするかを決定</li>
<li>集約の一意識別子となるフィールドに付与</li>
</ul>
<hr />
<h3 id="194-java">19.4 ドメインモデル（純粋な Java）<a class="headerlink" href="#194-java" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: Order.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order ドメインモデル（Axon 非依存）</span>
<span class="cm"> * 純粋なビジネスロジックのみを含む</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">Order</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">status</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ======== ファクトリメソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 注文作成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// バリデーション</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">quantity</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Quantity must be positive&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">totalAmount</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Total amount must be positive&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderCreatedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">                </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">                </span><span class="n">productId</span><span class="p">,</span>
<span class="w">                </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">                </span><span class="n">totalAmount</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントからの再構築</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Order</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">customerId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">totalAmount</span><span class="p">(),</span>
<span class="w">                </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">PENDING</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== 状態遷移メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 注文確定</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderConfirmedEvent</span><span class="w"> </span><span class="nf">confirm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">PENDING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only pending orders can be confirmed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderConfirmedEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 注文拒否</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderRejectedEvent</span><span class="w"> </span><span class="nf">reject</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">PENDING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only pending orders can be rejected&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderRejectedEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 出荷依頼</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ShipmentRequestedEvent</span><span class="w"> </span><span class="nf">requestShipment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only confirmed orders can request shipment&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ShipmentRequestedEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 出荷</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderShippedEvent</span><span class="w"> </span><span class="nf">ship</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">AWAITING_SHIPMENT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only orders awaiting shipment can be shipped&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderShippedEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 配達完了</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderDeliveredEvent</span><span class="w"> </span><span class="nf">deliver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SHIPPED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only shipped orders can be delivered&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderDeliveredEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセル</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">OrderCancelledEvent</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SHIPPED</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">DELIVERED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Shipped or delivered orders cannot be cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Order is already cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">REJECTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Rejected orders cannot be cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderCancelledEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== イベント適用メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントを適用して新しい状態を生成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">OrderEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">OrderConfirmedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">OrderRejectedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">REJECTED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">ShipmentRequestedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">AWAITING_SHIPMENT</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">OrderShippedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">SHIPPED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">OrderDeliveredEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">DELIVERED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">OrderCancelledEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 状態更新ヘルパー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">withStatus</span><span class="p">(</span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">newStatus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Order</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">,</span><span class="w"> </span><span class="n">newStatus</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: OrderStatus.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 注文ステータス</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PENDING</span><span class="p">,</span><span class="w">           </span><span class="c1">// 保留中</span>
<span class="w">    </span><span class="n">CONFIRMED</span><span class="p">,</span><span class="w">         </span><span class="c1">// 確定</span>
<span class="w">    </span><span class="n">REJECTED</span><span class="p">,</span><span class="w">          </span><span class="c1">// 拒否</span>
<span class="w">    </span><span class="n">AWAITING_SHIPMENT</span><span class="p">,</span><span class="w"> </span><span class="c1">// 出荷待ち</span>
<span class="w">    </span><span class="n">SHIPPED</span><span class="p">,</span><span class="w">           </span><span class="c1">// 出荷済み</span>
<span class="w">    </span><span class="n">DELIVERED</span><span class="p">,</span><span class="w">         </span><span class="c1">// 配達済み</span>
<span class="w">    </span><span class="n">CANCELLED</span><span class="w">          </span><span class="c1">// キャンセル</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>ドメインモデル設計原則：</strong></p>
<table>
<thead>
<tr>
<th>原則</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Axon 非依存</strong></td>
<td>ドメインモデルにフレームワーク依存を持たせない</td>
</tr>
<tr>
<td><strong>イミュータブル</strong></td>
<td>record でイミュータブルに設計</td>
</tr>
<tr>
<td><strong>イベントを返す</strong></td>
<td>状態遷移メソッドはイベントを返す</td>
</tr>
<tr>
<td><strong>最小限のフィールド</strong></td>
<td>状態遷移の判定に必要な最小限のみ保持</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="195-inventory-bounded-context">19.5 Inventory Bounded Context<a class="headerlink" href="#195-inventory-bounded-context" title="Permanent link">&para;</a></h3>
<p>商品在庫の予約・確定・解放を管理します。</p>
<h4 id="_4">イベント定義<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: StockEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.inventory.api.events</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Stock イベントの sealed interface</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">StockEvent</span><span class="w"> </span><span class="n">permits</span>
<span class="w">        </span><span class="n">StockInitializedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">StockReservedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">StockReservationFailedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">StockDeductedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">StockReleasedEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">productId</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: StockReservedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.inventory.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 在庫予約成功イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">StockReservedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">reservedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">StockEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: StockReservationFailedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.inventory.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 在庫予約失敗イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">StockReservationFailedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">requestedQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">failedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">StockEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="_5">ドメインモデル<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: Stock.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.inventory.domain.model.aggregate.stock</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.inventory.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Stock ドメインモデル（在庫管理）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">Stock</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">totalQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reservations</span><span class="w">  </span><span class="c1">// orderId -&gt; quantity</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Stock</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">reservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservations</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">reservations</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 初期化ファクトリ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Stock</span><span class="w"> </span><span class="nf">initial</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">initialQuantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stock</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">initialQuantity</span><span class="p">,</span><span class="w"> </span><span class="n">initialQuantity</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 在庫予約（成功または失敗イベントを返す）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StockEvent</span><span class="w"> </span><span class="nf">reserve</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reservations</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">orderId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StockReservationFailedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;Order already has a reservation&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">availableQuantity</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StockReservationFailedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;Insufficient stock&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StockReservedEvent</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 在庫確定（出荷時）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StockDeductedEvent</span><span class="w"> </span><span class="nf">deduct</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">reservations</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">orderId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;No reservation found for order: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">orderId</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StockDeductedEvent</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 在庫解放（キャンセル時）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">StockReleasedEvent</span><span class="w"> </span><span class="nf">release</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">reservations</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">orderId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;No reservation found for order: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">orderId</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StockReleasedEvent</span><span class="p">(</span><span class="n">productId</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベント適用</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Stock</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">StockEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">StockInitializedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">initial</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">initialQuantity</span><span class="p">());</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">StockReservedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">newReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">reservations</span><span class="p">);</span>
<span class="w">                </span><span class="n">newReservations</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span>
<span class="w">                </span><span class="kd">yield</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Stock</span><span class="p">(</span>
<span class="w">                        </span><span class="n">productId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">totalQuantity</span><span class="p">,</span>
<span class="w">                        </span><span class="n">availableQuantity</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">newReservations</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">StockReservationFailedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">  </span><span class="c1">// 状態変更なし</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">StockDeductedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">newReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">reservations</span><span class="p">);</span>
<span class="w">                </span><span class="n">newReservations</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>
<span class="w">                </span><span class="kd">yield</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Stock</span><span class="p">(</span>
<span class="w">                        </span><span class="n">productId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">totalQuantity</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">availableQuantity</span><span class="p">,</span>
<span class="w">                        </span><span class="n">newReservations</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">StockReleasedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">newReservations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">reservations</span><span class="p">);</span>
<span class="w">                </span><span class="n">newReservations</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>
<span class="w">                </span><span class="kd">yield</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Stock</span><span class="p">(</span>
<span class="w">                        </span><span class="n">productId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">totalQuantity</span><span class="p">,</span>
<span class="w">                        </span><span class="n">availableQuantity</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">newReservations</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="20aggregate-adapter-policy-handler">第20章：Aggregate Adapter と Policy Handler<a class="headerlink" href="#20aggregate-adapter-policy-handler" title="Permanent link">&para;</a></h2>
<h3 id="201-aggregate-adapter">20.1 Aggregate Adapter パターン<a class="headerlink" href="#201-aggregate-adapter" title="Permanent link">&para;</a></h3>
<p>Aggregate Adapter は、純粋なドメインモデルと Axon Framework を繋ぐアダプター層です。フレームワーク固有のアノテーションやライフサイクル処理をドメインモデルから分離します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjUxMHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTc3cHg7aGVpZ2h0OjUxMHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDU3NyA1MTAiIHdpZHRoPSI1NzdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTEwIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNTc3IiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gTGF5ZXItLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQXBwbGljYXRpb24gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNOC41LDYgTDE0Ny41NjU0LDYgQTMuNzUsMy43NSAwIDAgMSAxNTAuMDY1NCw4LjUgTDE1Ny4wNjU0LDI4LjI5NjkgTDQzNy41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgNDQwLDMwLjc5NjkgTDQ0MCwyMDguNTUgQTIuNSwyLjUgMCAwIDEgNDM3LjUsMjExLjA1IEw4LjUsMjExLjA1IEEyLjUsMi41IDAgMCAxIDYsMjA4LjU1IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE1Ny4wNjU0IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM4LjA2NTQiIHg9IjEwIiB5PSIyMC45OTUxIj5BcHBsaWNhdGlvbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgRG9tYWluIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBMYXllciIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDA0Ij48cGF0aCBkPSJNMjg4LjUsMjYwLjA1IEwzOTguMzA3NiwyNjAuMDUgQTMuNzUsMy43NSAwIDAgMSA0MDAuODA3NiwyNjIuNTUgTDQwNy44MDc2LDI4Mi4zNDY5IEw1NjcuNSwyODIuMzQ2OSBBMi41LDIuNSAwIDAgMSA1NzAsMjg0Ljg0NjkgTDU3MCw0MTMuNyBBMi41LDIuNSAwIDAgMSA1NjcuNSw0MTYuMiBMMjg4LjUsNDE2LjIgQTIuNSwyLjUgMCAwIDEgMjg2LDQxMy43IEwyODYsMjYyLjU1IEEyLjUsMi41IDAgMCAxIDI4OC41LDI2MC4wNSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjg2IiB4Mj0iNDA3LjgwNzYiIHkxPSIyODIuMzQ2OSIgeTI9IjI4Mi4zNDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC44MDc2IiB4PSIyOTAiIHk9IjI3NS4wNDUxIj5Eb21haW4gTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbGFzcyBPcmRlckFnZ3JlZ2F0ZUFkYXB0ZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJBcHBsaWNhdGlvbiBMYXllci5PcmRlckFnZ3JlZ2F0ZUFkYXB0ZXIiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE1NC4wNDY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0MDIuMjk3OSIgeD0iMjEuODUiIHk9IjQxIi8+PGVsbGlwc2UgY3g9IjEzNC4xOTUyIiBjeT0iNjEuMTMyOCIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTM3LjE2NCw2Ni43NzM0IFExMzYuNTg1OCw2Ny4wNzAzIDEzNS45NDUyLDY3LjIxMDkgUTEzNS4zMDQ2LDY3LjM2NzIgMTM0LjYwMTUsNjcuMzY3MiBRMTMyLjEwMTUsNjcuMzY3MiAxMzAuNzczMyw2NS43MjY2IFExMjkuNDYwOCw2NC4wNzAzIDEyOS40NjA4LDYwLjk0NTMgUTEyOS40NjA4LDU3LjgyMDMgMTMwLjc3MzMsNTYuMTY0MSBRMTMyLjEwMTUsNTQuNTA3OCAxMzQuNjAxNSw1NC41MDc4IFExMzUuMzA0Niw1NC41MDc4IDEzNS45NDUyLDU0LjY2NDEgUTEzNi42MDE1LDU0LjgyMDMgMTM3LjE2NCw1NS4xMTcyIEwxMzcuMTY0LDU3LjgzNTkgUTEzNi41MzksNTcuMjU3OCAxMzUuOTQ1Miw1Ni45OTIyIFExMzUuMzUxNSw1Ni43MTA5IDEzNC43MjY1LDU2LjcxMDkgUTEzMy4zODI3LDU2LjcxMDkgMTMyLjY5NTIsNTcuNzg5MSBRMTMyLjAwNzcsNTguODUxNiAxMzIuMDA3Nyw2MC45NDUzIFExMzIuMDA3Nyw2My4wMzkxIDEzMi42OTUyLDY0LjExNzIgUTEzMy4zODI3LDY1LjE3OTcgMTM0LjcyNjUsNjUuMTc5NyBRMTM1LjM1MTUsNjUuMTc5NyAxMzUuOTQ1Miw2NC45MTQxIFExMzYuNTM5LDY0LjYzMjggMTM3LjE2NCw2NC4wNTQ3IEwxMzcuMTY0LDY2Ljc3MzQgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg5LjUwMiIgeD0iMTk0LjQ5NzkiIHk9IjU3LjEzODciPiYjMTcxO0BBZ2dyZWdhdGUmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY5LjEwNzQiIHg9IjE1NC42OTUyIiB5PSI3Mi45NjM5Ij5PcmRlckFnZ3JlZ2F0ZUFkYXB0ZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjIuODUiIHgyPSI0MjMuMTQ3OSIgeTE9IjgxLjI2NTYiIHkyPSI4MS4yNjU2Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQUklWQVRFX0ZJRUxEIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjYiIHN0eWxlPSJzdHJva2U6I0M4MjkzMDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2IiB4PSIyOS44NSIgeT0iOTEuOTE0MSIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDEuNTQxIiB4PSI0MS44NSIgeT0iOTguMjYwNyI+b3JkZXJJZDogU3RyaW5nPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFJJVkFURV9GSUVMRCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI2IiBzdHlsZT0ic3Ryb2tlOiNDODI5MzA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNiIgeD0iMjkuODUiIHk9IjEwOC4yMTA5Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg2Ljc3NTQiIHg9IjQxLjg1IiB5PSIxMTQuNTU3NiI+b3JkZXI6IE9yZGVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIyLjg1IiB4Mj0iNDIzLjE0NzkiIHkxPSIxMjEuODU5NCIgeTI9IjEyMS44NTk0Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzIuODUiIGN5PSIxMzUuNTA3OCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2Ny42OTgyIiB4PSI0MS44NSIgeT0iMTM4Ljg1NDUiPkBDb21tYW5kSGFuZGxlcjogaGFuZGxlKENyZWF0ZU9yZGVyQ29tbWFuZCk8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzIuODUiIGN5PSIxNTEuODA0NyIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM3Ni4yOTc5IiB4PSI0MS44NSIgeT0iMTU1LjE1MTQiPkBDb21tYW5kSGFuZGxlcjogaGFuZGxlKENvbmZpcm1PcmRlckNvbW1hbmQpPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX01FVEhPRCI+PGVsbGlwc2UgY3g9IjMyLjg1IiBjeT0iMTY4LjEwMTYiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNDQuMDM5MSIgeD0iNDEuODUiIHk9IjE3MS40NDgyIj5ARXZlbnRTb3VyY2luZ0hhbmRsZXI6IG9uKE9yZGVyQ3JlYXRlZEV2ZW50KTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19NRVRIT0QiPjxlbGxpcHNlIGN4PSIzMi44NSIgY3k9IjE4NC4zOTg0IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzYxLjI1MiIgeD0iNDEuODUiIHk9IjE4Ny43NDUxIj5ARXZlbnRTb3VyY2luZ0hhbmRsZXI6IG9uKE9yZGVyQ29uZmlybWVkRXZlbnQpPC90ZXh0PjwvZz48IS0tY2xhc3MgT3JkZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJEb21haW4gTGF5ZXIuT3JkZXIiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBpZD0iZW50MDAwNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMDUuMTU2MyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjUyLjUwMiIgeD0iMzAxLjc1IiB5PSIyOTUuMDUiLz48ZWxsaXBzZSBjeD0iMzk5LjAwNTkiIGN5PSIzMTUuMTgyOCIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNDAxLjk3NDYsMzIwLjgyMzQgUTQwMS4zOTY1LDMyMS4xMjAzIDQwMC43NTU5LDMyMS4yNjA5IFE0MDAuMTE1MiwzMjEuNDE3MiAzOTkuNDEyMSwzMjEuNDE3MiBRMzk2LjkxMjEsMzIxLjQxNzIgMzk1LjU4NCwzMTkuNzc2NiBRMzk0LjI3MTUsMzE4LjEyMDMgMzk0LjI3MTUsMzE0Ljk5NTMgUTM5NC4yNzE1LDMxMS44NzAzIDM5NS41ODQsMzEwLjIxNDEgUTM5Ni45MTIxLDMwOC41NTc4IDM5OS40MTIxLDMwOC41NTc4IFE0MDAuMTE1MiwzMDguNTU3OCA0MDAuNzU1OSwzMDguNzE0MSBRNDAxLjQxMjEsMzA4Ljg3MDMgNDAxLjk3NDYsMzA5LjE2NzIgTDQwMS45NzQ2LDMxMS44ODU5IFE0MDEuMzQ5NiwzMTEuMzA3OCA0MDAuNzU1OSwzMTEuMDQyMiBRNDAwLjE2MjEsMzEwLjc2MDkgMzk5LjUzNzEsMzEwLjc2MDkgUTM5OC4xOTM0LDMxMC43NjA5IDM5Ny41MDU5LDMxMS44MzkxIFEzOTYuODE4NCwzMTIuOTAxNiAzOTYuODE4NCwzMTQuOTk1MyBRMzk2LjgxODQsMzE3LjA4OTEgMzk3LjUwNTksMzE4LjE2NzIgUTM5OC4xOTM0LDMxOS4yMjk3IDM5OS41MzcxLDMxOS4yMjk3IFE0MDAuMTYyMSwzMTkuMjI5NyA0MDAuNzU1OSwzMTguOTY0MSBRNDAxLjM0OTYsMzE4LjY4MjggNDAxLjk3NDYsMzE4LjEwNDcgTDQwMS45NzQ2LDMyMC44MjM0IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1My40OTAyIiB4PSI0MTcuNTA1OSIgeT0iMzExLjE4ODciPiYjMTcxO3JlY29yZCYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MC4wMzEzIiB4PSI0MjQuMjM1NCIgeT0iMzI3LjAxMzkiPk9yZGVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMwMi43NSIgeDI9IjU1My4yNTIiIHkxPSIzMzUuMzE1NiIgeTI9IjMzNS4zMTU2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzAyLjc1IiB4Mj0iNTUzLjI1MiIgeTE9IjM0My4zMTU2IiB5Mj0iMzQzLjMxNTYiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19NRVRIT0QiPjxlbGxpcHNlIGN4PSIzMTIuNzUiIGN5PSIzNTYuOTY0MSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwMC42ODk1IiB4PSIzMjEuNzUiIHk9IjM2MC4zMTA3Ij5jcmVhdGUoKTogT3JkZXJDcmVhdGVkRXZlbnQ8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzEyLjc1IiBjeT0iMzczLjI2MDkiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjYuNTAyIiB4PSIzMjEuNzUiIHk9IjM3Ni42MDc2Ij5jb25maXJtKCk6IE9yZGVyQ29uZmlybWVkRXZlbnQ8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzEyLjc1IiBjeT0iMzg5LjU1NzgiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzguNTIzNCIgeD0iMzIxLjc1IiB5PSIzOTIuOTA0NSI+YXBwbHkoZXZlbnQpOiBPcmRlcjwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01ONyIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGlkPSJlbnQwMDA4Ij48cGF0aCBkPSJNNTMuNTIsMzI3LjQ5IEw1My41MiwzNjcuNzU1NiBBMCwwIDAgMCAwIDUzLjUyLDM2Ny43NTU2IEwyNjYuNDczMiwzNjcuNzU1NiBBMCwwIDAgMCAwIDI2Ni40NzMyLDM2Ny43NTU2IEwyNjYuNDczMiwzMzcuNDkgTDI1Ni40NzMyLDMyNy40OSBMMTY5LjM0LDMyNy40OSBMMjAxLjg1LDE5NS40NSBMMTYxLjM0LDMyNy40OSBMNTMuNTIsMzI3LjQ5IEEwLDAgMCAwIDAgNTMuNTIsMzI3LjQ5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjU2LjQ3MzIsMzI3LjQ5IEwyNTYuNDczMiwzMzcuNDkgTDI2Ni40NzMyLDMzNy40OSBMMjU2LjQ3MzIsMzI3LjQ5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTEuOTUzMiIgeD0iNTkuNTIiIHk9IjM0NC41NTY5Ij5BeG9uIEZyYW1ld29yayAmIzI5OTkyOyYjMTI0NTA7JiMxMjQ4MDsmIzEyNTAzOyYjMTI0Nzk7JiMxMjU0MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU2LjAwMDIiIHg9IjU5LjUyIiB5PSIzNTkuNjg5NyI+JiMxMjUwMTsmIzEyNTI0OyYjMTI1NDA7JiMxMjUxMjsmIzEyNTI3OyYjMTI1NDA7JiMxMjQ2MzsmIzIwMzgxOyYjMjMzODQ7JiMxMjQzNDsmIzIxNTYwOyYjMjE0NTQ7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4xMCIgZGF0YS1zb3VyY2UtbGluZT0iMzAiIGlkPSJlbnQwMDExIj48cGF0aCBkPSJNMzUyLjUsNDYzLjIgTDM1Mi41LDUwMy40NjU2IEEwLDAgMCAwIDAgMzUyLjUsNTAzLjQ2NTYgTDUwMy41MDAyLDUwMy40NjU2IEEwLDAgMCAwIDAgNTAzLjUwMDIsNTAzLjQ2NTYgTDUwMy41MDAyLDQ3My4yIEw0OTMuNTAwMiw0NjMuMiBMNDMyLDQ2My4yIEw0MjgsNDAwLjMyIEw0MjQsNDYzLjIgTDM1Mi41LDQ2My4yIEEwLDAgMCAwIDAgMzUyLjUsNDYzLjIiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00OTMuNTAwMiw0NjMuMiBMNDkzLjUwMDIsNDczLjIgTDUwMy41MDAyLDQ3My4yIEw0OTMuNTAwMiw0NjMuMiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjM1OC41IiB5PSI0ODAuMjY2OSI+JiMzMjAyMDsmIzMxODgzOyYjMTIzOTQ7JiMxMjQ4OTsmIzEyNTEzOyYjMTI0NTI7JiMxMjUzMTsmIzEyNTE0OyYjMTI0ODc7JiMxMjUyMzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0LjkxMTciIHg9IjM1OC41IiB5PSI0OTUuMzk5NyI+QXhvbiAmIzEyMzk1OyYjMjAzODE7JiMyMzM4NDsmIzEyMzc1OyYjMTIzOTQ7JiMxMjM1Njs8L3RleHQ+PC9nPjwhLS1saW5rIE9yZGVyQWdncmVnYXRlQWRhcHRlciB0byBPcmRlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjIiIGlkPSJsbms2Ij48cGF0aCBjb2RlTGluZT0iMjIiIGQ9Ik0yOTEuODMsMTk1LjQ1IEMzMjEuMjYsMjI4LjEyIDM1MC44MzM5LDI2MC45NjIzIDM3Ny4yOTM5LDI5MC4zMzIzIiBmaWxsPSJub25lIiBpZD0iT3JkZXJBZ2dyZWdhdGVBZGFwdGVyLXRvLU9yZGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzODEuMzEsMjk0Ljc5LDM3OC4yNTc3LDI4NS40MjYsMzc3Ljk2MzMsMjkxLjA3NTIsMzcyLjMxNDEsMjkwLjc4MDgsMzgxLjMxLDI5NC43OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2IiB4PSIzMzIuNjUiIHk9IjI0MC4xMTY5Ij4mIzIyOTk2OyYjMzU2OTg7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBaUEJWSVc5MTVDUmx2b2FFVGdFOEJvMFlZWWE1R0hTLW1SV3hSZWxrcDNBa2JLSUdFcTU0SzE2NnRHR0xHUDY5TzVycTRWS205eDc3UTdSTkZxS0lDR21TdmxwY1Y2VS1DdXNRcExxZ2dHQ0xRakdpQVBoU0I4WXdhQjFLQVdRQjQ1U2RnQ0tXYmRWVGtjckdwbk9TcmNZQm9IWmk0QURFNm1yT2JvUUpVU2tJcEE4VW92bEt6UFk0SjBQb2lxRjhQWk1VMFg2V2dzT1FvZndxa0pLeklLU3JJMTlvMVU0dWI5aWhValUzbjRPT24wa0l3SjhYREk0SVZ6NjJMc3RmX0NBQmN1bnhQVDZLWFhRVk5IOHk3ZjZYWFhiMl95NFphVGM1TlJ0Y1ZZcUJYemdCaEdnaWFTcEdCdXppSU84SEFpU0o0bi0tRG45YTh3NXYtZVVtMWdZVUpJbEVtWlFjTGVSVEI5dkNBZk1URDlBNnNFWWt5emFWbldaWEdlLWY4Wm5GRTIyZ1l1VEF5amp3XzJOek96WU1hM0tPVC14SGxxNnJYd2dCX1prZ0x1Qmc3RE1aWmIxVGVIZTRXSl91VUJpU3pJX0dGbmtUbGVuRVpXZFo5V0h3WXJOOS1CYXA3WHZYLW03TDhRZmh6NnpIRlE3SUdXVWVVYjRKc0V2RGdoUXgwVGRVZHJOejBXMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="202-order-aggregate-adapter">20.2 Order Aggregate Adapter<a class="headerlink" href="#202-order-aggregate-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderAggregateAdapter.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order.Order</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order.OrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.CommandHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.EventSourcingHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateLifecycle</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.spring.stereotype.Aggregate</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order Aggregate Adapter（Axon Framework 用）</span>
<span class="cm"> */</span>
<span class="nd">@Aggregate</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderAggregateAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@AggregateIdentifier</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Axon が使用するデフォルトコンストラクタ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="nf">OrderAggregateAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Command Handlers ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 集約作成コマンドハンドラー（コンストラクタ）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">OrderAggregateAdapter</span><span class="p">(</span><span class="n">CreateOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ドメインモデルのファクトリメソッドを呼び出し</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">customerId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">totalAmount</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// イベントを発行</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 確定コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ConfirmOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">confirm</span><span class="p">();</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 拒否コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">RejectOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">reject</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 出荷依頼コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">RequestShipmentCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">requestShipment</span><span class="p">();</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 出荷コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ShipOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">ship</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">trackingNumber</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 配達完了コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">DeliverOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">deliver</span><span class="p">();</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセルコマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">CancelOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">cancel</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Event Sourcing Handlers（状態復元）========</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Order</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderConfirmedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">ShipmentRequestedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderShippedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderDeliveredEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">order</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>Axon アノテーション解説：</strong></p>
<table>
<thead>
<tr>
<th>アノテーション</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Aggregate</code></td>
<td>Event Sourcing 集約であることを宣言</td>
</tr>
<tr>
<td><code>@AggregateIdentifier</code></td>
<td>集約の識別子フィールド</td>
</tr>
<tr>
<td><code>@CommandHandler</code></td>
<td>コマンドを処理するメソッド</td>
</tr>
<tr>
<td><code>@EventSourcingHandler</code></td>
<td>イベントから状態を復元するメソッド</td>
</tr>
<tr>
<td><code>AggregateLifecycle.apply()</code></td>
<td>イベントを発行するメソッド</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="203-stock-aggregate-adapter">20.3 Stock Aggregate Adapter<a class="headerlink" href="#203-stock-aggregate-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: StockAggregateAdapter.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.inventory.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.inventory.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.inventory.domain.model.aggregate.stock.Stock</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.inventory.domain.model.aggregate.stock.StockCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.CommandHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.EventSourcingHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateLifecycle</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.spring.stereotype.Aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Stock Aggregate Adapter</span>
<span class="cm"> */</span>
<span class="nd">@Aggregate</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StockAggregateAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@AggregateIdentifier</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Stock</span><span class="w"> </span><span class="n">stock</span><span class="p">;</span>

<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="nf">StockAggregateAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">StockAggregateAdapter</span><span class="p">(</span><span class="n">InitializeStockCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StockInitializedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">initialQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ReserveStockCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock</span><span class="p">.</span><span class="na">reserve</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">DeductStockCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock</span><span class="p">.</span><span class="na">deduct</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ReleaseStockCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock</span><span class="p">.</span><span class="na">release</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">StockInitializedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">productId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stock</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">initialQuantity</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">StockReservedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">StockReservationFailedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 状態変更なし</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">StockDeductedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">StockReleasedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="204-policy-handlerchoreography">20.4 Policy Handler（Choreography パターン）<a class="headerlink" href="#204-policy-handlerchoreography" title="Permanent link">&para;</a></h3>
<p>Policy Handler は、他の Bounded Context から発行されたイベントを購読し、自律的に反応する処理を実装します。Choreography パターンでは、各 Context が独立して動作し、イベントを介して連携します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjgyN3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjAxcHg7aGVpZ2h0OjgyN3B4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYwMSA4MjciIHdpZHRoPSI2MDFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iODI3IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjAxIiB4PSIwIiB5PSIwIi8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyMzIuNzM0NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNTc0LjY4MjYiIHg9IjEwIiB5PSIxOTYuODI4MSIvPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iT3JkZXIiIGlkPSJwYXJ0MS1saWZlbGluZSI+PGc+PHRpdGxlPk9yZGVyIENvbnRleHQ8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI3NTUuNTkzOCIgd2lkdGg9IjgiIHg9IjcyLjc4NjEiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI3NiIgeDI9Ijc2IiB5MT0iMzYuMjk2OSIgeTI9Ijc5MS44OTA2Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQtbGlmZWxpbmUiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkJ1cyIgaWQ9InBhcnQyLWxpZmVsaW5lIj48Zz48dGl0bGU+RXZlbnQgQnVzPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNzU1LjU5MzgiIHdpZHRoPSI4IiB4PSIyODYuNjMxOCIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjI5MC40Njc4IiB4Mj0iMjkwLjQ2NzgiIHkxPSIzNi4yOTY5IiB5Mj0iNzkxLjg5MDYiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSW52ZW50b3J5IiBpZD0icGFydDMtbGlmZWxpbmUiPjxnPjx0aXRsZT5JbnZlbnRvcnkgQ29udGV4dDwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9Ijc1NS41OTM4IiB3aWR0aD0iOCIgeD0iNTAwLjQ3NzUiIHk9IjM2LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI1MDQuMjcyNSIgeDI9IjUwNC4yNzI1IiB5MT0iMzYuMjk2OSIgeTI9Ijc5MS44OTA2Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iT3JkZXIiIGlkPSJwYXJ0MS1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMy41NzIzIiB4PSIyMCIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk5LjU3MjMiIHg9IjI3IiB5PSIyNC45OTUxIj5PcmRlciBDb250ZXh0PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iT3JkZXIiIGlkPSJwYXJ0MS10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExMy41NzIzIiB4PSIyMCIgeT0iNzkwLjg5MDYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OS41NzIzIiB4PSIyNyIgeT0iODEwLjg4NTciPk9yZGVyIENvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJCdXMiIGlkPSJwYXJ0Mi1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0LjMyODEiIHg9IjI0OC40Njc4IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjU1LjQ2NzgiIHk9IjI0Ljk5NTEiPkV2ZW50IEJ1czwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkJ1cyIgaWQ9InBhcnQyLXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODQuMzI4MSIgeD0iMjQ4LjQ2NzgiIHk9Ijc5MC44OTA2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjU1LjQ2NzgiIHk9IjgxMC44ODU3Ij5FdmVudCBCdXM8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJJbnZlbnRvcnkiIGlkPSJwYXJ0My1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC40MTAyIiB4PSI0MzQuMjcyNSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNi40MTAyIiB4PSI0NDEuMjcyNSIgeT0iMjQuOTk1MSI+SW52ZW50b3J5IENvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJJbnZlbnRvcnkiIGlkPSJwYXJ0My10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC40MTAyIiB4PSI0MzQuMjcyNSIgeT0iNzkwLjg5MDYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjYuNDEwMiIgeD0iNDQxLjI3MjUiIHk9IjgxMC44ODU3Ij5JbnZlbnRvcnkgQ29udGV4dDwvdGV4dD48L2c+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIzIiBzdHlsZT0ic3Ryb2tlOiNFRUVFRUU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNTk0LjY4MjYiIHg9IjAiIHk9IjY2Ljg2MzMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9IjU5NC42ODI2IiB5MT0iNjYuODYzMyIgeTI9IjY2Ljg2MzMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9IjU5NC42ODI2IiB5MT0iNjkuODYzMyIgeTI9IjY5Ljg2MzMiLz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjIzLjEzMjgiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjsiIHdpZHRoPSIxMDkuNTI2IiB4PSIyNDIuNTc4MyIgeT0iNTYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSIyNDguNTc4MyIgeT0iNzIuMzYzOCI+JiMyNzg4MDsmIzI1OTkxOyYjMjAzMTY7JiMyNTEwNDsmIzEyNTAxOyYjMTI1MjU7JiMxMjU0MDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzEiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjc4LjYzMTgsMTA2LjU2MjUsMjg4LjYzMTgsMTEwLjU2MjUsMjc4LjYzMTgsMTE0LjU2MjUsMjgyLjYzMTgsMTEwLjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzYuNzg2MSIgeDI9IjI4NC42MzE4IiB5MT0iMTEwLjU2MjUiIHkyPSIxMTAuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNi4xNDciIHg9IjgzLjc4NjEiIHk9IjEwNS40OTY2Ij5PcmRlckNyZWF0ZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzIiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDkyLjQ3NzUsMTM1LjY5NTMsNTAyLjQ3NzUsMTM5LjY5NTMsNDkyLjQ3NzUsMTQzLjY5NTMsNDk2LjQ3NzUsMTM5LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjkwLjYzMTgiIHgyPSI0OTguNDc3NSIgeTE9IjEzOS42OTUzIiB5Mj0iMTM5LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjYuMTQ3IiB4PSIyOTcuNjMxOCIgeT0iMTM0LjYyOTQiPk9yZGVyQ3JlYXRlZEV2ZW50PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQzIiBpZD0ibXNnMyI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjUwNC40Nzc1IiB4Mj0iNTQ2LjQ3NzUiIHkxPSIxNjguODI4MSIgeTI9IjE2OC44MjgxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU0Ni40Nzc1IiB4Mj0iNTQ2LjQ3NzUiIHkxPSIxNjguODI4MSIgeTI9IjE4MS44MjgxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjUwNS40Nzc1IiB4Mj0iNTQ2LjQ3NzUiIHkxPSIxODEuODI4MSIgeTI9IjE4MS44MjgxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MTUuNDc3NSwxNzcuODI4MSw1MDUuNDc3NSwxODEuODI4MSw1MTUuNDc3NSwxODUuODI4MSw1MTEuNDc3NSwxODEuODI4MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU5LjI5MzUiIHg9IjUxMS40Nzc1IiB5PSIxNjMuNzYyMiI+cmVzZXJ2ZSgpPC90ZXh0PjwvZz48cGF0aCBkPSJNMTAsMTk2LjgyODEgTDc0LjQ0MjksMTk2LjgyODEgTDc0LjQ0MjksMjAzLjk2MDkgTDY0LjQ0MjksMjEzLjk2MDkgTDEwLDIxMy45NjA5IEwxMCwxOTYuODI4MSIgZmlsbD0iI0VFRUVFRSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyMzIuNzM0NCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNTc0LjY4MjYiIHg9IjEwIiB5PSIxOTYuODI4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOS40NDI5IiB4PSIyNSIgeT0iMjA5Ljg5NSI+YWx0PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NC4wNTQ0IiB4PSI4OS40NDI5IiB5PSIyMDkuMDM4NiI+WyYjMjIzMTI7JiMyNDIzNTsmIzEyMzU0OyYjMTI0MjY7XTwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQyIiBpZD0ibXNnNCI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMDEuNjMxOCwyMzEuMDkzOCwyOTEuNjMxOCwyMzUuMDkzOCwzMDEuNjMxOCwyMzkuMDkzOCwyOTcuNjMxOCwyMzUuMDkzOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyOTUuNjMxOCIgeDI9IjUwMy40Nzc1IiB5MT0iMjM1LjA5MzgiIHkyPSIyMzUuMDkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNC4zMTAxIiB4PSIzMDcuNjMxOCIgeT0iMjMwLjAyNzgiPlN0b2NrUmVzZXJ2ZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzUiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODcuNzg2MSwyNjAuMjI2Niw3Ny43ODYxLDI2NC4yMjY2LDg3Ljc4NjEsMjY4LjIyNjYsODMuNzg2MSwyNjQuMjI2NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4MS43ODYxIiB4Mj0iMjg5LjYzMTgiIHkxPSIyNjQuMjI2NiIgeTI9IjI2NC4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM0LjMxMDEiIHg9IjkzLjc4NjEiIHk9IjI1OS4xNjA2Ij5TdG9ja1Jlc2VydmVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDEiIGlkPSJtc2c2Ij48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzYuNzg2MSIgeDI9IjExOC43ODYxIiB5MT0iMjkzLjM1OTQiIHkyPSIyOTMuMzU5NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTguNzg2MSIgeDI9IjExOC43ODYxIiB5MT0iMjkzLjM1OTQiIHkyPSIzMDYuMzU5NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3Ny43ODYxIiB4Mj0iMTE4Ljc4NjEiIHkxPSIzMDYuMzU5NCIgeTI9IjMwNi4zNTk0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4Ny43ODYxLDMwMi4zNTk0LDc3Ljc4NjEsMzA2LjM1OTQsODcuNzg2MSwzMTAuMzU5NCw4My43ODYxLDMwNi4zNTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTkuNjgwNyIgeD0iODMuNzg2MSIgeT0iMjg4LjI5MzUiPmNvbmZpcm0oKTwvdGV4dD48L2c+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjEwIiB4Mj0iNTg0LjY4MjYiIHkxPSIzMTUuMzU5NCIgeTI9IjMxNS4zNTk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU0LjA1NDQiIHg9IjE1IiB5PSIzMjUuNTY5OCI+WyYjMjIzMTI7JiMyNDIzNTsmIzEyMzk0OyYjMTIzNzU7XTwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQyIiBpZD0ibXNnNyI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMDEuNjMxOCwzNDYuMjk2OSwyOTEuNjMxOCwzNTAuMjk2OSwzMDEuNjMxOCwzNTQuMjk2OSwyOTcuNjMxOCwzNTAuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyOTUuNjMxOCIgeDI9IjUwMy40Nzc1IiB5MT0iMzUwLjI5NjkiIHkyPSIzNTAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4OS44NDU3IiB4PSIzMDcuNjMxOCIgeT0iMzQ1LjIzMSI+U3RvY2tSZXNlcnZhdGlvbkZhaWxlZEV2ZW50PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDIiIGRhdGEtZW50aXR5LTI9InBhcnQxIiBpZD0ibXNnOCI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4Ny43ODYxLDM3NS40Mjk3LDc3Ljc4NjEsMzc5LjQyOTcsODcuNzg2MSwzODMuNDI5Nyw4My43ODYxLDM3OS40Mjk3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgxLjc4NjEiIHgyPSIyODkuNjMxOCIgeTE9IjM3OS40Mjk3IiB5Mj0iMzc5LjQyOTciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODkuODQ1NyIgeD0iOTMuNzg2MSIgeT0iMzc0LjM2MzgiPlN0b2NrUmVzZXJ2YXRpb25GYWlsZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzkiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3Ni43ODYxIiB4Mj0iMTE4Ljc4NjEiIHkxPSI0MDguNTYyNSIgeTI9IjQwOC41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExOC43ODYxIiB4Mj0iMTE4Ljc4NjEiIHkxPSI0MDguNTYyNSIgeTI9IjQyMS41NjI1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc3Ljc4NjEiIHgyPSIxMTguNzg2MSIgeTE9IjQyMS41NjI1IiB5Mj0iNDIxLjU2MjUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg3Ljc4NjEsNDE3LjU2MjUsNzcuNzg2MSw0MjEuNTYyNSw4Ny43ODYxLDQyNS41NjI1LDgzLjc4NjEsNDIxLjU2MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0Ny4zNDA4IiB4PSI4My43ODYxIiB5PSI0MDMuNDk2NiI+cmVqZWN0KCk8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjU5NC42ODI2IiB4PSIwIiB5PSI0NTcuMTI4OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiIHgxPSIwIiB4Mj0iNTk0LjY4MjYiIHkxPSI0NTcuMTI4OSIgeTI9IjQ1Ny4xMjg5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI1OTQuNjgyNiIgeTE9IjQ2MC4xMjg5IiB5Mj0iNDYwLjEyODkiLz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjIzLjEzMjgiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjsiIHdpZHRoPSI4My41MjYiIHg9IjI1NS41NzgzIiB5PSI0NDYuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIyNjEuNTc4MyIgeT0iNDYyLjYyOTQiPiYjMjA5ODY7JiMzMzY1NTsmIzEyNTAxOyYjMTI1MjU7JiMxMjU0MDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzEwIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI3OC42MzE4LDQ5Ni44MjgxLDI4OC42MzE4LDUwMC44MjgxLDI3OC42MzE4LDUwNC44MjgxLDI4Mi42MzE4LDUwMC44MjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc2Ljc4NjEiIHgyPSIyODQuNjMxOCIgeTE9IjUwMC44MjgxIiB5Mj0iNTAwLjgyODEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjcuMjcwNSIgeD0iODMuNzg2MSIgeT0iNDk1Ljc2MjIiPk9yZGVyU2hpcHBlZEV2ZW50PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDIiIGRhdGEtZW50aXR5LTI9InBhcnQzIiBpZD0ibXNnMTEiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDkyLjQ3NzUsNTI1Ljk2MDksNTAyLjQ3NzUsNTI5Ljk2MDksNDkyLjQ3NzUsNTMzLjk2MDksNDk2LjQ3NzUsNTI5Ljk2MDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjkwLjYzMTgiIHgyPSI0OTguNDc3NSIgeTE9IjUyOS45NjA5IiB5Mj0iNTI5Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjcuMjcwNSIgeD0iMjk3LjYzMTgiIHk9IjUyNC44OTUiPk9yZGVyU2hpcHBlZEV2ZW50PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQzIiBpZD0ibXNnMTIiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1MDQuNDc3NSIgeDI9IjU0Ni40Nzc1IiB5MT0iNTU5LjA5MzgiIHkyPSI1NTkuMDkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1NDYuNDc3NSIgeDI9IjU0Ni40Nzc1IiB5MT0iNTU5LjA5MzgiIHkyPSI1NzIuMDkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1MDUuNDc3NSIgeDI9IjU0Ni40Nzc1IiB5MT0iNTcyLjA5MzgiIHkyPSI1NzIuMDkzOCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTE1LjQ3NzUsNTY4LjA5MzgsNTA1LjQ3NzUsNTcyLjA5MzgsNTE1LjQ3NzUsNTc2LjA5MzgsNTExLjQ3NzUsNTcyLjA5MzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS4xMjk0IiB4PSI1MTEuNDc3NSIgeT0iNTU0LjAyNzgiPmRlZHVjdCgpPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQyIiBpZD0ibXNnMTMiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzAxLjYzMTgsNTk3LjIyNjYsMjkxLjYzMTgsNjAxLjIyNjYsMzAxLjYzMTgsNjA1LjIyNjYsMjk3LjYzMTgsNjAxLjIyNjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjk1LjYzMTgiIHgyPSI1MDMuNDc3NSIgeTE9IjYwMS4yMjY2IiB5Mj0iNjAxLjIyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzYuMjE0NCIgeD0iMzA3LjYzMTgiIHk9IjU5Ni4xNjA2Ij5TdG9ja0RlZHVjdGVkRXZlbnQ8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjU5NC42ODI2IiB4PSIwIiB5PSI2MjkuNzkzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI1OTQuNjgyNiIgeTE9IjYyOS43OTMiIHkyPSI2MjkuNzkzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI1OTQuNjgyNiIgeTE9IjYzMi43OTMiIHkyPSI2MzIuNzkzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMTIyLjUyNiIgeD0iMjM2LjA3ODMiIHk9IjYxOS4yMjY2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIyNDIuMDc4MyIgeT0iNjM1LjI5MzUiPiYjMTI0NjE7JiMxMjUxNTsmIzEyNTMxOyYjMTI0NzU7JiMxMjUyMzsmIzEyNTAxOyYjMTI1MjU7JiMxMjU0MDs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzE0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI3OC42MzE4LDY2OS40OTIyLDI4OC42MzE4LDY3My40OTIyLDI3OC42MzE4LDY3Ny40OTIyLDI4Mi42MzE4LDY3My40OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc2Ljc4NjEiIHgyPSIyODQuNjMxOCIgeTE9IjY3My40OTIyIiB5Mj0iNjczLjQ5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzguMzE1NCIgeD0iODMuNzg2MSIgeT0iNjY4LjQyNjMiPk9yZGVyQ2FuY2VsbGVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cxNSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OTIuNDc3NSw2OTguNjI1LDUwMi40Nzc1LDcwMi42MjUsNDkyLjQ3NzUsNzA2LjYyNSw0OTYuNDc3NSw3MDIuNjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI5MC42MzE4IiB4Mj0iNDk4LjQ3NzUiIHkxPSI3MDIuNjI1IiB5Mj0iNzAyLjYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOC4zMTU0IiB4PSIyOTcuNjMxOCIgeT0iNjk3LjU1OTEiPk9yZGVyQ2FuY2VsbGVkRXZlbnQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cxNiI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjUwNC40Nzc1IiB4Mj0iNTQ2LjQ3NzUiIHkxPSI3MzEuNzU3OCIgeTI9IjczMS43NTc4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU0Ni40Nzc1IiB4Mj0iNTQ2LjQ3NzUiIHkxPSI3MzEuNzU3OCIgeTI9Ijc0NC43NTc4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjUwNS40Nzc1IiB4Mj0iNTQ2LjQ3NzUiIHkxPSI3NDQuNzU3OCIgeTI9Ijc0NC43NTc4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MTUuNDc3NSw3NDAuNzU3OCw1MDUuNDc3NSw3NDQuNzU3OCw1MTUuNDc3NSw3NDguNzU3OCw1MTEuNDc3NSw3NDQuNzU3OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3LjgzMzUiIHg9IjUxMS40Nzc1IiB5PSI3MjYuNjkxOSI+cmVsZWFzZSgpPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQyIiBpZD0ibXNnMTciPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzAxLjYzMTgsNzY5Ljg5MDYsMjkxLjYzMTgsNzczLjg5MDYsMzAxLjYzMTgsNzc3Ljg5MDYsMjk3LjYzMTgsNzczLjg5MDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjk1LjYzMTgiIHgyPSI1MDMuNDc3NSIgeTE9Ijc3My44OTA2IiB5Mj0iNzczLjg5MDYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzIuODUwMSIgeD0iMzA3LjYzMTgiIHk9Ijc2OC44MjQ3Ij5TdG9ja1JlbGVhc2VkRXZlbnQ8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIFhQQXpKaUNtNThMdEZ1TEw1WFh1MFFHbTQ1ZzkyUWJ6MGZEU21DSXI4eVVmTzZtbzUyNFhpRzFCRHZRQVlnYTNLWWJGT25CbjYySW5jaWhxOXlmV3dQeEZ6bnBWdDJZV0YySUl6RjQ1eU84aEFNQmtrdTg5WVZTd3hWOTNnOTBMek1YOGtDQWpTLWMzbkF4VzJjdkwydkM4TG5LUlFXLVdFNHhZZzBBQXF2UkZVQWFCVU1WcmdRaThFR3hFUHZGeVBWSnBGU3hsZHRKd2hEQ0ZkSXdtdW8wSnVGMnVSOGtGWkJpaFdJWm1BcmpLcldqdlBSODlNZ2RfSzBhSG8wN2k3bzMyNUN4NmFzbS1yU0Q0OW1fczdVRlVLeThCa2tRQVJNellSWUpnNW9tUEpfMUJBbGs1OXgwOFFqRHRGTm5qQzJNQTJqdVhiM014aHc1aENJSlNXQVZBNURvbF9hNHNjbHktVlpQRWx0VERteDFmLVhRcVRWZS0tNzRMT1RrcEpvaldzUVNDZ1BDWXN2akVQcGh2cWtjcVVMUzh6dTJubmNzbmlIdHhtZTE0aTJEb3JuMmNxSHkwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="205-ordereventhandlerinventory-context">20.5 OrderEventHandler（Inventory Context 内）<a class="headerlink" href="#205-ordereventhandlerinventory-context" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderEventHandler.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.inventory.application.policy</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.inventory.domain.model.aggregate.stock.StockCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events.OrderCancelledEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events.OrderCreatedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events.OrderShippedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order イベントに反応して在庫操作を実行する Policy Handler</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderEventHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">OrderEventHandler</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When an order is created, reserve stock&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReserveStockCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">quantity</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When an order is shipped, deduct stock&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderShippedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeductStockCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">quantity</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When an order is cancelled, release stock&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReleaseStockCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">quantity</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="206-stockeventhandlerorder-context">20.6 StockEventHandler（Order Context 内）<a class="headerlink" href="#206-stockeventhandlerorder-context" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: StockEventHandler.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.application.policy</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.inventory.api.events.StockReservationFailedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.inventory.api.events.StockReservedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order.OrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Stock イベントに反応して注文状態を更新する Policy Handler</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StockEventHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">StockEventHandler</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When stock is reserved, confirm the order&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">StockReservedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConfirmOrderCommand</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When stock reservation fails, reject the order&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">StockReservationFailedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RejectOrderCommand</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>Policy Handler の設計原則：</strong></p>
<table>
<thead>
<tr>
<th>原則</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>単一責任</strong></td>
<td>1 つの Policy Handler は 1 つの関心事のみを扱う</td>
</tr>
<tr>
<td><strong>疎結合</strong></td>
<td>他の Context のイベントを購読し、自 Context のコマンドを発行</td>
</tr>
<tr>
<td><strong>自律性</strong></td>
<td>他のサービスに依存せず独立して動作</td>
</tr>
<tr>
<td><strong>冪等性</strong></td>
<td>同じイベントを複数回受信しても問題ないよう設計</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="21projection-read-model">第21章：Projection と Read Model<a class="headerlink" href="#21projection-read-model" title="Permanent link">&para;</a></h2>
<h3 id="211-projection">21.1 Projection の役割<a class="headerlink" href="#211-projection" title="Permanent link">&para;</a></h3>
<p>Projection は、イベントを購読して Read Model（クエリ用のデータモデル）を更新するコンポーネントです。CQRS では、書き込みモデル（Event Store）と読み取りモデル（Read Model DB）を分離し、それぞれに最適化されたデータ構造を使用します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjUzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzYxcHg7aGVpZ2h0OjUzNHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc2MSA1MzQiIHdpZHRoPSI3NjFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTM0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNzYxIiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDSCIgaWQ9InBhcnQxLWxpZmVsaW5lIj48Zz48dGl0bGU+Q29tbWFuZEhhbmRsZXI8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjcxLjU0IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNzUiIHgyPSI3NSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJFUyIgaWQ9InBhcnQyLWxpZmVsaW5lIj48Zz48dGl0bGU+RXZlbnQgU3RvcmU8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjIwMC4wMTM3IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMjAzLjA4MDEiIHgyPSIyMDMuMDgwMSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJQIiBpZD0icGFydDMtbGlmZWxpbmUiPjxnPjx0aXRsZT5Qcm9qZWN0aW9uPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSIzMDIuMDEzOCIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjMwNS4xMjMxIiB4Mj0iMzA1LjEyMzEiIHkxPSIzNi4yOTY5IiB5Mj0iNDk5LjI4OTEiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NCIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iTUIiIGlkPSJwYXJ0NC1saWZlbGluZSI+PGc+PHRpdGxlPk15QmF0aXMgTWFwcGVyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSI0MTcuMTQwMiIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjQyMC45MDQ0IiB4Mj0iNDIwLjkwNDQiIHkxPSIzNi4yOTY5IiB5Mj0iNDk5LjI4OTEiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iREIiIGlkPSJwYXJ0NS1saWZlbGluZSI+PGc+PHRpdGxlPlJlYWQgTW9kZWwgREI8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjU1MC45MzkxIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNTU0LjM3NjEiIHgyPSI1NTQuMzc2MSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ2IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJSQyIgaWQ9InBhcnQ2LWxpZmVsaW5lIj48Zz48dGl0bGU+UkVTVCBDb250cm9sbGVyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSI2ODMuMzE5NCIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjY4Ni41MDIiIHgyPSI2ODYuNTAyIiB5MT0iMzYuMjk2OSIgeTI9IjQ5OS4yODkxIi8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ0giIGlkPSJwYXJ0MS1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MS4wODAxIiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3LjA4MDEiIHg9IjEyIiB5PSIyNC45OTUxIj5Db21tYW5kSGFuZGxlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNIIiBpZD0icGFydDEtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDEuMDgwMSIgeD0iNSIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjcuMDgwMSIgeD0iMTIiIHk9IjUxOC4yODQyIj5Db21tYW5kSGFuZGxlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkVTIiBpZD0icGFydDItaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5NS44NjcyIiB4PSIxNTYuMDgwMSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjE2My4wODAxIiB5PSIyNC45OTUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkVTIiBpZD0icGFydDItdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5NS44NjcyIiB4PSIxNTYuMDgwMSIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxNjMuMDgwMSIgeT0iNTE4LjI4NDIiPkV2ZW50IFN0b3JlPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUCIgaWQ9InBhcnQzLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODMuNzgxMyIgeD0iMjY0LjEyMzEiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS43ODEzIiB4PSIyNzEuMTIzMSIgeT0iMjQuOTk1MSI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlAiIGlkPSJwYXJ0My10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjgzLjc4MTMiIHg9IjI2NC4xMjMxIiB5PSI0OTguMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9IjI3MS4xMjMxIiB5PSI1MTguMjg0MiI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDQiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ik1CIiBpZD0icGFydDQtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjYuNDcxNyIgeD0iMzU3LjkwNDQiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMzY0LjkwNDQiIHk9IjI0Ljk5NTEiPk15QmF0aXMgTWFwcGVyPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NCIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iTUIiIGlkPSJwYXJ0NC10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyNi40NzE3IiB4PSIzNTcuOTA0NCIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMzY0LjkwNDQiIHk9IjUxOC4yODQyIj5NeUJhdGlzIE1hcHBlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDUiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRCIiBpZD0icGFydDUtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEuMTI2IiB4PSI0OTQuMzc2MSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNy4xMjYiIHg9IjUwMS4zNzYxIiB5PSIyNC45OTUxIj5SZWFkIE1vZGVsIERCPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iREIiIGlkPSJwYXJ0NS10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMS4xMjYiIHg9IjQ5NC4zNzYxIiB5PSI0OTguMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNy4xMjYiIHg9IjUwMS4zNzYxIiB5PSI1MTguMjg0MiI+UmVhZCBNb2RlbCBEQjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDYiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlJDIiBpZD0icGFydDYtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjMuNjM0OCIgeD0iNjI1LjUwMiIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSI2MzIuNTAyIiB5PSIyNC45OTUxIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ2IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJSQyIgaWQ9InBhcnQ2LXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIzLjYzNDgiIHg9IjYyNS41MDIiIHk9IjQ5OC4yODkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjYzMi41MDIiIHk9IjUxOC4yODQyIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9Ijc1NC4xMzY4IiB4PSIwIiB5PSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjY2Ljg2MzMiIHkyPSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjY5Ljg2MzMiIHkyPSI2OS44NjMzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMjAxLjM2MzkiIHg9IjI3Ni4zODY1IiB5PSI1Ni4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4Ny4zNjM5IiB4PSIyODIuMzg2NSIgeT0iNzIuMzYzOCI+JiMyNjM2MDsmIzEyMzY1OyYjMzY3OTY7JiMxMjQxNTsmIzY1Mjg4O0NvbW1hbmQgU2lkZSYjNjUyODk7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5Mi4wMTM3LDEwNi41NjI1LDIwMi4wMTM3LDExMC41NjI1LDE5Mi4wMTM3LDExNC41NjI1LDE5Ni4wMTM3LDExMC41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc1LjU0IiB4Mj0iMTk4LjAxMzciIHkxPSIxMTAuNTYyNSIgeTI9IjExMC41NjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iODIuNTQiIHk9IjEwNS40OTY2Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA0NDU7JiMyMzM4NDs8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cyIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI5NC4wMTM4LDEzNS42OTUzLDMwNC4wMTM4LDEzOS42OTUzLDI5NC4wMTM4LDE0My42OTUzLDI5OC4wMTM4LDEzOS42OTUzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjIwNC4wMTM3IiB4Mj0iMzAwLjAxMzgiIHkxPSIxMzkuNjk1MyIgeTI9IjEzOS42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMjExLjAxMzciIHk9IjEzNC42Mjk0Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMzY4OTA7JiMzMDY5Mzs8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9Ijc1NC4xMzY4IiB4PSIwIiB5PSIxNjguMjYxNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiIHgxPSIwIiB4Mj0iNzU0LjEzNjgiIHkxPSIxNjguMjYxNyIgeTI9IjE2OC4yNjE3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjE3MS4yNjE3IiB5Mj0iMTcxLjI2MTciLz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjIzLjEzMjgiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjsiIHdpZHRoPSIxMzUuNTI2IiB4PSIzMDkuMzA1NCIgeT0iMTU3LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjMxNS4zMDU0IiB5PSIxNzMuNzYyMiI+JiMzNTUwMTsmIzEyNDE1OyYjMjE0NjI7JiMxMjQyNjsmIzEyNTE0OyYjMTI0ODc7JiMxMjUyMzsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDQiIGlkPSJtc2czIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwOS4xNDAyLDIwNy45NjA5LDQxOS4xNDAyLDIxMS45NjA5LDQwOS4xNDAyLDIxNS45NjA5LDQxMy4xNDAyLDIxMS45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMwNi4wMTM4IiB4Mj0iNDE1LjE0MDIiIHkxPSIyMTEuOTYwOSIgeTI9IjIxMS45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODcuMjQ4NSIgeD0iMzEzLjAxMzgiIHk9IjIwNi44OTUiPmluc2VydC91cGRhdGU8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NCIgZGF0YS1lbnRpdHktMj0icGFydDUiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU0Mi45MzkxLDIzNy4wOTM4LDU1Mi45MzkxLDI0MS4wOTM4LDU0Mi45MzkxLDI0NS4wOTM4LDU0Ni45MzkxLDI0MS4wOTM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQyMS4xNDAyIiB4Mj0iNTQ4LjkzOTEiIHkxPSIyNDEuMDkzOCIgeTI9IjI0MS4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuODU5NCIgeD0iNDI4LjE0MDIiIHk9IjIzNi4wMjc4Ij5TUUwgJiMyMzQ1NTsmIzM0ODkyOzwvdGV4dD48L2c+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIzIiBzdHlsZT0ic3Ryb2tlOiNFRUVFRUU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNzU0LjEzNjgiIHg9IjAiIHk9IjI2OS42NjAyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjI2OS42NjAyIiB5Mj0iMjY5LjY2MDIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9Ijc1NC4xMzY4IiB5MT0iMjcyLjY2MDIiIHkyPSIyNzIuNjYwMiIvPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMjMuMTMyOCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyOyIgd2lkdGg9IjE3Mi40NzU3IiB4PSIyOTAuODMwNiIgeT0iMjU5LjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU4LjQ3NTciIHg9IjI5Ni44MzA2IiB5PSIyNzUuMTYwNiI+JiMzNTUwMTsmIzEyNDE1OyYjMjE0NjI7JiMxMjQyNjsmIzY1Mjg4O1F1ZXJ5IFNpZGUmIzY1Mjg5OzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDYiIGRhdGEtZW50aXR5LTI9InBhcnQ0IiBpZD0ibXNnNSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MzIuMTQwMiwzMDkuMzU5NCw0MjIuMTQwMiwzMTMuMzU5NCw0MzIuMTQwMiwzMTcuMzU5NCw0MjguMTQwMiwzMTMuMzU5NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0MjYuMTQwMiIgeDI9IjY4Ni4zMTk0IiB5MT0iMzEzLjM1OTQiIHkyPSIzMTMuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzLjM3NzQiIHg9IjQzOC4xNDAyIiB5PSIzMDguMjkzNSI+ZmluZEJ5SWQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NCIgZGF0YS1lbnRpdHktMj0icGFydDUiIGlkPSJtc2c2Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU0Mi45MzkxLDMzOC40OTIyLDU1Mi45MzkxLDM0Mi40OTIyLDU0Mi45MzkxLDM0Ni40OTIyLDU0Ni45MzkxLDM0Mi40OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQyMS4xNDAyIiB4Mj0iNTQ4LjkzOTEiIHkxPSIzNDIuNDkyMiIgeTI9IjM0Mi40OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguOTQwNCIgeD0iNDI4LjE0MDIiIHk9IjMzNy40MjYzIj5TRUxFQ1Q8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NSIgZGF0YS1lbnRpdHktMj0icGFydDQiIGlkPSJtc2c3Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQzMi4xNDAyLDM2Ny42MjUsNDIyLjE0MDIsMzcxLjYyNSw0MzIuMTQwMiwzNzUuNjI1LDQyOC4xNDAyLDM3MS42MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDI2LjE0MDIiIHgyPSI1NTMuOTM5MSIgeTE9IjM3MS42MjUiIHkyPSIzNzEuNjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjQzOC4xNDAyIiB5PSIzNjYuNTU5MSI+JiMzMjA4MDsmIzI2NTI0OzwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQ0IiBkYXRhLWVudGl0eS0yPSJwYXJ0NiIgaWQ9Im1zZzgiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjc1LjMxOTQsMzk2Ljc1NzgsNjg1LjMxOTQsNDAwLjc1NzgsNjc1LjMxOTQsNDA0Ljc1NzgsNjc5LjMxOTQsNDAwLjc1NzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDIxLjE0MDIiIHgyPSI2ODEuMzE5NCIgeTE9IjQwMC43NTc4IiB5Mj0iNDAwLjc1NzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNy45NTI2IiB4PSI0MjguMTQwMiIgeT0iMzk1LjY5MTkiPkVudGl0eTwvdGV4dD48L2c+PHBhdGggZD0iTTMxMSw0MTMuNzU3OCBMMzExLDQ4My43NTc4IEw0NTEsNDgzLjc1NzggTDQ1MSw0MjMuNzU3OCBMNDQxLDQxMy43NTc4IEwzMTEsNDEzLjc1NzgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NDEsNDEzLjc1NzggTDQ0MSw0MjMuNzU3OCBMNDUxLDQyMy43NTc4IEw0NDEsNDEzLjc1NzgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjkyOTIiIHg9IjMxNyIgeT0iNDMwLjgyNDciPlByb2plY3Rpb24gJiMxMjM5OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjMxNyIgeT0iNDQ1Ljk1NzUiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMxMjQzNDsmIzM2MDkyOyYjMzU1MDE7JiMxMjM3NTsmIzEyMzkwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC40MDg3IiB4PSIzMTciIHk9IjQ2MS4wOTAzIj5NeUJhdGlzICYjMzIwNzY7JiMzMDAwMTsmIzEyMzkxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuNTQ1NSIgeD0iMzE3IiB5PSI0NzYuMjIzMSI+UmVhZCBNb2RlbCAmIzEyNDM0OyYjMjYzNTY7JiMyNjAzMjs8L3RleHQ+PD9wbGFudHVtbC1zcmMgUFA3QklXQ241OFJ0VU9nM2hpTXpLMVNwN1FkV0dFdHUwaDRKRFRlY0d2ZUF0SmNUWEhTS0hTSngxU0tCQUR2R21LTkhYdWN6a0Y4TEYxc2pUZkdtUDNaVlZfeHlvSWREUzE1R0hPaW1KbENwYXFnTVhNX0JXYkpHRS1JcTVvNjhEU19wVzBlREZST2k1Z2RtQ19XTGNFZTFNVzh4YXZHdWltbXRKcWw1T2t2dUlQdkxTZmhiRFBTWW5qYWFUSWlNclJtNEJXczJ4bURTQW9kOUNVZzNBdHJNV0JHTEF6OV81T3V0MWhPS01pYjI5c1JFOVlJTFdpUlVpbWJOTVl5cjR4di1yMVEteG1DVXp6YjdSSjZMOGRPNi1XT25EMG8wZ1B3UVFDVDQzb1BRVTdpemc1emw0d21acFZ3MXh0RXhwUUVwc0J6clVPdEV6VExES3Jxb3FPYzl2YXJxclRYeFI2cFUwUmZkcy1za1hWclNiOVpJX1VOMGZ2ZUhCMjU4anU0dEVXQnJjd0ZNeVY4X0dtbXlNY1FncVhLdFBfeXVKZDNYTXZMWEZzN2NaM1pzNkM3X2xld2ktUkpNRURvRkhMWjJfVzVtWEVRd0dlWUdjZTdZYXJDUXYwSEV2ZFRLT0M5UnFkcmJLcnJsRlRKWVM1aWNGMlVUa0pNVmJmaVJ6b1F5ODVyWkdsN040bjI2UnpxLXZIQzA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="212-order-projectionmybatis">21.2 Order Projection（MyBatis 版）<a class="headerlink" href="#212-order-projectionmybatis" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderProjection.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.application.query</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.outbound.persistence.entity.OrderEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.outbound.persistence.mapper.OrderMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order Projection（MyBatis を使用した Read Model の更新）</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderProjection</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">OrderProjection</span><span class="p">(</span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">orderMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderEntity</span><span class="p">();</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setOrderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCustomerId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">customerId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setProductId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">productId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setQuantity</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">quantity</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setTotalAmount</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">totalAmount</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;PENDING&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">createdAt</span><span class="p">());</span>

<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderConfirmedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;CONFIRMED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateConfirmedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">confirmedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;REJECTED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateRejection</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">rejectedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">ShipmentRequestedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;AWAITING_SHIPMENT&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateRequestedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">requestedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderShippedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;SHIPPED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateShipment</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">trackingNumber</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">shippedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderDeliveredEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;DELIVERED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateDeliveredAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">deliveredAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">OrderCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;CANCELLED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">updateCancellation</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">orderId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">cancelledAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="213-read-model-entity">21.3 Read Model Entity<a class="headerlink" href="#213-read-model-entity" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderEntity.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.outbound.persistence.entity</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order Read Model（表示用のすべてのフィールドを保持）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderEntity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">confirmedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">requestedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">shippedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">deliveredAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Getters and Setters</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getOrderId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setOrderId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCustomerId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCustomerId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">customerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getProductId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setProductId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">productId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getQuantity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setQuantity</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getTotalAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTotalAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">totalAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getStatus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getConfirmedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">confirmedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setConfirmedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">confirmedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">confirmedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confirmedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getRequestedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">requestedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRequestedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">requestedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">requestedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTrackingNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTrackingNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">trackingNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getShippedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">shippedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setShippedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">shippedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">shippedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shippedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getDeliveredAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">deliveredAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDeliveredAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">deliveredAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">deliveredAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deliveredAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancelledBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancellationReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancellationReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancellationReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCancelledAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRejectionReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectionReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectionReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getRejectedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCreatedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="214-mybatis-mapper">21.4 MyBatis Mapper インターフェース<a class="headerlink" href="#214-mybatis-mapper" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderMapper.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.outbound.persistence.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.outbound.persistence.entity.OrderEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Param</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order MyBatis Mapper</span>
<span class="cm"> */</span>
<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">OrderMapper</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// 挿入</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">OrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 検索</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">OrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByCustomerId</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;customerId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByStatus</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 更新</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateStatus</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateConfirmedAt</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;confirmedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">confirmedAt</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateRequestedAt</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;requestedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">requestedAt</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateShipment</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;trackingNumber&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;shippedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">shippedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateDeliveredAt</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;deliveredAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">deliveredAt</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateCancellation</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancelledBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancellationReason&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancelledAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateRejection</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;orderId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;rejectionReason&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;rejectedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="215-mybatis-mapper-xml">21.5 MyBatis Mapper XML<a class="headerlink" href="#215-mybatis-mapper-xml" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderMapper.xml</summary>

<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.sales.order.adapter.outbound.persistence.mapper.OrderMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;OrderEntity&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;orderId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;order_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;customerId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;customer_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;productId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;product_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;totalAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;total_amount&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;status&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;status&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;confirmedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;confirmed_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;requestedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;requested_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;trackingNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;tracking_number&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;shippedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;shipped_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;deliveredAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;delivered_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancelledBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancelled_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancellationReason&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancellation_reason&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancelledAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancelled_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;rejectionReason&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;rejection_reason&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;rejectedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;rejected_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;created_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;OrderEntity&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>orders<span class="w"> </span>(
<span class="w">            </span>order_id,<span class="w"> </span>customer_id,<span class="w"> </span>product_id,<span class="w"> </span>quantity,<span class="w"> </span>total_amount,
<span class="w">            </span>status,<span class="w"> </span>created_at
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{orderId},<span class="w"> </span>#{customerId},<span class="w"> </span>#{productId},<span class="w"> </span>#{quantity},<span class="w"> </span>#{totalAmount},
<span class="w">            </span>#{status},<span class="w"> </span>#{createdAt}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>orders<span class="w"> </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>orders<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByCustomerId&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>orders<span class="w"> </span>WHERE<span class="w"> </span>customer_id<span class="w"> </span>=<span class="w"> </span>#{customerId}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByStatus&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>orders<span class="w"> </span>WHERE<span class="w"> </span>status<span class="w"> </span>=<span class="w"> </span>#{status}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateStatus&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>orders<span class="w"> </span>SET<span class="w"> </span>status<span class="w"> </span>=<span class="w"> </span>#{status}<span class="w"> </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateConfirmedAt&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>orders<span class="w"> </span>SET<span class="w"> </span>confirmed_at<span class="w"> </span>=<span class="w"> </span>#{confirmedAt}<span class="w"> </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateRequestedAt&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>orders<span class="w"> </span>SET<span class="w"> </span>requested_at<span class="w"> </span>=<span class="w"> </span>#{requestedAt}<span class="w"> </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateShipment&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>orders
<span class="w">        </span>SET<span class="w"> </span>tracking_number<span class="w"> </span>=<span class="w"> </span>#{trackingNumber},<span class="w"> </span>shipped_at<span class="w"> </span>=<span class="w"> </span>#{shippedAt}
<span class="w">        </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateDeliveredAt&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>orders<span class="w"> </span>SET<span class="w"> </span>delivered_at<span class="w"> </span>=<span class="w"> </span>#{deliveredAt}<span class="w"> </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateCancellation&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>orders
<span class="w">        </span>SET<span class="w"> </span>cancelled_by<span class="w"> </span>=<span class="w"> </span>#{cancelledBy},
<span class="w">            </span>cancellation_reason<span class="w"> </span>=<span class="w"> </span>#{cancellationReason},
<span class="w">            </span>cancelled_at<span class="w"> </span>=<span class="w"> </span>#{cancelledAt}
<span class="w">        </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateRejection&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>orders
<span class="w">        </span>SET<span class="w"> </span>rejection_reason<span class="w"> </span>=<span class="w"> </span>#{rejectionReason},<span class="w"> </span>rejected_at<span class="w"> </span>=<span class="w"> </span>#{rejectedAt}
<span class="w">        </span>WHERE<span class="w"> </span>order_id<span class="w"> </span>=<span class="w"> </span>#{orderId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<hr />
<h3 id="216-read-model">21.6 Read Model スキーマ<a class="headerlink" href="#216-read-model" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: schema.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- Read Model: Orders テーブル</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">product_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">quantity</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_amount</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">confirmed_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">requested_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">tracking_number</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="n">shipped_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">delivered_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">cancelled_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">cancellation_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">cancelled_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">rejection_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">rejected_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_orders_customer_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">(</span><span class="n">customer_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_orders_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_orders_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">(</span><span class="n">created_at</span><span class="p">);</span>
</code></pre></div>

</details>

<hr />
<h3 id="217">21.7 最小限フィールドの原則<a class="headerlink" href="#217" title="Permanent link">&para;</a></h3>
<p>Event Sourcing では、ドメインモデルは「次のコマンドを処理するために必要な最小限の状態」のみを保持します。一方、Read Model は表示に必要なすべてのフィールドを保持します。</p>
<table>
<thead>
<tr>
<th>フィールド</th>
<th style="text-align: center;">ドメインモデル</th>
<th style="text-align: center;">Read Model</th>
<th>理由</th>
</tr>
</thead>
<tbody>
<tr>
<td>orderId</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>識別子として必要</td>
</tr>
<tr>
<td>status</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>状態遷移の判定に必要</td>
</tr>
<tr>
<td>confirmedAt</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>trackingNumber</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>cancelledBy</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>createdAt</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="22rest-api">第22章：REST API と統合テスト<a class="headerlink" href="#22rest-api" title="Permanent link">&para;</a></h2>
<h3 id="221-rest-controllerinbound-adapter">22.1 REST Controller（Inbound Adapter）<a class="headerlink" href="#221-rest-controllerinbound-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrdersController.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.inbound.rest.orders</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.inbound.rest.orders.protocol.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.outbound.persistence.mapper.OrderMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order.OrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.Operation</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.tags.Tag</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.ResponseEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletableFuture</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Order REST Controller（Inbound Adapter）</span>
<span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/orders&quot;</span><span class="p">)</span>
<span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Orders&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Order management API&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrdersController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">OrdersController</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">,</span><span class="w"> </span><span class="n">OrderMapper</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">orderMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Command Side (Write) ==========</span>

<span class="w">    </span><span class="nd">@PostMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Create a new order&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">OrderCreateResponse</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">OrderCreateRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateOrderCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">customerId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">productId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">quantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">totalAmount</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span>
<span class="w">                        </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CREATED</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderCreateResponse</span><span class="p">(</span><span class="n">orderId</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/request-shipment&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Request shipment for an order&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">requestShipment</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RequestShipmentCommand</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/ship&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Ship an order&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">ship</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">OrderShipRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ShipOrderCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">trackingNumber</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/deliver&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Deliver an order&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">deliver</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeliverOrderCommand</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/cancel&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cancel an order&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">OrderCancelRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CancelOrderCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Query Side (Read) ==========</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get an order by ID&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">OrderGetResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">OrderGetResponse</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">entity</span><span class="p">)))</span>
<span class="w">                </span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">notFound</span><span class="p">().</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get all orders&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">OrderListResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderMapper</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">OrderGetResponse</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderListResponse</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="222-requestresponse-dto">22.2 Request/Response DTO<a class="headerlink" href="#222-requestresponse-dto" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderCreateRequest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.inbound.rest.orders.protocol</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotBlank</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Positive</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 注文作成リクエスト</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">OrderCreateRequest</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@NotBlank</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@NotBlank</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@Positive</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>

<span class="w">        </span><span class="nd">@Positive</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: OrderGetResponse.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.inbound.rest.orders.protocol</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.adapter.outbound.persistence.entity.OrderEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 注文取得レスポンス</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">OrderGetResponse</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">productId</span><span class="p">,</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">confirmedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">requestedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">trackingNumber</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">shippedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">deliveredAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">OrderGetResponse</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">OrderEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderGetResponse</span><span class="p">(</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getProductId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getStatus</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getConfirmedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getRequestedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getTrackingNumber</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getShippedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getDeliveredAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCancelledBy</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCancellationReason</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCancelledAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getRejectionReason</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getRejectedAt</span><span class="p">(),</span>
<span class="w">                </span><span class="n">entity</span><span class="p">.</span><span class="na">getCreatedAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="223-api">22.3 API エンドポイント一覧<a class="headerlink" href="#223-api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>メソッド</th>
<th>パス</th>
<th>説明</th>
<th>種別</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/api/orders</code></td>
<td>注文作成</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/orders/{id}/request-shipment</code></td>
<td>出荷依頼</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/orders/{id}/ship</code></td>
<td>出荷</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/orders/{id}/deliver</code></td>
<td>配達完了</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/orders/{id}/cancel</code></td>
<td>キャンセル</td>
<td>Command</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/orders</code></td>
<td>注文一覧取得</td>
<td>Query</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/orders/{id}</code></td>
<td>注文詳細取得</td>
<td>Query</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="224-axon-test">22.4 Axon Test による単体テスト<a class="headerlink" href="#224-axon-test" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: OrderAggregateTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sales.order.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sales.order.domain.model.aggregate.order.OrderCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.AggregateTestFixture</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.FixtureConfiguration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.BeforeEach</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.DisplayName</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Nested</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">OrderAggregateTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FixtureConfiguration</span><span class="o">&lt;</span><span class="n">OrderAggregateAdapter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fixture</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AggregateTestFixture</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">OrderAggregateAdapter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;注文作成&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CreateOrder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;正常な注文を作成できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCreateOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateOrderCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;order-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;customer-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;product-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">OrderCreatedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;数量が0以下の場合はエラー&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRejectZeroQuantity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateOrderCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;order-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;customer-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;product-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;注文確定&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ConfirmOrder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;保留中の注文を確定できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldConfirmPendingOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;order-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;customer-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;product-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ConfirmOrderCommand</span><span class="p">(</span><span class="s">&quot;order-1&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">OrderConfirmedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;注文キャンセル&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CancelOrder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;保留中の注文をキャンセルできる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCancelPendingOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;order-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;customer-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;product-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CancelOrderCommand</span><span class="p">(</span><span class="s">&quot;order-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Customer request&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">OrderCancelledEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;出荷済みの注文はキャンセルできない&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotCancelShippedOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;order-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;customer-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;product-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                    </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">confirmedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderConfirmedEvent</span><span class="p">(</span><span class="s">&quot;order-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">requestedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ShipmentRequestedEvent</span><span class="p">(</span><span class="s">&quot;order-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">shippedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OrderShippedEvent</span><span class="p">(</span><span class="s">&quot;order-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;product-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TRACK123&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">confirmedEvent</span><span class="p">,</span><span class="w"> </span><span class="n">requestedEvent</span><span class="p">,</span><span class="w"> </span><span class="n">shippedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CancelOrderCommand</span><span class="p">(</span><span class="s">&quot;order-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Customer request&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="part-10-f">Part 10-F のまとめ<a class="headerlink" href="#part-10-f" title="Permanent link">&para;</a></h2>
<h3 id="_6">実装した機能一覧<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>章</th>
<th>内容</th>
<th>主要技術</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>第18章: 基礎</strong></td>
<td>CQRS/ES アーキテクチャの基礎</td>
<td>Axon Framework, Event Sourcing</td>
</tr>
<tr>
<td><strong>第19章: ドメイン設計</strong></td>
<td>イベント、コマンド、ドメインモデル</td>
<td>sealed interface, record</td>
</tr>
<tr>
<td><strong>第20章: Aggregate/Policy</strong></td>
<td>Aggregate Adapter, Choreography</td>
<td>@Aggregate, @EventHandler</td>
</tr>
<tr>
<td><strong>第21章: Projection</strong></td>
<td>Read Model の更新、最小限フィールド</td>
<td>@EventHandler, MyBatis</td>
</tr>
<tr>
<td><strong>第22章: REST API</strong></td>
<td>Inbound Adapter, テスト</td>
<td>CommandGateway, Axon Test</td>
</tr>
</tbody>
</table>
<h3 id="_7">アーキテクチャの特徴<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9Ijg3N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjA1cHg7aGVpZ2h0Ojg3N3B4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYwNSA4NzciIHdpZHRoPSI2MDVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iODc3IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjA1IiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgQ29tbWFuZCBTaWRlLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgaWQ9ImVudDAwMDIiPjxwYXRoIGQ9Ik04LjUsNiBMMTI3LjI3NjQsNiBBMy43NSwzLjc1IDAgMCAxIDEyOS43NzY0LDguNSBMMTM2Ljc3NjQsMjguMjk2OSBMNDI4LjUsMjguMjk2OSBBMi41LDIuNSAwIDAgMSA0MzEsMzAuNzk2OSBMNDMxLDQ3MC42OSBBMi41LDIuNSAwIDAgMSA0MjguNSw0NzMuMTkgTDguNSw0NzMuMTkgQTIuNSwyLjUgMCAwIDEgNiw0NzAuNjkgTDYsOC41IEEyLjUsMi41IDAgMCAxIDguNSw2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2IiB4Mj0iMTM2Ljc3NjQiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuNzc2NCIgeD0iMTAiIHk9IjIwLjk5NTEiPkNvbW1hbmQgU2lkZTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgUXVlcnkgU2lkZS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJRdWVyeSBTaWRlIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImVudDAwMDgiPjxwYXRoIGQ9Ik02Ny41LDUyMi4xOSBMMTU1LjE2Niw1MjIuMTkgQTMuNzUsMy43NSAwIDAgMSAxNTcuNjY2LDUyNC42OSBMMTY0LjY2Niw1NDQuNDg2OSBMMzg5LjUsNTQ0LjQ4NjkgQTIuNSwyLjUgMCAwIDEgMzkyLDU0Ni45ODY5IEwzOTIsODY4LjEzIEEyLjUsMi41IDAgMCAxIDM4OS41LDg3MC42MyBMNjcuNSw4NzAuNjMgQTIuNSwyLjUgMCAwIDEgNjUsODY4LjEzIEw2NSw1MjQuNjkgQTIuNSwyLjUgMCAwIDEgNjcuNSw1MjIuMTkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjY1IiB4Mj0iMTY0LjY2NiIgeTE9IjU0NC40ODY5IiB5Mj0iNTQ0LjQ4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuNjY2IiB4PSI2OSIgeT0iNTM3LjE4NTEiPlF1ZXJ5IFNpZGU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkMxLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlLlJDMSIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ5LjYzNDgiIHg9IjIyMC4xOCIgeT0iNDEiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMzQ5LjgxNDgiIHk9IjQ2Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIzNDcuODE0OCIgeT0iNDgiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjM0Ny44MTQ4IiB5PSI1MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSIyMzUuMTgiIHk9IjczLjk5NTEiPlJFU1QgQ29udHJvbGxlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBDRy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZS5DRyIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczLjc5OTgiIHg9IjIwOC4xIiB5PSIxNjQuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIzNjEuODk5OCIgeT0iMTY5LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjM1OS44OTk4IiB5PSIxNzEuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzU5Ljg5OTgiIHk9IjE3NS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjc5OTgiIHg9IjIyMy4xIiB5PSIxOTcuMjk1MSI+Q29tbWFuZEdhdGV3YXk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQUEtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUuQUEiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDA1Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3My41MjY0IiB4PSI0OS4yNCIgeT0iMjg3LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjIwMi43NjY0IiB5PSIyOTIuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIwMC43NjY0IiB5PSIyOTQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIwMC43NjY0IiB5PSIyOTguNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMuNTI2NCIgeD0iNjQuMjQiIHk9IjMyMC41ODUxIj5BZ2dyZWdhdGUgQWRhcHRlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBETS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZS5ETSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgaWQ9ImVudDAwMDYiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwLjgwOTYiIHg9IjMyLjYiIHk9IjE2NC4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE1My40MDk2IiB5PSIxNjkuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTUxLjQwOTYiIHk9IjE3MS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNTEuNDA5NiIgeT0iMTc1LjMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDAuODA5NiIgeD0iNDcuNiIgeT0iMTk3LjI5NTEiPkRvbWFpbiBNb2RlbDwvdGV4dD48L2c+PCEtLWVudGl0eSBFUy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZS5FUyIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIxLjg2NzIiIHg9Ijc1LjA3IiB5PSI0MTAuODkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTc2LjkzNzIiIHk9IjQxNS44OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTc0LjkzNzIiIHk9IjQxNy44OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTc0LjkzNzIiIHk9IjQyMS44OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjkwLjA3IiB5PSI0NDMuODg1MSI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkMyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5SQzIiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDkuNjM0OCIgeD0iMjI2LjE4IiB5PSI1NTcuMTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMzU1LjgxNDgiIHk9IjU2Mi4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzUzLjgxNDgiIHk9IjU2NC4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzUzLjgxNDgiIHk9IjU2OC4xOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSIyNDEuMTgiIHk9IjU5MC4xODUxIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgTUItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJRdWVyeSBTaWRlLk1CIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImVudDAwMTAiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUyLjQ3MTciIHg9IjkzLjc2IiB5PSI2ODUuMDQiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjI2LjIzMTciIHk9IjY5MC4wNCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjI0LjIzMTciIHk9IjY5Mi4wNCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjI0LjIzMTciIHk9IjY5Ni4wNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi40NzE3IiB4PSIxMDguNzYiIHk9IjcxOC4wMzUxIj5NeUJhdGlzIE1hcHBlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBEQi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUuREIiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDcuMTI2IiB4PSIxMDQuNDQiIHk9IjgwOC4zMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIyMzEuNTY2IiB5PSI4MTMuMzMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIyOS41NjYiIHk9IjgxNS4zMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjI5LjU2NiIgeT0iODE5LjMzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA3LjEyNiIgeD0iMTE5LjQ0IiB5PSI4NDEuMzI1MSI+UmVhZCBNb2RlbCBEQjwvdGV4dD48L2c+PCEtLWVudGl0eSBQLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5QIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA5Ljc4MTMiIHg9IjgxLjExIiB5PSI1NTcuMTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTcwLjg5MTMiIHk9IjU2Mi4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTY4Ljg5MTMiIHk9IjU2NC4xOSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTY4Ljg5MTMiIHk9IjU2OC4xOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9Ijk2LjExIiB5PSI1OTAuMTg1MSI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMjMiIGRhdGEtc291cmNlLWxpbmU9IjMxIiBpZD0iZW50MDAyNCI+PHBhdGggZD0iTTQ0Ny41LDE2Ny4zMSBMNDQ3LjUsMjA3LjU3NTYgTDU5OC41MDAyLDIwNy41NzU2IEw1OTguNTAwMiwxNzcuMzEgTDU4OC41MDAyLDE2Ny4zMSBMNDQ3LjUsMTY3LjMxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTg4LjUwMDIsMTY3LjMxIEw1ODguNTAwMiwxNzcuMzEgTDU5OC41MDAyLDE3Ny4zMSBMNTg4LjUwMDIsMTY3LjMxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjQ1My41IiB5PSIxODQuMzc2OSI+JiMzMjAyMDsmIzMxODgzOyYjMTIzOTQ7JiMxMjQ4OTsmIzEyNTEzOyYjMTI0NTI7JiMxMjUzMTsmIzEyNTE0OyYjMTI0ODc7JiMxMjUyMzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0LjkxMTciIHg9IjQ1My41IiB5PSIxOTkuNTA5NyI+QXhvbiAmIzEyMzk1OyYjMjAzODE7JiMyMzM4NDsmIzEyMzc1OyYjMTIzOTQ7JiMxMjM1Njs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjI2IiBkYXRhLXNvdXJjZS1saW5lPSIzNiIgaWQ9ImVudDAwMjciPjxwYXRoIGQ9Ik00MTAuNzMsNTUyLjY0IEw0MTAuNzMsNjA4LjAzODQgTDU1MS4yNzU1LDYwOC4wMzg0IEw1NTEuMjc1NSw1NjIuNjQgTDU0MS4yNzU1LDU1Mi42NCBMNDEwLjczLDU1Mi42NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTU0MS4yNzU1LDU1Mi42NCBMNTQxLjI3NTUsNTYyLjY0IEw1NTEuMjc1NSw1NjIuNjQgTDU0MS4yNzU1LDU1Mi42NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4wMDAxIiB4PSI0MTYuNzMiIHk9IjU2OS43MDY5Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMTI0MzQ7JiMzNjA5MjsmIzM1NTAxOyYjMTIzNzU7JiMxMjM5MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuNDA4NyIgeD0iNDE2LjczIiB5PSI1ODQuODM5NyI+TXlCYXRpcyAmIzMyMDc2OyYjMzAwMDE7JiMxMjM5MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE5LjU0NTUiIHg9IjQxNi43MyIgeT0iNTk5Ljk3MjUiPlJlYWQgTW9kZWwgJiMxMjQzNDsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjwvZz48IS0tbGluayBSQzEgdG8gQ0ctLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE4IiBpZD0ibG5rMTMiPjxwYXRoIGQ9Ik0yOTUsODcuNjggQzI5NSwxMDkuNDcgMjk1LDEzNi4yOSAyOTUsMTU4LjA0IiBmaWxsPSJub25lIiBpZD0iUkMxLXRvLUNHIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyOTUsMTY0LjA0LDI5OSwxNTUuMDQsMjk1LDE1OS4wNCwyOTEsMTU1LjA0LDI5NSwxNjQuMDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDYuMjkxNSIgeD0iMjk2IiB5PSIxMzAuMzY2OSI+c2VuZChjb21tYW5kKTwvdGV4dD48L2c+PCEtLWxpbmsgQ0cgdG8gQUEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAwNSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE5IiBpZD0ibG5rMTQiPjxwYXRoIGQ9Ik0yNzguOTcsMjEwLjkzIEMyNjcuODEsMjI1LjQ5IDI1MS45NCwyNDQuMTYgMjM1LDI1Ny41OSBDMjIwLjY5LDI2OC45NCAyMDguODgxNiwyNzYuMjU3MyAxOTIuOTExNiwyODQuNDI3MyIgZmlsbD0ibm9uZSIgaWQ9IkNHLXRvLUFBIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxODcuNTcsMjg3LjE2LDE5Ny40MDQyLDI4Ni42MjIxLDE5Mi4wMjEzLDI4NC44ODI4LDE5My43NjA2LDI3OS40OTk5LDE4Ny41NywyODcuMTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzEuMDAyOSIgeD0iMjU0LjQ4IiB5PSIyNTMuNjU2OSI+QENvbW1hbmRIYW5kbGVyPC90ZXh0PjwvZz48IS0tbGluayBBQSB0byBETS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA2IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGlkPSJsbmsxNSI+PHBhdGggZD0iTTEyOS45LDI4Ny4zMyBDMTIzLjk5LDI2NS41OSAxMTYuNjM2MiwyMzguNTQ5MyAxMTAuNzA2MiwyMTYuNzY5MyIgZmlsbD0ibm9uZSIgaWQ9IkFBLXRvLURNIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDkuMTMsMjEwLjk4LDEwNy42MzQ4LDIyMC43MTQ3LDExMC40NDM1LDIxNS44MDQ0LDExNS4zNTM5LDIxOC42MTMxLDEwOS4xMywyMTAuOTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTIyLjQ4IiB5PSIyNTMuNjU2OSI+JiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48L2c+PCEtLWxpbmsgRE0gdG8gQUEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNiIgZGF0YS1lbnRpdHktMj0iZW50MDAwNSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIxIiBpZD0ibG5rMTYiPjxwYXRoIGQ9Ik04MS45NywyMTAuOTQgQzcxLjkzLDIyNC41IDYzLjU2LDI0Mi4wOSA3MSwyNTcuNTkgQzc2LjYzLDI2OS4zMyA4MS42MDE5LDI3NS41ODg5IDkxLjgyMTksMjgzLjUyODkiIGZpbGw9Im5vbmUiIGlkPSJETS10by1BQSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTYuNTYsMjg3LjIxLDkxLjkwNjksMjc4LjUyOTYsOTIuNjExNiwyODQuMTQyNCw4Ni45OTg4LDI4NC44NDcxLDk2LjU2LDI4Ny4yMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM3LjAyNTkiIHg9IjcyIiB5PSIyNTMuNjU2OSI+ZXZlbnQ8L3RleHQ+PC9nPjwhLS1saW5rIEFBIHRvIEVTLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgaWQ9ImxuazE3Ij48cGF0aCBkPSJNMTM2LDMzNC4yNyBDMTM2LDM1Ni4wNiAxMzYsMzgyLjg4IDEzNiw0MDQuNjMiIGZpbGw9Im5vbmUiIGlkPSJBQS10by1FUyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM2LDQxMC42MywxNDAsNDAxLjYzLDEzNiw0MDUuNjMsMTMyLDQwMS42MywxMzYsNDEwLjYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuOTQ0OCIgeD0iMTM3IiB5PSIzNzYuOTU2OSI+YXBwbHkoZXZlbnQpPC90ZXh0PjwvZz48IS0tbGluayBFUyB0byBQLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDciIGRhdGEtZW50aXR5LTI9ImVudDAwMTIiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgaWQ9ImxuazE4Ij48cGF0aCBkPSJNMTM2LDQ1Ny41OSBDMTM2LDQ4NC43IDEzNiw1MjMuOTEgMTM2LDU1MC45NSIgZmlsbD0ibm9uZSIgaWQ9IkVTLXRvLVAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNiw1NTYuOTUsMTQwLDU0Ny45NSwxMzYsNTUxLjk1LDEzMiw1NDcuOTUsMTM2LDU1Ni45NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMS40MjkyIiB4PSIxMzciIHk9IjUwMi4yNTY5Ij5ARXZlbnRIYW5kbGVyPC90ZXh0PjwvZz48IS0tbGluayBQIHRvIE1CLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTIiIGRhdGEtZW50aXR5LTI9ImVudDAwMTAiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyNCIgaWQ9ImxuazE5Ij48cGF0aCBkPSJNMTQyLjA4LDYwMy44NCBDMTQ4LjI3LDYyNi43NCAxNTYuMjM1Miw2NTYuMjQ3NiAxNjIuNDA1Miw2NzkuMDg3NiIgZmlsbD0ibm9uZSIgaWQ9IlAtdG8tTUIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2My45Nyw2ODQuODgsMTY1LjQ4NDUsNjc1LjE0ODMsMTYyLjY2Niw2ODAuMDUzLDE1Ny43NjEzLDY3Ny4yMzQ2LDE2My45Nyw2ODQuODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ny4yNDg1IiB4PSIxNTYuMDQiIHk9IjY1MS4xMDY5Ij5pbnNlcnQvdXBkYXRlPC90ZXh0PjwvZz48IS0tbGluayBNQiB0byBEQi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDEwIiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGlkPSJsbmsyMCI+PHBhdGggZD0iTTE0Ni4wOSw3MzEuNzcgQzEzNS4xNSw3NDQuOTIgMTI1Ljg1LDc2Mi4wNiAxMzIsNzc4LjMzIEMxMzYuMTgsNzg5LjQgMTM5Ljc5NjQsNzk1LjI3MjIgMTQ3LjcyNjQsODAzLjY5MjIiIGZpbGw9Im5vbmUiIGlkPSJNQi10by1EQiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTUxLjg0LDgwOC4wNiwxNDguNTgxNCw3OTguNzY1OCwxNDguNDEyLDgwNC40MjAxLDE0Mi43NTc2LDgwNC4yNTA3LDE1MS44NCw4MDguMDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNS43MjcxIiB4PSIxMzMiIHk9Ijc3NC4zOTY5Ij5TUUw8L3RleHQ+PC9nPjwhLS1saW5rIE1CIHRvIERCLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTAiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgaWQ9ImxuazIyIj48cGF0aCBkPSJNMTcxLjQ5LDczMS43MiBDMTcyLjkyLDc1My41IDE3NC42OTYyLDc4MC4zNDI5IDE3Ni4xMjYyLDgwMi4wODI5IiBmaWxsPSJub25lIiBpZD0iTUItdG8tREItMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTc2LjUyLDgwOC4wNywxNzkuOTIwNyw3OTguODI2OSwxNzYuMTkxOCw4MDMuMDgwOCwxNzEuOTM3OSw3OTkuMzUxOSwxNzYuNTIsODA4LjA3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguOTQwNCIgeD0iMTc1LjQ4IiB5PSI3NzQuMzk2OSI+U0VMRUNUPC90ZXh0PjwvZz48IS0tbGluayBSQzIgdG8gTUItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOSIgZGF0YS1lbnRpdHktMj0iZW50MDAxMCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjI3IiBpZD0ibG5rMjEiPjxwYXRoIGQ9Ik0yODkuNCw2MDMuNzUgQzI4MC41OCw2MTkuMzUgMjY3LjM2LDYzOS45OCAyNTIsNjU1LjA0IEMyNDAuNTUsNjY2LjI1IDIzMS40MjE3LDY3My4xODgyIDIxOC4wMzE3LDY4MS40MTgyIiBmaWxsPSJub25lIiBpZD0iUkMyLXRvLU1CIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTIuOTIsNjg0LjU2LDIyMi42ODIsNjgzLjI1NSwyMTcuMTc5Nyw2ODEuOTQxOCwyMTguNDkyOSw2NzYuNDM5NSwyMTIuOTIsNjg0LjU2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzcuNTI3MyIgeD0iMjY3LjM5IiB5PSI2NTEuMTA2OSI+cXVlcnk8L3RleHQ+PC9nPjwhLS1saW5rIERNIHRvIEdNTjIzLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMjQiIGRhdGEtbGluay10eXBlPSJhc3NvY2lhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMzEiIGlkPSJsbmsyNSI+PHBhdGggZD0iTTEzMy4zNSwxNjMuODUgQzE1My40NCwxNDkuNzcgMTgxLjA2LDEzMy4yMyAyMDguNSwxMjUuOCBDMjk2LjQ0LDEwMS45OSAzMjUuMzcsMTAyLjY5IDQxMy41LDEyNS44IEM0NDMuODksMTMzLjc2IDQ3NC43NCwxNTIuMjcgNDk1LjkxLDE2Ni45NSIgZmlsbD0ibm9uZSIgaWQ9IkRNLUdNTjIzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PC9nPjwhLS1saW5rIFAgdG8gR01OMjYtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMiIgZGF0YS1lbnRpdHktMj0iZW50MDAyNyIgZGF0YS1saW5rLXR5cGU9ImFzc29jaWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIzNiIgaWQ9ImxuazI4Ij48cGF0aCBkPSJNMTUzLjEsNTU3LjA3IEMxNjkuNDEsNTM3LjA0IDE5NS45NSw1MDkuNTQgMjI2LjUsNDk3LjY5IEMyNTcuMTYsNDg1Ljc5IDM0My4zOSw0ODcuMDMgMzc0LjUsNDk3LjY5IEM0MDUuOTQsNTA4LjQ2IDQzNS4yNyw1MzIuNzEgNDU1LjE2LDU1Mi4xNyIgZmlsbD0ibm9uZSIgaWQ9IlAtR01OMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PD9wbGFudHVtbC1zcmMgWFA1RFF6SDA2Q1ZscHdUdWc5VnNLQ0dVRk9aUFJBbzcxakFjai0xWHQ4bmZSN09jSmhCZzhYd0k0UkpPTmhKdVdkWWVZNEJCdWFpaEE4WFZQaEpSWi00cGl4a3JVZjRtNDd4X3ZfYV9SekxjQmFnY00xLWxpenZjZmtIMGZCdWlmQzlwTG1CeDBQR2FpOHBaZDJfeFZJUElaRkVLcC00eklEUTJVMXJ6QU1lYll1QWhReVdnTkZDbEczQURONk9ybHlFNlpsbEJhN1hQZmRYNjRCc0tiVktxbV9DV3dTZS1vbU02Q2tNNVd6cUdhazBzNXBONmpMSlNpSTI2LXNWUU1Icm1EVm5WQ3FrR1hDQ0VnX0NBR3JRTUtudnNBOXdwVDU4R2t2cjlKUUFIYVpUdmh5d2JTMllvNU1hYU41b3lIMkZXSFFvdUlFVHhhX2FNVzkxTEY4LUtvekVmaHpBWjFlMldyUmVYUUtPX0RVck5ldFRDLXl0ZWFWbE5mbHEwZjl1UVMzbGxCMnM4WUwzN25OM1V5R0tXT2VOOGJkQWhjSE1BNzB5eDlFSVl1Z2UtRm9YSnNaOEdTWHJPOUx2VGlQQ2lfT2N6UFZWdFRxb200bFpoMDRCSVlMSVVSVEdlUnpYSlo4enNudnlWY3NSVncyc1p6cXB4cmtYM2V6eU9fVDNlMF8za0llNmNFVlp2dV9NbHFHbEpGQlVIcEdFV0xRN3ItalNuMGtWbXFmYXlDa3NKYXlGbDlfaVpiX1dFUGxTUVZ6YVV4dHVvcE5pdVNvZUFGZHZyVEZwaXV3ZHZSbTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_8">設計上の特徴<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>特徴</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ドメインモデルとフレームワークの分離</strong></td>
<td><code>Order.java</code> は純粋なドメインモデル、<code>OrderAggregateAdapter.java</code> は Axon 用アダプター</td>
</tr>
<tr>
<td><strong>Choreography による疎結合</strong></td>
<td>各 Context は独立して動作、イベントを介した非同期連携</td>
</tr>
<tr>
<td><strong>sealed interface による型安全性</strong></td>
<td>イベントの網羅性チェック、switch 式でコンパイル時検証</td>
</tr>
<tr>
<td><strong>record によるイミュータブル設計</strong></td>
<td>状態変更は常に新しいインスタンスを生成</td>
</tr>
<tr>
<td><strong>最小限フィールドの原則</strong></td>
<td>ドメインモデルは状態遷移判定に必要な最小限のみ保持</td>
</tr>
<tr>
<td><strong>MyBatis による柔軟な SQL 制御</strong></td>
<td>Read Model の更新に MyBatis Mapper を使用</td>
</tr>
</tbody>
</table>
<h3 id="_9">技術スタック<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カテゴリ</th>
<th>技術</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>言語</strong></td>
<td>Java 21</td>
</tr>
<tr>
<td><strong>フレームワーク</strong></td>
<td>Spring Boot 3.4.1</td>
</tr>
<tr>
<td><strong>CQRS/ES</strong></td>
<td>Axon Framework 4.10.3</td>
</tr>
<tr>
<td><strong>ORM</strong></td>
<td>MyBatis 3.0.4</td>
</tr>
<tr>
<td><strong>データベース</strong></td>
<td>H2 / PostgreSQL</td>
</tr>
<tr>
<td><strong>テスト</strong></td>
<td>JUnit 5, Axon Test</td>
</tr>
</tbody>
</table>
<h3 id="api">API 形式の比較<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>REST API</th>
<th>gRPC</th>
<th>GraphQL</th>
<th>CQRS/ES</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>書き込みモデル</strong></td>
<td>同一</td>
<td>同一</td>
<td>同一</td>
<td>分離（Command）</td>
</tr>
<tr>
<td><strong>読み取りモデル</strong></td>
<td>同一</td>
<td>同一</td>
<td>同一</td>
<td>分離（Query）</td>
</tr>
<tr>
<td><strong>履歴保持</strong></td>
<td>別途実装</td>
<td>別途実装</td>
<td>別途実装</td>
<td>標準搭載</td>
</tr>
<tr>
<td><strong>監査証跡</strong></td>
<td>別途実装</td>
<td>別途実装</td>
<td>別途実装</td>
<td>標準搭載</td>
</tr>
<tr>
<td><strong>スケーラビリティ</strong></td>
<td>中</td>
<td>高</td>
<td>中</td>
<td>非常に高</td>
</tr>
<tr>
<td><strong>複雑性</strong></td>
<td>低</td>
<td>中</td>
<td>中</td>
<td>高</td>
</tr>
</tbody>
</table>
<h3 id="cqrses">CQRS/ES を選択する場面<a class="headerlink" href="#cqrses" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>監査要件</strong>: すべての状態変更の履歴が必要</li>
<li><strong>複雑なドメイン</strong>: ビジネスロジックが複雑で、書き込みと読み取りの要件が異なる</li>
<li><strong>高いスケーラビリティ</strong>: 読み取りと書き込みを独立してスケールしたい</li>
<li><strong>イベント駆動アーキテクチャ</strong>: マイクロサービス間の連携にイベントを使用</li>
<li><strong>時間旅行</strong>: 過去の任意の時点の状態を再構築したい</li>
</ol>
<p>CQRS/ES は導入コストが高いですが、監査要件や複雑なドメインを持つシステムでは、その恩恵は大きくなります。Axon Framework を使用することで、イベントソーシングと CQRS の複雑さを軽減し、ドメインロジックに集中できます。MyBatis を使用することで、Read Model の更新において柔軟な SQL 制御が可能になります。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>