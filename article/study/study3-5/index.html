
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../study3-4/">
      
      
        <link rel="next" href="../study4-1/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>研究5 AxonCQRS/ESの実装 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#5-axon-cqrses" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              研究5 AxonCQRS/ESの実装
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-setup-instruction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    プロジェクトセットアップ手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study2-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" checked>
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        はじめに
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#26axon-cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        第26章：Axon CQRS/ES アーキテクチャの基礎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第26章：Axon CQRS/ES アーキテクチャの基礎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#261-cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.1 CQRS とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#262-event-sourcing" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.2 Event Sourcing とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#263" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.3 ヘキサゴナルアーキテクチャとの統合
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#264" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.4 技術スタック
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26.4 技術スタック">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildgradlekts" class="md-nav__link">
    <span class="md-ellipsis">
      
        build.gradle.kts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#265" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.5 ディレクトリ構造
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#266-axon" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.6 Axon 設定クラス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#267-mybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.7 MyBatis 設定クラス
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    <span class="md-ellipsis">
      
        第27章：ドメインモデルとイベント設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第27章：ドメインモデルとイベント設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#271-journal-bounded-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        27.1 Journal Bounded Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="27.1 Journal Bounded Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        状態遷移図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント一覧
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#272-api-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        27.2 イベント定義（API Layer）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="27.2 イベント定義（API Layer）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sealed-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        sealed interface によるイベントの型安全性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#record" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント record の実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#273-domain-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        27.3 コマンド定義（Domain Layer）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#274-java" class="md-nav__link">
    <span class="md-ellipsis">
      
        27.4 ドメインモデル（純粋な Java）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#275-account-bounded-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        27.5 Account Bounded Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="27.5 Account Bounded Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント定義
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#28aggregate-adapter-policy-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        第28章：Aggregate Adapter と Policy Handler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第28章：Aggregate Adapter と Policy Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#281-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        28.1 Aggregate Adapter パターン
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#282-journalentry-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        28.2 JournalEntry Aggregate Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#283-policy-handlerchoreography" class="md-nav__link">
    <span class="md-ellipsis">
      
        28.3 Policy Handler（Choreography パターン）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#284-journaleventhandleraccount-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        28.4 JournalEventHandler（Account Context 内）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#29projection-read-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        第29章：Projection と Read Model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第29章：Projection と Read Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#291-projection" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.1 Projection の役割
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#292-journalentry-projectionmybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.2 JournalEntry Projection（MyBatis 版）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#293-read-model-entity" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.3 Read Model Entity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#294-mybatis-mapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.4 MyBatis Mapper インターフェース
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#295-mybatis-mapper-xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.5 MyBatis Mapper XML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#296-read-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.6 Read Model スキーマ
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#297" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.7 最小限フィールドの原則
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#30rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        第30章：REST API と統合テスト
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第30章：REST API と統合テスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#301-rest-controllerinbound-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        30.1 REST Controller（Inbound Adapter）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#302-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        30.2 API エンドポイント一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#303-axon-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        30.3 Axon Test による単体テスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-f" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 5-F のまとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 5-F のまとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        実装した機能一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        アーキテクチャの特徴
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        設計上の特徴
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        財務会計システムでの CQRS/ES の意義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        技術スタック
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study4-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter22-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 Axon CQRS/ESの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_18" >
        
          
          <label class="md-nav__link" for="__nav_1_18" id="__nav_1_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（FAS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（PMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="5-axon-cqrses">実践データベース設計：財務会計システム 研究 5 - Axon CQRS/ES の実装<a class="headerlink" href="#5-axon-cqrses" title="Permanent link">&para;</a></h1>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本研究では、REST API（第21章）、gRPC（研究 3）、GraphQL（研究 4）とは異なるアプローチとして、<strong>CQRS（Command Query Responsibility Segregation）</strong> と <strong>Event Sourcing</strong> による財務会計システムを実装します。Axon Framework を使用し、コマンド（書き込み）とクエリ（読み取り）を分離し、すべての状態変更をイベントとして記録するアーキテクチャを構築します。</p>
<p>研究 1 で構築したヘキサゴナルアーキテクチャの考え方を踏襲しつつ、<strong>ドメインモデルをフレームワークから分離</strong>し、Axon Aggregate Adapter を介して連携させます。Read Model の永続化には <strong>MyBatis</strong> を使用します。</p>
<p>財務会計システムでは、<strong>仕訳（Journal Entry）</strong> の作成から承認、転記までのワークフローを CQRS/ES で実装し、すべての取引履歴を完全に追跡可能な形で保存します。</p>
<hr />
<h2 id="26axon-cqrses">第26章：Axon CQRS/ES アーキテクチャの基礎<a class="headerlink" href="#26axon-cqrses" title="Permanent link">&para;</a></h2>
<h3 id="261-cqrs">26.1 CQRS とは<a class="headerlink" href="#261-cqrs" title="Permanent link">&para;</a></h3>
<p>CQRS（Command Query Responsibility Segregation）は、コマンド（書き込み）とクエリ（読み取り）の責務を分離するアーキテクチャパターンです。従来の CRUD 操作を単一のモデルで処理するのではなく、書き込み用のモデルと読み取り用のモデルを分けることで、それぞれに最適化された設計が可能になります。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjYzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzMycHg7aGVpZ2h0OjYzNHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMzMiA2MzQiIHdpZHRoPSIzMzJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPkNRUlMgJiMxMjQ1MDsmIzEyNTQwOyYjMTI0NjE7JiMxMjQ4NjsmIzEyNDYzOyYjMTI0ODE7JiMxMjUxNTsmIzY1Mjg4OyYjMzYwMDE7JiMyMTIwOTsmIzIwMjUwOyYjMzUzMzY7JiMxMjQ3MTsmIzEyNDczOyYjMTI0ODY7JiMxMjUxMjsmIzY1Mjg5OzwvdGl0bGU+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNjM0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzMyIiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSI0Ij48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjg1LjkxMiIgeD0iMTYuMDQ0IiB5PSIyMi45OTUxIj5DUVJTICYjMTI0NTA7JiMxMjU0MDsmIzEyNDYxOyYjMTI0ODY7JiMxMjQ2MzsmIzEyNDgxOyYjMTI1MTU7JiM2NTI4ODsmIzM2MDAxOyYjMjEyMDk7JiMyMDI1MDsmIzM1MzM2OyYjMTI0NzE7JiMxMjQ3MzsmIzEyNDg2OyYjMTI1MTI7JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIENvbW1hbmQgU2lkZSAoV3JpdGUpLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSAuV3JpdGUuIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwMiI+PHBhdGggZD0iTTguNSw0My4yOTY5IEwxODguMjgwMyw0My4yOTY5IEEzLjc1LDMuNzUgMCAwIDEgMTkwLjc4MDMsNDUuNzk2OSBMMTk3Ljc4MDMsNjUuNTkzOCBMMTk3LjUsNjUuNTkzOCBBMi41LDIuNSAwIDAgMSAyMDAsNjguMDkzOCBMMjAwLDQxNi45ODY5IEEyLjUsMi41IDAgMCAxIDE5Ny41LDQxOS40ODY5IEw4LjUsNDE5LjQ4NjkgQTIuNSwyLjUgMCAwIDEgNiw0MTYuOTg2OSBMNiw0NS43OTY5IEEyLjUsMi41IDAgMCAxIDguNSw0My4yOTY5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2IiB4Mj0iMTk3Ljc4MDMiIHkxPSI2NS41OTM4IiB5Mj0iNjUuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzguNzgwMyIgeD0iMTAiIHk9IjU4LjI5MiI+Q29tbWFuZCBTaWRlIChXcml0ZSk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFF1ZXJ5IFNpZGUgKFJlYWQpLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMTAiPjxwYXRoIGQ9Ik0zOC41LDQ0My40ODY5IEwxODMuNTgxMSw0NDMuNDg2OSBBMy43NSwzLjc1IDAgMCAxIDE4Ni4wODExLDQ0NS45ODY5IEwxOTMuMDgxMSw0NjUuNzgzNyBMMzIyLjUsNDY1Ljc4MzcgQTIuNSwyLjUgMCAwIDEgMzI1LDQ2OC4yODM3IEwzMjUsNjI0LjU3NjkgQTIuNSwyLjUgMCAwIDEgMzIyLjUsNjI3LjA3NjkgTDM4LjUsNjI3LjA3NjkgQTIuNSwyLjUgMCAwIDEgMzYsNjI0LjU3NjkgTDM2LDQ0NS45ODY5IEEyLjUsMi41IDAgMCAxIDM4LjUsNDQzLjQ4NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjM2IiB4Mj0iMTkzLjA4MTEiIHkxPSI0NjUuNzgzNyIgeTI9IjQ2NS43ODM3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NC4wODExIiB4PSI0MCIgeT0iNDU4LjQ4MiI+UXVlcnkgU2lkZSAoUmVhZCk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkVTVCBDb250cm9sbGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4uUkVTVCBDb250cm9sbGVyIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkuNjM0OCIgeD0iNDQuMTgiIHk9Ijc4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkuNjM0OCIgeD0iNTQuMTgiIHk9IjEwMS4yOTIiPlJFU1QgQ29udHJvbGxlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBDb21tYW5kR2F0ZXdheS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSAuV3JpdGUuLkNvbW1hbmRHYXRld2F5IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwNCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTMuNzk5OCIgeD0iMjYuMSIgeT0iMTc0LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMuNzk5OCIgeD0iMzYuMSIgeT0iMTk3LjU5MiI+Q29tbWFuZEdhdGV3YXk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQWdncmVnYXRlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4uQWdncmVnYXRlIiBkYXRhLXNvdXJjZS1saW5lPSI4IiBpZD0iZW50MDAwNiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5My4yODgxIiB4PSI1Mi4zNiIgeT0iMjcwLjg4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My4yODgxIiB4PSI2Mi4zNiIgeT0iMjkzLjg4MiI+QWdncmVnYXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IEV2ZW50IFN0b3JlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4uRXZlbnQgU3RvcmUiIGRhdGEtc291cmNlLWxpbmU9IjkiIGlkPSJlbnQwMDA4Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwMS44NjcyIiB4PSI0Ny4wNyIgeT0iMzY3LjE4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSI1Ny4wNyIgeT0iMzkwLjE4MiI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuLlByb2plY3Rpb24iIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS43ODEzIiB4PSI1Mi4xMSIgeT0iNDc4LjQ4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS43ODEzIiB4PSI2Mi4xMSIgeT0iNTAxLjQ4MiI+UHJvamVjdGlvbjwvdGV4dD48L2c+PCEtLWVudGl0eSBSZWFkIE1vZGVsIERCLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZSAuUmVhZC4uUmVhZCBNb2RlbCBEQiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDEzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyNy4xMjYiIHg9IjExNS40NCIgeT0iNTc0Ljc3NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuMTI2IiB4PSIxMjUuNDQiIHk9IjU5Ny43NzIiPlJlYWQgTW9kZWwgREI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgTXlCYXRpcyBNYXBwZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJRdWVyeSBTaWRlIC5SZWFkLi5NeUJhdGlzIE1hcHBlciIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGlkPSJlbnQwMDE1Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMi40NzE3IiB4PSIxNzYuNzYiIHk9IjQ3OC40ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyLjQ3MTciIHg9IjE4Ni43NiIgeT0iNTAxLjQ4MiI+TXlCYXRpcyBNYXBwZXI8L3RleHQ+PC9nPjwhLS1saW5rIFJFU1QgQ29udHJvbGxlciB0byBDb21tYW5kR2F0ZXdheS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA0IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgaWQ9ImxuazUiPjxwYXRoIGQ9Ik0xMDcuOSwxMTQuNzM2OSBDMTA2LjgyLDEzMS42NDY5IDEwNS41NzA5LDE1MS4yNjkgMTA0LjQ5MDksMTY4LjI0OSIgZmlsbD0ibm9uZSIgaWQ9IlJFU1QgQ29udHJvbGxlci10by1Db21tYW5kR2F0ZXdheSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTA0LjExLDE3NC4yMzY5LDEwOC42NzMyLDE2NS41MDg5LDEwNC40Mjc0LDE2OS4yNDcsMTAwLjY4OTQsMTY1LjAwMTEsMTA0LjExLDE3NC4yMzY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIENvbW1hbmRHYXRld2F5IHRvIEFnZ3JlZ2F0ZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA2IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImxuazciPjxwYXRoIGQ9Ik0xMDIuMjcsMjExLjAzNjkgQzEwMS41NSwyMjcuOTQ2OSAxMDAuNzE0MiwyNDcuNTYyMyA5OS45OTQyLDI2NC41NDIzIiBmaWxsPSJub25lIiBpZD0iQ29tbWFuZEdhdGV3YXktdG8tQWdncmVnYXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5OS43NCwyNzAuNTM2OSwxMDQuMTE3NywyNjEuNzE0NCw5OS45NTE4LDI2NS41NDE0LDk2LjEyNDksMjYxLjM3NTUsOTkuNzQsMjcwLjUzNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQWdncmVnYXRlIHRvIEV2ZW50IFN0b3JlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMDgiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBpZD0ibG5rOSI+PHBhdGggZD0iTTk4LjgyLDMwNy4zMzY5IEM5OC42NCwzMjQuMjM2OSA5OC40MzM2LDM0My44NDcyIDk4LjI1MzYsMzYwLjgyNzIiIGZpbGw9Im5vbmUiIGlkPSJBZ2dyZWdhdGUtdG8tRXZlbnQgU3RvcmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk4LjE5LDM2Ni44MjY5LDEwMi4yODUyLDM1Ny44Njk4LDk4LjI0MywzNjEuODI3Miw5NC4yODU2LDM1Ny43ODUsOTguMTksMzY2LjgyNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgRXZlbnQgU3RvcmUgdG8gUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJsbmsxMiI+PHBhdGggZD0iTTk3Ljg0LDQwMy44OTY5IEM5Ny42NSw0MjQuMjg2OSA5Ny40MDU5LDQ1MS43MzcxIDk3LjIxNTksNDcyLjExNzEiIGZpbGw9Im5vbmUiIGlkPSJFdmVudCBTdG9yZS10by1Qcm9qZWN0aW9uIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5Ny4xNiw0NzguMTE2OSwxMDEuMjQzNyw0NjkuMTU0Niw5Ny4yMDY2LDQ3My4xMTcxLDkzLjI0NDEsNDY5LjA4LDk3LjE2LDQ3OC4xMTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFByb2plY3Rpb24gdG8gUmVhZCBNb2RlbCBEQi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDExIiBkYXRhLWVudGl0eS0yPSJlbnQwMDEzIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJsbmsxNCI+PHBhdGggZD0iTTExMi4wNCw1MTQuOTI2OSBDMTI2Ljc0LDUzMS44MzY5IDE0NS4wNzIyLDU1Mi45MTk5IDE1OS44NDIyLDU2OS44OTk5IiBmaWxsPSJub25lIiBpZD0iUHJvamVjdGlvbi10by1SZWFkIE1vZGVsIERCIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjMuNzgsNTc0LjQyNjksMTYwLjg5MTMsNTY1LjAxMTIsMTYwLjQ5ODUsNTcwLjY1NDQsMTU0Ljg1NTMsNTcwLjI2MTYsMTYzLjc4LDU3NC40MjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFJFU1QgQ29udHJvbGxlciB0byBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDE1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGlkPSJsbmsxNiI+PHBhdGggZD0iTTEzOC4wNiwxMTQuOTE2OSBDMTU4LjA0LDEyOC41NTY5IDE4My4zNSwxNDkuNDA2OSAxOTcsMTc0LjU5NjkgQzI1My4zNCwyNzguNTQ2OSAyNDguNjM1MSw0MjIuMDAyNyAyNDQuOTc1MSw0NzIuMzQyNyIgZmlsbD0ibm9uZSIgaWQ9IlJFU1QgQ29udHJvbGxlci10by1NeUJhdGlzIE1hcHBlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjQ0LjU0LDQ3OC4zMjY5LDI0OS4xODIxLDQ2OS42NDA2LDI0NC45MDI2LDQ3My4zNCwyNDEuMjAzMiw0NjkuMDYwNSwyNDQuNTQsNDc4LjMyNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgTXlCYXRpcyBNYXBwZXIgdG8gUmVhZCBNb2RlbCBEQi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDE1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEzIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTYiIGlkPSJsbmsxNyI+PHBhdGggZD0iTTIzMS4yNiw1MTQuOTI2OSBDMjE5Ljc5LDUzMS44MzY5IDIwNS43Njg2LDU1Mi40ODE3IDE5NC4yNDg2LDU2OS40NjE3IiBmaWxsPSJub25lIiBpZD0iTXlCYXRpcyBNYXBwZXItdG8tUmVhZCBNb2RlbCBEQiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTkwLjg4LDU3NC40MjY5LDE5OS4yNDMsNTY5LjIyNDksMTkzLjY4NzEsNTcwLjI4OTMsMTkyLjYyMjgsNTY0LjczMzQsMTkwLjg4LDU3NC40MjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjw/cGxhbnR1bWwtc3JjIFRQM0RJaUdtNThOdFVPaEJrRDc1bDhCV3JFZ2d1QkkyWXc2QnM1djJkM0dmUUtPZkNXalJhMTZWRzVWLVJEbzhDMWlILVpQSGNEc3lXWWFUVDFZS1I5OXBsZGl1RHlNT292bmdjYTZZaWJuOWIyT29mSzNHYzFXZ2NLMUlfMjJkRDFhcGhJT296UEhHNmhPRV9GT0dPaFhuOHp1bVpDMU1KeFBrUkZMZ3dzalJsVGR3b2pSRm9zUXNjM3otdFR2ekRsVUJidmNqdGN0cnFHQnJteEF2OElIdG1QR1h6M29MUExJYzRGNEtPVmo0U3VDeEZSV2FlejJGWmk1SnFjV2IxRWVPLWxyVDZBdG1Hc2htV2ZPbnNIR3dRZXluWlNuOTNsWXpUdnZfeFpRNm8yWmp0RWJRYS00NFRSZGc0STlEa25oaFUxVG1mRE1QLW9na2Y0alZVdEhrRW1jMUliNzBfWTMtUnVzVzc1MzMybVhlZFprSFIwZl9QYXNfMEcwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>CQRS の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>スケーラビリティ</strong></td>
<td>読み取りと書き込みを独立してスケール可能</td>
</tr>
<tr>
<td><strong>パフォーマンス</strong></td>
<td>読み取りに最適化されたモデルで高速クエリ</td>
</tr>
<tr>
<td><strong>複雑性の分離</strong></td>
<td>書き込みロジックと読み取りロジックを独立して開発</td>
</tr>
<tr>
<td><strong>監査対応</strong></td>
<td>Event Sourcing と組み合わせて完全な履歴を保持</td>
</tr>
</tbody>
</table>
<p><strong>財務会計システムでの CQRS の意義：</strong></p>
<ul>
<li><strong>監査証跡</strong>: すべての仕訳変更履歴を完全に保持</li>
<li><strong>複雑なクエリ</strong>: 試算表、財務諸表など多様なビューを効率的に生成</li>
<li><strong>データ整合性</strong>: イベントベースで一貫性を保証</li>
</ul>
<hr />
<h3 id="262-event-sourcing">26.2 Event Sourcing とは<a class="headerlink" href="#262-event-sourcing" title="Permanent link">&para;</a></h3>
<p>Event Sourcing は、アプリケーションの状態をイベントの連続として保存するパターンです。現在の状態を直接保存するのではなく、状態変更を表すイベントを記録し、必要に応じてイベントを再生して現在の状態を再構築します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUwMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDIycHg7aGVpZ2h0OjUwMnB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQyMiA1MDIiIHdpZHRoPSI0MjJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTAyIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNDIyIiB4PSIwIiB5PSIwIi8+PCEtLWVudGl0eSBDb21tYW5kLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTEuOTU1MSIgeD0iOTcuNDMiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MS45NTUxIiB4PSIxMDcuNDMiIHk9IjI5Ljk5NTEiPkNvbW1hbmQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQWdncmVnYXRlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQWdncmVnYXRlIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5My4yODgxIiB4PSI5Ni43NiIgeT0iMTIwLjI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuMjg4MSIgeD0iMTA2Ljc2IiB5PSIxNDMuMjg1MSI+QWdncmVnYXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBNb2RlbCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIwLjgwOTYiIHg9IjciIHk9IjIzMy41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC44MDk2IiB4PSIxNyIgeT0iMjU2LjU4NTEiPkRvbWFpbiBNb2RlbDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2MC4xMDY0IiB4PSI2NC4zNSIgeT0iMzQ2Ljg5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTA2NCIgeD0iNzQuMzUiIHk9IjM2OS44ODUxIj5FdmVudDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IFN0b3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDEuODY3MiIgeD0iMTExLjQ3IiB5PSI0NjAuMTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxMjEuNDciIHk9IjQ4My4xNzUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PCEtLWxpbmsgQ29tbWFuZCB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJsbms0Ij48cGF0aCBkPSJNMTQzLjQsNDMuNTMgQzE0My40LDY0LjMyIDE0My40LDkyLjkxIDE0My40LDExMy44MSIgZmlsbD0ibm9uZSIgaWQ9IkNvbW1hbmQtdG8tQWdncmVnYXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDMuNCwxMTkuODEsMTQ3LjQsMTEwLjgxLDE0My40LDExNC44MSwxMzkuNCwxMTAuODEsMTQzLjQsMTE5LjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuNTM1NyIgeD0iMTQ0LjQiIHk9Ijg2LjM1NjkiPjEuICYjMTI0Njc7JiMxMjUxMDsmIzEyNTMxOyYjMTI0ODk7JiMyMTQ2MzsmIzIwNDQ5OzwvdGV4dD48L2c+PCEtLWxpbmsgQWdncmVnYXRlIHRvIERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImxuazYiPjxwYXRoIGQ9Ik05Ni41LDE1My40MiBDODAuNjEsMTYwLjY1IDY0LjU4LDE3MS4yNyA1NS40LDE4Ni41OSBDNDYuOTEsMjAwLjc4IDQ5LjYwNTEsMjE0LjE1MzEgNTUuNTU1MSwyMjcuNzUzMSIgZmlsbD0ibm9uZSIgaWQ9IkFnZ3JlZ2F0ZS10by1Eb21haW4gTW9kZWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Ljk2LDIzMy4yNSw1OC4wMTczLDIyMy40MDEzLDU1Ljk1NTksMjI4LjY2OTIsNTAuNjg4LDIyNi42MDc5LDU3Ljk2LDIzMy4yNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni41MzU4IiB4PSI1Ni40IiB5PSIxOTkuNjU2OSI+Mi4gJiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOyYjMjM0NTU7JiMzNDg5Mjs8L3RleHQ+PC9nPjwhLS1saW5rIERvbWFpbiBNb2RlbCB0byBFdmVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImxuazgiPjxwYXRoIGQ9Ik03MS42MiwyNzAuMTMgQzc2LjY3LDI5MC45MSA4My42NDU1LDMxOS42NjkxIDg4LjcxNTUsMzQwLjU2OTEiIGZpbGw9Im5vbmUiIGlkPSJEb21haW4gTW9kZWwtdG8tRXZlbnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjkwLjEzLDM0Ni40LDkxLjg5NTUsMzM2LjcxMDcsODguOTUxMywzNDEuNTQwOSw4NC4xMjEsMzM4LjU5NjcsOTAuMTMsMzQ2LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC41MzU3IiB4PSI4My41MiIgeT0iMzEyLjk1NjkiPjMuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyOTk4MzsmIzI1MTA0OzwvdGV4dD48L2c+PCEtLWxpbmsgRXZlbnQgdG8gRXZlbnQgU3RvcmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNyIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJsbmsxMCI+PHBhdGggZD0iTTkwLjIzLDM4My40MSBDODcuOTIsMzk2Ljk0IDg2Ljg2LDQxNS43OCA5NC40LDQzMC4xOCBDMTAwLjkzLDQ0Mi42NiAxMDcuMzU1Miw0NDkuMjg5IDExOS4wNTUyLDQ1Ni42NjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudC10by1FdmVudCBTdG9yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI0LjEzLDQ1OS44NywxMTguNjUxOCw0NTEuNjg1MywxMTkuOTAxLDQ1Ny4yMDI1LDExNC4zODM4LDQ1OC40NTE3LDEyNC4xMyw0NTkuODciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuNTM1OCIgeD0iOTUuNCIgeT0iNDI2LjI0NjkiPjQuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyNzcwNDsmIzMyMTU0OyYjMjEyNzA7PC90ZXh0PjwvZz48IS0tbGluayBFdmVudCBTdG9yZSB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOSIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJsbmsxMSI+PHBhdGggZD0iTTE4NS4xLDQ2MC4wOSBDMTkzLjgyLDQ1Mi4wNyAyMDIuNzgsNDQxLjc0IDIwNy40LDQzMC4xOCBDMjQ3LjY3LDMyOS42OCAyNTYuMjQsMjgzLjIyIDIwNy40LDE4Ni41OSBDMjAxLjE4LDE3NC4yNyAxOTUuMDQ4NCwxNjcuNjk5IDE4My43OTg0LDE2MC4yMjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudCBTdG9yZS10by1BZ2dyZWdhdGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3OC44LDE1Ni45MSwxODQuMDg1LDE2NS4yMjA3LDE4Mi45NjU0LDE1OS42NzU4LDE4OC41MTAzLDE1OC41NTYyLDE3OC44LDE1Ni45MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3Mi41MzU4IiB4PSIyNDEuODkiIHk9IjMxMi45NTY5Ij41LiAmIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA4Nzc7JiMyOTk4MzsmIzY1Mjg4OyYjMjkzNjY7JiMyNDkwNzsmIzI0NDg5OyYjMjA4MDM7JiM2NTI4OTs8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIEF5eEVwMmo4QjRoQ0xLWkVwb3Q4cHFsREFtYWtnU245TElYQUpJdjlwNGxGSVVLZ1hZajlJYXBFSllfQUJ5ckJTU3hGb0l6SUs3UHAxSzRraGNaZF9EcFNuQm9LTTBMVE5KazVRQ1ZxekFCS3pDSUlyNVc1QW1MM0ZPTjdKUGlWRHl6eHQwbWFFdl9zSnQtb1ZvNE5pWGdtN2ZWeXRDSkNGME5WXzlKSzc5MHM4dzJzdmljRmN0T3lSa3Z6dEJKcFNWRFFDQmx2U1RGd2YtbGNsclpPbXVNYzFNb0FRbmRHMG8zam5ZMVJicG5rZFdjc2pVRnZiRmRGRVlQbW1VR0hRWE0ySV9BQm1FdXFHVE5uUkNFRXZ6amNGVXNQbmVNZzRERTNmZ1dRZHhScjBjcnhsd1ZaVVRVc1B3dFRKX1VqVkRoUV83dkY5bTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<p><strong>Event Sourcing の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>完全な履歴</strong></td>
<td>すべての状態変更が記録される</td>
</tr>
<tr>
<td><strong>監査証跡</strong></td>
<td>いつ、誰が、何を変更したかが明確</td>
</tr>
<tr>
<td><strong>時間旅行</strong></td>
<td>過去の任意の時点の状態を再構築可能</td>
</tr>
<tr>
<td><strong>イベント駆動</strong></td>
<td>他システムとの連携が容易</td>
</tr>
<tr>
<td><strong>デバッグ</strong></td>
<td>問題発生時にイベントを追跡可能</td>
</tr>
</tbody>
</table>
<p><strong>財務会計システムでの Event Sourcing の意義：</strong></p>
<ul>
<li><strong>訂正仕訳の追跡</strong>: 修正履歴を完全に保持</li>
<li><strong>期末決算処理</strong>: 任意の時点での残高を再計算可能</li>
<li><strong>内部統制</strong>: SOX 法対応の監査証跡を自動生成</li>
</ul>
<hr />
<h3 id="263">26.3 ヘキサゴナルアーキテクチャとの統合<a class="headerlink" href="#263" title="Permanent link">&para;</a></h3>
<p>本実装では、ヘキサゴナルアーキテクチャ（Ports &amp; Adapters）を採用し、ビジネスロジックを外部依存から分離します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjQ4NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTY0OHB4O2hlaWdodDo0ODZweDtiYWNrZ3JvdW5kOiNGRUZFRkU7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNjQ4IDQ4NiIgd2lkdGg9IjE2NDhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNDg2IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTY0OCIgeD0iMCIgeT0iMCIvPjwhLS1jbHVzdGVyIEhleGFnb25hbCBBcmNoaXRlY3R1cmUgKENRUlMvRVMgPyktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLiIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxwYXRoIGQ9Ik01MTMuMTYsNiBMODA1LjI2ODMsNiBBMy43NSwzLjc1IDAgMCAxIDgwNy43NjgzLDguNSBMODE0Ljc2ODMsMjguMjk2OSBMMTYzOS4xNiwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDE2NDEuNjYsMzAuNzk2OSBMMTY0MS42Niw0NzcuMzkgQTIuNSwyLjUgMCAwIDEgMTYzOS4xNiw0NzkuODkgTDUxMy4xNiw0NzkuODkgQTIuNSwyLjUgMCAwIDEgNTEwLjY2LDQ3Ny4zOSBMNTEwLjY2LDguNSBBMi41LDIuNSAwIDAgMSA1MTMuMTYsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTEwLjY2IiB4Mj0iODE0Ljc2ODMiIHkxPSIyOC4yOTY5IiB5Mj0iMjguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOTEuMTA4MyIgeD0iNTE0LjY2IiB5PSIyMC45OTUxIj5IZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIChDUVJTL0VTICYjMjkyNTY7KTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgSW5ib3VuZCBBZGFwdGVycy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkluYm91bmQgQWRhcHRlcnMiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDAzIj48cGF0aCBkPSJNNTczLjE2LDQ5IEw3MTUuNTU0NSw0OSBBMy43NSwzLjc1IDAgMCAxIDcxOC4wNTQ1LDUxLjUgTDcyNS4wNTQ1LDcxLjI5NjkgTDc1MC4xNiw3MS4yOTY5IEEyLjUsMi41IDAgMCAxIDc1Mi42Niw3My43OTY5IEw3NTIuNjYsMTQzLjggQTIuNSwyLjUgMCAwIDEgNzUwLjE2LDE0Ni4zIEw1NzMuMTYsMTQ2LjMgQTIuNSwyLjUgMCAwIDEgNTcwLjY2LDE0My44IEw1NzAuNjYsNTEuNSBBMi41LDIuNSAwIDAgMSA1NzMuMTYsNDkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjU3MC42NiIgeDI9IjcyNS4wNTQ1IiB5MT0iNzEuMjk2OSIgeTI9IjcxLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQxLjM5NDUiIHg9IjU3NC42NiIgeT0iNjMuOTk1MSI+SW5ib3VuZCBBZGFwdGVyczwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gQ29yZS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0iZW50MDAwNSI+PHBhdGggZD0iTTUzNy4xNiwxNzAuMyBMNjY4LjYyMzksMTcwLjMgQTMuNzUsMy43NSAwIDAgMSA2NzEuMTIzOSwxNzIuOCBMNjc4LjEyMzksMTkyLjU5NjkgTDEyNTAuMTYsMTkyLjU5NjkgQTIuNSwyLjUgMCAwIDEgMTI1Mi42NiwxOTUuMDk2OSBMMTI1Mi42Niw0NTMuMzkgQTIuNSwyLjUgMCAwIDEgMTI1MC4xNiw0NTUuODkgTDUzNy4xNiw0NTUuODkgQTIuNSwyLjUgMCAwIDEgNTM0LjY2LDQ1My4zOSBMNTM0LjY2LDE3Mi44IEEyLjUsMi41IDAgMCAxIDUzNy4xNiwxNzAuMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTM0LjY2IiB4Mj0iNjc4LjEyMzkiIHkxPSIxOTIuNTk2OSIgeTI9IjE5Mi41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC40NjM5IiB4PSI1MzguNjYiIHk9IjE4NS4yOTUxIj5BcHBsaWNhdGlvbiBDb3JlPC90ZXh0PjwvZz48IS0tY2x1c3RlciBBcHBsaWNhdGlvbiBMYXllci0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuQXBwbGljYXRpb24gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjExIiBpZD0iZW50MDAwNiI+PHBhdGggZD0iTTU2MS4xNiwyMTMuMyBMNzAwLjIyNTQsMjEzLjMgQTMuNzUsMy43NSAwIDAgMSA3MDIuNzI1NCwyMTUuOCBMNzA5LjcyNTQsMjM1LjU5NjkgTDEwODIuMTYsMjM1LjU5NjkgQTIuNSwyLjUgMCAwIDEgMTA4NC42NiwyMzguMDk2OSBMMTA4NC42NiwzMDguMDkgQTIuNSwyLjUgMCAwIDEgMTA4Mi4xNiwzMTAuNTkgTDU2MS4xNiwzMTAuNTkgQTIuNSwyLjUgMCAwIDEgNTU4LjY2LDMwOC4wOSBMNTU4LjY2LDIxNS44IEEyLjUsMi41IDAgMCAxIDU2MS4xNiwyMTMuMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTU4LjY2IiB4Mj0iNzA5LjcyNTQiIHkxPSIyMzUuNTk2OSIgeTI9IjIzNS41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOC4wNjU0IiB4PSI1NjIuNjYiIHk9IjIyOC4yOTUxIj5BcHBsaWNhdGlvbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgRG9tYWluIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5Eb21haW4gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjE3IiBpZD0iZW50MDAxMCI+PHBhdGggZD0iTTU2OS4xNiwzMzQuNTkgTDY3OC45Njc2LDMzNC41OSBBMy43NSwzLjc1IDAgMCAxIDY4MS40Njc2LDMzNy4wOSBMNjg4LjQ2NzYsMzU2Ljg4NjkgTDEwNjIuMTYsMzU2Ljg4NjkgQTIuNSwyLjUgMCAwIDEgMTA2NC42NiwzNTkuMzg2OSBMMTA2NC42Niw0MjkuMzkgQTIuNSwyLjUgMCAwIDEgMTA2Mi4xNiw0MzEuODkgTDU2OS4xNiw0MzEuODkgQTIuNSwyLjUgMCAwIDEgNTY2LjY2LDQyOS4zOSBMNTY2LjY2LDMzNy4wOSBBMi41LDIuNSAwIDAgMSA1NjkuMTYsMzM0LjU5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1NjYuNjYiIHgyPSI2ODguNDY3NiIgeTE9IjM1Ni44ODY5IiB5Mj0iMzU2Ljg4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjgwNzYiIHg9IjU3MC42NiIgeT0iMzQ5LjU4NTEiPkRvbWFpbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQVBJIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5BUEkgTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0iZW50MDAxNCI+PHBhdGggZD0iTTExMTEuMTYsMjEzLjMgTDExODcuMjMyMywyMTMuMyBBMy43NSwzLjc1IDAgMCAxIDExODkuNzMyMywyMTUuOCBMMTE5Ni43MzIzLDIzNS41OTY5IEwxMjI2LjE2LDIzNS41OTY5IEEyLjUsMi41IDAgMCAxIDEyMjguNjYsMjM4LjA5NjkgTDEyMjguNjYsMzA4LjA5IEEyLjUsMi41IDAgMCAxIDEyMjYuMTYsMzEwLjU5IEwxMTExLjE2LDMxMC41OSBBMi41LDIuNSAwIDAgMSAxMTA4LjY2LDMwOC4wOSBMMTEwOC42NiwyMTUuOCBBMi41LDIuNSAwIDAgMSAxMTExLjE2LDIxMy4zIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMTA4LjY2IiB4Mj0iMTE5Ni43MzIzIiB5MT0iMjM1LjU5NjkiIHkyPSIyMzUuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NS4wNzIzIiB4PSIxMTEyLjY2IiB5PSIyMjguMjk1MSI+QVBJIExheWVyPC90ZXh0PjwvZz48IS0tY2x1c3RlciBPdXRib3VuZCBBZGFwdGVycy0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLk91dGJvdW5kIEFkYXB0ZXJzIiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgaWQ9ImVudDAwMTYiPjxwYXRoIGQ9Ik0xMjc5LjE2LDMzNC41OSBMMTQzNC45MzkzLDMzNC41OSBBMy43NSwzLjc1IDAgMCAxIDE0MzcuNDM5MywzMzcuMDkgTDE0NDQuNDM5MywzNTYuODg2OSBMMTYxNS4xNiwzNTYuODg2OSBBMi41LDIuNSAwIDAgMSAxNjE3LjY2LDM1OS4zODY5IEwxNjE3LjY2LDQyOS4zOSBBMi41LDIuNSAwIDAgMSAxNjE1LjE2LDQzMS44OSBMMTI3OS4xNiw0MzEuODkgQTIuNSwyLjUgMCAwIDEgMTI3Ni42Niw0MjkuMzkgTDEyNzYuNjYsMzM3LjA5IEEyLjUsMi41IDAgMCAxIDEyNzkuMTYsMzM0LjU5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxMjc2LjY2IiB4Mj0iMTQ0NC40MzkzIiB5MT0iMzU2Ljg4NjkiIHkyPSIzNTYuODg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTQuNzc5MyIgeD0iMTI4MC42NiIgeT0iMzQ5LjU4NTEiPk91dGJvdW5kIEFkYXB0ZXJzPC90ZXh0PjwvZz48IS0tZW50aXR5IFJFU1QgQ29udHJvbGxlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uSW5ib3VuZCBBZGFwdGVycy5SRVNUIENvbnRyb2xsZXIiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDA0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0OS42MzQ4IiB4PSI1ODYuODQiIHk9Ijg0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjcxNi40NzQ4IiB5PSI4OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNzE0LjQ3NDgiIHk9IjkxIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI3MTQuNDc0OCIgeT0iOTUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkuNjM0OCIgeD0iNjAxLjg0IiB5PSIxMTYuOTk1MSI+UkVTVCBDb250cm9sbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IEFnZ3JlZ2F0ZSBBZGFwdGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkFwcGxpY2F0aW9uIExheWVyLkFnZ3JlZ2F0ZSBBZGFwdGVyIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczLjUyNjQiIHg9IjU3NC45IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI3MjguNDI2NCIgeT0iMjUzLjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcyNi40MjY0IiB5PSIyNTUuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNzI2LjQyNjQiIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjUyNjQiIHg9IjU4OS45IiB5PSIyODEuMjk1MSI+QWdncmVnYXRlIEFkYXB0ZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5BcHBsaWNhdGlvbiBMYXllci5Qcm9qZWN0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA5Ljc4MTMiIHg9Ijc4My43NyIgeT0iMjQ4LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iODczLjU1MTMiIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI4NzEuNTUxMyIgeT0iMjU1LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijg3MS41NTEzIiB5PSIyNTkuMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9Ijc5OC43NyIgeT0iMjgxLjI5NTEiPlByb2plY3Rpb248L3RleHQ+PC9nPjwhLS1lbnRpdHkgUG9saWN5IEhhbmRsZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuQXBwbGljYXRpb24gTGF5ZXIuUG9saWN5IEhhbmRsZXIiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDAuMzQ0NyIgeD0iOTI4LjQ5IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxMDQ4LjgzNDciIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDQ2LjgzNDciIHk9IjI1NS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDQ2LjgzNDciIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAwLjM0NDciIHg9Ijk0My40OSIgeT0iMjgxLjI5NTEiPlBvbGljeSBIYW5kbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uQXBwbGljYXRpb24gQ29yZS5Eb21haW4gTGF5ZXIuRG9tYWluIE1vZGVsIiBkYXRhLXNvdXJjZS1saW5lPSIxOCIgaWQ9ImVudDAwMTEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwLjgwOTYiIHg9IjU4Mi4yNiIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjcwMy4wNjk2IiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcwMS4wNjk2IiB5PSIzNzYuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcwMS4wNjk2IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDAuODA5NiIgeD0iNTk3LjI2IiB5PSI0MDIuNTg1MSI+RG9tYWluIE1vZGVsPC90ZXh0PjwvZz48IS0tZW50aXR5IENvbW1hbmRzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkRvbWFpbiBMYXllci5Db21tYW5kcyIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGlkPSJlbnQwMDEyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExOS4yNDkiIHg9Ijc1OC4wNCIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9Ijg1Ny4yODkiIHk9IjM3NC41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iODU1LjI4OSIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI4NTUuMjg5IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OS4yNDkiIHg9Ijc3My4wNCIgeT0iNDAyLjU4NTEiPkNvbW1hbmRzPC90ZXh0PjwvZz48IS0tZW50aXR5IFZhbHVlIE9iamVjdHMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIC4uLkFwcGxpY2F0aW9uIENvcmUuRG9tYWluIExheWVyLlZhbHVlIE9iamVjdHMiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBpZD0iZW50MDAxMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzYuODcyMSIgeD0iOTEyLjIyIiB5PSIzNjkuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTAyOS4wOTIxIiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjEwMjcuMDkyMSIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDI3LjA5MjEiIHk9IjM4MC41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2Ljg3MjEiIHg9IjkyNy4yMiIgeT0iNDAyLjU4NTEiPlZhbHVlIE9iamVjdHM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgRXZlbnRzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5BcHBsaWNhdGlvbiBDb3JlLkFQSSBMYXllci5FdmVudHMiIGRhdGEtc291cmNlLWxpbmU9IjI0IiBpZD0iZW50MDAxNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4Ny40MDA0IiB4PSIxMTI0Ljk2IiB5PSIyNDguMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxMTkyLjM2MDQiIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkwLjM2MDQiIHk9IjI1NS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMTkwLjM2MDQiIHk9IjI1OS4zIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDcuNDAwNCIgeD0iMTEzOS45NiIgeT0iMjgxLjI5NTEiPkV2ZW50czwvdGV4dD48L2c+PCEtLWVudGl0eSBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgLi4uT3V0Ym91bmQgQWRhcHRlcnMuTXlCYXRpcyBNYXBwZXIiIGRhdGEtc291cmNlLWxpbmU9IjI5IiBpZD0iZW50MDAxNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTIuNDcxNyIgeD0iMTI5Mi40MiIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE0MjQuODkxNyIgeT0iMzc0LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNDIyLjg5MTciIHk9IjM3Ni41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTQyMi44OTE3IiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMTMwNy40MiIgeT0iNDAyLjU4NTEiPk15QmF0aXMgTWFwcGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IEV2ZW50IFN0b3JlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyAuLi5PdXRib3VuZCBBZGFwdGVycy5FdmVudCBTdG9yZSIgZGF0YS1zb3VyY2UtbGluZT0iMzAiIGlkPSJlbnQwMDE4Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMS44NjcyIiB4PSIxNDc5LjczIiB5PSIzNjkuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTU4MS41OTcyIiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE1NzkuNTk3MiIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNTc5LjU5NzIiIHk9IjM4MC41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjE0OTQuNzMiIHk9IjQwMi41ODUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMjIiIGRhdGEtc291cmNlLWxpbmU9IjM5IiBpZD0iZW50MDAyMyI+PHBhdGggZD0iTTI4Mi4xOCwyNDMuNzUgTDI4Mi4xOCwyOTkuMTQ4NCBBMCwwIDAgMCAwIDI4Mi4xOCwyOTkuMTQ4NCBMNDQ0LjU3LDI5OS4xNDg0IEw2MDIuNzQsMzY5LjE4IEw0NTIuNTcsMjk5LjE0ODQgTDQ5NS4xMzMyLDI5OS4xNDg0IEEwLDAgMCAwIDAgNDk1LjEzMzIsMjk5LjE0ODQgTDQ5NS4xMzMyLDI1My43NSBMNDg1LjEzMzIsMjQzLjc1IEwyODIuMTgsMjQzLjc1IEEwLDAgMCAwIDAgMjgyLjE4LDI0My43NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTQ4NS4xMzMyLDI0My43NSBMNDg1LjEzMzIsMjUzLjc1IEw0OTUuMTMzMiwyNTMuNzUgTDQ4NS4xMzMyLDI0My43NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjI4OC4xOCIgeT0iMjYwLjgxNjkiPiYjMzIwMjA7JiMzMTg4MzsmIzEyMzk0OyYjMTI0ODk7JiMxMjUxMzsmIzEyNDUyOyYjMTI1MzE7JiMxMjUxNDsmIzEyNDg3OyYjMTI1MjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5MS45NTMyIiB4PSIyODguMTgiIHk9IjI3NS45NDk3Ij5BeG9uIEZyYW1ld29yayAmIzEyMzk1OyYjMjAzODE7JiMyMzM4NDsmIzEyMzc1OyYjMTIzOTQ7JiMxMjM1Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjI4OC4xOCIgeT0iMjkxLjA4MjUiPiYjMTI0OTk7JiMxMjQ3MjsmIzEyNDkzOyYjMTI0NzM7JiMxMjUyNTsmIzEyNDcyOyYjMTI0ODM7JiMxMjQ2MzsmIzEyMzk4OyYjMTI0MTU7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4yNSIgZGF0YS1zb3VyY2UtbGluZT0iNDUiIGlkPSJlbnQwMDI2Ij48cGF0aCBkPSJNNiwyNDMuNzUgTDYsMjk5LjE0ODQgTDI0Ny4zMjA4LDI5OS4xNDg0IEwyNDcuMzIwOCwyNTMuNzUgTDIzNy4zMjA4LDI0My43NSBMNiwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yMzcuMzIwOCwyNDMuNzUgTDIzNy4zMjA4LDI1My43NSBMMjQ3LjMyMDgsMjUzLjc1IEwyMzcuMzIwOCwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTQuOTExNyIgeD0iMTIiIHk9IjI2MC44MTY5Ij5BeG9uICYjMjk5OTI7JiMxMjQ1MDsmIzEyNDgwOyYjMTI1MDM7JiMxMjQ3OTsmIzEyNTQwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjAuMzIwOCIgeD0iMTIiIHk9IjI3NS45NDk3Ij5AQWdncmVnYXRlLCBAQ29tbWFuZEhhbmRsZXI8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU2LjAwMDIiIHg9IjEyIiB5PSIyOTEuMDgyNSI+JiMxMjUwMTsmIzEyNTI0OyYjMTI1NDA7JiMxMjUxMjsmIzEyNTI3OyYjMTI1NDA7JiMxMjQ2MzsmIzIwMzgxOyYjMjMzODQ7JiMxMjQzNDsmIzIxNTYwOyYjMjE0NTQ7PC90ZXh0PjwvZz48IS0tbGluayBSRVNUIENvbnRyb2xsZXIgdG8gQWdncmVnYXRlIEFkYXB0ZXItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAwNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjM0IiBpZD0ibG5rMTkiPjxwYXRoIGQ9Ik02NjEuNjYsMTMwLjcxIEM2NjEuNjYsMTYxLjYzIDY2MS42NiwyMTAuODUgNjYxLjY2LDI0MS44MSIgZmlsbD0ibm9uZSIgaWQ9IlJFU1QgQ29udHJvbGxlci10by1BZ2dyZWdhdGUgQWRhcHRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjYxLjY2LDI0Ny44MSw2NjUuNjYsMjM4LjgxLDY2MS42NiwyNDIuODEsNjU3LjY2LDIzOC44MSw2NjEuNjYsMjQ3LjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEFnZ3JlZ2F0ZSBBZGFwdGVyIHRvIERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA3IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzUiIGlkPSJsbmsyMCI+PHBhdGggZD0iTTY1OS45NywyOTQuODggQzY1OC4zNiwzMTYuMjEgNjU2LjM5OTYsMzQyLjEyNjkgNjU0Ljc5OTYsMzYzLjQxNjkiIGZpbGw9Im5vbmUiIGlkPSJBZ2dyZWdhdGUgQWRhcHRlci10by1Eb21haW4gTW9kZWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY1NC4zNSwzNjkuNCw2NTkuMDEzMiwzNjAuNzI1MSw2NTQuNzI0NywzNjQuNDE0MSw2NTEuMDM1NywzNjAuMTI1NSw2NTQuMzUsMzY5LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUHJvamVjdGlvbiB0byBNeUJhdGlzIE1hcHBlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDE3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMzYiIGlkPSJsbmsyMSI+PHBhdGggZD0iTTg2Ni4zNSwyOTQuOTkgQzg3OS4wNywzMDQuMDQgODk0LjgzLDMxMy41MSA5MTAuNjYsMzE4LjU5IEM5NDMuMjksMzI5LjA4IDEwMzAuNjksMzIyLjEgMTA2NC42NiwzMjYuNTkgQzExNDIuOTIsMzM2Ljk0IDEyMjUuMTU0MiwzNTUuMjk0NSAxMjg2LjI3NDIsMzcwLjM1NDUiIGZpbGw9Im5vbmUiIGlkPSJQcm9qZWN0aW9uLXRvLU15QmF0aXMgTWFwcGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMjkyLjEsMzcxLjc5LDEyODQuMzE4MywzNjUuNzUzLDEyODcuMjQ1MiwzNzAuNTkzOCwxMjgyLjQwNDQsMzczLjUyMDYsMTI5Mi4xLDM3MS43OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBHTU4yNSB0byBBZ2dyZWdhdGUgQWRhcHRlci0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDI2IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iYXNzb2NpYXRpb24iIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBpZD0ibG5rMjciPjxwYXRoIGQ9Ik0xNTQuMjEsMjQzLjQ0IEMxODAuMzgsMjE4LjQ2IDIyMS45NiwxODIuNzYgMjY0LjY2LDE2Mi4zIEMyNzEuODYsMTU4Ljg1IDI3NC4yMywxNTkuMTkgMjgyLjE2LDE1OC4zIEMzMjkuMiwxNTIuOTkgNDQ4LjEzLDE1Mi45OSA0OTUuMTYsMTU4LjMgQzU1Ni44LDE2NS4yNSA2MTMuMDEsMjE2Ljk2IDY0MS42OCwyNDguMDEiIGZpbGw9Im5vbmUiIGlkPSJHTU4yNS1BZ2dyZWdhdGUgQWRhcHRlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48P3BsYW50dW1sLXNyYyBSTEJUUWpIMDVCd1ZmcFpNNm1NQlJvMkRRVmUzTkxqdFlwVWI1eEY5UjhteEVuQ2NpemY1MTlDSFIxNV9xNGd6QVFYdThUUXdlNXZLNEZpbW5zTFZtdmJpQjY1dG9TdDlkRV9sZDliQjRVaWFXYTRweUJVek13aVIwT0lTUFhkOWtlYjhnUTh6UURFbTZvbFA1djRsa0xIbVVJTG03bzZmUlQyT21TOFFzd0VuNTlJM2Z5QXhZTVFYeFlpNkxfcFJwVFJyZTBOWldfc2gyXzJtbmJXTlJJUzhOYUhKcExKY2tabERlQktEbFhIUUlTd1BzWU1GUVdtbEpOYUlLZnI4T0o2QUVTUlN2V09UQzVOZ1VONmlNNG1yLXMtcEl0UXNiQm5kdXJjVy12Nk1ETzByQWc4UGxzTlBlcWJUaEpmZW84WG5vX0xiaHNUdmNJdGxLRHZkaURic21qYkt3Z3RyY2FIbWR1YTllZXhQeEVpdm9zV0NSamZ2Q2NaR0Qyc0pic0hlUUpqeGZKMnBDNVhTbDA1cG52dXpjczJkWGdmalB6QVZKYTY0ajFmUWZZMHhxLXBucHlGbnpzVU9WcTVwV0VPMzVmX0dfNDNwNFNySkQyVjRzeEVOaXM4VjU3aVdMSFNtRl9keHZ0WHEtV3hwOHlWOWRuMHFSeDB1R19DU1lyemVKaWxRTzM3NF8xbGN2dUpQNUpkeEFXSGQ3THNjYzNEbHdKSy1fOG81VE4tQ3ZXWUJTcElfb1Q4NXpYZWlMSlRPdFJ2clZ1bGNncU1YVU96Y3c4ZllNNEtpTmV6VWRPclVsaFo4eTB5MD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>設計原則：</strong></p>
<ol>
<li><strong>ドメインモデルの純粋性</strong>: ドメインモデルは Axon に依存しない純粋な Java コード</li>
<li><strong>Aggregate Adapter</strong>: Axon Framework 用のアダプターを Application Layer に配置</li>
<li><strong>イベントは公開 API</strong>: イベントは他の Context から参照される公開 API として定義</li>
</ol>
<hr />
<h3 id="264">26.4 技術スタック<a class="headerlink" href="#264" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カテゴリ</th>
<th>技術</th>
<th>バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td>言語</td>
<td>Java</td>
<td>21</td>
</tr>
<tr>
<td>フレームワーク</td>
<td>Spring Boot</td>
<td>3.4.1</td>
</tr>
<tr>
<td>CQRS/ES</td>
<td>Axon Framework</td>
<td>4.10.3</td>
</tr>
<tr>
<td>ORM</td>
<td>MyBatis</td>
<td>3.0.4</td>
</tr>
<tr>
<td>API ドキュメント</td>
<td>SpringDoc OpenAPI</td>
<td>2.7.0</td>
</tr>
<tr>
<td>データベース</td>
<td>H2 (開発) / PostgreSQL (本番)</td>
<td>-</td>
</tr>
</tbody>
</table>
<h4 id="buildgradlekts">build.gradle.kts<a class="headerlink" href="#buildgradlekts" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: build.gradle.kts</summary>

<div class="highlight"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Spring Boot</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-validation&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Axon Framework</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-spring-boot-starter:4.10.3&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exclude</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;org.axonframework&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;axon-server-connector&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// MyBatis</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.4&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// OpenAPI</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springdoc:springdoc-openapi-starter-webmvc-ui:2.7.0&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Database</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;com.h2database:h2&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;org.postgresql:postgresql&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-test:4.10.3&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.mybatis.spring.boot:mybatis-spring-boot-starter-test:3.0.4&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="265">26.5 ディレクトリ構造<a class="headerlink" href="#265" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: ディレクトリ構成</summary>

<div class="highlight"><pre><span></span><code>src/main/java/com/example/accounting/
├── app/                              # アプリケーション共通
│   └── RootController.java
├── config/                           # 設定クラス
│   ├── AxonConfig.java
│   ├── MyBatisConfig.java
│   └── OpenApiConfig.java
├── journal/                          # Journal Bounded Context（仕訳）
│   ├── api/
│   │   └── events/                   # 公開イベント API
│   │       ├── JournalEntryEvent.java     # sealed interface
│   │       ├── JournalEntryCreatedEvent.java
│   │       ├── JournalEntryApprovedEvent.java
│   │       └── JournalEntryPostedEvent.java
│   ├── adapter/
│   │   ├── inbound/rest/journals/    # Inbound Adapter (REST)
│   │   │   ├── JournalsController.java
│   │   │   └── protocol/             # Request/Response DTO
│   │   └── outbound/persistence/     # Outbound Adapter (MyBatis)
│   │       ├── entity/
│   │       │   └── JournalEntryEntity.java
│   │       └── mapper/
│   │           └── JournalEntryMapper.java
│   ├── application/
│   │   ├── aggregate/                # Axon Aggregate Adapter
│   │   │   └── JournalEntryAggregateAdapter.java
│   │   ├── policy/                   # イベントハンドラー（Choreography）
│   │   │   └── AccountEventHandler.java
│   │   └── query/                    # Projection
│   │       └── JournalEntryProjection.java
│   └── domain/
│       └── model/aggregate/journal/  # 純粋なドメインモデル
│           ├── JournalEntry.java
│           ├── JournalEntryCommands.java
│           ├── JournalEntryStatus.java
│           └── JournalLine.java
└── account/                          # Account Bounded Context（勘定科目）
    ├── api/events/
    │   ├── AccountEvent.java
    │   ├── AccountBalanceUpdatedEvent.java
    │   └── AccountClosedEvent.java
    ├── application/
    │   ├── aggregate/
    │   │   └── AccountAggregateAdapter.java
    │   └── policy/
    │       └── JournalEventHandler.java
    └── domain/model/aggregate/account/
        ├── Account.java
        └── AccountCommands.java

src/main/resources/
├── application.yml
├── schema.sql                        # Read Model スキーマ
└── mapper/
    └── JournalEntryMapper.xml        # MyBatis マッパー XML
</code></pre></div>

</details>

<hr />
<h3 id="266-axon">26.6 Axon 設定クラス<a class="headerlink" href="#266-axon" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: AxonConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EmbeddedEventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.Serializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.json.JacksonSerializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Axon Framework 設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AxonConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JDBC ベースの Event Storage Engine</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="nf">eventStorageEngine</span><span class="p">(</span>
<span class="w">            </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">,</span>
<span class="w">            </span><span class="n">Serializer</span><span class="w"> </span><span class="n">serializer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JdbcEventStorageEngine</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">snapshotSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">eventSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">dataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Event Store</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStore</span><span class="w"> </span><span class="nf">eventStore</span><span class="p">(</span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="n">eventStorageEngine</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EmbeddedEventStore</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">storageEngine</span><span class="p">(</span><span class="n">eventStorageEngine</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JSON シリアライザー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Serializer</span><span class="w"> </span><span class="nf">eventSerializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JacksonSerializer</span><span class="p">.</span><span class="na">defaultSerializer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="267-mybatis">26.7 MyBatis 設定クラス<a class="headerlink" href="#267-mybatis" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: MyBatisConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.session.SqlSessionFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.SqlSessionFactoryBean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.annotation.MapperScan</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.core.io.support.PathMatchingResourcePatternResolver</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * MyBatis 設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@MapperScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;com.example.accounting.journal.adapter.outbound.persistence.mapper&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;com.example.accounting.account.adapter.outbound.persistence.mapper&quot;</span>
<span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyBatisConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SqlSessionFactory</span><span class="w"> </span><span class="nf">sqlSessionFactory</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SqlSessionFactoryBean</span><span class="w"> </span><span class="n">factoryBean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlSessionFactoryBean</span><span class="p">();</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setMapperLocations</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">PathMatchingResourcePatternResolver</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">getResources</span><span class="p">(</span><span class="s">&quot;classpath:mapper/**/*.xml&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setTypeAliasesPackage</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;com.example.accounting.journal.adapter.outbound.persistence.entity,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;com.example.accounting.account.adapter.outbound.persistence.entity&quot;</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">session</span><span class="p">.</span><span class="na">Configuration</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">ibatis</span><span class="p">.</span><span class="na">session</span><span class="p">.</span><span class="na">Configuration</span><span class="p">();</span>
<span class="w">        </span><span class="n">configuration</span><span class="p">.</span><span class="na">setMapUnderscoreToCamelCase</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">setConfiguration</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">factoryBean</span><span class="p">.</span><span class="na">getObject</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="27">第27章：ドメインモデルとイベント設計<a class="headerlink" href="#27" title="Permanent link">&para;</a></h2>
<h3 id="271-journal-bounded-context">27.1 Journal Bounded Context<a class="headerlink" href="#271-journal-bounded-context" title="Permanent link">&para;</a></h3>
<p>仕訳の作成から転記完了までのライフサイクルを管理します。</p>
<h4 id="_2">状態遷移図<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNUQVRFIiBoZWlnaHQ9IjU3N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzE2cHg7aGVpZ2h0OjU3N3B4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDcxNiA1NzciIHdpZHRoPSI3MTZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjAxODE7JiMzNTM3OTsmIzY1Mjg4O0pvdXJuYWwgRW50cnkmIzY1Mjg5OyYjMTIzOTg7JiMyOTM2NjsmIzI0OTA3OyYjMzY5ODM7JiMzMTIyNzs8L3RpdGxlPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRkVGRUZFIiBoZWlnaHQ9IjU3NyIgc3R5bGU9InN0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjcxNiIgeD0iMCIgeT0iMCIvPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMyI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyOS4wMzc1IiB4PSIyMzYuNTA0MyIgeT0iMjIuOTk1MSI+JiMyMDE4MTsmIzM1Mzc5OyYjNjUyODg7Sm91cm5hbCBFbnRyeSYjNjUyODk7JiMxMjM5ODsmIzI5MzY2OyYjMjQ5MDc7JiMzNjk4MzsmIzMxMjI3OzwvdGV4dD48L2c+PGVsbGlwc2UgY3g9IjI5Mi44NCIgY3k9IjUzLjI5NjkiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2Ni42ODk1IiB4PSIyNTkuNDkiIHk9IjE0MC4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjU5LjQ5IiB4Mj0iMzI2LjE3OTUiIHkxPSIxNjYuNTkzOCIgeTI9IjE2Ni41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDYuNjg5NSIgeD0iMjY5LjQ5IiB5PSIxNTguMjkyIj5EUkFGVDwvdGV4dD48L2c+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjUuMTU0MyIgeD0iMjEwLjI2IiB5PSIyNjcuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIxMC4yNiIgeDI9IjM3NS40MTQzIiB5MT0iMjkzLjU5MzgiIHkyPSIyOTMuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NS4xNTQzIiB4PSIyMjAuMjYiIHk9IjI4NS4yOTIiPlBFTkRJTkdfQVBQUk9WQUw8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTAzLjY3MTkiIHg9IjciIHk9IjM5NC4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNyIgeDI9IjExMC42NzE5IiB5MT0iNDIwLjU5MzgiIHkyPSI0MjAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjY3MTkiIHg9IjE3IiB5PSI0MTIuMjkyIj5DQU5DRUxMRUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTYuNDEyMSIgeD0iMjI0LjYzIiB5PSIzOTQuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIyNC42MyIgeDI9IjMyMS4wNDIxIiB5MT0iNDIwLjU5MzgiIHkyPSI0MjAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc2LjQxMjEiIHg9IjIzNC42MyIgeT0iNDEyLjI5MiI+QVBQUk9WRUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODkuNTAxIiB4PSI0OTIuMDkiIHk9IjM5NC4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDkyLjA5IiB4Mj0iNTgxLjU5MSIgeTE9IjQyMC41OTM4IiB5Mj0iNDIwLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS41MDEiIHg9IjUwMi4wOSIgeT0iNDEyLjI5MiI+UkVKRUNURUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzYuNTI2NCIgeD0iMjM0LjU3IiB5PSI1MjEuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIzNC41NyIgeDI9IjMxMS4wOTY0IiB5MT0iNTQ3LjU5MzgiIHkyPSI1NDcuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2LjUyNjQiIHg9IjI0NC41NyIgeT0iNTM5LjI5MiI+UE9TVEVEPC90ZXh0PjwvZz48IS0tbGluayAqc3RhcnQqIHRvIERSQUZULS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDIiIGRhdGEtZW50aXR5LTI9ImVudDAwMDMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0ibG5rNCI+PHBhdGggZD0iTTI5Mi44NCw2My42NzY5IEMyOTIuODQsODAuNDA2OSAyOTIuODQsMTA5Ljg4NjkgMjkyLjg0LDEzMy45MjY5IiBmaWxsPSJub25lIiBpZD0iKnN0YXJ0Ki10by1EUkFGVCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjkyLjg0LDEzOS45MjY5LDI5Ni44NCwxMzAuOTI2OSwyOTIuODQsMTM0LjkyNjksMjg4Ljg0LDEzMC45MjY5LDI5Mi44NCwxMzkuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS41MTA3IiB4PSIyOTMuODQiIHk9IjEwNi4zNjM4Ij5Kb3VybmFsRW50cnlDcmVhdGVkPC90ZXh0PjwvZz48IS0tbGluayBEUkFGVCB0byBQRU5ESU5HX0FQUFJPVkFMLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDUiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0ibG5rNiI+PHBhdGggZD0iTTI5Mi44NCwxOTAuNjk2OSBDMjkyLjg0LDIxMi43MTY5IDI5Mi44NCwyMzguOTU2OSAyOTIuODQsMjYwLjk1NjkiIGZpbGw9Im5vbmUiIGlkPSJEUkFGVC10by1QRU5ESU5HX0FQUFJPVkFMIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyOTIuODQsMjY2Ljk1NjksMjk2Ljg0LDI1Ny45NTY5LDI5Mi44NCwyNjEuOTU2OSwyODguODQsMjU3Ljk1NjksMjkyLjg0LDI2Ni45NTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ3LjI0MDIiIHg9IjI5My44NCIgeT0iMjMzLjM2MzgiPkpvdXJuYWxFbnRyeVN1Ym1pdHRlZDwvdGV4dD48L2c+PCEtLWxpbmsgRFJBRlQgdG8gQ0FOQ0VMTEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0ibG5rOCI+PHBhdGggZD0iTTI1OS4wMiwxNjguODE2OSBDMjAzLjc4LDE3NC45NzY5IDk1LjU3LDE5NS45OTY5IDQ3Ljg0LDI2Ny4yOTY5IEMyMi4yNSwzMDUuNTE2OSAzNC43MDc1LDM1Ni40MTYyIDQ2LjQ2NzUsMzg4LjM2NjIiIGZpbGw9Im5vbmUiIGlkPSJEUkFGVC10by1DQU5DRUxMRUQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ4LjU0LDM5My45OTY5LDQ5LjE4NSwzODQuMTY5Miw0Ni44MTI5LDM4OS4zMDQ2LDQxLjY3NzQsMzg2LjkzMjUsNDguNTQsMzkzLjk5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuNjc5MiIgeD0iNDguODQiIHk9IjI5Ni44NjM4Ij5Kb3VybmFsRW50cnlDYW5jZWxsZWQ8L3RleHQ+PC9nPjwhLS1saW5rIFBFTkRJTkdfQVBQUk9WQUwgdG8gQVBQUk9WRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNSIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJsbmsxMCI+PHBhdGggZD0iTTI4MC4wMSwzMTcuNjI2OSBDMjc1LjkxLDMyNi42NzY5IDI3MS44OSwzMzcuMjE2OSAyNjkuODQsMzQ3LjI5NjkgQzI2Ni43LDM2Mi42NDY5IDI2Ni43Njg4LDM3NC4yODIzIDI2OC4yNzg4LDM4OC4xMTIzIiBmaWxsPSJub25lIiBpZD0iUEVORElOR19BUFBST1ZBTC10by1BUFBST1ZFRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjY4LjkzLDM5NC4wNzY5LDI3MS45Mjk1LDM4NC42OTU5LDI2OC4zODczLDM4OS4xMDY0LDI2My45NzY4LDM4NS41NjQyLDI2OC45MywzOTQuMDc2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Mi40MTYiIHg9IjI3MC44NCIgeT0iMzYwLjM2MzgiPkpvdXJuYWxFbnRyeUFwcHJvdmVkPC90ZXh0PjwvZz48IS0tbGluayBQRU5ESU5HX0FQUFJPVkFMIHRvIFJFSkVDVEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBpZD0ibG5rMTIiPjxwYXRoIGQ9Ik0zNTMuNjUsMzE3LjY5NjkgQzM3NC4zLDMyNi40NjY5IDM5Ny4zMiwzMzYuNzk2OSA0MTcuODQsMzQ3LjI5NjkgQzQ0NS41NywzNjEuNDg2OSA0NzAuNjA3NSwzNzYuMzE0IDQ5My42MDc1LDM5MC42NDQiIGZpbGw9Im5vbmUiIGlkPSJQRU5ESU5HX0FQUFJPVkFMLXRvLVJFSkVDVEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OTguNywzOTMuODE2OSw0OTMuMTc2NSwzODUuNjYyNyw0OTQuNDU2MywzOTEuMTcyOSw0ODguOTQ2MSwzOTIuNDUyNiw0OTguNywzOTMuODE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNi45MTI2IiB4PSI0NDguOTIiIHk9IjM2MC4zNjM4Ij5Kb3VybmFsRW50cnlSZWplY3RlZDwvdGV4dD48L2c+PCEtLWxpbmsgUEVORElOR19BUFBST1ZBTCB0byBDQU5DRUxMRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNSIgZGF0YS1lbnRpdHktMj0iZW50MDAwNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0ibG5rMTMiPjxwYXRoIGQ9Ik0yMTAuMDEsMzEzLjMyNjkgQzE3MS42MiwzMjMuNjE2OSAxMzAuOTcsMzM2LjI4NjkgMTE0Ljg0LDM0Ny4yOTY5IEM5Ny4yLDM1OS4zMjY5IDg1Ljc0MDksMzczLjU2NzUgNzUuODMwOSwzODkuMDA3NSIgZmlsbD0ibm9uZSIgaWQ9IlBFTkRJTkdfQVBQUk9WQUwtdG8tQ0FOQ0VMTEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3Mi41OSwzOTQuMDU2OSw4MC44MTc2LDM4OC42NDM0LDc1LjI5MDgsMzg5Ljg0OSw3NC4wODUxLDM4NC4zMjIyLDcyLjU5LDM5NC4wNTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzLjY3OTIiIHg9IjExNS44NCIgeT0iMzYwLjM2MzgiPkpvdXJuYWxFbnRyeUNhbmNlbGxlZDwvdGV4dD48L2c+PCEtLWxpbmsgQVBQUk9WRUQgdG8gUE9TVEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDkiIGRhdGEtZW50aXR5LTI9ImVudDAwMTQiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImxuazE1Ij48cGF0aCBkPSJNMjcyLjg0LDQ0NC42OTY5IEMyNzIuODQsNDY2LjcxNjkgMjcyLjg0LDQ5Mi45NTY5IDI3Mi44NCw1MTQuOTU2OSIgZmlsbD0ibm9uZSIgaWQ9IkFQUFJPVkVELXRvLVBPU1RFRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjcyLjg0LDUyMC45NTY5LDI3Ni44NCw1MTEuOTU2OSwyNzIuODQsNTE1Ljk1NjksMjY4Ljg0LDUxMS45NTY5LDI3Mi44NCw1MjAuOTU2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMy42OTA0IiB4PSIyNzMuODQiIHk9IjQ4Ny4zNjM4Ij5Kb3VybmFsRW50cnlQb3N0ZWQ8L3RleHQ+PC9nPjwhLS1saW5rIFJFSkVDVEVEIHRvIERSQUZULS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTEiIGRhdGEtZW50aXR5LTI9ImVudDAwMDMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImxuazE2Ij48cGF0aCBkPSJNNTc0LjYxLDM5NC4xMDY5IEM1ODkuNiwzODEuMjY2OSA2MDEuNjQsMzY0LjU4NjkgNTkzLjg0LDM0Ny4yOTY5IEM1NDQuNjYsMjM4LjM2NjkgNDAwLjE3NzMsMTkxLjU2NjIgMzMyLjQxNzMsMTc0Ljk0NjIiIGZpbGw9Im5vbmUiIGlkPSJSRUpFQ1RFRC10by1EUkFGVCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzI2LjU5LDE3My41MTY5LDMzNC4zNzgsMTc5LjU0NTcsMzMxLjQ0NjEsMTc0LjcwOCwzMzYuMjgzOCwxNzEuNzc2LDMyNi41OSwxNzMuNTE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS4xMzYyIiB4PSI1NzYuOTEiIHk9IjI5Ni44NjM4Ij5Kb3VybmFsRW50cnlSZXZpc2VkPC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBBeXhFcDJqOEI0aENMS1hBSkN2RUJ5ZWxwS2pucGlfOUJyOUdUZEM1R0l3a2Fpb0lkNUk1OXhrZGxiWW4tVnNVM2dfeXFnQXluMW01cnhvSWVpaHRVcGVWRHd2eHRoTmpNTWx0b3lSanB2Vmx2a0FBcmVmTHFETXJLdDA5U2RHQktSMUlXNmUwZ3RTa0lhcWlJS3RYV2lZMUwwTXUtaGJ1LWhkN0VtTzQxRmM3RVZnV1FHV2tKU2hEQjQ3THVrcGV2LXBndS1GZ1djdnVPYnZvUWF1RUsyczZlSTFqNDB3NkJpVTJXZ0J5Q2JvUVdib3pOOXIzQzNHNWZNUWI5ZlZXcWFKT1dOMnRXOEYwRm5aSlhlM3lPZjN2U0ZqblhNWEdRYmJjU01lQTAwMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_3">イベント一覧<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>イベント</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>JournalEntryCreatedEvent</code></td>
<td>仕訳が作成された</td>
</tr>
<tr>
<td><code>JournalEntrySubmittedEvent</code></td>
<td>仕訳が承認申請された</td>
</tr>
<tr>
<td><code>JournalEntryApprovedEvent</code></td>
<td>仕訳が承認された</td>
</tr>
<tr>
<td><code>JournalEntryRejectedEvent</code></td>
<td>仕訳が却下された</td>
</tr>
<tr>
<td><code>JournalEntryRevisedEvent</code></td>
<td>却下された仕訳が修正された</td>
</tr>
<tr>
<td><code>JournalEntryPostedEvent</code></td>
<td>仕訳が転記された（元帳に反映）</td>
</tr>
<tr>
<td><code>JournalEntryCancelledEvent</code></td>
<td>仕訳がキャンセルされた</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="272-api-layer">27.2 イベント定義（API Layer）<a class="headerlink" href="#272-api-layer" title="Permanent link">&para;</a></h3>
<h4 id="sealed-interface">sealed interface によるイベントの型安全性<a class="headerlink" href="#sealed-interface" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: JournalEntryEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry イベントの sealed interface</span>
<span class="cm"> * すべての JournalEntry イベントの親インターフェース</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">JournalEntryEvent</span><span class="w"> </span><span class="n">permits</span>
<span class="w">        </span><span class="n">JournalEntryCreatedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryApprovedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryRejectedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryRevisedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryPostedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">journalEntryId</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>sealed interface の利点：</strong></p>
<ul>
<li><strong>網羅性チェック</strong>: switch 式でコンパイル時に全ケースをチェック</li>
<li><strong>型安全性</strong>: 許可されたクラスのみが実装可能</li>
<li><strong>ドキュメント</strong>: 存在するイベントが一目でわかる</li>
</ul>
<h4 id="record">イベント record の実装<a class="headerlink" href="#record" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: JournalEntryCreatedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳作成イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳明細データ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalLineData</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalEntryApprovedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳承認イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntryApprovedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">approvedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalEntryPostedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳転記イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntryPostedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">postedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalEntryCancelledEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳キャンセルイベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntryCancelledEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="273-domain-layer">27.3 コマンド定義（Domain Layer）<a class="headerlink" href="#273-domain-layer" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryCommands.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.TargetAggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry 集約へのコマンド定義</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryCommands</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">JournalEntryCommands</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳作成コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineInput</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalLineInput</span><span class="p">(</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">,</span>
<span class="w">                </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">,</span>
<span class="w">                </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳承認申請コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">SubmitJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳承認コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ApproveJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">comment</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳却下コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">RejectJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳修正コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ReviseJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CreateJournalEntryCommand</span><span class="p">.</span><span class="na">JournalLineInput</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">revisedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳転記コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">PostJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳キャンセルコマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CancelJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>@TargetAggregateIdentifier の役割：</strong></p>
<ul>
<li>Axon がコマンドをどの集約インスタンスにルーティングするかを決定</li>
<li>集約の一意識別子となるフィールドに付与</li>
</ul>
<hr />
<h3 id="274-java">27.4 ドメインモデル（純粋な Java）<a class="headerlink" href="#274-java" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntry.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryCreatedEvent.JournalLineData</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry ドメインモデル（Axon 非依存）</span>
<span class="cm"> * 純粋なビジネスロジックのみを含む</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntry</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="n">status</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ======== ファクトリメソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳作成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// バリデーション: 借方・貸方の合計が一致すること</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalDebit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalLineData</span><span class="p">::</span><span class="n">debitAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalCredit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalLineData</span><span class="p">::</span><span class="n">creditAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">totalDebit</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">totalCredit</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;Debit and credit amounts must be equal. Debit: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">totalDebit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, Credit: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">totalCredit</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Journal entry must have at least one line&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">                </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">                </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="p">,</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">createdBy</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントからの再構築</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLine</span><span class="p">(</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">journalNumber</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== 状態遷移メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認申請</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only draft journal entries can be submitted&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="nf">approve</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">comment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">PENDING_APPROVAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only pending journal entries can be approved&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 却下</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="nf">reject</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">PENDING_APPROVAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only pending journal entries can be rejected&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryRejectedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 修正</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryRevisedEvent</span><span class="w"> </span><span class="nf">revise</span><span class="p">(</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">revisedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">REJECTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only rejected journal entries can be revised&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// バリデーション</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalDebit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalLineData</span><span class="p">::</span><span class="n">debitAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalCredit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalLineData</span><span class="p">::</span><span class="n">creditAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">totalDebit</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">totalCredit</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Debit and credit amounts must be equal&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryRevisedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">                </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="p">,</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">revisedBy</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 転記</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">APPROVED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only approved journal entries can be posted&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span><span class="w"> </span><span class="n">postedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセル</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">POSTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Posted journal entries cannot be cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Journal entry is already cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== イベント適用メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントを適用して新しい状態を生成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">PENDING_APPROVAL</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">APPROVED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">REJECTED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryRevisedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">revised</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">POSTED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 状態更新ヘルパー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="nf">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="n">newStatus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="n">newStatus</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 修正適用</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="nf">revised</span><span class="p">(</span><span class="n">JournalEntryRevisedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLine</span><span class="p">(</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">(</span>
<span class="w">                </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">                </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">newLines</span><span class="p">,</span>
<span class="w">                </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalEntryStatus.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳ステータス</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DRAFT</span><span class="p">,</span><span class="w">              </span><span class="c1">// 下書き</span>
<span class="w">    </span><span class="n">PENDING_APPROVAL</span><span class="p">,</span><span class="w">   </span><span class="c1">// 承認待ち</span>
<span class="w">    </span><span class="n">APPROVED</span><span class="p">,</span><span class="w">           </span><span class="c1">// 承認済み</span>
<span class="w">    </span><span class="n">REJECTED</span><span class="p">,</span><span class="w">           </span><span class="c1">// 却下</span>
<span class="w">    </span><span class="n">POSTED</span><span class="p">,</span><span class="w">             </span><span class="c1">// 転記済み</span>
<span class="w">    </span><span class="n">CANCELLED</span><span class="w">           </span><span class="c1">// キャンセル</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalLine.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳明細</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalLine</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalLine</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">debitAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="n">debitAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">creditAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="n">creditAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 借方と貸方は排他的</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">debitAmount</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">creditAmount</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;A journal line cannot have both debit and credit amounts&quot;</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>ドメインモデル設計原則：</strong></p>
<table>
<thead>
<tr>
<th>原則</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Axon 非依存</strong></td>
<td>ドメインモデルにフレームワーク依存を持たせない</td>
</tr>
<tr>
<td><strong>イミュータブル</strong></td>
<td>record でイミュータブルに設計</td>
</tr>
<tr>
<td><strong>イベントを返す</strong></td>
<td>状態遷移メソッドはイベントを返す</td>
</tr>
<tr>
<td><strong>最小限のフィールド</strong></td>
<td>状態遷移の判定に必要な最小限のみ保持</td>
</tr>
<tr>
<td><strong>ビジネスルール</strong></td>
<td>借方・貸方の一致検証をドメインモデル内で実施</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="275-account-bounded-context">27.5 Account Bounded Context<a class="headerlink" href="#275-account-bounded-context" title="Permanent link">&para;</a></h3>
<p>勘定科目の残高管理を行います。</p>
<h4 id="_4">イベント定義<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: AccountEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.account.api.events</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Account イベントの sealed interface</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountEvent</span><span class="w"> </span><span class="n">permits</span>
<span class="w">        </span><span class="n">AccountCreatedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">AccountBalanceUpdatedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">AccountClosedEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">accountCode</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: AccountBalanceUpdatedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.account.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 勘定残高更新イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">AccountBalanceUpdatedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">balanceAfter</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AccountEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="28aggregate-adapter-policy-handler">第28章：Aggregate Adapter と Policy Handler<a class="headerlink" href="#28aggregate-adapter-policy-handler" title="Permanent link">&para;</a></h2>
<h3 id="281-aggregate-adapter">28.1 Aggregate Adapter パターン<a class="headerlink" href="#281-aggregate-adapter" title="Permanent link">&para;</a></h3>
<p>Aggregate Adapter は、純粋なドメインモデルと Axon Framework を繋ぐアダプター層です。フレームワーク固有のアノテーションやライフサイクル処理をドメインモデルから分離します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjUxMHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjQycHg7aGVpZ2h0OjUxMHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY0MiA1MTAiIHdpZHRoPSI2NDJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTEwIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjQyIiB4PSIwIiB5PSIwIi8+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gTGF5ZXItLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQXBwbGljYXRpb24gTGF5ZXIiIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNOC41LDYgTDE0Ny41NjU0LDYgQTMuNzUsMy43NSAwIDAgMSAxNTAuMDY1NCw4LjUgTDE1Ny4wNjU0LDI4LjI5NjkgTDQ4Ny41LDI4LjI5NjkgQTIuNSwyLjUgMCAwIDEgNDkwLDMwLjc5NjkgTDQ5MCwyMDguNTUgQTIuNSwyLjUgMCAwIDEgNDg3LjUsMjExLjA1IEw4LjUsMjExLjA1IEEyLjUsMi41IDAgMCAxIDYsMjA4LjU1IEw2LDguNSBBMi41LDIuNSAwIDAgMSA4LjUsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE1Ny4wNjU0IiB5MT0iMjguMjk2OSIgeTI9IjI4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM4LjA2NTQiIHg9IjEwIiB5PSIyMC45OTUxIj5BcHBsaWNhdGlvbiBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgRG9tYWluIExheWVyLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBMYXllciIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDA0Ij48cGF0aCBkPSJNMzA3LjUsMjYwLjA1IEw0MTcuMzA3NiwyNjAuMDUgQTMuNzUsMy43NSAwIDAgMSA0MTkuODA3NiwyNjIuNTUgTDQyNi44MDc2LDI4Mi4zNDY5IEw2MzIuNSwyODIuMzQ2OSBBMi41LDIuNSAwIDAgMSA2MzUsMjg0Ljg0NjkgTDYzNSw0MTMuNyBBMi41LDIuNSAwIDAgMSA2MzIuNSw0MTYuMiBMMzA3LjUsNDE2LjIgQTIuNSwyLjUgMCAwIDEgMzA1LDQxMy43IEwzMDUsMjYyLjU1IEEyLjUsMi41IDAgMCAxIDMwNy41LDI2MC4wNSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzA1IiB4Mj0iNDI2LjgwNzYiIHkxPSIyODIuMzQ2OSIgeTI9IjI4Mi4zNDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC44MDc2IiB4PSIzMDkiIHk9IjI3NS4wNDUxIj5Eb21haW4gTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbGFzcyBKb3VybmFsRW50cnlBZ2dyZWdhdGVBZGFwdGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQXBwbGljYXRpb24gTGF5ZXIuSm91cm5hbEVudHJ5QWdncmVnYXRlQWRhcHRlciIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTU0LjA0NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ1MS4zMjUyIiB4PSIyMi4zNCIgeT0iNDEiLz48ZWxsaXBzZSBjeD0iMTM2LjI1NzUiIGN5PSI2MS4xMzI4IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0xMzkuMjI2Miw2Ni43NzM0IFExMzguNjQ4MSw2Ny4wNzAzIDEzOC4wMDc1LDY3LjIxMDkgUTEzNy4zNjY5LDY3LjM2NzIgMTM2LjY2MzcsNjcuMzY3MiBRMTM0LjE2MzcsNjcuMzY3MiAxMzIuODM1Niw2NS43MjY2IFExMzEuNTIzMSw2NC4wNzAzIDEzMS41MjMxLDYwLjk0NTMgUTEzMS41MjMxLDU3LjgyMDMgMTMyLjgzNTYsNTYuMTY0MSBRMTM0LjE2MzcsNTQuNTA3OCAxMzYuNjYzNyw1NC41MDc4IFExMzcuMzY2OSw1NC41MDc4IDEzOC4wMDc1LDU0LjY2NDEgUTEzOC42NjM3LDU0LjgyMDMgMTM5LjIyNjIsNTUuMTE3MiBMMTM5LjIyNjIsNTcuODM1OSBRMTM4LjYwMTIsNTcuMjU3OCAxMzguMDA3NSw1Ni45OTIyIFExMzcuNDEzNyw1Ni43MTA5IDEzNi43ODg3LDU2LjcxMDkgUTEzNS40NDUsNTYuNzEwOSAxMzQuNzU3NSw1Ny43ODkxIFExMzQuMDcsNTguODUxNiAxMzQuMDcsNjAuOTQ1MyBRMTM0LjA3LDYzLjAzOTEgMTM0Ljc1NzUsNjQuMTE3MiBRMTM1LjQ0NSw2NS4xNzk3IDEzNi43ODg3LDY1LjE3OTcgUTEzNy40MTM3LDY1LjE3OTcgMTM4LjAwNzUsNjQuOTE0MSBRMTM4LjYwMTIsNjQuNjMyOCAxMzkuMjI2Miw2NC4wNTQ3IEwxMzkuMjI2Miw2Ni43NzM0IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtc3R5bGU9Iml0YWxpYyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OS41MDIiIHg9IjIxOS41MDE2IiB5PSI1Ny4xMzg3Ij4mIzE3MTtAQWdncmVnYXRlJiMxODc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxNC45OTAyIiB4PSIxNTYuNzU3NSIgeT0iNzIuOTYzOSI+Sm91cm5hbEVudHJ5QWdncmVnYXRlQWRhcHRlcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMy4zNCIgeDI9IjQ3Mi42NjUyIiB5MT0iODEuMjY1NiIgeTI9IjgxLjI2NTYiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjMwLjM0IiB5PSI5MS45MTQxIi8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0OS42Mzg3IiB4PSI0Mi4zNCIgeT0iOTguMjYwNyI+am91cm5hbEVudHJ5SWQ6IFN0cmluZzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBSSVZBVEVfRklFTEQiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNiIgc3R5bGU9InN0cm9rZTojQzgyOTMwO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjYiIHg9IjMwLjM0IiB5PSIxMDguMjEwOSIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODAuNzU1OSIgeD0iNDIuMzQiIHk9IjExNC41NTc2Ij5qb3VybmFsRW50cnk6IEpvdXJuYWxFbnRyeTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMy4zNCIgeDI9IjQ3Mi42NjUyIiB5MT0iMTIxLjg1OTQiIHkyPSIxMjEuODU5NCIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX01FVEhPRCI+PGVsbGlwc2UgY3g9IjMzLjM0IiBjeT0iMTM1LjUwNzgiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MTMuNTgxMSIgeD0iNDIuMzQiIHk9IjEzOC44NTQ1Ij5AQ29tbWFuZEhhbmRsZXI6IGhhbmRsZShDcmVhdGVKb3VybmFsRW50cnlDb21tYW5kKTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19NRVRIT0QiPjxlbGxpcHNlIGN4PSIzMy4zNCIgY3k9IjE1MS44MDQ3IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDI1LjMyNTIiIHg9IjQyLjM0IiB5PSIxNTUuMTUxNCI+QENvbW1hbmRIYW5kbGVyOiBoYW5kbGUoQXBwcm92ZUpvdXJuYWxFbnRyeUNvbW1hbmQpPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX01FVEhPRCI+PGVsbGlwc2UgY3g9IjMzLjM0IiBjeT0iMTY4LjEwMTYiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzODkuOTIxOSIgeD0iNDIuMzQiIHk9IjE3MS40NDgyIj5ARXZlbnRTb3VyY2luZ0hhbmRsZXI6IG9uKEpvdXJuYWxFbnRyeUNyZWF0ZWRFdmVudCk8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzMuMzQiIGN5PSIxODQuMzk4NCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwMS42NjYiIHg9IjQyLjM0IiB5PSIxODcuNzQ1MSI+QEV2ZW50U291cmNpbmdIYW5kbGVyOiBvbihKb3VybmFsRW50cnlBcHByb3ZlZEV2ZW50KTwvdGV4dD48L2c+PCEtLWNsYXNzIEpvdXJuYWxFbnRyeS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBMYXllci5Kb3VybmFsRW50cnkiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBpZD0iZW50MDAwNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMDUuMTU2MyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjk3LjE0MDYiIHg9IjMyMS40MyIgeT0iMjk1LjA1Ii8+PGVsbGlwc2UgY3g9IjQyMi43OTMzIiBjeT0iMzE1LjE4MjgiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTQyNS43NjIsMzIwLjgyMzQgUTQyNS4xODM5LDMyMS4xMjAzIDQyNC41NDMzLDMyMS4yNjA5IFE0MjMuOTAyNywzMjEuNDE3MiA0MjMuMTk5NSwzMjEuNDE3MiBRNDIwLjY5OTUsMzIxLjQxNzIgNDE5LjM3MTQsMzE5Ljc3NjYgUTQxOC4wNTg5LDMxOC4xMjAzIDQxOC4wNTg5LDMxNC45OTUzIFE0MTguMDU4OSwzMTEuODcwMyA0MTkuMzcxNCwzMTAuMjE0MSBRNDIwLjY5OTUsMzA4LjU1NzggNDIzLjE5OTUsMzA4LjU1NzggUTQyMy45MDI3LDMwOC41NTc4IDQyNC41NDMzLDMwOC43MTQxIFE0MjUuMTk5NSwzMDguODcwMyA0MjUuNzYyLDMwOS4xNjcyIEw0MjUuNzYyLDMxMS44ODU5IFE0MjUuMTM3LDMxMS4zMDc4IDQyNC41NDMzLDMxMS4wNDIyIFE0MjMuOTQ5NSwzMTAuNzYwOSA0MjMuMzI0NSwzMTAuNzYwOSBRNDIxLjk4MDgsMzEwLjc2MDkgNDIxLjI5MzMsMzExLjgzOTEgUTQyMC42MDU4LDMxMi45MDE2IDQyMC42MDU4LDMxNC45OTUzIFE0MjAuNjA1OCwzMTcuMDg5MSA0MjEuMjkzMywzMTguMTY3MiBRNDIxLjk4MDgsMzE5LjIyOTcgNDIzLjMyNDUsMzE5LjIyOTcgUTQyMy45NDk1LDMxOS4yMjk3IDQyNC41NDMzLDMxOC45NjQxIFE0MjUuMTM3LDMxOC42ODI4IDQyNS43NjIsMzE4LjEwNDcgTDQyNS43NjIsMzIwLjgyMzQgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgZm9udC1zdHlsZT0iaXRhbGljIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzLjQ5MDIiIHg9IjQ1OS41MDUyIiB5PSIzMTEuMTg4NyI+JiMxNzE7cmVjb3JkJiMxODc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg1LjkxNDEiIHg9IjQ0My4yOTMzIiB5PSIzMjcuMDEzOSI+Sm91cm5hbEVudHJ5PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMyMi40MyIgeDI9IjYxNy41NzA2IiB5MT0iMzM1LjMxNTYiIHkyPSIzMzUuMzE1NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMyMi40MyIgeDI9IjYxNy41NzA2IiB5MT0iMzQzLjMxNTYiIHkyPSIzNDMuMzE1NiIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX01FVEhPRCI+PGVsbGlwc2UgY3g9IjMzMi40MyIgY3k9IjM1Ni45NjQxIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQ2LjU3MjMiIHg9IjM0MS40MyIgeT0iMzYwLjMxMDciPmNyZWF0ZSgpOiBKb3VybmFsRW50cnlDcmVhdGVkRXZlbnQ8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfTUVUSE9EIj48ZWxsaXBzZSBjeD0iMzMyLjQzIiBjeT0iMzczLjI2MDkiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNzEuMTQwNiIgeD0iMzQxLjQzIiB5PSIzNzYuNjA3NiI+YXBwcm92ZSgpOiBKb3VybmFsRW50cnlBcHByb3ZlZEV2ZW50PC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX01FVEhPRCI+PGVsbGlwc2UgY3g9IjMzMi40MyIgY3k9IjM4OS41NTc4IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg0LjQwNjMiIHg9IjM0MS40MyIgeT0iMzkyLjkwNDUiPmFwcGx5KGV2ZW50KTogSm91cm5hbEVudHJ5PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU43IiBkYXRhLXNvdXJjZS1saW5lPSIyNSIgaWQ9ImVudDAwMDgiPjxwYXRoIGQ9Ik03My41MiwzMjcuNDkgTDczLjUyLDM2Ny43NTU2IEEwLDAgMCAwIDAgNzMuNTIsMzY3Ljc1NTYgTDI4Ni40NzMyLDM2Ny43NTU2IEEwLDAgMCAwIDAgMjg2LjQ3MzIsMzY3Ljc1NTYgTDI4Ni40NzMyLDMzNy40OSBMMjc2LjQ3MzIsMzI3LjQ5IEwxODkuNzYsMzI3LjQ5IEwyMjUuMTcsMTk1LjQ1IEwxODEuNzYsMzI3LjQ5IEw3My41MiwzMjcuNDkgQTAsMCAwIDAgMCA3My41MiwzMjcuNDkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yNzYuNDczMiwzMjcuNDkgTDI3Ni40NzMyLDMzNy40OSBMMjg2LjQ3MzIsMzM3LjQ5IEwyNzYuNDczMiwzMjcuNDkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5MS45NTMyIiB4PSI3OS41MiIgeT0iMzQ0LjU1NjkiPkF4b24gRnJhbWV3b3JrICYjMjk5OTI7JiMxMjQ1MDsmIzEyNDgwOyYjMTI1MDM7JiMxMjQ3OTsmIzEyNTQwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTYuMDAwMiIgeD0iNzkuNTIiIHk9IjM1OS42ODk3Ij4mIzEyNTAxOyYjMTI1MjQ7JiMxMjU0MDsmIzEyNTEyOyYjMTI1Mjc7JiMxMjU0MDsmIzEyNDYzOyYjMjAzODE7JiMyMzM4NDsmIzEyNDM0OyYjMjE1NjA7JiMyMTQ1NDs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjEwIiBkYXRhLXNvdXJjZS1saW5lPSIzMCIgaWQ9ImVudDAwMTEiPjxwYXRoIGQ9Ik0zOTQuNSw0NjMuMiBMMzk0LjUsNTAzLjQ2NTYgQTAsMCAwIDAgMCAzOTQuNSw1MDMuNDY1NiBMNTQ1LjUwMDIsNTAzLjQ2NTYgQTAsMCAwIDAgMCA1NDUuNTAwMiw1MDMuNDY1NiBMNTQ1LjUwMDIsNDczLjIgTDUzNS41MDAyLDQ2My4yIEw0NzQsNDYzLjIgTDQ3MCw0MDAuMzIgTDQ2Niw0NjMuMiBMMzk0LjUsNDYzLjIgQTAsMCAwIDAgMCAzOTQuNSw0NjMuMiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTUzNS41MDAyLDQ2My4yIEw1MzUuNTAwMiw0NzMuMiBMNTQ1LjUwMDIsNDczLjIgTDUzNS41MDAyLDQ2My4yIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuMDAwMiIgeD0iNDAwLjUiIHk9IjQ4MC4yNjY5Ij4mIzMyMDIwOyYjMzE4ODM7JiMxMjM5NDsmIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMTI1MTQ7JiMxMjQ4NzsmIzEyNTIzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTQuOTExNyIgeD0iNDAwLjUiIHk9IjQ5NS4zOTk3Ij5BeG9uICYjMTIzOTU7JiMyMDM4MTsmIzIzMzg0OyYjMTIzNzU7JiMxMjM5NDsmIzEyMzU2OzwvdGV4dD48L2c+PCEtLWxpbmsgSm91cm5hbEVudHJ5QWdncmVnYXRlQWRhcHRlciB0byBKb3VybmFsRW50cnktLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIyIiBpZD0ibG5rNiI+PHBhdGggY29kZUxpbmU9IjIyIiBkPSJNMzIyLjU0LDE5NS40NSBDMzU0LjQxLDIyOC4xMiAzODYuNjAwMywyNjEuMTI1IDQxNS4yNTAzLDI5MC40OTUiIGZpbGw9Im5vbmUiIGlkPSJKb3VybmFsRW50cnlBZ2dyZWdhdGVBZGFwdGVyLXRvLUpvdXJuYWxFbnRyeSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDE5LjQ0LDI5NC43OSw0MTYuMDE4OCwyODUuNTU0NCw0MTUuOTQ4NiwyOTEuMjEwOSw0MTAuMjkyMiwyOTEuMTQwNyw0MTkuNDQsMjk0Ljc5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjM2Ni42NiIgeT0iMjQwLjExNjkiPiYjMjI5OTY7JiMzNTY5ODs8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIFpMQjFJaUQwNEJ0bExtcHJxWUJ6V0lBYmZMUEtsRmE1UXhCNnM2R3RSNUVyWTYycFdlWVc4WE16MjJnMmVmUDJ6VTExejZGNkszXzNKTGZoS3AzOGlaM2lsM1ZseFNwS1FwUnRnQUdraDUyWlBhZEh1NlA1RTRCMnI1bXJFZUh1RWE0ajFmY292cGNzR05yUlM1WVlKSU9waTRxQ1h6UmhpMldRYWJFZG9kdFBCNWtNUDFSck1UY2FkaXlhcENuMFFWRzhuUTljdk01elpCNVc1YzNQYnBRdDlYQTVINjRvM1FNQVM1dEFwTmJ6N0lPQmkxTzdzT2Zha2xPdVUwWkNmUDNxVndKTy05REx0TTNTTnpQOUduaVJTR05GOVdZbmkxYlpfeXlRQWxfR1RsSnZSVkVpU0FjVHNrNmVldjhQR2ZnM1JhdzM0VGw4dmY4RDZwVWRHTklXRWViQWMxZDBkNlFNblRPYzFYMFJKUHJyRmJ6Q01ZcjA5aG5oVnRMdzZLQXVxRkRWNFJ1bE4xMmhnS2ozb2Jqd28tUnFPaDlEOE1sR1J6elpTOERnNXpLdjFYLWV0V1lnQ3JIRkVhOXJYUWVSMUs3dHlfcW94NW5XUzFnVWw4UjdIdUhuNG9CUEw3N0lWc2R0VXVWT1VhMXJXRWVRV3JqS3B3WXF0WndnbnU0TlIzcUVZeFZFOHNIaFJySnk2bTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="282-journalentry-aggregate-adapter">28.2 JournalEntry Aggregate Adapter<a class="headerlink" href="#282-journalentry-aggregate-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryAggregateAdapter.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryCreatedEvent.JournalLineData</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntryCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.CommandHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.EventSourcingHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateLifecycle</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.spring.stereotype.Aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry Aggregate Adapter（Axon Framework 用）</span>
<span class="cm"> */</span>
<span class="nd">@Aggregate</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryAggregateAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@AggregateIdentifier</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Axon が使用するデフォルトコンストラクタ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="nf">JournalEntryAggregateAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Command Handlers ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 集約作成コマンドハンドラー（コンストラクタ）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalEntryAggregateAdapter</span><span class="p">(</span><span class="n">CreateJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 仕訳番号を生成</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateJournalNumber</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 明細データを変換</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ドメインモデルのファクトリメソッドを呼び出し</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">createdBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// イベントを発行</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認申請コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">SubmitJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">submittedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ApproveJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">approve</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">approvedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">comment</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 却下コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">RejectJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">reject</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">rejectedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 修正コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ReviseJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">input</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">revise</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">revisedBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 転記コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">PostJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">postedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセルコマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">CancelJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">cancel</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Event Sourcing Handlers（状態復元）========</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryRevisedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== ヘルパーメソッド ========</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateJournalNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 実際のシステムでは年月日 + 連番など</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;JE-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">).</span><span class="na">toUpperCase</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>Axon アノテーション解説：</strong></p>
<table>
<thead>
<tr>
<th>アノテーション</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Aggregate</code></td>
<td>Event Sourcing 集約であることを宣言</td>
</tr>
<tr>
<td><code>@AggregateIdentifier</code></td>
<td>集約の識別子フィールド</td>
</tr>
<tr>
<td><code>@CommandHandler</code></td>
<td>コマンドを処理するメソッド</td>
</tr>
<tr>
<td><code>@EventSourcingHandler</code></td>
<td>イベントから状態を復元するメソッド</td>
</tr>
<tr>
<td><code>AggregateLifecycle.apply()</code></td>
<td>イベントを発行するメソッド</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="283-policy-handlerchoreography">28.3 Policy Handler（Choreography パターン）<a class="headerlink" href="#283-policy-handlerchoreography" title="Permanent link">&para;</a></h3>
<p>Policy Handler は、他の Bounded Context から発行されたイベントを購読し、自律的に反応する処理を実装します。Choreography パターンでは、各 Context が独立して動作し、イベントを介して連携します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjI2NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjAwcHg7aGVpZ2h0OjI2NHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYwMCAyNjQiIHdpZHRoPSI2MDBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iMjY0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjAwIiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJKb3VybmFsIiBpZD0icGFydDEtbGlmZWxpbmUiPjxnPjx0aXRsZT5Kb3VybmFsIENvbnRleHQ8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxOTIuNjY0MSIgd2lkdGg9IjgiIHg9IjYyLjEwMyIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjY2IiB4Mj0iNjYiIHkxPSIzNi4yOTY5IiB5Mj0iMjI4Ljk2MDkiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MiIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQnVzIiBpZD0icGFydDItbGlmZWxpbmUiPjxnPjx0aXRsZT5FdmVudCBCdXM8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxOTIuNjY0MSIgd2lkdGg9IjgiIHg9IjI0Ny4wMzUyIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMjUwLjg3MTEiIHgyPSIyNTAuODcxMSIgeTE9IjM2LjI5NjkiIHkyPSIyMjguOTYwOSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJBY2NvdW50IiBpZD0icGFydDMtbGlmZWxpbmUiPjxnPjx0aXRsZT5BY2NvdW50IENvbnRleHQ8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxOTIuNjY0MSIgd2lkdGg9IjgiIHg9IjQ2OC4xNzQzIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNDcyLjAxNzYiIHgyPSI0NzIuMDE3NiIgeTE9IjM2LjI5NjkiIHkyPSIyMjguOTYwOSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkpvdXJuYWwiIGlkPSJwYXJ0MS1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMi4yMDYxIiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjIwNjEiIHg9IjEyIiB5PSIyNC45OTUxIj5Kb3VybmFsIENvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJKb3VybmFsIiBpZD0icGFydDEtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjIuMjA2MSIgeD0iNSIgeT0iMjI3Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDguMjA2MSIgeD0iMTIiIHk9IjI0Ny45NTYxIj5Kb3VybmFsIENvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJCdXMiIGlkPSJwYXJ0Mi1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0LjMyODEiIHg9IjIwOC44NzExIiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjE1Ljg3MTEiIHk9IjI0Ljk5NTEiPkV2ZW50IEJ1czwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkJ1cyIgaWQ9InBhcnQyLXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODQuMzI4MSIgeD0iMjA4Ljg3MTEiIHk9IjIyNy45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjE1Ljg3MTEiIHk9IjI0Ny45NTYxIj5FdmVudCBCdXM8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJBY2NvdW50IiBpZD0icGFydDMtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzAuMzEzNSIgeD0iNDA3LjAxNzYiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuMzEzNSIgeD0iNDE0LjAxNzYiIHk9IjI0Ljk5NTEiPkFjY291bnQgQ29udGV4dDwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkFjY291bnQiIGlkPSJwYXJ0My10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMC4zMTM1IiB4PSI0MDcuMDE3NiIgeT0iMjI3Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuMzEzNSIgeD0iNDE0LjAxNzYiIHk9IjI0Ny45NTYxIj5BY2NvdW50IENvbnRleHQ8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjU5My45NzAyIiB4PSIwIiB5PSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI1OTMuOTcwMiIgeTE9IjY2Ljg2MzMiIHkyPSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI1OTMuOTcwMiIgeTE9IjY5Ljg2MzMiIHkyPSI2OS44NjMzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMTA5LjUyNiIgeD0iMjQyLjIyMjEiIHk9IjU2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMjQ4LjIyMjEiIHk9IjcyLjM2MzgiPiYjMjAxODE7JiMzNTM3OTsmIzM2NTc4OyYjMzUzNTI7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS4wMzUyLDEwNi41NjI1LDI0OS4wMzUyLDExMC41NjI1LDIzOS4wMzUyLDExNC41NjI1LDI0My4wMzUyLDExMC41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjY2LjEwMyIgeDI9IjI0NS4wMzUyIiB5MT0iMTEwLjU2MjUiIHkyPSIxMTAuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2MC45MzIxIiB4PSI3My4xMDMiIHk9IjEwNS40OTY2Ij5Kb3VybmFsRW50cnlQb3N0ZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzIiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDYwLjE3NDMsMTM1LjY5NTMsNDcwLjE3NDMsMTM5LjY5NTMsNDYwLjE3NDMsMTQzLjY5NTMsNDY0LjE3NDMsMTM5LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjUxLjAzNTIiIHgyPSI0NjYuMTc0MyIgeTE9IjEzOS42OTUzIiB5Mj0iMTM5LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjAuOTMyMSIgeD0iMjU4LjAzNTIiIHk9IjEzNC42Mjk0Ij5Kb3VybmFsRW50cnlQb3N0ZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQzIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzMiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NzIuMTc0MyIgeDI9IjUxNC4xNzQzIiB5MT0iMTY4LjgyODEiIHkyPSIxNjguODI4MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1MTQuMTc0MyIgeDI9IjUxNC4xNzQzIiB5MT0iMTY4LjgyODEiIHkyPSIxODEuODI4MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NzMuMTc0MyIgeDI9IjUxNC4xNzQzIiB5MT0iMTgxLjgyODEiIHkyPSIxODEuODI4MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDgzLjE3NDMsMTc3LjgyODEsNDczLjE3NDMsMTgxLjgyODEsNDgzLjE3NDMsMTg1LjgyODEsNDc5LjE3NDMsMTgxLjgyODEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuNzk1OSIgeD0iNDc5LjE3NDMiIHk9IjE2My43NjIyIj51cGRhdGVCYWxhbmNlKCk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI2Mi4wMzUyLDIwNi45NjA5LDI1Mi4wMzUyLDIxMC45NjA5LDI2Mi4wMzUyLDIxNC45NjA5LDI1OC4wMzUyLDIxMC45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI1Ni4wMzUyIiB4Mj0iNDcxLjE3NDMiIHkxPSIyMTAuOTYwOSIgeTI9IjIxMC45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk3LjEzOTIiIHg9IjI2OC4wMzUyIiB5PSIyMDUuODk1Ij5BY2NvdW50QmFsYW5jZVVwZGF0ZWRFdmVudDwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgQXl4RXAyajhCNGhDTEtYQUpDdkVCeWVscEtqbnBpXzlCcjlHVGRDNUdJdWtlN0g5UGQ5Y0dNOVVZT0FJTHR2ZktMdllaZTlwVmJ2OVFhTTlhYTlZaUc5SzM1TVhRcmFnYTc4Z0JHT2gwVEFlcWV4OW9LMmhJYjNDV09mblNUZFFBWnBQRlZONVlpcWxUWXp3aU1CNnUtUWZadmxORmN4VWVzMWhvbUxwV0F1VG81MDVBdlpqaGRhYkhQSzEtU0tiZ0liV2d4YjBpYTE1QzhqbUF1SWZHNTVTTWYySU05QmdiOVlKYzlVU2dnNjloMFhZQkxHMGdZOEtoMW5ZODAwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="284-journaleventhandleraccount-context">28.4 JournalEventHandler（Account Context 内）<a class="headerlink" href="#284-journaleventhandleraccount-context" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEventHandler.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.account.application.policy</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.account.domain.model.aggregate.account.AccountCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryPostedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Journal イベントに反応して勘定残高を更新する Policy Handler</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEventHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalEventHandler</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When a journal entry is posted, update account balances&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 仕訳の各明細に対して勘定残高を更新</span>
<span class="w">        </span><span class="c1">// 実際の実装では、イベントから明細情報を取得して処理</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateAccountBalanceCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>Policy Handler の設計原則：</strong></p>
<table>
<thead>
<tr>
<th>原則</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>単一責任</strong></td>
<td>1 つの Policy Handler は 1 つの関心事のみを扱う</td>
</tr>
<tr>
<td><strong>疎結合</strong></td>
<td>他の Context のイベントを購読し、自 Context のコマンドを発行</td>
</tr>
<tr>
<td><strong>自律性</strong></td>
<td>他のサービスに依存せず独立して動作</td>
</tr>
<tr>
<td><strong>冪等性</strong></td>
<td>同じイベントを複数回受信しても問題ないよう設計</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="29projection-read-model">第29章：Projection と Read Model<a class="headerlink" href="#29projection-read-model" title="Permanent link">&para;</a></h2>
<h3 id="291-projection">29.1 Projection の役割<a class="headerlink" href="#291-projection" title="Permanent link">&para;</a></h3>
<p>Projection は、イベントを購読して Read Model（クエリ用のデータモデル）を更新するコンポーネントです。CQRS では、書き込みモデル（Event Store）と読み取りモデル（Read Model DB）を分離し、それぞれに最適化されたデータ構造を使用します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjUzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzYxcHg7aGVpZ2h0OjUzNHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc2MSA1MzQiIHdpZHRoPSI3NjFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTM0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNzYxIiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDSCIgaWQ9InBhcnQxLWxpZmVsaW5lIj48Zz48dGl0bGU+Q29tbWFuZEhhbmRsZXI8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjcxLjU0IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNzUiIHgyPSI3NSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJFUyIgaWQ9InBhcnQyLWxpZmVsaW5lIj48Zz48dGl0bGU+RXZlbnQgU3RvcmU8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjIwMC4wMTM3IiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMjAzLjA4MDEiIHgyPSIyMDMuMDgwMSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJQIiBpZD0icGFydDMtbGlmZWxpbmUiPjxnPjx0aXRsZT5Qcm9qZWN0aW9uPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSIzMDIuMDEzOCIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjMwNS4xMjMxIiB4Mj0iMzA1LjEyMzEiIHkxPSIzNi4yOTY5IiB5Mj0iNDk5LjI4OTEiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NCIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iTUIiIGlkPSJwYXJ0NC1saWZlbGluZSI+PGc+PHRpdGxlPk15QmF0aXMgTWFwcGVyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSI0MTcuMTQwMiIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjQyMC45MDQ0IiB4Mj0iNDIwLjkwNDQiIHkxPSIzNi4yOTY5IiB5Mj0iNDk5LjI4OTEiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iREIiIGlkPSJwYXJ0NS1saWZlbGluZSI+PGc+PHRpdGxlPlJlYWQgTW9kZWwgREI8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NjIuOTkyMiIgd2lkdGg9IjgiIHg9IjU1MC45MzkxIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNTU0LjM3NjEiIHgyPSI1NTQuMzc2MSIgeTE9IjM2LjI5NjkiIHkyPSI0OTkuMjg5MSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ2IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJSQyIgaWQ9InBhcnQ2LWxpZmVsaW5lIj48Zz48dGl0bGU+UkVTVCBDb250cm9sbGVyPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDYyLjk5MjIiIHdpZHRoPSI4IiB4PSI2ODMuMzE5NCIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjY4Ni41MDIiIHgyPSI2ODYuNTAyIiB5MT0iMzYuMjk2OSIgeTI9IjQ5OS4yODkxIi8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ0giIGlkPSJwYXJ0MS1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MS4wODAxIiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3LjA4MDEiIHg9IjEyIiB5PSIyNC45OTUxIj5Db21tYW5kSGFuZGxlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNIIiBpZD0icGFydDEtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDEuMDgwMSIgeD0iNSIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjcuMDgwMSIgeD0iMTIiIHk9IjUxOC4yODQyIj5Db21tYW5kSGFuZGxlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkVTIiBpZD0icGFydDItaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5NS44NjcyIiB4PSIxNTYuMDgwMSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjE2My4wODAxIiB5PSIyNC45OTUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkVTIiBpZD0icGFydDItdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5NS44NjcyIiB4PSIxNTYuMDgwMSIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxNjMuMDgwMSIgeT0iNTE4LjI4NDIiPkV2ZW50IFN0b3JlPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUCIgaWQ9InBhcnQzLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODMuNzgxMyIgeD0iMjY0LjEyMzEiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS43ODEzIiB4PSIyNzEuMTIzMSIgeT0iMjQuOTk1MSI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlAiIGlkPSJwYXJ0My10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjgzLjc4MTMiIHg9IjI2NC4xMjMxIiB5PSI0OTguMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9IjI3MS4xMjMxIiB5PSI1MTguMjg0MiI+UHJvamVjdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDQiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ik1CIiBpZD0icGFydDQtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjYuNDcxNyIgeD0iMzU3LjkwNDQiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMzY0LjkwNDQiIHk9IjI0Ljk5NTEiPk15QmF0aXMgTWFwcGVyPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NCIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iTUIiIGlkPSJwYXJ0NC10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyNi40NzE3IiB4PSIzNTcuOTA0NCIgeT0iNDk4LjI4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNDcxNyIgeD0iMzY0LjkwNDQiIHk9IjUxOC4yODQyIj5NeUJhdGlzIE1hcHBlcjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDUiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRCIiBpZD0icGFydDUtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEuMTI2IiB4PSI0OTQuMzc2MSIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNy4xMjYiIHg9IjUwMS4zNzYxIiB5PSIyNC45OTUxIj5SZWFkIE1vZGVsIERCPC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iREIiIGlkPSJwYXJ0NS10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMS4xMjYiIHg9IjQ5NC4zNzYxIiB5PSI0OTguMjg5MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNy4xMjYiIHg9IjUwMS4zNzYxIiB5PSI1MTguMjg0MiI+UmVhZCBNb2RlbCBEQjwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDYiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlJDIiBpZD0icGFydDYtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjMuNjM0OCIgeD0iNjI1LjUwMiIgeT0iNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSI2MzIuNTAyIiB5PSIyNC45OTUxIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ2IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJSQyIgaWQ9InBhcnQ2LXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIzLjYzNDgiIHg9IjYyNS41MDIiIHk9IjQ5OC4yODkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjYzMi41MDIiIHk9IjUxOC4yODQyIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9Ijc1NC4xMzY4IiB4PSIwIiB5PSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjY2Ljg2MzMiIHkyPSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjY5Ljg2MzMiIHkyPSI2OS44NjMzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMjAxLjM2MzkiIHg9IjI3Ni4zODY1IiB5PSI1Ni4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4Ny4zNjM5IiB4PSIyODIuMzg2NSIgeT0iNzIuMzYzOCI+JiMyNjM2MDsmIzEyMzY1OyYjMzY3OTY7JiMxMjQxNTsmIzY1Mjg4O0NvbW1hbmQgU2lkZSYjNjUyODk7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5Mi4wMTM3LDEwNi41NjI1LDIwMi4wMTM3LDExMC41NjI1LDE5Mi4wMTM3LDExNC41NjI1LDE5Ni4wMTM3LDExMC41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc1LjU0IiB4Mj0iMTk4LjAxMzciIHkxPSIxMTAuNTYyNSIgeTI9IjExMC41NjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iODIuNTQiIHk9IjEwNS40OTY2Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA0NDU7JiMyMzM4NDs8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cyIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI5NC4wMTM4LDEzNS42OTUzLDMwNC4wMTM4LDEzOS42OTUzLDI5NC4wMTM4LDE0My42OTUzLDI5OC4wMTM4LDEzOS42OTUzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjIwNC4wMTM3IiB4Mj0iMzAwLjAxMzgiIHkxPSIxMzkuNjk1MyIgeTI9IjEzOS42OTUzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMjExLjAxMzciIHk9IjEzNC42Mjk0Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMzY4OTA7JiMzMDY5Mzs8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9Ijc1NC4xMzY4IiB4PSIwIiB5PSIxNjguMjYxNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiIHgxPSIwIiB4Mj0iNzU0LjEzNjgiIHkxPSIxNjguMjYxNyIgeTI9IjE2OC4yNjE3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjE3MS4yNjE3IiB5Mj0iMTcxLjI2MTciLz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjIzLjEzMjgiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjsiIHdpZHRoPSIxMzUuNTI2IiB4PSIzMDkuMzA1NCIgeT0iMTU3LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjMxNS4zMDU0IiB5PSIxNzMuNzYyMiI+JiMzNTUwMTsmIzEyNDE1OyYjMjE0NjI7JiMxMjQyNjsmIzEyNTE0OyYjMTI0ODc7JiMxMjUyMzsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDQiIGlkPSJtc2czIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQwOS4xNDAyLDIwNy45NjA5LDQxOS4xNDAyLDIxMS45NjA5LDQwOS4xNDAyLDIxNS45NjA5LDQxMy4xNDAyLDIxMS45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMwNi4wMTM4IiB4Mj0iNDE1LjE0MDIiIHkxPSIyMTEuOTYwOSIgeTI9IjIxMS45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODcuMjQ4NSIgeD0iMzEzLjAxMzgiIHk9IjIwNi44OTUiPmluc2VydC91cGRhdGU8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NCIgZGF0YS1lbnRpdHktMj0icGFydDUiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU0Mi45MzkxLDIzNy4wOTM4LDU1Mi45MzkxLDI0MS4wOTM4LDU0Mi45MzkxLDI0NS4wOTM4LDU0Ni45MzkxLDI0MS4wOTM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQyMS4xNDAyIiB4Mj0iNTQ4LjkzOTEiIHkxPSIyNDEuMDkzOCIgeTI9IjI0MS4wOTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuODU5NCIgeD0iNDI4LjE0MDIiIHk9IjIzNi4wMjc4Ij5TUUwgJiMyMzQ1NTsmIzM0ODkyOzwvdGV4dD48L2c+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIzIiBzdHlsZT0ic3Ryb2tlOiNFRUVFRUU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNzU0LjEzNjgiIHg9IjAiIHk9IjI2OS42NjAyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI3NTQuMTM2OCIgeTE9IjI2OS42NjAyIiB5Mj0iMjY5LjY2MDIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9Ijc1NC4xMzY4IiB5MT0iMjcyLjY2MDIiIHkyPSIyNzIuNjYwMiIvPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMjMuMTMyOCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyOyIgd2lkdGg9IjE3Mi40NzU3IiB4PSIyOTAuODMwNiIgeT0iMjU5LjA5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU4LjQ3NTciIHg9IjI5Ni44MzA2IiB5PSIyNzUuMTYwNiI+JiMzNTUwMTsmIzEyNDE1OyYjMjE0NjI7JiMxMjQyNjsmIzY1Mjg4O1F1ZXJ5IFNpZGUmIzY1Mjg5OzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDYiIGRhdGEtZW50aXR5LTI9InBhcnQ0IiBpZD0ibXNnNSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MzIuMTQwMiwzMDkuMzU5NCw0MjIuMTQwMiwzMTMuMzU5NCw0MzIuMTQwMiwzMTcuMzU5NCw0MjguMTQwMiwzMTMuMzU5NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0MjYuMTQwMiIgeDI9IjY4Ni4zMTk0IiB5MT0iMzEzLjM1OTQiIHkyPSIzMTMuMzU5NCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzLjM3NzQiIHg9IjQzOC4xNDAyIiB5PSIzMDguMjkzNSI+ZmluZEJ5SWQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NCIgZGF0YS1lbnRpdHktMj0icGFydDUiIGlkPSJtc2c2Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU0Mi45MzkxLDMzOC40OTIyLDU1Mi45MzkxLDM0Mi40OTIyLDU0Mi45MzkxLDM0Ni40OTIyLDU0Ni45MzkxLDM0Mi40OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQyMS4xNDAyIiB4Mj0iNTQ4LjkzOTEiIHkxPSIzNDIuNDkyMiIgeTI9IjM0Mi40OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguOTQwNCIgeD0iNDI4LjE0MDIiIHk9IjMzNy40MjYzIj5TRUxFQ1Q8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NSIgZGF0YS1lbnRpdHktMj0icGFydDQiIGlkPSJtc2c3Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQzMi4xNDAyLDM2Ny42MjUsNDIyLjE0MDIsMzcxLjYyNSw0MzIuMTQwMiwzNzUuNjI1LDQyOC4xNDAyLDM3MS42MjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDI2LjE0MDIiIHgyPSI1NTMuOTM5MSIgeTE9IjM3MS42MjUiIHkyPSIzNzEuNjI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYiIHg9IjQzOC4xNDAyIiB5PSIzNjYuNTU5MSI+JiMzMjA4MDsmIzI2NTI0OzwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQ0IiBkYXRhLWVudGl0eS0yPSJwYXJ0NiIgaWQ9Im1zZzgiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjc1LjMxOTQsMzk2Ljc1NzgsNjg1LjMxOTQsNDAwLjc1NzgsNjc1LjMxOTQsNDA0Ljc1NzgsNjc5LjMxOTQsNDAwLjc1NzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDIxLjE0MDIiIHgyPSI2ODEuMzE5NCIgeTE9IjQwMC43NTc4IiB5Mj0iNDAwLjc1NzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNy45NTI2IiB4PSI0MjguMTQwMiIgeT0iMzk1LjY5MTkiPkVudGl0eTwvdGV4dD48L2c+PHBhdGggZD0iTTMxMSw0MTMuNzU3OCBMMzExLDQ4My43NTc4IEw0NTEsNDgzLjc1NzggTDQ1MSw0MjMuNzU3OCBMNDQxLDQxMy43NTc4IEwzMTEsNDEzLjc1NzgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NDEsNDEzLjc1NzggTDQ0MSw0MjMuNzU3OCBMNDUxLDQyMy43NTc4IEw0NDEsNDEzLjc1NzgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjkyOTIiIHg9IjMxNyIgeT0iNDMwLjgyNDciPlByb2plY3Rpb24gJiMxMjM5OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjMxNyIgeT0iNDQ1Ljk1NzUiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMxMjQzNDsmIzM2MDkyOyYjMzU1MDE7JiMxMjM3NTsmIzEyMzkwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC40MDg3IiB4PSIzMTciIHk9IjQ2MS4wOTAzIj5NeUJhdGlzICYjMzIwNzY7JiMzMDAwMTsmIzEyMzkxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuNTQ1NSIgeD0iMzE3IiB5PSI0NzYuMjIzMSI+UmVhZCBNb2RlbCAmIzEyNDM0OyYjMjYzNTY7JiMyNjAzMjs8L3RleHQ+PD9wbGFudHVtbC1zcmMgUFA3QklXQ241OFJ0VU9nM2hpTXpLMVNwN1FkV0dFdHUwaDRKRFRlY0d2ZUF0SmNUWEhTS0hTSngxU0tCQUR2R21LTkhYdWN6a0Y4TEYxc2pUZkdtUDNaVlZfeHlvSWREUzE1R0hPaW1KbENwYXFnTVhNX0JXYkpHRS1JcTVvNjhEU19wVzBlREZST2k1Z2RtQ19XTGNFZTFNVzh4YXZHdWltbXRKcWw1T2t2dUlQdkxTZmhiRFBTWW5qYWFUSWlNclJtNEJXczJ4bURTQW9kOUNVZzNBdHJNV0JHTEF6OV81T3V0MWhPS01pYjI5c1JFOVlJTFdpUlVpbWJOTVl5cjR4di1yMVEteG1DVXp6YjdSSjZMOGRPNi1XT25EMG8wZ1B3UVFDVDQzb1BRVTdpemc1emw0d21acFZ3MXh0RXhwUUVwc0J6clVPdEV6VExES3Jxb3FPYzl2YXJxclRYeFI2cFUwUmZkcy1za1hWclNiOVpJX1VOMGZ2ZUhCMjU4anU0dEVXQnJjd0ZNeVY4X0dtbXlNY1FncVhLdFBfeXVKZDNYTXZMWEZzN2NaM1pzNkM3X2xld2ktUkpNRURvRkhMWjJfVzVtWEVRd0dlWUdjZTdZYXJDUXYwSEV2ZFRLT0M5UnFkcmJLcnJsRlRKWVM1aWNGMlVUa0pNVmJmaVJ6b1F5ODVyWkdsN040bjI2UnpxLXZIQzA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h3 id="292-journalentry-projectionmybatis">29.2 JournalEntry Projection（MyBatis 版）<a class="headerlink" href="#292-journalentry-projectionmybatis" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryProjection.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.application.query</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity.JournalEntryEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity.JournalLineEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.mapper.JournalEntryMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry Projection（MyBatis を使用した Read Model の更新）</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryProjection</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">JournalEntryMapper</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalEntryProjection</span><span class="p">(</span><span class="n">JournalEntryMapper</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntryMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryEntity</span><span class="p">();</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setJournalEntryId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setJournalNumber</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalNumber</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setTransactionDate</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setDescription</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">description</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;DRAFT&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCreatedBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">createdBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">createdAt</span><span class="p">());</span>

<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 明細を保存</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">var</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineEntity</span><span class="p">();</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setJournalEntryId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setAccountCode</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">accountCode</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setAccountName</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">accountName</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setDebitAmount</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setCreditAmount</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">());</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">line</span><span class="p">;</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">insertLines</span><span class="p">(</span><span class="n">lines</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;PENDING_APPROVAL&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateSubmission</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">submittedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">submittedAt</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;APPROVED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateApproval</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">approvedBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">comment</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">approvedAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;REJECTED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateRejection</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">rejectedBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">rejectedAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryRevisedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;DRAFT&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateRevision</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">revisedBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">revisedAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 明細を削除して再作成</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">deleteLines</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">());</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">var</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineEntity</span><span class="p">();</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setJournalEntryId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setAccountCode</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">accountCode</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setAccountName</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">accountName</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setDebitAmount</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">());</span>
<span class="w">                    </span><span class="n">line</span><span class="p">.</span><span class="na">setCreditAmount</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">());</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">line</span><span class="p">;</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">insertLines</span><span class="p">(</span><span class="n">lines</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;POSTED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updatePosting</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">postedBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">postedAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;CANCELLED&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">updateCancellation</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">cancelledAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="293-read-model-entity">29.3 Read Model Entity<a class="headerlink" href="#293-read-model-entity" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryEntity.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry Read Model（表示用のすべてのフィールドを保持）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryEntity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 合計金額（集計用）</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalDebitAmount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalCreditAmount</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 監査情報</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">revisedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">revisedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">postedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 明細</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Getters and Setters</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getJournalEntryId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setJournalEntryId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getJournalNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setJournalNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">journalNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="nf">getTransactionDate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTransactionDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">transactionDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getDescription</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">description</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDescription</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">description</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getStatus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getTotalDebitAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">totalDebitAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTotalDebitAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalDebitAmount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">totalDebitAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">totalDebitAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getTotalCreditAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">totalCreditAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTotalCreditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalCreditAmount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">totalCreditAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">totalCreditAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCreatedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createdBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCreatedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSubmittedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSubmittedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">submittedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getSubmittedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSubmittedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">submittedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getApprovedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApprovedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">approvedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getApprovalComment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApprovalComment</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">approvalComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getApprovedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApprovedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">approvedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRejectedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRejectionReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectionReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectionReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getRejectedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRevisedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">revisedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRevisedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">revisedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">revisedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">revisedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getRevisedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">revisedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRevisedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">revisedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">revisedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">revisedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getFiscalPeriod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFiscalPeriod</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPostedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">postedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPostedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">postedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">postedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getPostedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">postedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPostedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">postedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">postedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">postedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancelledBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancellationReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancellationReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancellationReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCancelledAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getLines</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLines</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalLineEntity.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalLine Read Model</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalLineEntity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">lineId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Getters and Setters</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getLineId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">lineId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLineId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">lineId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">lineId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lineId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getJournalEntryId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setJournalEntryId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAccountCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAccountCode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">accountCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAccountName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAccountName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">accountName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getDebitAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDebitAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">debitAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getCreditAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">creditAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="294-mybatis-mapper">29.4 MyBatis Mapper インターフェース<a class="headerlink" href="#294-mybatis-mapper" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryMapper.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity.JournalEntryEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity.JournalLineEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Param</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry MyBatis Mapper</span>
<span class="cm"> */</span>
<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">JournalEntryMapper</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// 挿入</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">JournalEntryEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insertLines</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 検索</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByStatus</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByFiscalPeriod</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;fiscalPeriod&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByTransactionDateRange</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;fromDate&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">fromDate</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;toDate&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">toDate</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findLinesByJournalEntryId</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 更新</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateStatus</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateSubmission</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;submittedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;submittedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">submittedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateApproval</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;approvedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;comment&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;approvedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">approvedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateRejection</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;rejectedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;reason&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;rejectedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateRevision</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;transactionDate&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;revisedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">revisedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;revisedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">revisedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updatePosting</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;fiscalPeriod&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;postedBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;postedAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">postedAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateCancellation</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancelledBy&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;reason&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;cancelledAt&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 削除</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteLines</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;journalEntryId&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="295-mybatis-mapper-xml">29.5 MyBatis Mapper XML<a class="headerlink" href="#295-mybatis-mapper-xml" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryMapper.xml</summary>

<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.accounting.journal.adapter.outbound.persistence.mapper.JournalEntryMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;journalEntryResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;JournalEntryEntity&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;journalEntryId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;journal_entry_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;journalNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;journal_number&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;transactionDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;transaction_date&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;description&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;description&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;status&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;status&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;totalDebitAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;total_debit_amount&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;totalCreditAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;total_credit_amount&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;created_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;created_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;submittedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;submitted_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;submittedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;submitted_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;approvedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;approved_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;approvalComment&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;approval_comment&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;approvedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;approved_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;rejectedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;rejected_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;rejectionReason&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;rejection_reason&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;rejectedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;rejected_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;revisedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;revised_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;revisedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;revised_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;fiscalPeriod&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;fiscal_period&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;postedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;posted_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;postedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;posted_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancelledBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancelled_by&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancellationReason&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancellation_reason&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;cancelledAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cancelled_at&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lines&quot;</span><span class="w"> </span><span class="na">ofType=</span><span class="s">&quot;JournalLineEntity&quot;</span>
<span class="w">                    </span><span class="na">select=</span><span class="s">&quot;findLinesByJournalEntryId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;journal_entry_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;journalLineResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;JournalLineEntity&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;line_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;journalEntryId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;journal_entry_id&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;accountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;account_code&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;accountName&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;account_name&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;debitAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;debit_amount&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;creditAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;credit_amount&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;JournalEntryEntity&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>journal_entries<span class="w"> </span>(
<span class="w">            </span>journal_entry_id,<span class="w"> </span>journal_number,<span class="w"> </span>transaction_date,<span class="w"> </span>description,
<span class="w">            </span>status,<span class="w"> </span>created_by,<span class="w"> </span>created_at
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{journalEntryId},<span class="w"> </span>#{journalNumber},<span class="w"> </span>#{transactionDate},<span class="w"> </span>#{description},
<span class="w">            </span>#{status},<span class="w"> </span>#{createdBy},<span class="w"> </span>#{createdAt}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insertLines&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;list&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>journal_lines<span class="w"> </span>(
<span class="w">            </span>journal_entry_id,<span class="w"> </span>account_code,<span class="w"> </span>account_name,<span class="w"> </span>debit_amount,<span class="w"> </span>credit_amount
<span class="w">        </span>)<span class="w"> </span>VALUES
<span class="w">        </span><span class="nt">&lt;foreach</span><span class="w"> </span><span class="na">collection=</span><span class="s">&quot;list&quot;</span><span class="w"> </span><span class="na">item=</span><span class="s">&quot;line&quot;</span><span class="w"> </span><span class="na">separator=</span><span class="s">&quot;,&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>(#{line.journalEntryId},<span class="w"> </span>#{line.accountCode},<span class="w"> </span>#{line.accountName},
<span class="w">             </span>#{line.debitAmount},<span class="w"> </span>#{line.creditAmount})
<span class="w">        </span><span class="nt">&lt;/foreach&gt;</span>
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;journalEntryResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>je.*,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(debit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_debit_amount,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(credit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_credit_amount
<span class="w">        </span>FROM<span class="w"> </span>journal_entries<span class="w"> </span>je
<span class="w">        </span>WHERE<span class="w"> </span>je.journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;journalEntryResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>je.*,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(debit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_debit_amount,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(credit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_credit_amount
<span class="w">        </span>FROM<span class="w"> </span>journal_entries<span class="w"> </span>je
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>je.created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByStatus&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;journalEntryResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>je.*,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(debit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_debit_amount,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(credit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_credit_amount
<span class="w">        </span>FROM<span class="w"> </span>journal_entries<span class="w"> </span>je
<span class="w">        </span>WHERE<span class="w"> </span>je.status<span class="w"> </span>=<span class="w"> </span>#{status}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>je.created_at<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByFiscalPeriod&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;journalEntryResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>je.*,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(debit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_debit_amount,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(credit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_credit_amount
<span class="w">        </span>FROM<span class="w"> </span>journal_entries<span class="w"> </span>je
<span class="w">        </span>WHERE<span class="w"> </span>je.fiscal_period<span class="w"> </span>=<span class="w"> </span>#{fiscalPeriod}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>je.transaction_date,<span class="w"> </span>je.journal_number
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByTransactionDateRange&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;journalEntryResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>je.*,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(debit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_debit_amount,
<span class="w">               </span>(SELECT<span class="w"> </span>COALESCE(SUM(credit_amount),<span class="w"> </span>0)<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>je.journal_entry_id)<span class="w"> </span>as<span class="w"> </span>total_credit_amount
<span class="w">        </span>FROM<span class="w"> </span>journal_entries<span class="w"> </span>je
<span class="w">        </span>WHERE<span class="w"> </span>je.transaction_date<span class="w"> </span>BETWEEN<span class="w"> </span>#{fromDate}<span class="w"> </span>AND<span class="w"> </span>#{toDate}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>je.transaction_date,<span class="w"> </span>je.journal_number
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findLinesByJournalEntryId&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;journalLineResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>line_id
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateStatus&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>journal_entries<span class="w"> </span>SET<span class="w"> </span>status<span class="w"> </span>=<span class="w"> </span>#{status}<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateSubmission&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>journal_entries
<span class="w">        </span>SET<span class="w"> </span>submitted_by<span class="w"> </span>=<span class="w"> </span>#{submittedBy},<span class="w"> </span>submitted_at<span class="w"> </span>=<span class="w"> </span>#{submittedAt}
<span class="w">        </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateApproval&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>journal_entries
<span class="w">        </span>SET<span class="w"> </span>approved_by<span class="w"> </span>=<span class="w"> </span>#{approvedBy},<span class="w"> </span>approval_comment<span class="w"> </span>=<span class="w"> </span>#{comment},<span class="w"> </span>approved_at<span class="w"> </span>=<span class="w"> </span>#{approvedAt}
<span class="w">        </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateRejection&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>journal_entries
<span class="w">        </span>SET<span class="w"> </span>rejected_by<span class="w"> </span>=<span class="w"> </span>#{rejectedBy},<span class="w"> </span>rejection_reason<span class="w"> </span>=<span class="w"> </span>#{reason},<span class="w"> </span>rejected_at<span class="w"> </span>=<span class="w"> </span>#{rejectedAt}
<span class="w">        </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateRevision&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>journal_entries
<span class="w">        </span>SET<span class="w"> </span>transaction_date<span class="w"> </span>=<span class="w"> </span>#{transactionDate},<span class="w"> </span>description<span class="w"> </span>=<span class="w"> </span>#{description},
<span class="w">            </span>revised_by<span class="w"> </span>=<span class="w"> </span>#{revisedBy},<span class="w"> </span>revised_at<span class="w"> </span>=<span class="w"> </span>#{revisedAt}
<span class="w">        </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updatePosting&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>journal_entries
<span class="w">        </span>SET<span class="w"> </span>fiscal_period<span class="w"> </span>=<span class="w"> </span>#{fiscalPeriod},<span class="w"> </span>posted_by<span class="w"> </span>=<span class="w"> </span>#{postedBy},<span class="w"> </span>posted_at<span class="w"> </span>=<span class="w"> </span>#{postedAt}
<span class="w">        </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateCancellation&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>UPDATE<span class="w"> </span>journal_entries
<span class="w">        </span>SET<span class="w"> </span>cancelled_by<span class="w"> </span>=<span class="w"> </span>#{cancelledBy},<span class="w"> </span>cancellation_reason<span class="w"> </span>=<span class="w"> </span>#{reason},<span class="w"> </span>cancelled_at<span class="w"> </span>=<span class="w"> </span>#{cancelledAt}
<span class="w">        </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/update&gt;</span>

<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteLines&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>DELETE<span class="w"> </span>FROM<span class="w"> </span>journal_lines<span class="w"> </span>WHERE<span class="w"> </span>journal_entry_id<span class="w"> </span>=<span class="w"> </span>#{journalEntryId}
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<hr />
<h3 id="296-read-model">29.6 Read Model スキーマ<a class="headerlink" href="#296-read-model" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: schema.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- Read Model: Journal Entries テーブル</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">journal_entries</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">journal_entry_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">journal_number</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">transaction_date</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>

<span class="w">    </span><span class="c1">-- 監査情報</span>
<span class="w">    </span><span class="n">created_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">submitted_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">submitted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">approved_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">approval_comment</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">approved_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">rejected_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">rejection_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">rejected_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">revised_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">revised_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">fiscal_period</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">    </span><span class="n">posted_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">posted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">cancelled_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">cancellation_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">cancelled_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="c1">-- Read Model: Journal Lines テーブル</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">journal_lines</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">line_id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">journal_entry_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">journal_entries</span><span class="p">(</span><span class="n">journal_entry_id</span><span class="p">),</span>
<span class="w">    </span><span class="n">account_code</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">account_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">debit_amount</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">credit_amount</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_journal_entries_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">journal_entries</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_journal_entries_transaction_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">journal_entries</span><span class="p">(</span><span class="n">transaction_date</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_journal_entries_fiscal_period</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">journal_entries</span><span class="p">(</span><span class="n">fiscal_period</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_journal_lines_journal_entry_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">journal_lines</span><span class="p">(</span><span class="n">journal_entry_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">idx_journal_lines_account_code</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">journal_lines</span><span class="p">(</span><span class="n">account_code</span><span class="p">);</span>
</code></pre></div>

</details>

<hr />
<h3 id="297">29.7 最小限フィールドの原則<a class="headerlink" href="#297" title="Permanent link">&para;</a></h3>
<p>Event Sourcing では、ドメインモデルは「次のコマンドを処理するために必要な最小限の状態」のみを保持します。一方、Read Model は表示に必要なすべてのフィールドを保持します。</p>
<table>
<thead>
<tr>
<th>フィールド</th>
<th style="text-align: center;">ドメインモデル</th>
<th style="text-align: center;">Read Model</th>
<th>理由</th>
</tr>
</thead>
<tbody>
<tr>
<td>journalEntryId</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>識別子として必要</td>
</tr>
<tr>
<td>status</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>状態遷移の判定に必要</td>
</tr>
<tr>
<td>lines</td>
<td style="text-align: center;">O</td>
<td style="text-align: center;">O</td>
<td>借方・貸方の検証に必要</td>
</tr>
<tr>
<td>approvedBy</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>approvedAt</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>fiscalPeriod</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>判定に不要、表示のみ</td>
</tr>
<tr>
<td>totalDebitAmount</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">O</td>
<td>集計値、表示のみ</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="30rest-api">第30章：REST API と統合テスト<a class="headerlink" href="#30rest-api" title="Permanent link">&para;</a></h2>
<h3 id="301-rest-controllerinbound-adapter">30.1 REST Controller（Inbound Adapter）<a class="headerlink" href="#301-rest-controllerinbound-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalsController.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.inbound.rest.journals</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.inbound.rest.journals.protocol.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.mapper.JournalEntryMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntryCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.Operation</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.tags.Tag</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.ResponseEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletableFuture</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry REST Controller（Inbound Adapter）</span>
<span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/journals&quot;</span><span class="p">)</span>
<span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Journals&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Journal Entry management API&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalsController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">JournalEntryMapper</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalsController</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">,</span><span class="w"> </span><span class="n">JournalEntryMapper</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntryMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Command Side (Write) ==========</span>

<span class="w">    </span><span class="nd">@PostMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Create a new journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalEntryCreateResponse</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalEntryCreateRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">journalEntryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">createdBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span>
<span class="w">                        </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CREATED</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCreateResponse</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/submit&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Submit a journal entry for approval&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalEntrySubmitRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SubmitJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">submittedBy</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/approve&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Approve a journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">approve</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalEntryApproveRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ApproveJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">approvedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">comment</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/reject&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Reject a journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">reject</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalEntryRejectRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RejectJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">rejectedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/post&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Post a journal entry to the ledger&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalEntryPostRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">postedBy</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/cancel&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cancel a journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalEntryCancelRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CancelJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Query Side (Read) ==========</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get a journal entry by ID&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalEntryGetResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">JournalEntryGetResponse</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">entity</span><span class="p">)))</span>
<span class="w">                </span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">notFound</span><span class="p">().</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get all journal entries&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalEntryListResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalEntryGetResponse</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryListResponse</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/status/{status}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get journal entries by status&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalEntryListResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getByStatus</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntryMapper</span><span class="p">.</span><span class="na">findByStatus</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalEntryGetResponse</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryListResponse</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="302-api">30.2 API エンドポイント一覧<a class="headerlink" href="#302-api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>メソッド</th>
<th>パス</th>
<th>説明</th>
<th>種別</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/api/journals</code></td>
<td>仕訳作成</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/submit</code></td>
<td>承認申請</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/approve</code></td>
<td>承認</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/reject</code></td>
<td>却下</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/post</code></td>
<td>転記</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/cancel</code></td>
<td>キャンセル</td>
<td>Command</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/journals</code></td>
<td>仕訳一覧取得</td>
<td>Query</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/journals/{id}</code></td>
<td>仕訳詳細取得</td>
<td>Query</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/journals/status/{status}</code></td>
<td>ステータス別一覧</td>
<td>Query</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="303-axon-test">30.3 Axon Test による単体テスト<a class="headerlink" href="#303-axon-test" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryAggregateTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryCreatedEvent.JournalLineData</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntryCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.AggregateTestFixture</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.FixtureConfiguration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.BeforeEach</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.DisplayName</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Nested</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">JournalEntryAggregateTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FixtureConfiguration</span><span class="o">&lt;</span><span class="n">JournalEntryAggregateAdapter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fixture</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AggregateTestFixture</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">JournalEntryAggregateAdapter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳作成&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CreateJournalEntry</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;借方・貸方が一致する仕訳を作成できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCreateBalancedJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;1000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;現金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;4000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;売上計上&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;借方・貸方が一致しない場合はエラー&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRejectUnbalancedJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;1000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;現金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;4000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">5000</span><span class="p">))</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;不均衡な仕訳&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳承認&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ApproveJournalEntry</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;承認待ちの仕訳を承認できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldApprovePendingJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSampleCreatedEvent</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">submittedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">submittedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ApproveJournalEntryCommand</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;approver-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;承認します&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;下書きの仕訳は承認できない&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotApproveDraftJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSampleCreatedEvent</span><span class="p">();</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ApproveJournalEntryCommand</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;approver-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;承認します&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳転記&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">PostJournalEntry</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;承認済みの仕訳を転記できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldPostApprovedJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSampleCreatedEvent</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">submittedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">approvedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;approver-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OK&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">submittedEvent</span><span class="p">,</span><span class="w"> </span><span class="n">approvedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PostJournalEntryCommand</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2024-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;poster-1&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="nf">createSampleCreatedEvent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;1000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;現金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;4000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;JE-00000001&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">),</span>
<span class="w">                </span><span class="s">&quot;売上計上&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="part-5-f">Part 5-F のまとめ<a class="headerlink" href="#part-5-f" title="Permanent link">&para;</a></h2>
<h3 id="_5">実装した機能一覧<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>章</th>
<th>内容</th>
<th>主要技術</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>第26章: 基礎</strong></td>
<td>CQRS/ES アーキテクチャの基礎</td>
<td>Axon Framework, Event Sourcing</td>
</tr>
<tr>
<td><strong>第27章: ドメイン設計</strong></td>
<td>イベント、コマンド、ドメインモデル</td>
<td>sealed interface, record</td>
</tr>
<tr>
<td><strong>第28章: Aggregate/Policy</strong></td>
<td>Aggregate Adapter, Choreography</td>
<td>@Aggregate, @EventHandler</td>
</tr>
<tr>
<td><strong>第29章: Projection</strong></td>
<td>Read Model の更新、最小限フィールド</td>
<td>@EventHandler, MyBatis</td>
</tr>
<tr>
<td><strong>第30章: REST API</strong></td>
<td>Inbound Adapter, テスト</td>
<td>CommandGateway, Axon Test</td>
</tr>
</tbody>
</table>
<h3 id="_6">アーキテクチャの特徴<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjkxNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjA1cHg7aGVpZ2h0OjkxNHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYwNSA5MTQiIHdpZHRoPSI2MDVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPkNRUlMvRVMgJiMxMjQ1MDsmIzEyNTQwOyYjMTI0NjE7JiMxMjQ4NjsmIzEyNDYzOyYjMTI0ODE7JiMxMjUxNTsmIzY1Mjg4OyYjMzYwMDE7JiMyMTIwOTsmIzIwMjUwOyYjMzUzMzY7JiMxMjQ3MTsmIzEyNDczOyYjMTI0ODY7JiMxMjUxMjsmIzY1Mjg5OzwvdGl0bGU+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iOTE0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjA1IiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIzIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzEwLjY3MTgiIHg9IjE0MC40MTQyIiB5PSIyMi45OTUxIj5DUVJTL0VTICYjMTI0NTA7JiMxMjU0MDsmIzEyNDYxOyYjMTI0ODY7JiMxMjQ2MzsmIzEyNDgxOyYjMTI1MTU7JiM2NTI4ODsmIzM2MDAxOyYjMjEyMDk7JiMyMDI1MDsmIzM1MzM2OyYjMTI0NzE7JiMxMjQ3MzsmIzEyNDg2OyYjMTI1MTI7JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIENvbW1hbmQgU2lkZS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUiIGRhdGEtc291cmNlLWxpbmU9IjUiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNOC41LDQzLjI5NjkgTDEyNy4yNzY0LDQzLjI5NjkgQTMuNzUsMy43NSAwIDAgMSAxMjkuNzc2NCw0NS43OTY5IEwxMzYuNzc2NCw2NS41OTM4IEw0MjguNSw2NS41OTM4IEEyLjUsMi41IDAgMCAxIDQzMSw2OC4wOTM4IEw0MzEsNTA3Ljk4NjkgQTIuNSwyLjUgMCAwIDEgNDI4LjUsNTEwLjQ4NjkgTDguNSw1MTAuNDg2OSBBMi41LDIuNSAwIDAgMSA2LDUwNy45ODY5IEw2LDQ1Ljc5NjkgQTIuNSwyLjUgMCAwIDEgOC41LDQzLjI5NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjYiIHgyPSIxMzYuNzc2NCIgeTE9IjY1LjU5MzgiIHkyPSI2NS41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy43NzY0IiB4PSIxMCIgeT0iNTguMjkyIj5Db21tYW5kIFNpZGU8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFF1ZXJ5IFNpZGUtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZSIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJlbnQwMDA4Ij48cGF0aCBkPSJNNjcuNSw1NTkuNDg2OSBMMTU1LjE2Niw1NTkuNDg2OSBBMy43NSwzLjc1IDAgMCAxIDE1Ny42NjYsNTYxLjk4NjkgTDE2NC42NjYsNTgxLjc4MzcgTDM4OS41LDU4MS43ODM3IEEyLjUsMi41IDAgMCAxIDM5Miw1ODQuMjgzNyBMMzkyLDkwNS40MjY5IEEyLjUsMi41IDAgMCAxIDM4OS41LDkwNy45MjY5IEw2Ny41LDkwNy45MjY5IEEyLjUsMi41IDAgMCAxIDY1LDkwNS40MjY5IEw2NSw1NjEuOTg2OSBBMi41LDIuNSAwIDAgMSA2Ny41LDU1OS40ODY5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2NSIgeDI9IjE2NC42NjYiIHkxPSI1ODEuNzgzNyIgeTI9IjU4MS43ODM3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg2LjY2NiIgeD0iNjkiIHk9IjU3NC40ODIiPlF1ZXJ5IFNpZGU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkMxLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlLlJDMSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ5LjYzNDgiIHg9IjIyMC4xOCIgeT0iNzguMjk2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIzNDkuODE0OCIgeT0iODMuMjk2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzQ3LjgxNDgiIHk9Ijg1LjI5NjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjM0Ny44MTQ4IiB5PSI4OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjIzNS4xOCIgeT0iMTExLjI5MiI+UkVTVCBDb250cm9sbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IENHLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlLkNHIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwNCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzMuNzk5OCIgeD0iMjA4LjEiIHk9IjIwMS41OTY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjM2MS44OTk4IiB5PSIyMDYuNTk2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzU5Ljg5OTgiIHk9IjIwOC41OTY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIzNTkuODk5OCIgeT0iMjEyLjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMuNzk5OCIgeD0iMjIzLjEiIHk9IjIzNC41OTIiPkNvbW1hbmRHYXRld2F5PC90ZXh0PjwvZz48IS0tZW50aXR5IEFBLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlLkFBIiBkYXRhLXNvdXJjZS1saW5lPSI4IiBpZD0iZW50MDAwNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzMuNTI2NCIgeD0iNDkuMjQiIHk9IjMyNC44ODY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjIwMi43NjY0IiB5PSIzMjkuODg2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjAwLjc2NjQiIHk9IjMzMS44ODY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMDAuNzY2NCIgeT0iMzM1Ljg4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzMuNTI2NCIgeD0iNjQuMjQiIHk9IjM1Ny44ODIiPkFnZ3JlZ2F0ZSBBZGFwdGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IERNLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlLkRNIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBpZD0iZW50MDAwNiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDAuODA5NiIgeD0iMzIuNiIgeT0iMjAxLjU5NjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTUzLjQwOTYiIHk9IjIwNi41OTY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNTEuNDA5NiIgeT0iMjA4LjU5NjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE1MS40MDk2IiB5PSIyMTIuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC44MDk2IiB4PSI0Ny42IiB5PSIyMzQuNTkyIj5Eb21haW4gTW9kZWw8L3RleHQ+PC9nPjwhLS1lbnRpdHkgRVMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUuRVMiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEuODY3MiIgeD0iNzUuMDciIHk9IjQ0OC4xODY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE3Ni45MzcyIiB5PSI0NTMuMTg2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTc0LjkzNzIiIHk9IjQ1NS4xODY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNzQuOTM3MiIgeT0iNDU5LjE4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSI5MC4wNyIgeT0iNDgxLjE4MiI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkMyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5SQzIiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDkuNjM0OCIgeD0iMjI2LjE4IiB5PSI1OTQuNDg2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIzNTUuODE0OCIgeT0iNTk5LjQ4NjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjM1My44MTQ4IiB5PSI2MDEuNDg2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzUzLjgxNDgiIHk9IjYwNS40ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjI0MS4xOCIgeT0iNjI3LjQ4MiI+UkVTVCBDb250cm9sbGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IE1CLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5NQiIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGlkPSJlbnQwMDEwIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1Mi40NzE3IiB4PSI5My43NiIgeT0iNzIyLjMzNjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjI2LjIzMTciIHk9IjcyNy4zMzY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMjQuMjMxNyIgeT0iNzI5LjMzNjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIyNC4yMzE3IiB5PSI3MzMuMzM2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi40NzE3IiB4PSIxMDguNzYiIHk9Ijc1NS4zMzIiPk15QmF0aXMgTWFwcGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IERCLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5EQiIgZGF0YS1zb3VyY2UtbGluZT0iMTYiIGlkPSJlbnQwMDExIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0Ny4xMjYiIHg9IjEwNC40NCIgeT0iODQ1LjYyNjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjMxLjU2NiIgeT0iODUwLjYyNjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjIyOS41NjYiIHk9Ijg1Mi42MjY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIyMjkuNTY2IiB5PSI4NTYuNjI2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNy4xMjYiIHg9IjExOS40NCIgeT0iODc4LjYyMiI+UmVhZCBNb2RlbCBEQjwvdGV4dD48L2c+PCEtLWVudGl0eSBQLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iUXVlcnkgU2lkZS5QIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImVudDAwMTIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA5Ljc4MTMiIHg9IjgxLjExIiB5PSI1OTQuNDg2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxNzAuODkxMyIgeT0iNTk5LjQ4NjkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE2OC44OTEzIiB5PSI2MDEuNDg2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTY4Ljg5MTMiIHk9IjYwNS40ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuNzgxMyIgeD0iOTYuMTEiIHk9IjYyNy40ODIiPlByb2plY3Rpb248L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjIzIiBkYXRhLXNvdXJjZS1saW5lPSIzMyIgaWQ9ImVudDAwMjQiPjxwYXRoIGQ9Ik00NDcuNSwyMDQuNjA2OSBMNDQ3LjUsMjQ0Ljg3MjUgTDU5OC41MDAyLDI0NC44NzI1IEw1OTguNTAwMiwyMTQuNjA2OSBMNTg4LjUwMDIsMjA0LjYwNjkgTDQ0Ny41LDIwNC42MDY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTg4LjUwMDIsMjA0LjYwNjkgTDU4OC41MDAyLDIxNC42MDY5IEw1OTguNTAwMiwyMTQuNjA2OSBMNTg4LjUwMDIsMjA0LjYwNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuMDAwMiIgeD0iNDUzLjUiIHk9IjIyMS42NzM4Ij4mIzMyMDIwOyYjMzE4ODM7JiMxMjM5NDsmIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMTI1MTQ7JiMxMjQ4NzsmIzEyNTIzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTQuOTExNyIgeD0iNDUzLjUiIHk9IjIzNi44MDY2Ij5BeG9uICYjMTIzOTU7JiMyMDM4MTsmIzIzMzg0OyYjMTIzNzU7JiMxMjM5NDsmIzEyMzU2OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMjYiIGRhdGEtc291cmNlLWxpbmU9IjM4IiBpZD0iZW50MDAyNyI+PHBhdGggZD0iTTQxMC43Myw1ODkuOTM2OSBMNDEwLjczLDY0NS4zMzUzIEw1NTEuMjc1NSw2NDUuMzM1MyBMNTUxLjI3NTUsNTk5LjkzNjkgTDU0MS4yNzU1LDU4OS45MzY5IEw0MTAuNzMsNTg5LjkzNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik01NDEuMjc1NSw1ODkuOTM2OSBMNTQxLjI3NTUsNTk5LjkzNjkgTDU1MS4yNzU1LDU5OS45MzY5IEw1NDEuMjc1NSw1ODkuOTM2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4wMDAxIiB4PSI0MTYuNzMiIHk9IjYwNy4wMDM4Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMTI0MzQ7JiMzNjA5MjsmIzM1NTAxOyYjMTIzNzU7JiMxMjM5MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuNDA4NyIgeD0iNDE2LjczIiB5PSI2MjIuMTM2NiI+TXlCYXRpcyAmIzMyMDc2OyYjMzAwMDE7JiMxMjM5MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE5LjU0NTUiIHg9IjQxNi43MyIgeT0iNjM3LjI2OTQiPlJlYWQgTW9kZWwgJiMxMjQzNDsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjwvZz48IS0tbGluayBSQzEgdG8gQ0ctLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBpZD0ibG5rMTMiPjxwYXRoIGQ9Ik0yOTUsMTI0Ljk3NjkgQzI5NSwxNDYuNzY2OSAyOTUsMTczLjU4NjkgMjk1LDE5NS4zMzY5IiBmaWxsPSJub25lIiBpZD0iUkMxLXRvLUNHIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyOTUsMjAxLjMzNjksMjk5LDE5Mi4zMzY5LDI5NSwxOTYuMzM2OSwyOTEsMTkyLjMzNjksMjk1LDIwMS4zMzY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA2LjI5MTUiIHg9IjI5NiIgeT0iMTY3LjY2MzgiPnNlbmQoY29tbWFuZCk8L3RleHQ+PC9nPjwhLS1saW5rIENHIHRvIEFBLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDQiIGRhdGEtZW50aXR5LTI9ImVudDAwMDUiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgaWQ9ImxuazE0Ij48cGF0aCBkPSJNMjc4Ljk3LDI0OC4yMjY5IEMyNjcuODEsMjYyLjc4NjkgMjUxLjk0LDI4MS40NTY5IDIzNSwyOTQuODg2OSBDMjIwLjY5LDMwNi4yMzY5IDIwOC44ODE2LDMxMy41NTQyIDE5Mi45MTE2LDMyMS43MjQyIiBmaWxsPSJub25lIiBpZD0iQ0ctdG8tQUEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE4Ny41NywzMjQuNDU2OSwxOTcuNDA0MiwzMjMuOTE4OSwxOTIuMDIxMywzMjIuMTc5NywxOTMuNzYwNiwzMTYuNzk2OCwxODcuNTcsMzI0LjQ1NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzEuMDAyOSIgeD0iMjU0LjQ4IiB5PSIyOTAuOTUzOCI+QENvbW1hbmRIYW5kbGVyPC90ZXh0PjwvZz48IS0tbGluayBBQSB0byBETS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA2IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjIiIGlkPSJsbmsxNSI+PHBhdGggZD0iTTEyOS45LDMyNC42MjY5IEMxMjMuOTksMzAyLjg4NjkgMTE2LjYzNjIsMjc1Ljg0NjEgMTEwLjcwNjIsMjU0LjA2NjEiIGZpbGw9Im5vbmUiIGlkPSJBQS10by1ETSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTA5LjEzLDI0OC4yNzY5LDEwNy42MzQ4LDI1OC4wMTE2LDExMC40NDM1LDI1My4xMDEzLDExNS4zNTM5LDI1NS45MDk5LDEwOS4xMywyNDguMjc2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIxMjIuNDgiIHk9IjI5MC45NTM4Ij4mIzEyNDk5OyYjMTI0NzI7JiMxMjQ5MzsmIzEyNDczOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7PC90ZXh0PjwvZz48IS0tbGluayBETSB0byBBQS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA2IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjMiIGlkPSJsbmsxNiI+PHBhdGggZD0iTTgxLjk3LDI0OC4yMzY5IEM3MS45MywyNjEuNzk2OSA2My41NiwyNzkuMzg2OSA3MSwyOTQuODg2OSBDNzYuNjMsMzA2LjYyNjkgODEuNjAxOSwzMTIuODg1OCA5MS44MjE5LDMyMC44MjU4IiBmaWxsPSJub25lIiBpZD0iRE0tdG8tQUEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk2LjU2LDMyNC41MDY5LDkxLjkwNjksMzE1LjgyNjUsOTIuNjExNiwzMjEuNDM5Myw4Ni45OTg4LDMyMi4xNDQsOTYuNTYsMzI0LjUwNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNy4wMjU5IiB4PSI3MiIgeT0iMjkwLjk1MzgiPmV2ZW50PC90ZXh0PjwvZz48IS0tbGluayBBQSB0byBFUy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjQiIGlkPSJsbmsxNyI+PHBhdGggZD0iTTEzNiwzNzEuNTY2OSBDMTM2LDM5My4zNTY5IDEzNiw0MjAuMTc2OSAxMzYsNDQxLjkyNjkiIGZpbGw9Im5vbmUiIGlkPSJBQS10by1FUyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM2LDQ0Ny45MjY5LDE0MCw0MzguOTI2OSwxMzYsNDQyLjkyNjksMTMyLDQzOC45MjY5LDEzNiw0NDcuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgyLjk0NDgiIHg9IjEzNyIgeT0iNDE0LjI1MzgiPmFwcGx5KGV2ZW50KTwvdGV4dD48L2c+PCEtLWxpbmsgRVMgdG8gUC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA3IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEyIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGlkPSJsbmsxOCI+PHBhdGggZD0iTTEzNiw0OTQuODg2OSBDMTM2LDUyMS45OTY5IDEzNiw1NjEuMjA2OSAxMzYsNTg4LjI0NjkiIGZpbGw9Im5vbmUiIGlkPSJFUy10by1QIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzYsNTk0LjI0NjksMTQwLDU4NS4yNDY5LDEzNiw1ODkuMjQ2OSwxMzIsNTg1LjI0NjksMTM2LDU5NC4yNDY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAxLjQyOTIiIHg9IjEzNyIgeT0iNTM5LjU1MzgiPkBFdmVudEhhbmRsZXI8L3RleHQ+PC9nPjwhLS1saW5rIFAgdG8gTUItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMiIgZGF0YS1lbnRpdHktMj0iZW50MDAxMCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjI2IiBpZD0ibG5rMTkiPjxwYXRoIGQ9Ik0xNDIuMDgsNjQxLjEzNjkgQzE0OC4yNyw2NjQuMDM2OSAxNTYuMjM1Miw2OTMuNTQ0NSAxNjIuNDA1Miw3MTYuMzg0NSIgZmlsbD0ibm9uZSIgaWQ9IlAtdG8tTUIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2My45Nyw3MjIuMTc2OSwxNjUuNDg0NSw3MTIuNDQ1MiwxNjIuNjY2LDcxNy4zNDk5LDE1Ny43NjEzLDcxNC41MzE1LDE2My45Nyw3MjIuMTc2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg3LjI0ODUiIHg9IjE1Ni4wNCIgeT0iNjg4LjQwMzgiPmluc2VydC91cGRhdGU8L3RleHQ+PC9nPjwhLS1saW5rIE1CIHRvIERCLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTAiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyNyIgaWQ9ImxuazIwIj48cGF0aCBkPSJNMTQ2LjA5LDc2OS4wNjY5IEMxMzUuMTUsNzgyLjIxNjkgMTI1Ljg1LDc5OS4zNTY5IDEzMiw4MTUuNjI2OSBDMTM2LjE4LDgyNi42OTY5IDEzOS43OTY0LDgzMi41NjkgMTQ3LjcyNjQsODQwLjk4OSIgZmlsbD0ibm9uZSIgaWQ9Ik1CLXRvLURCIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNTEuODQsODQ1LjM1NjksMTQ4LjU4MTQsODM2LjA2MjcsMTQ4LjQxMiw4NDEuNzE3LDE0Mi43NTc2LDg0MS41NDc2LDE1MS44NCw4NDUuMzU2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1LjcyNzEiIHg9IjEzMyIgeT0iODExLjY5MzgiPlNRTDwvdGV4dD48L2c+PCEtLWxpbmsgTUIgdG8gREItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMCIgZGF0YS1lbnRpdHktMj0iZW50MDAxMSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjMwIiBpZD0ibG5rMjIiPjxwYXRoIGQ9Ik0xNzEuNDksNzY5LjAxNjkgQzE3Mi45Miw3OTAuNzk2OSAxNzQuNjk2Miw4MTcuNjM5OCAxNzYuMTI2Miw4MzkuMzc5OCIgZmlsbD0ibm9uZSIgaWQ9Ik1CLXRvLURCLTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3Ni41Miw4NDUuMzY2OSwxNzkuOTIwNyw4MzYuMTIzNywxNzYuMTkxOCw4NDAuMzc3NywxNzEuOTM3OSw4MzYuNjQ4OCwxNzYuNTIsODQ1LjM2NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC45NDA0IiB4PSIxNzUuNDgiIHk9IjgxMS42OTM4Ij5TRUxFQ1Q8L3RleHQ+PC9nPjwhLS1saW5rIFJDMiB0byBNQi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA5IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEwIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjkiIGlkPSJsbmsyMSI+PHBhdGggZD0iTTI4OS40LDY0MS4wNDY5IEMyODAuNTgsNjU2LjY0NjkgMjY3LjM2LDY3Ny4yNzY5IDI1Miw2OTIuMzM2OSBDMjQwLjU1LDcwMy41NDY5IDIzMS40MjE3LDcxMC40ODUxIDIxOC4wMzE3LDcxOC43MTUxIiBmaWxsPSJub25lIiBpZD0iUkMyLXRvLU1CIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTIuOTIsNzIxLjg1NjksMjIyLjY4Miw3MjAuNTUxOSwyMTcuMTc5Nyw3MTkuMjM4NywyMTguNDkyOSw3MTMuNzM2NCwyMTIuOTIsNzIxLjg1NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNy41MjczIiB4PSIyNjcuMzkiIHk9IjY4OC40MDM4Ij5xdWVyeTwvdGV4dD48L2c+PCEtLWxpbmsgRE0gdG8gR01OMjMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNiIgZGF0YS1lbnRpdHktMj0iZW50MDAyNCIgZGF0YS1saW5rLXR5cGU9ImFzc29jaWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIzMyIgaWQ9ImxuazI1Ij48cGF0aCBkPSJNMTMzLjM1LDIwMS4xNDY5IEMxNTMuNDQsMTg3LjA2NjkgMTgxLjA2LDE3MC41MjY5IDIwOC41LDE2My4wOTY5IEMyOTYuNDQsMTM5LjI4NjkgMzI1LjM3LDEzOS45ODY5IDQxMy41LDE2My4wOTY5IEM0NDMuODksMTcxLjA1NjkgNDc0Ljc0LDE4OS41NjY5IDQ5NS45MSwyMDQuMjQ2OSIgZmlsbD0ibm9uZSIgaWQ9IkRNLUdNTjIzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PC9nPjwhLS1saW5rIFAgdG8gR01OMjYtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMiIgZGF0YS1lbnRpdHktMj0iZW50MDAyNyIgZGF0YS1saW5rLXR5cGU9ImFzc29jaWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIzOCIgaWQ9ImxuazI4Ij48cGF0aCBkPSJNMTUzLjEsNTk0LjM2NjkgQzE2OS40MSw1NzQuMzM2OSAxOTUuOTUsNTQ2LjgzNjkgMjI2LjUsNTM0Ljk4NjkgQzI1Ny4xNiw1MjMuMDg2OSAzNDMuMzksNTI0LjMyNjkgMzc0LjUsNTM0Ljk4NjkgQzQwNS45NCw1NDUuNzU2OSA0MzUuMjcsNTcwLjAwNjkgNDU1LjE2LDU4OS40NjY5IiBmaWxsPSJub25lIiBpZD0iUC1HTU4yNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48P3BsYW50dW1sLXNyYyBYTDlGSm5EMTdCdF9GaUs0QnQwV0g4dVNaRGxqWVdTc1FSbFNEWHg2eGhZa1I3Vk13TEhqWjhWVENHZjFCcTlHRDJRWUhXc2FLRzZaOWVyVlBlM3NuYlZtRHpDTXFPbFBKQjl2eHl0eF9OZEpOYWNvZDBoUThqVGZTb0tNbDlENUJhLXY4MVVrVUVPM2E4YkM2TjdoWk0zRTJ1V2t0c2hMcnNMRmdxVXdfQW5MZVRNeHFfeGdTN19kVTd0eGdGem8tNmJMYnp6ci1UQzhyOWxKX1hmMFpqdXFQY0pBdlFxTXBJOEk5MTZSOGxTWFI3WjFDZDV2OVdMRktvUWs0VGVjM1ZTWVg2RmI4Zk5pQmtyUXQ1czRxOGJabU04NFlIRkhOOHZsRTB3NExUd1lJS1B5N2g3S1diS1ZHa3lFb29HOTkxVkNPYnUwM3l3cksteW1xVnJWQ19DRy1qcUFiS2NSLTNKRm54WFZHSnNacVFXV2dMUDZESDZqMk53QkRNTjJDbWxMSjRLU1lTcEVOaThIbzA5Zmlvb1FSZXhjY202NDNFQ3VvNW1VSnRxTDNwTzAyMWdrd1lFZHJPT2tWc1pyckF3c1BfeUw5VzM4ZFhhbUMtX2E2Z1FyR0IzWmozamp5SGIwbjEwckt5Z2tQYkFlUGQ2X1dhSUlqUGNHU3ZxeW1ZcTNHaE8zbW1KcjlKRjlfMV9qUlJFX2xwTlVha1NrMHNHUzhuOTlWNUNJVmlENENKWlM3RW9sd3M5TmdwTWpUZEp2TmdpM2hWMG5GVFBnM3ZueEYyRXdzM2x3elZndXpxOE5wdXNvVTBZdUFjQXlfZE1pV05OT2pZUnV1OXVEM19oM3RQd3otMDRjVUdzLUZIYmlWak41SHBXTjVPZkZOWHNVUjdxdkNfeUQ/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_7">設計上の特徴<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>特徴</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ドメインモデルとフレームワークの分離</strong></td>
<td><code>JournalEntry.java</code> は純粋なドメインモデル、<code>JournalEntryAggregateAdapter.java</code> は Axon 用アダプター</td>
</tr>
<tr>
<td><strong>Choreography による疎結合</strong></td>
<td>各 Context は独立して動作、イベントを介した非同期連携</td>
</tr>
<tr>
<td><strong>sealed interface による型安全性</strong></td>
<td>イベントの網羅性チェック、switch 式でコンパイル時検証</td>
</tr>
<tr>
<td><strong>record によるイミュータブル設計</strong></td>
<td>状態変更は常に新しいインスタンスを生成</td>
</tr>
<tr>
<td><strong>最小限フィールドの原則</strong></td>
<td>ドメインモデルは状態遷移判定に必要な最小限のみ保持</td>
</tr>
<tr>
<td><strong>MyBatis による柔軟な SQL 制御</strong></td>
<td>Read Model の更新に MyBatis Mapper を使用</td>
</tr>
<tr>
<td><strong>ビジネスルールの集約</strong></td>
<td>借方・貸方一致検証をドメインモデル内で実施</td>
</tr>
</tbody>
</table>
<h3 id="cqrses">財務会計システムでの CQRS/ES の意義<a class="headerlink" href="#cqrses" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>監査証跡</strong></td>
<td>すべての仕訳変更履歴を完全に保持（SOX 法対応）</td>
</tr>
<tr>
<td><strong>訂正仕訳</strong></td>
<td>過去の仕訳を直接変更せず、訂正仕訳として追記</td>
</tr>
<tr>
<td><strong>期末決算</strong></td>
<td>任意の時点での残高を再計算可能</td>
</tr>
<tr>
<td><strong>ワークフロー</strong></td>
<td>仕訳の作成→承認→転記の状態管理</td>
</tr>
<tr>
<td><strong>内部統制</strong></td>
<td>誰が・いつ・何を承認したかの記録</td>
</tr>
</tbody>
</table>
<h3 id="_8">技術スタック<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カテゴリ</th>
<th>技術</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>言語</strong></td>
<td>Java 21</td>
</tr>
<tr>
<td><strong>フレームワーク</strong></td>
<td>Spring Boot 3.4.1</td>
</tr>
<tr>
<td><strong>CQRS/ES</strong></td>
<td>Axon Framework 4.10.3</td>
</tr>
<tr>
<td><strong>ORM</strong></td>
<td>MyBatis 3.0.4</td>
</tr>
<tr>
<td><strong>データベース</strong></td>
<td>H2 / PostgreSQL</td>
</tr>
<tr>
<td><strong>テスト</strong></td>
<td>JUnit 5, Axon Test</td>
</tr>
</tbody>
</table>
<p>CQRS/ES は財務会計システムに特に適しています。すべての取引履歴を完全に保持し、監査要件に対応できるだけでなく、仕訳の承認ワークフローやビジネスルール（借方・貸方の一致）を明確に表現できます。MyBatis を使用することで、複雑な財務レポート（試算表、財務諸表など）のクエリにも柔軟に対応できます。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>