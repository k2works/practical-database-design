
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../chapter25/">
      
      
        <link rel="next" href="../chapter27/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>第26章 外注委託管理の設計 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#26" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第26章 外注委託管理の設計
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-setup-instruction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    プロジェクトセットアップ手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" checked>
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#261" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.1 外注委託業務の理解
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26.1 外注委託業務の理解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        外注委託とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        有償支給と無償支給
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        外注委託の業務フロー
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#262-db" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.2 外注委託の DB 設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26.2 外注委託の DB 設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        外注オーダの構造
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        支給関連のスキーマ設計
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        発注データとの紐付け
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        支給金額の計算（有償支給の場合）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java エンティティの定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typehandler" class="md-nav__link">
    <span class="md-ellipsis">
      
        TypeHandler の実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mybatis-mapper-xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        MyBatis Mapper XML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mapper インターフェース
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        支給サービスの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        コマンドクラス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        TDD: 支給データの登録テスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#263" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.3 消費業務の設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26.3 消費業務の設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        消費関連のスキーマ設計
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        入荷受入データとの紐付け
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        消費率の計算
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java エンティティの定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mybatis-mapper-xml_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        MyBatis Mapper XML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapper_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mapper インターフェース
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        消費サービスの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        コマンドクラス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tdd_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        TDD: 消費データのテスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#264" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.4 外注委託ワークフロー
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26.4 外注委託ワークフロー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        外注委託の全体フロー
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        外注委託ワークフローサービス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dto" class="md-nav__link">
    <span class="md-ellipsis">
      
        コマンド・DTO クラス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        有償支給と無償支給の会計処理の違い
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#265" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.5 リレーションと楽観ロックの設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26.5 リレーションと楽観ロックの設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mybatis-resultmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        MyBatis ネストした ResultMap によるリレーション設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MyBatis ネストした ResultMap によるリレーション設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resultmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        ネストした ResultMap の定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        リレーション設定のポイント
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        楽観ロックの実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="楽観ロックの実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyway" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flyway マイグレーション: バージョンカラム追加
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        エンティティへのバージョンフィールド追加
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mybatis-mapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        MyBatis Mapper: 楽観ロック対応の更新
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository 実装: 楽観ロック対応
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tdd_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        TDD: 楽観ロックのテスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        消費処理における楽観ロックの考慮
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="消費処理における楽観ロックの考慮">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        消費サービスの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        楽観ロックのベストプラクティス（外注委託向け）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#266" class="md-nav__link">
    <span class="md-ellipsis">
      
        26.6 まとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26.6 まとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        学んだこと
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        テーブル一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum" class="md-nav__link">
    <span class="md-ellipsis">
      
        ENUM 一覧
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter22-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 Axon CQRS/ESの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_18" >
        
          
          <label class="md-nav__link" for="__nav_1_18" id="__nav_1_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（FAS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（PMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="26">第26章：外注委託管理の設計<a class="headerlink" href="#26" title="Permanent link">&para;</a></h1>
<p>本章では、外注委託業務の DB 設計を解説します。自社で製造できない工程を外部の委託先に依頼し、材料を支給して加工してもらう業務フローをデータベースで表現します。</p>
<hr />
<h2 id="261">26.1 外注委託業務の理解<a class="headerlink" href="#261" title="Permanent link">&para;</a></h2>
<p>外注委託は、自社の生産能力を補完し、専門的な加工を外部に依頼するための重要な業務です。</p>
<h3 id="_1">外注委託とは<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjUyNXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzI2cHg7aGVpZ2h0OjUyNXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyNiA1MjUiIHdpZHRoPSIzMjZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjI4MDY7JiMzNzA5NjsmIzIyOTk2OyYjMzUzNTE7JiMxMjM5ODsmIzIwMzYzOzwvdGl0bGU+PGRlZnMvPjxnPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMSI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjExOS45MzA2IiB5PSIzMi45OTUxIj4mIzIyODA2OyYjMzcwOTY7JiMyMjk5NjsmIzM1MzUxOyYjMTIzOTg7JiMyMDM2Mzs8L3RleHQ+PC9nPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjAuOTUzMSIgc3R5bGU9InN0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjI5My44NjA3IiB4PSIxNSIgeT0iNTAuMDQyIi8+PGVsbGlwc2UgY3g9IjEwMy4wMDAzIiBjeT0iODUuOTk1MSIgZmlsbD0iIzIyMjIyMiIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNTYuMDAwMyIgeD0iNzUuMDAwMSIgeT0iMTE1Ljk5NTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNi4wMDAzIiB4PSI4NS4wMDAxIiB5PSIxMzcuMTMzOCI+JiMyMTQwNzsmIzI2NDQ4OyYjMjYwMDk7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSI2OS4wMDAxIiB5PSIxNjkuOTYzOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4LjAwMDQiIHg9Ijc5LjAwMDEiIHk9IjE5MS4xMDI1Ij4mIzEyNTAzOyYjMTI1MjQ7JiMxMjQ3MzsmIzIxNjk3OzwvdGV4dD48cmVjdCBmaWxsPSIjNTU1NTU1IiBoZWlnaHQ9IjYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzU1NTU1NTtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxNjQuMDAwNSIgeD0iMjEiIHk9IjMzMS44NzAxIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ0LjAwMDIiIHg9IjMzIiB5PSIzNTcuODcwMSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0LjAwMDIiIHg9IjQzIiB5PSIzNzkuMDA4OCI+JiMzNzA5NjsmIzIxNjk3OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjguMDAwNCIgeD0iMTA1LjAwMDIiIHk9IjM1Ny44NzAxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguMDAwNCIgeD0iMTE1LjAwMDIiIHk9IjM3OS4wMDg4Ij4mIzEyNTEzOyYjMTI0ODM7JiMxMjQ2MTsmIzIxNjk3OzwvdGV4dD48cmVjdCBmaWxsPSIjNTU1NTU1IiBoZWlnaHQ9IjYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzU1NTU1NTtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxNjQuMDAwNSIgeD0iMjEiIHk9IjQxMS44Mzg5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ0LjAwMDIiIHg9IjgxLjAwMDIiIHk9IjQzNy44Mzg5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQuMDAwMiIgeD0iOTEuMDAwMiIgeT0iNDU4Ljk3NzUiPiYjMzUwNjk7JiMyMTY5Nzs8L3RleHQ+PGVsbGlwc2UgY3g9IjEwMy4wMDAzIiBjeT0iNTAyLjgwNzYiIGZpbGw9Im5vbmUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGVsbGlwc2UgY3g9IjEwMy4wMDAzIiBjeT0iNTAyLjgwNzYiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE1IiB4Mj0iMTUiIHkxPSI1MC4wNDIiIHkyPSI1MTMuODA3NiIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIyMTUiIHk9IjIyMy45MzI2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguMDAwNCIgeD0iMjI1IiB5PSIyNDUuMDcxMyI+JiMxMjUwMzsmIzEyNTI0OyYjMTI0NzM7JiMyMTY5Nzs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY4LjAwMDQiIHg9IjIxNSIgeT0iMjc3LjkwMTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIyMjUiIHk9IjI5OS4wNCI+JiMxMjUxMzsmIzEyNDgzOyYjMTI0NjE7JiMyMTY5Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTg5LjAwMDUiIHgyPSIxODkuMDAwNSIgeTE9IjUwLjA0MiIgeTI9IjUxMy44MDc2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMzA2Ljk5OTkiIHgyPSIzMDYuOTk5OSIgeTE9IjUwLjA0MiIgeTI9IjUxMy44MDc2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEwMy4wMDAzIiB4Mj0iMTAzLjAwMDMiIHkxPSI5NS45OTUxIiB5Mj0iMTE1Ljk5NTEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk5LjAwMDMsMTA1Ljk5NTEsMTAzLjAwMDMsMTE1Ljk5NTEsMTA3LjAwMDMsMTA1Ljk5NTEsMTAzLjAwMDMsMTA5Ljk5NTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTAzLjAwMDMiIHgyPSIxMDMuMDAwMyIgeTE9IjE0OS45NjM5IiB5Mj0iMTY5Ljk2MzkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk5LjAwMDMsMTU5Ljk2MzksMTAzLjAwMDMsMTY5Ljk2MzksMTA3LjAwMDMsMTU5Ljk2MzksMTAzLjAwMDMsMTYzLjk2MzkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTUuMDAwMSIgeDI9IjU1LjAwMDEiIHkxPSIzMzcuODcwMSIgeTI9IjM1Ny44NzAxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1MS4wMDAxLDM0Ny44NzAxLDU1LjAwMDEsMzU3Ljg3MDEsNTkuMDAwMSwzNDcuODcwMSw1NS4wMDAxLDM1MS44NzAxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEzOS4wMDA0IiB4Mj0iMTM5LjAwMDQiIHkxPSIzMzcuODcwMSIgeTI9IjM1Ny44NzAxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzUuMDAwNCwzNDcuODcwMSwxMzkuMDAwNCwzNTcuODcwMSwxNDMuMDAwNCwzNDcuODcwMSwxMzkuMDAwNCwzNTEuODcwMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1NS4wMDAxIiB4Mj0iNTUuMDAwMSIgeTE9IjM5MS44Mzg5IiB5Mj0iNDExLjgzODkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjUxLjAwMDEsNDAxLjgzODksNTUuMDAwMSw0MTEuODM4OSw1OS4wMDAxLDQwMS44Mzg5LDU1LjAwMDEsNDA1LjgzODkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTM5LjAwMDQiIHgyPSIxMzkuMDAwNCIgeTE9IjM5MS44Mzg5IiB5Mj0iNDExLjgzODkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNS4wMDA0LDQwMS44Mzg5LDEzOS4wMDA0LDQxMS44Mzg5LDE0My4wMDA0LDQwMS44Mzg5LDEzOS4wMDA0LDQwNS44Mzg5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEwMy4wMDAzIiB4Mj0iMTAzLjAwMDMiIHkxPSI0MTcuODM4OSIgeTI9IjQzNy44Mzg5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5OS4wMDAzLDQyNy44Mzg5LDEwMy4wMDAzLDQzNy44Mzg5LDEwNy4wMDAzLDQyNy44Mzg5LDEwMy4wMDAzLDQzMS44Mzg5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEwMy4wMDAzIiB4Mj0iMTAzLjAwMDMiIHkxPSI0NzEuODA3NiIgeTI9IjQ5MS44MDc2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5OS4wMDAzLDQ4MS44MDc2LDEwMy4wMDAzLDQ5MS44MDc2LDEwNy4wMDAzLDQ4MS44MDc2LDEwMy4wMDAzLDQ4NS44MDc2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI0OS4wMDAyIiB4Mj0iMjQ5LjAwMDIiIHkxPSIyNTcuOTAxNCIgeTI9IjI3Ny45MDE0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDUuMDAwMiwyNjcuOTAxNCwyNDkuMDAwMiwyNzcuOTAxNCwyNTMuMDAwMiwyNjcuOTAxNCwyNDkuMDAwMiwyNzEuOTAxNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDMuMDAwMyIgeDI9IjEwMy4wMDAzIiB5MT0iMjAzLjkzMjYiIHkyPSIyMDguOTMyNiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMDMuMDAwMyIgeDI9IjI0OS4wMDAyIiB5MT0iMjA4LjkzMjYiIHkyPSIyMDguOTMyNiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNDkuMDAwMiIgeDI9IjI0OS4wMDAyIiB5MT0iMjA4LjkzMjYiIHkyPSIyMjMuOTMyNiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjQ1LjAwMDIsMjEzLjkzMjYsMjQ5LjAwMDIsMjIzLjkzMjYsMjUzLjAwMDIsMjEzLjkzMjYsMjQ5LjAwMDIsMjE3LjkzMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQ5LjAwMDIiIHgyPSIyNDkuMDAwMiIgeTE9IjMxMS44NzAxIiB5Mj0iMzE2Ljg3MDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjQ5LjAwMDIiIHgyPSIxMDMuMDAwMyIgeTE9IjMxNi44NzAxIiB5Mj0iMzE2Ljg3MDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTAzLjAwMDMiIHgyPSIxMDMuMDAwMyIgeTE9IjMxNi44NzAxIiB5Mj0iMzMxLjg3MDEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk5LjAwMDMsMzIxLjg3MDEsMTAzLjAwMDMsMzMxLjg3MDEsMTA3LjAwMDMsMzIxLjg3MDEsMTAzLjAwMDMsMzI1Ljg3MDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MS45OTk2IiB4PSI2Ni4wMDA1IiB5PSI2Ni43NSI+JiMzMzI1ODsmIzMxMDM4OyYjMjQwMzc7JiMyMjU4MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTgiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA3Ljk5OTQiIHg9IjE5NC4wMDA1IiB5PSI2Ni43NSI+JiMyMjgwNjsmIzM3MDk2OyYjMjI5OTY7JiMzNTM1MTsmIzI0MDM3OyYjMjI1ODA7PC90ZXh0Pjw/cGxhbnR1bWwtc3JjIEF5YWlvS2JMVUJmYXNpbGM1Sy1OSnRjbk9saFpuZExGemRMcFNUTXlRNV9yVkNjLWZ6a05GYnNtZk9RaGsySW5nOEpCd2NkVl82VHA5cG9SRGpFUW8tZm55X0o3cE1pVUQtcnlFaGRIY2dpNnNIMk9CWkdyR0V4Mm55dERadmxNR2hJV01mNk1OdkpEUEdLbzBvRzl1WWFhZllUY3ZnNWgweWthdmdMbU1Sck9sMVNpS2JvSU5tMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<p>外注委託には以下の特徴があります：</p>
<table>
<thead>
<tr>
<th>特徴</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>専門加工の委託</strong></td>
<td>メッキ、熱処理、塗装など専門設備が必要な工程を委託</td>
</tr>
<tr>
<td><strong>生産能力の補完</strong></td>
<td>繁忙期の生産量増加への対応</td>
</tr>
<tr>
<td><strong>コスト最適化</strong></td>
<td>内製と外注のコスト比較による最適な生産配分</td>
</tr>
</tbody>
</table>
<h3 id="_2">有償支給と無償支給<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>外注委託における材料の支給方法には2種類あります。</p>
<table>
<thead>
<tr>
<th>支給方式</th>
<th>説明</th>
<th>会計処理</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>有償支給</strong></td>
<td>材料を売却扱いで支給</td>
<td>売上計上後、加工品を仕入れ</td>
</tr>
<tr>
<td><strong>無償支給</strong></td>
<td>材料を無償で貸与</td>
<td>在庫のまま、加工賃のみ支払い</td>
</tr>
</tbody>
</table>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjU0NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTI0cHg7aGVpZ2h0OjU0NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDUyNCA1NDUiIHdpZHRoPSI1MjRweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjYzNzc7JiMyMDc2NzsmIzI1OTAzOyYjMzIxMDI7JiMxMjM5MjsmIzI4OTYxOyYjMjA3Njc7JiMyNTkwMzsmIzMyMTAyOyYjMTIzOTg7JiMzNjk0OTsmIzEyMzU2OzwvdGl0bGU+PGRlZnMvPjxnPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMSI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2Ny45OTkzIiB4PSIxNzYuOTMxNyIgeT0iMzIuOTk1MSI+JiMyNjM3NzsmIzIwNzY3OyYjMjU5MDM7JiMzMjEwMjsmIzEyMzkyOyYjMjg5NjE7JiMyMDc2NzsmIzI1OTAzOyYjMzIxMDI7JiMxMjM5ODsmIzM2OTQ5OyYjMTIzNTY7PC90ZXh0PjwvZz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIwLjk1MzEiIHN0eWxlPSJzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI0OTEuODYyNiIgeD0iMTUiIHk9IjUwLjA0MiIvPjxyZWN0IGZpbGw9IiNBREQ4RTYiIGhlaWdodD0iNDgzLjc2NTYiIHN0eWxlPSJzdHJva2U6I0FERDhFNjtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIyMzIuMDAwOSIgeD0iMTUiIHk9IjUwLjA0MiIvPjxlbGxpcHNlIGN4PSI4NS4wMDA0IiBjeT0iODUuOTk1MSIgZmlsbD0iIzIyMjIyMiIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTY5LjAwMDgsMTIwLjQxMzEgTDE2OS4wMDA4LDEyOC45Nzk1IEwxNDkuMDAwOCwxMzIuOTc5NSBMMTY5LjAwMDgsMTM2Ljk3OTUgTDE2OS4wMDA4LDE0NS41NDU5IEEwLDAgMCAwIDAgMTY5LjAwMDgsMTQ1LjU0NTkgTDI0Mi4wMDA5LDE0NS41NDU5IEEwLDAgMCAwIDAgMjQyLjAwMDksMTQ1LjU0NTkgTDI0Mi4wMDA5LDEzMC40MTMxIEwyMzIuMDAwOSwxMjAuNDEzMSBMMTY5LjAwMDgsMTIwLjQxMzEgQTAsMCAwIDAgMCAxNjkuMDAwOCwxMjAuNDEzMSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTIzMi4wMDA5LDEyMC40MTMxIEwyMzIuMDAwOSwxMzAuNDEzMSBMMjQyLjAwMDksMTMwLjQxMzEgTDIzMi4wMDA5LDEyMC40MTMxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSIxNzUuMDAwOCIgeT0iMTM3LjQ4Ij4mIzIyNzcwOyYjMTk5Nzg7JiMzNTMzNjsmIzE5OTc4OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI4LjAwMDgiIHg9IjIxIiB5PSIxMTUuOTk1MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC4wMDA4IiB4PSIzMSIgeT0iMTM3LjEzMzgiPiYjMjY0NDg7JiMyNjAwOTsmIzEyNDM0OyYjMjI4MDY7JiMyNzg4MDsmIzIwODA4OyYjMTIzOTU7JiMyMjc3MDsmIzIxMzY0OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTIuMDAwNSIgeD0iMzkuMDAwMSIgeT0iMTY5Ljk2MzkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi4wMDA1IiB4PSI0OS4wMDAxIiB5PSIxOTEuMTAyNSI+JiMyMjgwNjsmIzI3ODgwOyYjMjA4MDg7JiMxMjM5MTsmIzIxMTUyOyYjMjQwMzc7PC90ZXh0PjxwYXRoIGQ9Ik0xNTEuMDAwNywyMjguMzUwNiBMMTUxLjAwMDcsMjM2LjkxNyBMMTMxLjAwMDcsMjQwLjkxNyBMMTUxLjAwMDcsMjQ0LjkxNyBMMTUxLjAwMDcsMjUzLjQ4MzQgQTAsMCAwIDAgMCAxNTEuMDAwNywyNTMuNDgzNCBMMjI0LjAwMDcsMjUzLjQ4MzQgQTAsMCAwIDAgMCAyMjQuMDAwNywyNTMuNDgzNCBMMjI0LjAwMDcsMjM4LjM1MDYgTDIxNC4wMDA3LDIyOC4zNTA2IEwxNTEuMDAwNywyMjguMzUwNiBBMCwwIDAgMCAwIDE1MS4wMDA3LDIyOC4zNTA2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjE0LjAwMDcsMjI4LjM1MDYgTDIxNC4wMDA3LDIzOC4zNTA2IEwyMjQuMDAwNywyMzguMzUwNiBMMjE0LjAwMDcsMjI4LjM1MDYiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjE1Ny4wMDA3IiB5PSIyNDUuNDE3NSI+JiMyMDE4MTsmIzIwODM3OyYjMzUzMzY7JiMxOTk3ODs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkyLjAwMDUiIHg9IjM5LjAwMDEiIHk9IjIyMy45MzI2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIuMDAwNSIgeD0iNDkuMDAwMSIgeT0iMjQ1LjA3MTMiPiYjMjExNTI7JiMyNDAzNzsmIzIxNjk3OyYjMTI0MzQ7JiMzNjA5MjsmIzIwODM3OzwvdGV4dD48ZWxsaXBzZSBjeD0iODUuMDAwNCIgY3k9IjI4OC45MDE0IiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxlbGxpcHNlIGN4PSI4NS4wMDA0IiBjeT0iMjg4LjkwMTQiIGZpbGw9IiMyMjIyMjIiIHJ4PSI2IiByeT0iNiIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE1IiB4Mj0iMTUiIHkxPSI1MC4wNDIiIHkyPSI1MzMuODA3NiIvPjxyZWN0IGZpbGw9IiM5MEVFOTAiIGhlaWdodD0iNDgzLjc2NTYiIHN0eWxlPSJzdHJva2U6IzkwRUU5MDtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIyNTguMDAwOSIgeD0iMjQ3LjAwMDkiIHk9IjUwLjA0MiIvPjxlbGxpcHNlIGN4PSIzMTcuMDAxMyIgY3k9IjMxOS45MDE0IiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00MDEuMDAxNywzNTQuMzE5MyBMNDAxLjAwMTcsMzYyLjg4NTcgTDM4MS4wMDE3LDM2Ni44ODU3IEw0MDEuMDAxNywzNzAuODg1NyBMNDAxLjAwMTcsMzc5LjQ1MjEgQTAsMCAwIDAgMCA0MDEuMDAxNywzNzkuNDUyMSBMNTAwLjAwMTgsMzc5LjQ1MjEgQTAsMCAwIDAgMCA1MDAuMDAxOCwzNzkuNDUyMSBMNTAwLjAwMTgsMzY0LjMxOTMgTDQ5MC4wMDE4LDM1NC4zMTkzIEw0MDEuMDAxNywzNTQuMzE5MyBBMCwwIDAgMCAwIDQwMS4wMDE3LDM1NC4zMTkzIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNDkwLjAwMTgsMzU0LjMxOTMgTDQ5MC4wMDE4LDM2NC4zMTkzIEw1MDAuMDAxOCwzNjQuMzE5MyBMNDkwLjAwMTgsMzU0LjMxOTMiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjQwNy4wMDE3IiB5PSIzNzEuMzg2MiI+JiMyMjMxMjsmIzI0MjM1OyYjMzEyMjc7JiMyMTIwNTsmIzEyMzk4OyYjMTI0MTU7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjguMDAwOCIgeD0iMjUzLjAwMDkiIHk9IjM0OS45MDE0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjAwMDgiIHg9IjI2My4wMDA5IiB5PSIzNzEuMDQiPiYjMjY0NDg7JiMyNjAwOTsmIzEyNDM0OyYjMjI4MDY7JiMyNzg4MDsmIzIwODA4OyYjMTIzOTU7JiMzNjAyNDsmIzE5OTgyOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTIuMDAwNSIgeD0iMjcxLjAwMSIgeT0iNDAzLjg3MDEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi4wMDA1IiB4PSIyODEuMDAxIiB5PSI0MjUuMDA4OCI+JiMyMjgwNjsmIzI3ODgwOyYjMjA4MDg7JiMxMjM5MTsmIzIxMTUyOyYjMjQwMzc7PC90ZXh0PjxwYXRoIGQ9Ik0zODMuMDAxNiw0NjIuMjU2OCBMMzgzLjAwMTYsNDcwLjgyMzIgTDM2My4wMDE2LDQ3NC44MjMyIEwzODMuMDAxNiw0NzguODIzMiBMMzgzLjAwMTYsNDg3LjM4OTYgQTAsMCAwIDAgMCAzODMuMDAxNiw0ODcuMzg5NiBMNDk1LjAwMTcsNDg3LjM4OTYgQTAsMCAwIDAgMCA0OTUuMDAxNyw0ODcuMzg5NiBMNDk1LjAwMTcsNDcyLjI1NjggTDQ4NS4wMDE3LDQ2Mi4yNTY4IEwzODMuMDAxNiw0NjIuMjU2OCBBMCwwIDAgMCAwIDM4My4wMDE2LDQ2Mi4yNTY4IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNDg1LjAwMTcsNDYyLjI1NjggTDQ4NS4wMDE3LDQ3Mi4yNTY4IEw0OTUuMDAxNyw0NzIuMjU2OCBMNDg1LjAwMTcsNDYyLjI1NjgiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjM4OS4wMDE2IiB5PSI0NzkuMzIzNyI+JiMyMTE1MjsmIzI0MDM3OyYjMzYwMzU7JiMxMjM5ODsmIzEyNDE1OyYjMzUzMzY7JiMxOTk3ODs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkyLjAwMDUiIHg9IjI3MS4wMDEiIHk9IjQ1Ny44Mzg5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzIuMDAwNSIgeD0iMjgxLjAwMSIgeT0iNDc4Ljk3NzUiPiYjMjExNTI7JiMyNDAzNzsmIzIxNjk3OyYjMTI0MzQ7JiMyMTQ2MzsmIzIwODM3OzwvdGV4dD48ZWxsaXBzZSBjeD0iMzE3LjAwMTMiIGN5PSI1MjIuODA3NiIgZmlsbD0ibm9uZSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZWxsaXBzZSBjeD0iMzE3LjAwMTMiIGN5PSI1MjIuODA3NiIgZmlsbD0iIzIyMjIyMiIgcng9IjYiIHJ5PSI2IiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjQ3LjAwMDkiIHgyPSIyNDcuMDAwOSIgeTE9IjUwLjA0MiIgeTI9IjUzMy44MDc2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTA1LjAwMTgiIHgyPSI1MDUuMDAxOCIgeTE9IjUwLjA0MiIgeTI9IjUzMy44MDc2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg1LjAwMDQiIHgyPSI4NS4wMDA0IiB5MT0iOTUuOTk1MSIgeTI9IjExNS45OTUxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4MS4wMDA0LDEwNS45OTUxLDg1LjAwMDQsMTE1Ljk5NTEsODkuMDAwNCwxMDUuOTk1MSw4NS4wMDA0LDEwOS45OTUxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg1LjAwMDQiIHgyPSI4NS4wMDA0IiB5MT0iMTQ5Ljk2MzkiIHkyPSIxNjkuOTYzOSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODEuMDAwNCwxNTkuOTYzOSw4NS4wMDA0LDE2OS45NjM5LDg5LjAwMDQsMTU5Ljk2MzksODUuMDAwNCwxNjMuOTYzOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4NS4wMDA0IiB4Mj0iODUuMDAwNCIgeTE9IjIwMy45MzI2IiB5Mj0iMjIzLjkzMjYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgxLjAwMDQsMjEzLjkzMjYsODUuMDAwNCwyMjMuOTMyNiw4OS4wMDA0LDIxMy45MzI2LDg1LjAwMDQsMjE3LjkzMjYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODUuMDAwNCIgeDI9Ijg1LjAwMDQiIHkxPSIyNTcuOTAxNCIgeTI9IjI3Ny45MDE0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4MS4wMDA0LDI2Ny45MDE0LDg1LjAwMDQsMjc3LjkwMTQsODkuMDAwNCwyNjcuOTAxNCw4NS4wMDA0LDI3MS45MDE0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMxNy4wMDEzIiB4Mj0iMzE3LjAwMTMiIHkxPSIzMjkuOTAxNCIgeTI9IjM0OS45MDE0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTMuMDAxMywzMzkuOTAxNCwzMTcuMDAxMywzNDkuOTAxNCwzMjEuMDAxMywzMzkuOTAxNCwzMTcuMDAxMywzNDMuOTAxNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMTcuMDAxMyIgeDI9IjMxNy4wMDEzIiB5MT0iMzgzLjg3MDEiIHkyPSI0MDMuODcwMSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzEzLjAwMTMsMzkzLjg3MDEsMzE3LjAwMTMsNDAzLjg3MDEsMzIxLjAwMTMsMzkzLjg3MDEsMzE3LjAwMTMsMzk3Ljg3MDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzE3LjAwMTMiIHgyPSIzMTcuMDAxMyIgeTE9IjQzNy44Mzg5IiB5Mj0iNDU3LjgzODkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMxMy4wMDEzLDQ0Ny44Mzg5LDMxNy4wMDEzLDQ1Ny44Mzg5LDMyMS4wMDEzLDQ0Ny44Mzg5LDMxNy4wMDEzLDQ1MS44Mzg5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMxNy4wMDEzIiB4Mj0iMzE3LjAwMTMiIHkxPSI0OTEuODA3NiIgeTI9IjUxMS44MDc2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTMuMDAxMyw1MDEuODA3NiwzMTcuMDAxMyw1MTEuODA3NiwzMjEuMDAxMyw1MDEuODA3NiwzMTcuMDAxMyw1MDUuODA3NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcxLjk5OTYiIHg9Ijk1LjAwMDciIHk9IjY2Ljc1Ij4mIzI2Mzc3OyYjMjA3Njc7JiMyNTkwMzsmIzMyMTAyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MS45OTk2IiB4PSIzNDAuMDAxNiIgeT0iNjYuNzUiPiYjMjg5NjE7JiMyMDc2NzsmIzI1OTAzOyYjMzIxMDI7PC90ZXh0Pjw/cGxhbnR1bWwtc3JjIEF5YWlvS2JMVTNRZHlzZEJfNlRKclpfVmtrbm51dWhkQkdrSGtFalVEYXZ6dERaMm5MTVp4OUVQZGI3WWI1RVFNZUVpZXVRaGsySW5nOEpCd2pkUzJTLWNwTnBTREVkZmFjZEZEZ3p1c2pobms3N3JxeU1SZGxQa2lVUkFvb3o5TElXMjZNMmIwMUh4aWdGaG5PZUU4Q2JiWFFIdy1URWsxSy10QnhLNjJlOFBKb1N0MGVyeGlOZEZxelFiZzRPeXNKcUxBME9yZWhXYWxtM2tGbFVZckRJeTZjR191N1ZXWXFxeGRrcGVHdEZXZDFMRlR3ci1sZHB0cXN3V3R6U3pSam5GWDNFVnphXzdTMlA0X2lOY1BlV2ZJRXU1MDAwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_3">外注委託の業務フロー<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjkzMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6OTg5cHg7aGVpZ2h0OjkzMnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDk4OSA5MzIiIHdpZHRoPSI5ODlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjI4MDY7JiMyNzg4MDsmIzIyOTk2OyYjMzUzNTE7JiMxMjM5ODsmIzI2OTg5OyYjMjEyMDk7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5Ljk5OTQiIHg9IjQyMy4yMDYiIHk9IjMyLjk5NTEiPiYjMjI4MDY7JiMyNzg4MDsmIzIyOTk2OyYjMzUzNTE7JiMxMjM5ODsmIzI2OTg5OyYjMjEyMDk7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7PC90ZXh0PjwvZz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIwLjk1MzEiIHN0eWxlPSJzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI5NTYuNDExMyIgeD0iMTUiIHk9IjUwLjA0MiIvPjxlbGxpcHNlIGN4PSI2MS4wMDAyIiBjeT0iODUuOTk1MSIgZmlsbD0iIzIyMjIyMiIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTIxLjAwMDUsMTEyLjg0NjcgTDEyMS4wMDA1LDEyOC45Nzk1IEwxMDEuMDAwNSwxMzIuOTc5NSBMMTIxLjAwMDUsMTM2Ljk3OTUgTDEyMS4wMDA1LDE1My4xMTIzIEEwLDAgMCAwIDAgMTIxLjAwMDUsMTUzLjExMjMgTDI0Ni4wMDA2LDE1My4xMTIzIEEwLDAgMCAwIDAgMjQ2LjAwMDYsMTUzLjExMjMgTDI0Ni4wMDA2LDEyMi44NDY3IEwyMzYuMDAwNiwxMTIuODQ2NyBMMTIxLjAwMDUsMTEyLjg0NjcgQTAsMCAwIDAgMCAxMjEuMDAwNSwxMTIuODQ2NyIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTIzNi4wMDA2LDExMi44NDY3IEwyMzYuMDAwNiwxMjIuODQ2NyBMMjQ2LjAwMDYsMTIyLjg0NjcgTDIzNi4wMDA2LDExMi44NDY3IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSIxMjcuMDAwNSIgeT0iMTI5LjkxMzYiPiYjMzUwNjk7JiMzNjg5NjsmIzEyNDU4OyYjMTI1NDA7JiMxMjQ4MDsmIzEyMzYzOyYjMTI0MjU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIxMjcuMDAwNSIgeT0iMTQ1LjA0NjQiPiYjMjI4MDY7JiMyNzg4MDsmIzEyNDU4OyYjMTI1NDA7JiMxMjQ4MDsmIzEyNDM0OyYjMjk5ODM7JiMyNTEwNDs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjgwLjAwMDUiIHg9IjIxIiB5PSIxMTUuOTk1MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjAwMDUiIHg9IjMxIiB5PSIxMzcuMTMzOCI+JiMxMjQ1ODsmIzEyNTQwOyYjMTI0ODA7JiMyNDc3MzsmIzIyNTc3OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNSIgeDI9IjE1IiB5MT0iNTAuMDQyIiB5Mj0iOTIwLjczNzMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjguMDAwNCIgeD0iNDA3LjAwMSIgeT0iMTczLjExMjMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSI0MTcuMDAxIiB5PSIxOTQuMjUxIj4mIzMwMzMwOyYjMjc4ODA7JiMyMDMxNjsmIzI1MTA0OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDAwNSIgeD0iNDAxLjAwMSIgeT0iMjI3LjA4MTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wMDA1IiB4PSI0MTEuMDAxIiB5PSIyNDguMjE5NyI+JiMyNzg4MDsmIzI1OTkxOyYjMjYzNjA7JiMzMDMzMDsmIzM0ODkyOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjguMDAwNCIgeD0iMjc1LjAwMDciIHk9Ijc1Ni43OTk4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguMDAwNCIgeD0iMjg1LjAwMDciIHk9Ijc3Ny45Mzg1Ij4mIzI2OTA4OyYjMjE0NTQ7JiMyMDk2NjsmIzI5NzAyOzwvdGV4dD48cGF0aCBkPSJNMzgxLjAwMTIsODE1LjE4NjUgTDM4MS4wMDEyLDgyMy43NTI5IEwzNjEuMDAxMiw4MjcuNzUyOSBMMzgxLjAwMTIsODMxLjc1MjkgTDM4MS4wMDEyLDg0MC4zMTkzIEEwLDAgMCAwIDAgMzgxLjAwMTIsODQwLjMxOTMgTDUxOS4wMDE0LDg0MC4zMTkzIEEwLDAgMCAwIDAgNTE5LjAwMTQsODQwLjMxOTMgTDUxOS4wMDE0LDgyNS4xODY1IEw1MDkuMDAxNCw4MTUuMTg2NSBMMzgxLjAwMTIsODE1LjE4NjUgQTAsMCAwIDAgMCAzODEuMDAxMiw4MTUuMTg2NSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTUwOS4wMDE0LDgxNS4xODY1IEw1MDkuMDAxNCw4MjUuMTg2NSBMNTE5LjAwMTQsODI1LjE4NjUgTDUwOS4wMDE0LDgxNS4xODY1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuMDAwMSIgeD0iMzg3LjAwMTIiIHk9IjgzMi4yNTM0Ij4mIzI1OTAzOyYjMzIxMDI7JiMyMTY5NzsmIzEyMzk4OyYjMjgwNDA7JiMzNjAyNzsmIzEyNDM0OyYjMzUzNTI7JiMzNzY4Mjs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwNC4wMDA2IiB4PSIyNTcuMDAwNiIgeT0iODEwLjc2ODYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NC4wMDA2IiB4PSIyNjcuMDAwNiIgeT0iODMxLjkwNzIiPiYjMjgwNDA7JiMzNjAyNzsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzIwMzE2OyYjMjUxMDQ7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjI1MS4wMDA2IiB4Mj0iMjUxLjAwMDYiIHkxPSI1MC4wNDIiIHkyPSI5MjAuNzM3MyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MC4wMDA1IiB4PSI1MzYuMDAxNCIgeT0iMjgxLjA0OTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wMDA1IiB4PSI1NDYuMDAxNCIgeT0iMzAyLjE4ODUiPiYjMjU5MDM7JiMzMjEwMjsmIzIxNjk3OyYjMjgzMTA7JiMyMDYzMzs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkyLjAwMDUiIHg9IjUzMC4wMDE0IiB5PSIzMzUuMDE4NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcyLjAwMDUiIHg9IjU0MC4wMDE0IiB5PSIzNTYuMTU3MiI+JiMyNTkwMzsmIzMyMTAyOyYjMjAyNTM7JiMzMTA4MDsmIzIwMzE2OyYjMjUxMDQ7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MC4wMDA1IiB4PSI1MzYuMDAxNCIgeT0iMzg4Ljk4NzMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wMDA1IiB4PSI1NDYuMDAxNCIgeT0iNDEwLjEyNiI+JiMyNTkwMzsmIzMyMTAyOyYjMjE2OTc7JiMyMDk4NjsmIzMzNjU1OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1MjQuMDAxNCIgeDI9IjUyNC4wMDE0IiB5MT0iNTAuMDQyIiB5Mj0iOTIwLjczNzMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDAwNSIgeD0iNjMyLjAwMTkiIHk9IjQ0Mi45NTYxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjAuMDAwNSIgeD0iNjQyLjAwMTkiIHk9IjQ2NC4wOTQ3Ij4mIzI1OTAzOyYjMzIxMDI7JiMyMTY5NzsmIzIxNDYzOyYjMzg5MzY7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSI2MzguMDAyIiB5PSI0OTYuOTI0OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4LjAwMDQiIHg9IjY0OC4wMDIiIHk9IjUxOC4wNjM1Ij4mIzIxMTUyOyYjMjQwMzc7JiMyMDMxNjsmIzI2OTg5OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDAwNSIgeD0iNjMyLjAwMTkiIHk9IjU1MC44OTM2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjAuMDAwNSIgeD0iNjQyLjAwMTkiIHk9IjU3Mi4wMzIyIj4mIzIzNDM2OyYjMjUxMDQ7JiMyMTY5NzsmIzIwOTg2OyYjMzM2NTU7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjYyNi4wMDE5IiB4Mj0iNjI2LjAwMTkiIHkxPSI1MC4wNDIiIHkyPSI5MjAuNzM3MyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSI3MjQuMDAyIiB5PSI2MDQuODYyMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4LjAwMDQiIHg9IjczNC4wMDIiIHk9IjYyNi4wMDEiPiYjMjA4Mzc7JiMzMzY1NTsmIzIxNDYzOyYjMjA4Mzc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjcxNi4wMDI0IiB4Mj0iNzE2LjAwMjQiIHkxPSI1MC4wNDIiIHkyPSI5MjAuNzM3MyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSI4MTMuOTI5MiIgeT0iNjU4LjgzMTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSI4MjMuOTI5MiIgeT0iNjc5Ljk2OTciPiYjMjE0NjM7JiMyMDgzNzsmIzI2OTA4OyYjMjY2MTk7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iODM0LjAxMDIsNzEyLjc5OTgsODYxLjg0ODUsNzEyLjc5OTgsODczLjg0ODUsNzI0Ljc5OTgsODYxLjg0ODUsNzM2Ljc5OTgsODM0LjAxMDIsNzM2Ljc5OTgsODIyLjAxMDIsNzI0Ljc5OTgsODM0LjAxMDIsNzEyLjc5OTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3LjgzODIiIHg9IjgzNC4wMTAyIiB5PSI3MjguNjA3OSI+JiMyMTUxMjsmIzI2Njg0Oz88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkuMDA4MyIgeD0iODAzLjAwMTkiIHk9IjcyMi4yMDU2Ij55ZXM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMuNzAxNyIgeD0iODczLjg0ODUiIHk9IjcyMi4yMDU2Ij5ubzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjguMDAwNCIgeD0iODk3LjU1MDEiIHk9Ijc1Ni43OTk4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguMDAwNCIgeD0iOTA3LjU1MDEiIHk9Ijc3Ny45Mzg1Ij4mIzE5OTgxOyYjMzMzOTE7JiMyMDk2NjsmIzI5NzAyOzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9Ijg0Ny45Mjk0LDg1NC43MzczLDg1OS45Mjk0LDg2Ni43MzczLDg0Ny45Mjk0LDg3OC43MzczLDgzNS45Mjk0LDg2Ni43MzczLDg0Ny45Mjk0LDg1NC43MzczIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48ZWxsaXBzZSBjeD0iODQ3LjkyOTQiIGN5PSI5MDkuNzM3MyIgZmlsbD0ibm9uZSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZWxsaXBzZSBjeD0iODQ3LjkyOTQiIGN5PSI5MDkuNzM3MyIgZmlsbD0iIzIyMjIyMiIgcng9IjYiIHJ5PSI2IiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNzk4LjAwMTkiIHgyPSI3OTguMDAxOSIgeTE9IjUwLjA0MiIgeTI9IjkyMC43MzczIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iOTY5LjU1MDUiIHgyPSI5NjkuNTUwNSIgeTE9IjUwLjA0MiIgeTI9IjkyMC43MzczIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjYxLjAwMDIiIHgyPSI2MS4wMDAyIiB5MT0iOTUuOTk1MSIgeTI9IjExNS45OTUxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1Ny4wMDAyLDEwNS45OTUxLDYxLjAwMDIsMTE1Ljk5NTEsNjUuMDAwMiwxMDUuOTk1MSw2MS4wMDAyLDEwOS45OTUxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ0MS4wMDEyIiB4Mj0iNDQxLjAwMTIiIHkxPSIyMDcuMDgxMSIgeTI9IjIyNy4wODExIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MzcuMDAxMiwyMTcuMDgxMSw0NDEuMDAxMiwyMjcuMDgxMSw0NDUuMDAxMiwyMTcuMDgxMSw0NDEuMDAxMiwyMjEuMDgxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMDkuMDAwOSIgeDI9IjMwOS4wMDA5IiB5MT0iNzkwLjc2ODYiIHkyPSI4MTAuNzY4NiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA1LjAwMDksODAwLjc2ODYsMzA5LjAwMDksODEwLjc2ODYsMzEzLjAwMDksODAwLjc2ODYsMzA5LjAwMDksODA0Ljc2ODYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTc2LjAwMTYiIHgyPSI1NzYuMDAxNiIgeTE9IjMxNS4wMTg2IiB5Mj0iMzM1LjAxODYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Mi4wMDE2LDMyNS4wMTg2LDU3Ni4wMDE2LDMzNS4wMTg2LDU4MC4wMDE2LDMyNS4wMTg2LDU3Ni4wMDE2LDMyOS4wMTg2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU3Ni4wMDE2IiB4Mj0iNTc2LjAwMTYiIHkxPSIzNjguOTg3MyIgeTI9IjM4OC45ODczIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NzIuMDAxNiwzNzguOTg3Myw1NzYuMDAxNiwzODguOTg3Myw1ODAuMDAxNiwzNzguOTg3Myw1NzYuMDAxNiwzODIuOTg3MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2NzIuMDAyMSIgeDI9IjY3Mi4wMDIxIiB5MT0iNDc2LjkyNDgiIHkyPSI0OTYuOTI0OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjY4LjAwMjEsNDg2LjkyNDgsNjcyLjAwMjEsNDk2LjkyNDgsNjc2LjAwMjEsNDg2LjkyNDgsNjcyLjAwMjEsNDkwLjkyNDgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjcyLjAwMjEiIHgyPSI2NzIuMDAyMSIgeTE9IjUzMC44OTM2IiB5Mj0iNTUwLjg5MzYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY2OC4wMDIxLDU0MC44OTM2LDY3Mi4wMDIxLDU1MC44OTM2LDY3Ni4wMDIxLDU0MC44OTM2LDY3Mi4wMDIxLDU0NC44OTM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg3My44NDg1IiB4Mj0iOTMxLjU1MDMiIHkxPSI3MjQuNzk5OCIgeTI9IjcyNC43OTk4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjkzMS41NTAzIiB4Mj0iOTMxLjU1MDMiIHkxPSI3MjQuNzk5OCIgeTI9Ijc1Ni43OTk4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5MjcuNTUwMyw3NDYuNzk5OCw5MzEuNTUwMyw3NTYuNzk5OCw5MzUuNTUwMyw3NDYuNzk5OCw5MzEuNTUwMyw3NTAuNzk5OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI5MzEuNTUwMyIgeDI9IjkzMS41NTAzIiB5MT0iNzkwLjc2ODYiIHkyPSI4NjYuNzM3MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI5MzEuNTUwMyIgeDI9Ijg1OS45Mjk0IiB5MT0iODY2LjczNzMiIHkyPSI4NjYuNzM3MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODY5LjkyOTQsODYyLjczNzMsODU5LjkyOTQsODY2LjczNzMsODY5LjkyOTQsODcwLjczNzMsODY1LjkyOTQsODY2LjczNzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODQ3LjkyOTQiIHgyPSI4NDcuOTI5NCIgeTE9IjY5Mi43OTk4IiB5Mj0iNzEyLjc5OTgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg0My45Mjk0LDcwMi43OTk4LDg0Ny45Mjk0LDcxMi43OTk4LDg1MS45Mjk0LDcwMi43OTk4LDg0Ny45Mjk0LDcwNi43OTk4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg0Ny45Mjk0IiB4Mj0iODQ3LjkyOTQiIHkxPSI4NzguNzM3MyIgeTI9Ijg5OC43MzczIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4NDMuOTI5NCw4ODguNzM3Myw4NDcuOTI5NCw4OTguNzM3Myw4NTEuOTI5NCw4ODguNzM3Myw4NDcuOTI5NCw4OTIuNzM3MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2MS4wMDAyIiB4Mj0iNjEuMDAwMiIgeTE9IjE0OS45NjM5IiB5Mj0iMTU4LjExMjMiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjEuMDAwMiIgeDI9IjQ0MS4wMDEyIiB5MT0iMTU4LjExMjMiIHkyPSIxNTguMTEyMyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NDEuMDAxMiIgeDI9IjQ0MS4wMDEyIiB5MT0iMTU4LjExMjMiIHkyPSIxNzMuMTEyMyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDM3LjAwMTIsMTYzLjExMjMsNDQxLjAwMTIsMTczLjExMjMsNDQ1LjAwMTIsMTYzLjExMjMsNDQxLjAwMTIsMTY3LjExMjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDQxLjAwMTIiIHgyPSI0NDEuMDAxMiIgeTE9IjI2MS4wNDk4IiB5Mj0iMjY2LjA0OTgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDQxLjAwMTIiIHgyPSI1NzYuMDAxNiIgeTE9IjI2Ni4wNDk4IiB5Mj0iMjY2LjA0OTgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNTc2LjAwMTYiIHgyPSI1NzYuMDAxNiIgeTE9IjI2Ni4wNDk4IiB5Mj0iMjgxLjA0OTgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Mi4wMDE2LDI3MS4wNDk4LDU3Ni4wMDE2LDI4MS4wNDk4LDU4MC4wMDE2LDI3MS4wNDk4LDU3Ni4wMDE2LDI3NS4wNDk4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU3Ni4wMDE2IiB4Mj0iNTc2LjAwMTYiIHkxPSI0MjIuOTU2MSIgeTI9IjQyNy45NTYxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjU3Ni4wMDE2IiB4Mj0iNjcyLjAwMjEiIHkxPSI0MjcuOTU2MSIgeTI9IjQyNy45NTYxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjY3Mi4wMDIxIiB4Mj0iNjcyLjAwMjEiIHkxPSI0MjcuOTU2MSIgeTI9IjQ0Mi45NTYxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NjguMDAyMSw0MzIuOTU2MSw2NzIuMDAyMSw0NDIuOTU2MSw2NzYuMDAyMSw0MzIuOTU2MSw2NzIuMDAyMSw0MzYuOTU2MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2NzIuMDAyMSIgeDI9IjY3Mi4wMDIxIiB5MT0iNTg0Ljg2MjMiIHkyPSI1ODkuODYyMyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2NzIuMDAyMSIgeDI9Ijc1OC4wMDIyIiB5MT0iNTg5Ljg2MjMiIHkyPSI1ODkuODYyMyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3NTguMDAyMiIgeDI9Ijc1OC4wMDIyIiB5MT0iNTg5Ljg2MjMiIHkyPSI2MDQuODYyMyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzU0LjAwMjIsNTk0Ljg2MjMsNzU4LjAwMjIsNjA0Ljg2MjMsNzYyLjAwMjIsNTk0Ljg2MjMsNzU4LjAwMjIsNTk4Ljg2MjMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzU4LjAwMjIiIHgyPSI3NTguMDAyMiIgeTE9IjYzOC44MzExIiB5Mj0iNjQzLjgzMTEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzU4LjAwMjIiIHgyPSI4NDcuOTI5NCIgeTE9IjY0My44MzExIiB5Mj0iNjQzLjgzMTEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODQ3LjkyOTQiIHgyPSI4NDcuOTI5NCIgeTE9IjY0My44MzExIiB5Mj0iNjU4LjgzMTEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg0My45Mjk0LDY0OC44MzExLDg0Ny45Mjk0LDY1OC44MzExLDg1MS45Mjk0LDY0OC44MzExLDg0Ny45Mjk0LDY1Mi44MzExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgyMi4wMTAyIiB4Mj0iMzA5LjAwMDkiIHkxPSI3MjQuNzk5OCIgeTI9IjcyNC43OTk4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMwOS4wMDA5IiB4Mj0iMzA5LjAwMDkiIHkxPSI3MjQuNzk5OCIgeTI9Ijc1Ni43OTk4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMDUuMDAwOSw3NDYuNzk5OCwzMDkuMDAwOSw3NTYuNzk5OCwzMTMuMDAwOSw3NDYuNzk5OCwzMDkuMDAwOSw3NTAuNzk5OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMDkuMDAwOSIgeDI9IjMwOS4wMDA5IiB5MT0iODQ0LjczNzMiIHkyPSI4NjYuNzM3MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMDkuMDAwOSIgeDI9IjgzNS45Mjk0IiB5MT0iODY2LjczNzMiIHkyPSI4NjYuNzM3MyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODI1LjkyOTQsODYyLjczNzMsODM1LjkyOTQsODY2LjczNzMsODI1LjkyOTQsODcwLjczNzMsODI5LjkyOTQsODY2LjczNzMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OS45OTk1IiB4PSI4OC4wMDA2IiB5PSI2Ni43NSI+JiMyOTk4MzsmIzI5OTg3OyYjMzE2NDk7JiMyOTcwMjsmIzM3MDk2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1My45OTk3IiB4PSIzNjAuNTAxMSIgeT0iNjYuNzUiPiYjMzYwOTI7JiMzNjAyMzsmIzM3MDk2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1My45OTk3IiB4PSI1NDguMDAxOCIgeT0iNjYuNzUiPiYjMjI4MDY7JiMyNzg4MDsmIzM3MDk2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1My45OTk3IiB4PSI2NDQuMDAyMyIgeT0iNjYuNzUiPiYjMjI5OTY7JiMzNTM1MTsmIzIwODA4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MS45OTk2IiB4PSI3MjEuMDAyNCIgeT0iNjYuNzUiPiYjMzYwMzk7JiMyNjQ0ODsmIzIwNDg5OyYjMjQyMzU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg5Ljk5OTUiIHg9IjgzOC43NzY1IiB5PSI2Ni43NSI+JiMyMTY5NzsmIzM2MDc0OyYjMzE2NDk7JiMyOTcwMjsmIzM3MDk2OzwvdGV4dD48P3BsYW50dW1sLXNyYyBSUDdEUWk5MDQ4M2xVT2VTekhOWWVJX0lJdzZuMlhBQnZiQm1lMGFzTWhLNkpWc1hZWDZEYkhRTDZiZWJIbGVtd3NwTWotV2E4TFFYanpzUFJ4eFBjUE5KU2FSYU9UZ1h6WHBVMzNSbGFqQUlNV2tlek9kd0dqRzVLTHNFQXRaNm8zQ2N0ZEJpd096N1RMeFd5bDlESmtPNGVobVpHREdZTFNqV1ZZT3VBSWtCVjJ2emJ2ODVkYXRzbnc5dkdhWWZIZkpnakhHcy1taWhCUkpKWWV2amNFc296SVBlODdYejF4NzNWZTJmMTJWV2NOT3EtaGg1RTFsTjRxWTdlZjJjbmloeGNhNnhIOXFFQUZyNDUzY3VHeXl3aXFHT1EwdmhSMDlCQzNNS0EtU01RN1FGUFd5QnVDYzRaVU5OTW1sX2tnb1p3QUFVc0hlVHdiMmlXbEUxMllYUmNDMXdGMEp3VGVkUHhzVVI0eThTZEd4ZVE4VDRFaWQ3R0F6R3F4c0F5dDlBYkZaT1d2WUZOb3UzUU1XLVdwUDNZcF82VHVNalRxSkxfMUtnRno1dXZ5aV9aVUJfUHVXaEJKUmw3VWpoSmlwYUhKdWNQVUZfRlUtbVJSM2dBY2ViSWhWZjk4VlZkUnRfMUcwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h2 id="262-db">26.2 外注委託の DB 設計<a class="headerlink" href="#262-db" title="Permanent link">&para;</a></h2>
<h3 id="_4">外注オーダの構造<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>外注オーダは、通常の購買発注と同じテーブル構造を使用します。発注データと発注明細データに外注委託用の情報を追加する形で管理します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjgxNnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTY3cHg7aGVpZ2h0OjgxNnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDE2NyA4MTYiIHdpZHRoPSIxNjdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjI4MDY7JiMyNzg4MDsmIzIyOTk2OyYjMzUzNTE7JiMxMjM5ODsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzI3MDgzOyYjMzY4OTY7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5Ljk5OTQiIHg9IjEwIiB5PSIyMi45OTUxIj4mIzIyODA2OyYjMjc4ODA7JiMyMjk5NjsmIzM1MzUxOyYjMTIzOTg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7JiMyNzA4MzsmIzM2ODk2OzwvdGV4dD48L2c+PCEtLWNsYXNzIHBvLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0icG8iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjExMy4xODc1IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjguNjA3MSIgeD0iMjIuNjk5NSIgeT0iNDQuMjk2OSIvPjxlbGxpcHNlIGN4PSI0OS42NzI4IiBjeT0iNjAuMjk2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNTMuNzgyMiw2Ni4yOTY5IEw0Ni4wNjM0LDY2LjI5NjkgTDQ2LjA2MzQsNTMuOTA2MyBMNTMuNzgyMiw1My45MDYzIEw1My43ODIyLDU2LjA2MjUgTDQ4LjUxNjUsNTYuMDYyNSBMNDguNTE2NSw1OC43MzQ0IEw1My4yODIyLDU4LjczNDQgTDUzLjI4MjIsNjAuODkwNiBMNDguNTE2NSw2MC44OTA2IEw0OC41MTY1LDY0LjE0MDYgTDUzLjc4MjIsNjQuMTQwNiBMNTMuNzgyMiw2Ni4yOTY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNjYuMzMzNSIgeT0iNjUuMTQzNiI+JiMzMDMzMDsmIzI3ODgwOyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMy42OTk1IiB4Mj0iMTUwLjMwNjUiIHkxPSI3Ni4yOTY5IiB5Mj0iNzYuMjk2OSIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iSUVfTUFOREFUT1JZIj48ZWxsaXBzZSBjeD0iMzMuNjk5NSIgY3k9Ijg5Ljk0NTMiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OC45OTY4IiB4PSI0Mi42OTk1IiB5PSI5My4yOTIiPiYjMzAzMzA7JiMyNzg4MDsmIzMwMDU4OyYjMjE0OTU7IFtQS108L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjIzLjY5OTUiIHgyPSIxNTAuMzA2NSIgeTE9IjEwMC41OTM4IiB5Mj0iMTAwLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuNjA3MSIgeD0iMjguNjk5NSIgeT0iMTE3LjU4ODkiPiYjMjE0NjI7JiMyNDM0MTsmIzIwODA4OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OyBbRktdPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjI4LjY5OTUiIHk9IjEzMy44ODU3Ij4mIzMwMzMwOyYjMjc4ODA7JiMyNjA4NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMjguNjk5NSIgeT0iMTUwLjE4MjYiPiYjMTI0NzM7JiMxMjQ4NjsmIzEyNTQwOyYjMTI0Nzk7JiMxMjQ3Mzs8L3RleHQ+PC9nPjwhLS1jbGFzcyBwb2QtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJwb2QiIGRhdGEtc291cmNlLWxpbmU9IjExIiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMjkuNDg0NCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM2LjY4MDQiIHg9IjE4LjY1OTUiIHk9IjIzNC40NzY5Ii8+PGVsbGlwc2UgY3g9IjM2LjY2NTkiIGN5PSIyNTAuNDc2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNDAuNzc1MiwyNTYuNDc2OSBMMzMuMDU2NSwyNTYuNDc2OSBMMzMuMDU2NSwyNDQuMDg2MyBMNDAuNzc1MiwyNDQuMDg2MyBMNDAuNzc1MiwyNDYuMjQyNSBMMzUuNTA5NiwyNDYuMjQyNSBMMzUuNTA5NiwyNDguOTE0NCBMNDAuMjc1MiwyNDguOTE0NCBMNDAuMjc1MiwyNTEuMDcwNiBMMzUuNTA5NiwyNTEuMDcwNiBMMzUuNTA5NiwyNTQuMzIwNiBMNDAuNzc1MiwyNTQuMzIwNiBMNDAuNzc1MiwyNTYuNDc2OSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjUxLjMzNCIgeT0iMjU1LjMyMzYiPiYjMzAzMzA7JiMyNzg4MDsmIzI2MTI2OyYjMzIwNDg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE5LjY1OTUiIHgyPSIxNTQuMzM5OSIgeTE9IjI2Ni40NzY5IiB5Mj0iMjY2LjQ3NjkiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjI5LjY1OTUiIGN5PSIyODAuMTI1MyIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMC42ODA0IiB4PSIzOC42NTk1IiB5PSIyODMuNDcyIj4mIzMwMzMwOyYjMjc4ODA7JiMzMDA1ODsmIzIxNDk1OyBbUEssRktdPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iSUVfTUFOREFUT1JZIj48ZWxsaXBzZSBjeD0iMjkuNjU5NSIgY3k9IjI5Ni40MjIyIiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjk5NjgiIHg9IjM4LjY1OTUiIHk9IjI5OS43Njg5Ij4mIzMwMzMwOyYjMjc4ODA7JiMzNDg5MjsmIzMwMDU4OyYjMjE0OTU7IFtQS108L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE5LjY1OTUiIHgyPSIxNTQuMzM5OSIgeTE9IjMwNy4wNzA2IiB5Mj0iMzA3LjA3MDYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDIuNjA3MSIgeD0iMjQuNjU5NSIgeT0iMzI0LjA2NTciPiYjMjE2OTc7JiMzMDQ0NjsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsgW0ZLXTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIyNC42NTk1IiB5PSIzNDAuMzYyNiI+JiMzMDMzMDsmIzI3ODgwOyYjMjU5Njg7JiMzNzMyNzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMjQuNjU5NSIgeT0iMzU2LjY1OTUiPiYjMzAzMzA7JiMyNzg4MDsmIzIxMzM2OyYjMjAzODU7PC90ZXh0PjwvZz48IS0tY2xhc3Mgc3VwLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0ic3VwIiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTQ1Ljc4MTMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOC42MDcxIiB4PSIyMi42OTk1IiB5PSI0NDAuOTY2OSIvPjxlbGxpcHNlIGN4PSI0OS42NzI4IiBjeT0iNDU2Ljk2NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTUzLjc4MjIsNDYyLjk2NjkgTDQ2LjA2MzQsNDYyLjk2NjkgTDQ2LjA2MzQsNDUwLjU3NjMgTDUzLjc4MjIsNDUwLjU3NjMgTDUzLjc4MjIsNDUyLjczMjUgTDQ4LjUxNjUsNDUyLjczMjUgTDQ4LjUxNjUsNDU1LjQwNDQgTDUzLjI4MjIsNDU1LjQwNDQgTDUzLjI4MjIsNDU3LjU2MDYgTDQ4LjUxNjUsNDU3LjU2MDYgTDQ4LjUxNjUsNDYwLjgxMDYgTDUzLjc4MjIsNDYwLjgxMDYgTDUzLjc4MjIsNDYyLjk2NjkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI2Ni4zMzM1IiB5PSI0NjEuODEzNiI+JiMyNTkwMzsmIzMyMTAyOyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMy42OTk1IiB4Mj0iMTUwLjMwNjUiIHkxPSI0NzIuOTY2OSIgeTI9IjQ3Mi45NjY5Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIzMy42OTk1IiBjeT0iNDg2LjYxNTMiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OC45OTY4IiB4PSI0Mi42OTk1IiB5PSI0ODkuOTYyIj4mIzI1OTAzOyYjMzIxMDI7JiMzMDA1ODsmIzIxNDk1OyBbUEtdPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyMy42OTk1IiB4Mj0iMTUwLjMwNjUiIHkxPSI0OTcuMjYzOCIgeTI9IjQ5Ny4yNjM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODguNjA3MiIgeD0iMjguNjk5NSIgeT0iNTE0LjI1ODkiPiYjMzAzMzA7JiMyNzg4MDsmIzMwMDU4OyYjMjE0OTU7IFtGS108L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjYwNzEiIHg9IjI4LjY5OTUiIHk9IjUzMC41NTU3Ij4mIzMwMzMwOyYjMjc4ODA7JiMzNDg5MjsmIzMwMDU4OyYjMjE0OTU7IFtGS108L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE2LjYwNzEiIHg9IjI4LjY5OTUiIHk9IjU0Ni44NTI2Ij4mIzIxNDYyOyYjMjQzNDE7JiMyMDgwODsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsgW0ZLXTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIyOC42OTk1IiB5PSI1NjMuMTQ5NSI+JiMyNTkwMzsmIzMyMTAyOyYjMjYwODU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjI4LjY5OTUiIHk9IjU3OS40NDY0Ij4mIzI1OTAzOyYjMzIxMDI7JiMyMTMwNjsmIzIwOTk4OzwvdGV4dD48L2c+PCEtLWNsYXNzIHN1cGQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJzdXBkIiBkYXRhLXNvdXJjZS1saW5lPSIzMCIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTQ1Ljc4MTMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzNi42ODA0IiB4PSIxOC42NTk1IiB5PSI2NjMuNzQ2OSIvPjxlbGxpcHNlIGN4PSIzNi42NjU5IiBjeT0iNjc5Ljc0NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTQwLjc3NTIsNjg1Ljc0NjkgTDMzLjA1NjUsNjg1Ljc0NjkgTDMzLjA1NjUsNjczLjM1NjMgTDQwLjc3NTIsNjczLjM1NjMgTDQwLjc3NTIsNjc1LjUxMjUgTDM1LjUwOTYsNjc1LjUxMjUgTDM1LjUwOTYsNjc4LjE4NDQgTDQwLjI3NTIsNjc4LjE4NDQgTDQwLjI3NTIsNjgwLjM0MDYgTDM1LjUwOTYsNjgwLjM0MDYgTDM1LjUwOTYsNjgzLjU5MDYgTDQwLjc3NTIsNjgzLjU5MDYgTDQwLjc3NTIsNjg1Ljc0NjkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSI1MS4zMzQiIHk9IjY4NC41OTM2Ij4mIzI1OTAzOyYjMzIxMDI7JiMyNjEyNjsmIzMyMDQ4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxOS42NTk1IiB4Mj0iMTU0LjMzOTkiIHkxPSI2OTUuNzQ2OSIgeTI9IjY5NS43NDY5Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIyOS42NTk1IiBjeT0iNzA5LjM5NTMiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNjgwNCIgeD0iMzguNjU5NSIgeT0iNzEyLjc0MiI+JiMyNTkwMzsmIzMyMTAyOyYjMzAwNTg7JiMyMTQ5NTsgW1BLLEZLXTwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjI5LjY1OTUiIGN5PSI3MjUuNjkyMiIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMi45OTY4IiB4PSIzOC42NTk1IiB5PSI3MjkuMDM4OSI+JiMyNTkwMzsmIzMyMTAyOyYjMzQ4OTI7JiMzMDA1ODsmIzIxNDk1OyBbUEtdPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxOS42NTk1IiB4Mj0iMTU0LjMzOTkiIHkxPSI3MzYuMzQwNiIgeTI9IjczNi4zNDA2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjYwNzEiIHg9IjI0LjY1OTUiIHk9Ijc1My4zMzU3Ij4mIzIxNjk3OyYjMzA0NDY7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7IFtGS108L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEuOTk5OCIgeD0iMjQuNjU5NSIgeT0iNzY5LjYzMjYiPiYjMjU5MDM7JiMzMjEwMjsmIzI1OTY4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIyNC42NTk1IiB5PSI3ODUuOTI5NSI+JiMyNTkwMzsmIzMyMTAyOyYjMjEzMzY7JiMyMDM4NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMjQuNjU5NSIgeT0iODAyLjIyNjQiPiYjMjU5MDM7JiMzMjEwMjsmIzM3MzI5OyYjMzg5ODk7PC90ZXh0PjwvZz48IS0tbGluayBwbyB0byBwb2QtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImNyb3dmb290IiBkYXRhLXNvdXJjZS1saW5lPSI0MCIgaWQ9ImxuazYiPjxwYXRoIGNvZGVMaW5lPSI0MCIgZD0iTTg2Ljk5OTUsMTY1Ljg4NjkgQzg2Ljk5OTUsMTg5LjY4NjkgODYuOTk5NSwxOTEuNTc2OSA4Ni45OTk1LDIxNi4xODY5IiBmaWxsPSJub25lIiBpZD0icG8tcG9kIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgyLjk5OTUiIHgyPSI5MC45OTk1IiB5MT0iMTYxLjg4NjkiIHkyPSIxNjEuODg2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Mi45OTk1IiB4Mj0iOTAuOTk5NSIgeTE9IjE2NC44ODY5IiB5Mj0iMTY0Ljg4NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODYuOTk5NSIgeDI9Ijg2Ljk5OTUiIHkxPSIxNjUuODg2OSIgeTI9IjE1Ny44ODY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg2Ljk5OTUiIHgyPSI5Mi45OTk1IiB5MT0iMjI2LjE4NjkiIHkyPSIyMzQuMTg2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ni45OTk1IiB4Mj0iODAuOTk5NSIgeTE9IjIyNi4xODY5IiB5Mj0iMjM0LjE4NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODYuOTk5NSIgeDI9Ijg2Ljk5OTUiIHkxPSIyMjYuMTg2OSIgeTI9IjIzNC4xODY5Ii8+PGVsbGlwc2UgY3g9Ijg2Ljk5OTUiIGN5PSIyMjAuMTg2OSIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuMDI3OCIgeD0iODcuOTk5NSIgeT0iMjAwLjU0MzgiPmNvbnRhaW5zPC90ZXh0PjwvZz48IS0tbGluayBwb2QgdG8gc3VwLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDQiIGRhdGEtbGluay10eXBlPSJjcm93Zm9vdCIgZGF0YS1zb3VyY2UtbGluZT0iNDEiIGlkPSJsbms3Ij48cGF0aCBjb2RlTGluZT0iNDEiIGQ9Ik04Ni45OTk1LDM3Mi4zMDY5IEM4Ni45OTk1LDM5Ni4zOTY5IDg2Ljk5OTUsMzk3LjkzNjkgODYuOTk5NSw0MjIuNzE2OSIgZmlsbD0ibm9uZSIgaWQ9InBvZC1zdXAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODIuOTk5NSIgeDI9IjkwLjk5OTUiIHkxPSIzNjguMzA2OSIgeTI9IjM2OC4zMDY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgyLjk5OTUiIHgyPSI5MC45OTk1IiB5MT0iMzcxLjMwNjkiIHkyPSIzNzEuMzA2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ni45OTk1IiB4Mj0iODYuOTk5NSIgeTE9IjM3Mi4zMDY5IiB5Mj0iMzY0LjMwNjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODYuOTk5NSIgeDI9IjkyLjk5OTUiIHkxPSI0MzIuNzE2OSIgeTI9IjQ0MC43MTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg2Ljk5OTUiIHgyPSI4MC45OTk1IiB5MT0iNDMyLjcxNjkiIHkyPSI0NDAuNzE2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ni45OTk1IiB4Mj0iODYuOTk5NSIgeTE9IjQzMi43MTY5IiB5Mj0iNDQwLjcxNjkiLz48ZWxsaXBzZSBjeD0iODYuOTk5NSIgY3k9IjQyNi43MTY5IiBmaWxsPSJub25lIiByeD0iNCIgcnk9IjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNiIgeD0iODcuOTk5NSIgeT0iNDA3LjAzMzgiPiYjMjU5MDM7JiMzMjEwMjs8L3RleHQ+PC9nPjwhLS1saW5rIHN1cCB0byBzdXBkLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDQiIGRhdGEtZW50aXR5LTI9ImVudDAwMDUiIGRhdGEtbGluay10eXBlPSJjcm93Zm9vdCIgZGF0YS1zb3VyY2UtbGluZT0iNDIiIGlkPSJsbms4Ij48cGF0aCBjb2RlTGluZT0iNDIiIGQ9Ik04Ni45OTk1LDU5NS4xNDY5IEM4Ni45OTk1LDYxOS42NjY5IDg2Ljk5OTUsNjIxLjA1NjkgODYuOTk5NSw2NDUuNTU2OSIgZmlsbD0ibm9uZSIgaWQ9InN1cC1zdXBkIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgyLjk5OTUiIHgyPSI5MC45OTk1IiB5MT0iNTkxLjE0NjkiIHkyPSI1OTEuMTQ2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Mi45OTk1IiB4Mj0iOTAuOTk5NSIgeTE9IjU5NC4xNDY5IiB5Mj0iNTk0LjE0NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODYuOTk5NSIgeDI9Ijg2Ljk5OTUiIHkxPSI1OTUuMTQ2OSIgeTI9IjU4Ny4xNDY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg2Ljk5OTUiIHgyPSI5Mi45OTk1IiB5MT0iNjU1LjU1NjkiIHkyPSI2NjMuNTU2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ni45OTk1IiB4Mj0iODAuOTk5NSIgeTE9IjY1NS41NTY5IiB5Mj0iNjYzLjU1NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODYuOTk5NSIgeDI9Ijg2Ljk5OTUiIHkxPSI2NTUuNTU2OSIgeTI9IjY2My41NTY5Ii8+PGVsbGlwc2UgY3g9Ijg2Ljk5OTUiIGN5PSI2NDkuNTU2OSIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuMDI3OCIgeD0iODcuOTk5NSIgeT0iNjI5LjgxMzgiPmNvbnRhaW5zPC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBBeWFpb0tiTFVCZmFzaEZEQXZ1a2RfOVluVko3WlVpVUR4U19SanhwazZkX2ktTlRCbmlNUzc2YnZmTGFiYkdnQTNzVmtHa2UzWXdqZjkxT2g1MkdocjNEZlFLMGFOZS1UVE5KX2txQXFHN1VpTG93a2JuRi13U3p0SkZyUU1sN3V3UkQ4MnREZEdoSFJhMGZZRTlkcXZUb0ZNeFEtUll2M004U2FDckxZc3hQaW5ienB4VGlHQlNvMVFrVEVZMnBPUzhsNWxRV2tzUG91X0ZQd3gweFBVZzZiLXR6S0N4SnRYYkZ6WXI0VGlncEFVa1ZScnM2d2VaWXFXQW04bzFvUTVRWGtXblgzdkFaRzhBdW1XVFk5WVh5OEFvZEZSa1VUaEhYa1dYUnUwM1RiT0JMT1QzR1dHV0o2SmZHUXdQa1czYTQ0WkdHcGlsc1lJeU56ZTlTMUttM0RKTXdrbGRMdUFZbkthWkVwb2o5cENtaHZXOW5lSkFXeUJBMnNpdTV1WTM0YVJLMDAwMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_5">支給関連のスキーマ設計<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<details>
<summary>DDL: 支給関連テーブル</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- V011__create_supply_tables.sql</span>

<span class="c1">-- 支給区分</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="err">支給区分</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;有償支給&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;無償支給&#39;</span><span class="p">);</span>

<span class="c1">-- 支給データ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;支給データ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;発注番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;発注行番号&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;取引先コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給日&quot;</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給担当者コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給区分&quot;</span><span class="w"> </span><span class="err">支給区分</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;無償支給&#39;</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;備考&quot;</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成者&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新者&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_支給データ_発注明細&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;発注番号&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;発注行番号&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;発注明細データ&quot;</span><span class="p">(</span><span class="ss">&quot;発注番号&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;発注行番号&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_支給データ_取引先&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;取引先コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;取引先マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;取引先コード&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 支給明細データ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給行番号&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;品目コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給数&quot;</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給単価&quot;</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;支給金額&quot;</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;備考&quot;</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_支給明細_支給&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;支給番号&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;支給データ&quot;</span><span class="p">(</span><span class="ss">&quot;支給番号&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_支給明細_品目&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;品目コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;品目マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;品目コード&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;支給番号&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;支給行番号&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_支給データ_発注番号&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;支給データ&quot;</span><span class="p">(</span><span class="ss">&quot;発注番号&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;発注行番号&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_支給データ_取引先コード&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;支給データ&quot;</span><span class="p">(</span><span class="ss">&quot;取引先コード&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_支給データ_支給日&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;支給データ&quot;</span><span class="p">(</span><span class="ss">&quot;支給日&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_支給明細_品目コード&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="p">(</span><span class="ss">&quot;品目コード&quot;</span><span class="p">);</span>
</code></pre></div>

</details>

<h3 id="_6">発注データとの紐付け<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>支給データは発注明細データと紐付けられます。1つの発注明細に対して、複数の支給が発生する場合があります（分割支給）。</p>
<h3 id="_7">支給金額の計算（有償支給の場合）<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>有償支給の場合、支給金額は以下の計算式で算出されます：</p>
<div class="highlight"><pre><span></span><code>支給金額 = 支給数 × 支給単価
</code></pre></div>
<p>無償支給の場合も金額は計算されますが、会計処理が異なります。</p>
<h3 id="java">Java エンティティの定義<a class="headerlink" href="#java" title="Permanent link">&para;</a></h3>
<details>
<summary>支給区分 Enum</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/domain/model/subcontract/SupplyType.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Getter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>

<span class="nd">@Getter</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PAID</span><span class="p">(</span><span class="s">&quot;有償支給&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">FREE</span><span class="p">(</span><span class="s">&quot;無償支給&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">displayName</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="nf">fromDisplayName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">displayName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SupplyType</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="na">displayName</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">displayName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;不正な支給区分: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">displayName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>支給データエンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/domain/model/subcontract/Supply.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.supplier.Supplier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.purchase.PurchaseOrderDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Supply</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">supplyDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierPersonCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="n">supplyType</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">updatedBy</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PurchaseOrderDetail</span><span class="w"> </span><span class="n">purchaseOrderDetail</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Supplier</span><span class="w"> </span><span class="n">supplier</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>支給明細データエンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/domain/model/subcontract/SupplyDetail.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SupplyDetail</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="typehandler">TypeHandler の実装<a class="headerlink" href="#typehandler" title="Permanent link">&para;</a></h3>
<details>
<summary>SupplyTypeTypeHandler</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/infrastructure/persistence/SupplyTypeTypeHandler.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.persistence</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.SupplyType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.type.BaseTypeHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.type.JdbcType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.type.MappedTypes</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.CallableStatement</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.PreparedStatement</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.ResultSet</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.SQLException</span><span class="p">;</span>

<span class="nd">@MappedTypes</span><span class="p">(</span><span class="n">SupplyType</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SupplyTypeTypeHandler</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">BaseTypeHandler</span><span class="o">&lt;</span><span class="n">SupplyType</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setNonNullParameter</span><span class="p">(</span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">JdbcType</span><span class="w"> </span><span class="n">jdbcType</span><span class="p">)</span>
<span class="w">            </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">parameter</span><span class="p">.</span><span class="na">getDisplayName</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="nf">getNullableResult</span><span class="p">(</span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">columnName</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">columnName</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SupplyType</span><span class="p">.</span><span class="na">fromDisplayName</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="nf">getNullableResult</span><span class="p">(</span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">columnIndex</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">columnIndex</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SupplyType</span><span class="p">.</span><span class="na">fromDisplayName</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="nf">getNullableResult</span><span class="p">(</span><span class="n">CallableStatement</span><span class="w"> </span><span class="n">cs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">columnIndex</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">columnIndex</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SupplyType</span><span class="p">.</span><span class="na">fromDisplayName</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="mybatis-mapper-xml">MyBatis Mapper XML<a class="headerlink" href="#mybatis-mapper-xml" title="Permanent link">&para;</a></h3>
<details>
<summary>SupplyMapper.xml</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- src/main/resources/mapper/SupplyMapper.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.mapper.SupplyMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;SupplyResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Supply&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;purchaseOrderNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;発注番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;発注行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;取引先コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給日&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierPersonCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給担当者コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyType&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給区分&quot;</span>
<span class="w">                </span><span class="na">typeHandler=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.typehandler.SupplyTypeTypeHandler&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成者&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新者&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- PostgreSQL用 INSERT --&gt;</span>
<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Supply&quot;</span>
<span class="w">            </span><span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">keyProperty=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">keyColumn=</span><span class="s">&quot;ID&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;postgresql&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>(
<span class="w">            </span>&quot;支給番号&quot;,<span class="w"> </span>&quot;発注番号&quot;,<span class="w"> </span>&quot;発注行番号&quot;,<span class="w"> </span>&quot;取引先コード&quot;,
<span class="w">            </span>&quot;支給日&quot;,<span class="w"> </span>&quot;支給担当者コード&quot;,<span class="w"> </span>&quot;支給区分&quot;,<span class="w"> </span>&quot;備考&quot;,<span class="w"> </span>&quot;作成者&quot;,<span class="w"> </span>&quot;更新者&quot;
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{supplyNumber},
<span class="w">            </span>#{purchaseOrderNumber},
<span class="w">            </span>#{lineNumber},
<span class="w">            </span>#{supplierCode},
<span class="w">            </span>#{supplyDate},
<span class="w">            </span>#{supplierPersonCode},
<span class="w">            </span>#{supplyType,<span class="w"> </span>typeHandler=com.example.pms.infrastructure.out.persistence.typehandler.SupplyTypeTypeHandler}::支給区分,
<span class="w">            </span>#{remarks},
<span class="w">            </span>#{createdBy},
<span class="w">            </span>#{updatedBy}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- H2用 INSERT --&gt;</span>
<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Supply&quot;</span>
<span class="w">            </span><span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">keyProperty=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">keyColumn=</span><span class="s">&quot;ID&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;h2&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>(
<span class="w">            </span>&quot;支給番号&quot;,<span class="w"> </span>&quot;発注番号&quot;,<span class="w"> </span>&quot;発注行番号&quot;,<span class="w"> </span>&quot;取引先コード&quot;,
<span class="w">            </span>&quot;支給日&quot;,<span class="w"> </span>&quot;支給担当者コード&quot;,<span class="w"> </span>&quot;支給区分&quot;,<span class="w"> </span>&quot;備考&quot;,<span class="w"> </span>&quot;作成者&quot;,<span class="w"> </span>&quot;更新者&quot;
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{supplyNumber},
<span class="w">            </span>#{purchaseOrderNumber},
<span class="w">            </span>#{lineNumber},
<span class="w">            </span>#{supplierCode},
<span class="w">            </span>#{supplyDate},
<span class="w">            </span>#{supplierPersonCode},
<span class="w">            </span>#{supplyType,<span class="w"> </span>typeHandler=com.example.pms.infrastructure.out.persistence.typehandler.SupplyTypeTypeHandler},
<span class="w">            </span>#{remarks},
<span class="w">            </span>#{createdBy},
<span class="w">            </span>#{updatedBy}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findBySupplyNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;支給番号&quot;<span class="w"> </span>=<span class="w"> </span>#{supplyNumber}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByPurchaseOrderNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;発注番号&quot;<span class="w"> </span>=<span class="w"> </span>#{purchaseOrderNumber}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;支給日&quot;<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByPurchaseOrderNumberAndLineNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給データ&quot;
<span class="w">        </span>WHERE<span class="w"> </span>&quot;発注番号&quot;<span class="w"> </span>=<span class="w"> </span>#{purchaseOrderNumber}<span class="w"> </span>AND<span class="w"> </span>&quot;発注行番号&quot;<span class="w"> </span>=<span class="w"> </span>#{lineNumber}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;支給日&quot;<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findBySupplierCode&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;取引先コード&quot;<span class="w"> </span>=<span class="w"> </span>#{supplierCode}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;支給日&quot;<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;支給日&quot;<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- PostgreSQL用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;postgresql&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>TRUNCATE<span class="w"> </span>TABLE<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>CASCADE
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- H2用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;h2&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>DELETE<span class="w"> </span>FROM<span class="w"> </span>&quot;支給データ&quot;
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<details>
<summary>SupplyDetailMapper.xml</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- src/main/resources/mapper/SupplyDetailMapper.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.mapper.SupplyDetailMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;SupplyDetailResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.SupplyDetail&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;品目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給数&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;unitPrice&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給単価&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;amount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;支給金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.SupplyDetail&quot;</span>
<span class="w">            </span><span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">keyProperty=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">keyColumn=</span><span class="s">&quot;ID&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>(
<span class="w">            </span>&quot;支給番号&quot;,<span class="w"> </span>&quot;支給行番号&quot;,<span class="w"> </span>&quot;品目コード&quot;,<span class="w"> </span>&quot;支給数&quot;,<span class="w"> </span>&quot;支給単価&quot;,<span class="w"> </span>&quot;支給金額&quot;,<span class="w"> </span>&quot;備考&quot;,<span class="w"> </span>&quot;作成者&quot;,<span class="w"> </span>&quot;更新者&quot;
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{supplyNumber},
<span class="w">            </span>#{lineNumber},
<span class="w">            </span>#{itemCode},
<span class="w">            </span>#{quantity},
<span class="w">            </span>#{unitPrice},
<span class="w">            </span>#{amount},
<span class="w">            </span>#{remarks},
<span class="w">            </span>#{createdBy},
<span class="w">            </span>#{updatedBy}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findBySupplyNumberAndLineNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給明細データ&quot;
<span class="w">        </span>WHERE<span class="w"> </span>&quot;支給番号&quot;<span class="w"> </span>=<span class="w"> </span>#{supplyNumber}<span class="w"> </span>AND<span class="w"> </span>&quot;支給行番号&quot;<span class="w"> </span>=<span class="w"> </span>#{lineNumber}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findBySupplyNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給明細データ&quot;
<span class="w">        </span>WHERE<span class="w"> </span>&quot;支給番号&quot;<span class="w"> </span>=<span class="w"> </span>#{supplyNumber}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;支給行番号&quot;
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;SupplyDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;支給番号&quot;,<span class="w"> </span>&quot;支給行番号&quot;
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- PostgreSQL用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;postgresql&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>TRUNCATE<span class="w"> </span>TABLE<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>CASCADE
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- H2用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;h2&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>DELETE<span class="w"> </span>FROM<span class="w"> </span>&quot;支給明細データ&quot;
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<h3 id="mapper">Mapper インターフェース<a class="headerlink" href="#mapper" title="Permanent link">&para;</a></h3>
<details>
<summary>SupplyMapper</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/infrastructure/out/persistence/mapper/SupplyMapper.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.Supply</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Param</span><span class="p">;</span>

<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">SupplyMapper</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="p">);</span>
<span class="w">    </span><span class="n">Supply</span><span class="w"> </span><span class="nf">findBySupplyNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">);</span>
<span class="w">    </span><span class="n">Supply</span><span class="w"> </span><span class="nf">findByPurchaseOrderDetail</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;purchaseOrderNumber&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">,</span>
<span class="w">                                     </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;lineNumber&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">);</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">findLatestSupplyNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAll</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>SupplyDetailMapper</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/infrastructure/out/persistence/mapper/SupplyDetailMapper.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.SupplyDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">SupplyDetailMapper</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">SupplyDetail</span><span class="w"> </span><span class="n">detail</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findBySupplyNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAll</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="_8">支給サービスの実装<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<details>
<summary>SupplyService</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/service/SupplyService.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command.SupplyCreateCommand</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command.SupplyDetailCommand</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.format.DateTimeFormatter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SupplyService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SupplyMapper</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SupplyDetailMapper</span><span class="w"> </span><span class="n">supplyDetailMapper</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 支給番号を生成する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateSupplyNumber</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">supplyDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SUP-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">supplyDate</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyyMM&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">latestNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">.</span><span class="na">findLatestSupplyNumber</span><span class="p">(</span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">latestNumber</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">latestNumber</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">latestNumber</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span>
<span class="w">            </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%04d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 支給データを作成する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Supply</span><span class="w"> </span><span class="nf">createSupply</span><span class="p">(</span><span class="n">SupplyCreateCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateSupplyNumber</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getSupplyDate</span><span class="p">());</span>
<span class="w">        </span><span class="n">SupplyType</span><span class="w"> </span><span class="n">supplyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getSupplyType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getSupplyType</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SupplyType</span><span class="p">.</span><span class="na">FREE</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 支給ヘッダを作成</span>
<span class="w">        </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Supply</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">purchaseOrderNumber</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getPurchaseOrderNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplyDate</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getSupplyDate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierPersonCode</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getSupplierPersonCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplyType</span><span class="p">(</span><span class="n">supplyType</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">remarks</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getRemarks</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">supplyMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">supply</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 支給明細を作成</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">detailLineNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SupplyDetailCommand</span><span class="w"> </span><span class="n">detailCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getDetails</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">detailLineNumber</span><span class="o">++</span><span class="p">;</span>

<span class="w">            </span><span class="n">SupplyDetail</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SupplyDetail</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="n">detailLineNumber</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">amount</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">().</span><span class="na">multiply</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">remarks</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getRemarks</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">supplyDetailMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">detail</span><span class="p">);</span>

<span class="w">            </span><span class="n">details</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">detail</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">supply</span><span class="p">.</span><span class="na">setDetails</span><span class="p">(</span><span class="n">details</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">supply</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 支給番号で検索する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Supply</span><span class="w"> </span><span class="nf">findBySupplyNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">.</span><span class="na">findBySupplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">supply</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">supply</span><span class="p">.</span><span class="na">setDetails</span><span class="p">(</span><span class="n">supplyDetailMapper</span><span class="p">.</span><span class="na">findBySupplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">supply</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="_9">コマンドクラス<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<details>
<summary>SupplyCreateCommand</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/port/in/command/SupplyCreateCommand.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.SupplyType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SupplyCreateCommand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">supplyDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierPersonCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="n">supplyType</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetailCommand</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>SupplyDetailCommand</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/port/in/command/SupplyDetailCommand.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SupplyDetailCommand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="tdd">TDD: 支給データの登録テスト<a class="headerlink" href="#tdd" title="Permanent link">&para;</a></h3>
<details>
<summary>SupplyServiceTest</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/test/java/com/example/pms/application/service/SupplyServiceTest.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.item.ItemCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.supplier.Supplier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.purchase.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.boot.test.autoconfigure.MybatisTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertyRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertySource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.containers.PostgreSQLContainer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Container</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Testcontainers</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@MybatisTest</span>
<span class="nd">@AutoConfigureTestDatabase</span><span class="p">(</span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AutoConfigureTestDatabase</span><span class="p">.</span><span class="na">Replace</span><span class="p">.</span><span class="na">NONE</span><span class="p">)</span>
<span class="nd">@Import</span><span class="p">({</span><span class="n">SupplyService</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">PurchaseOrderService</span><span class="p">.</span><span class="na">class</span><span class="p">})</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;支給業務&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">SupplyServiceTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withDatabaseName</span><span class="p">(</span><span class="s">&quot;testdb&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withUsername</span><span class="p">(</span><span class="s">&quot;testuser&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withPassword</span><span class="p">(</span><span class="s">&quot;testpass&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@DynamicPropertySource</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureProperties</span><span class="p">(</span><span class="n">DynamicPropertyRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getJdbcUrl</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.username&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getUsername</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getPassword</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyService</span><span class="w"> </span><span class="n">supplyService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PurchaseOrderService</span><span class="w"> </span><span class="n">purchaseOrderService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ItemMapper</span><span class="w"> </span><span class="n">itemMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplierMapper</span><span class="w"> </span><span class="n">supplierMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UnitPriceMapper</span><span class="w"> </span><span class="n">unitPriceMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyMapper</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyDetailMapper</span><span class="w"> </span><span class="n">supplyDetailMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PurchaseOrderMapper</span><span class="w"> </span><span class="n">purchaseOrderMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PurchaseOrderDetailMapper</span><span class="w"> </span><span class="n">purchaseOrderDetailMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="n">testPurchaseOrder</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">supplyDetailMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">supplyMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">purchaseOrderDetailMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">purchaseOrderMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">unitPriceMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">supplierMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// マスタデータの準備</span>
<span class="w">        </span><span class="n">Supplier</span><span class="w"> </span><span class="n">supplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Supplier</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">effectiveFrom</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierName</span><span class="p">(</span><span class="s">&quot;株式会社メッキ工業&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">supplierMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">supplier</span><span class="p">);</span>

<span class="w">        </span><span class="n">Item</span><span class="w"> </span><span class="n">parentItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Item</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PLATED-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">effectiveFrom</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="s">&quot;メッキ加工品&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCategory</span><span class="p">(</span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">SEMI_PRODUCT</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">parentItem</span><span class="p">);</span>

<span class="w">        </span><span class="n">Item</span><span class="w"> </span><span class="n">supplyItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Item</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PRESS-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">effectiveFrom</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemName</span><span class="p">(</span><span class="s">&quot;プレス部品&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCategory</span><span class="p">(</span><span class="n">ItemCategory</span><span class="p">.</span><span class="na">PART</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">itemMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">supplyItem</span><span class="p">);</span>

<span class="w">        </span><span class="n">unitPriceMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">UnitPrice</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PLATED-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">effectiveFrom</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;500&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// テスト用発注を作成</span>
<span class="w">        </span><span class="n">PurchaseOrderCreateInput</span><span class="w"> </span><span class="n">poInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PurchaseOrderCreateInput</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">orderDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">details</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                        </span><span class="n">PurchaseOrderDetailInput</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PLATED-001&quot;</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">))</span>
<span class="w">                                </span><span class="p">.</span><span class="na">expectedReceivingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">))</span>
<span class="w">                                </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">testPurchaseOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purchaseOrderService</span><span class="p">.</span><span class="na">createPurchaseOrder</span><span class="p">(</span><span class="n">poInput</span><span class="p">);</span>
<span class="w">        </span><span class="n">purchaseOrderService</span><span class="p">.</span><span class="na">confirmPurchaseOrder</span><span class="p">(</span><span class="n">testPurchaseOrder</span><span class="p">.</span><span class="na">getPurchaseOrderNumber</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;支給データ作成&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">SupplyCreation</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;発注に紐づく支給データを作成できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">canCreateSupplyFromPurchaseOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="n">SupplyCreateCommand</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SupplyCreateCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">purchaseOrderNumber</span><span class="p">(</span><span class="n">testPurchaseOrder</span><span class="p">.</span><span class="na">getPurchaseOrderNumber</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplyDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplierPersonCode</span><span class="p">(</span><span class="s">&quot;EMP001&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplyType</span><span class="p">(</span><span class="n">SupplyType</span><span class="p">.</span><span class="na">FREE</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">details</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="n">SupplyDetailCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PRESS-001&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;200&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyService</span><span class="p">.</span><span class="na">createSupply</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">).</span><span class="na">isNotNull</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyNumber</span><span class="p">()).</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;SUP-&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyType</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">SupplyType</span><span class="p">.</span><span class="na">FREE</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getDetails</span><span class="p">()).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getDetails</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getQuantity</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;有償支給を作成できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">canCreatePaidSupply</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="n">SupplyCreateCommand</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SupplyCreateCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">purchaseOrderNumber</span><span class="p">(</span><span class="n">testPurchaseOrder</span><span class="p">.</span><span class="na">getPurchaseOrderNumber</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplyDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplierPersonCode</span><span class="p">(</span><span class="s">&quot;EMP001&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplyType</span><span class="p">(</span><span class="n">SupplyType</span><span class="p">.</span><span class="na">PAID</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">details</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="n">SupplyDetailCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PRESS-001&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;200&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyService</span><span class="p">.</span><span class="na">createSupply</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyType</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">SupplyType</span><span class="p">.</span><span class="na">PAID</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getDetails</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getAmount</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;20000&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="263">26.3 消費業務の設計<a class="headerlink" href="#263" title="Permanent link">&para;</a></h2>
<p>外注先が支給品を加工して納品した際、支給した材料がどれだけ消費されたかを記録します。</p>
<h3 id="_10">消費関連のスキーマ設計<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjU2MXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTUwcHg7aGVpZ2h0OjU2MXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDE1MCA1NjEiIHdpZHRoPSIxNTBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjgwNDA7JiMzNjAyNzsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyMzk4OyYjMzgzMDY7JiMzNjg5OTs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEuOTk5NSIgeD0iMTIuMzQwNSIgeT0iMjIuOTk1MSI+JiMyODA0MDsmIzM2MDI3OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMTIzOTg7JiMzODMwNjsmIzM2ODk5OzwvdGV4dD48L2c+PCEtLWNsYXNzIHJjdi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9InJjdiIgZGF0YS1zb3VyY2UtbGluZT0iMyIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTI5LjQ4NDQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOS45OTk2IiB4PSIxMC4zNCIgeT0iNDQuMjk2OSIvPjxlbGxpcHNlIGN4PSIyNS4zNCIgY3k9IjYwLjI5NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTI5LjQ0OTQsNjYuMjk2OSBMMjEuNzMwNiw2Ni4yOTY5IEwyMS43MzA2LDUzLjkwNjMgTDI5LjQ0OTQsNTMuOTA2MyBMMjkuNDQ5NCw1Ni4wNjI1IEwyNC4xODM4LDU2LjA2MjUgTDI0LjE4MzgsNTguNzM0NCBMMjguOTQ5NCw1OC43MzQ0IEwyOC45NDk0LDYwLjg5MDYgTDI0LjE4MzgsNjAuODkwNiBMMjQuMTgzOCw2NC4xNDA2IEwyOS40NDk0LDY0LjE0MDYgTDI5LjQ0OTQsNjYuMjk2OSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjM5LjM0IiB5PSI2NS4xNDM2Ij4mIzIwODM3OyYjMzM2NTU7JiMyMTQ2MzsmIzIwODM3OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMS4zNCIgeDI9IjEzOS4zMzk2IiB5MT0iNzYuMjk2OSIgeTI9Ijc2LjI5NjkiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjIxLjM0IiBjeT0iODkuOTQ1MyIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg4Ljk5NjgiIHg9IjMwLjM0IiB5PSI5My4yOTIiPiYjMjA4Mzc7JiMzMzY1NTsmIzMwMDU4OyYjMjE0OTU7IFtQS108L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExLjM0IiB4Mj0iMTM5LjMzOTYiIHkxPSIxMDAuNTkzOCIgeTI9IjEwMC41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODguNjA3MiIgeD0iMTYuMzQiIHk9IjExNy41ODg5Ij4mIzMwMzMwOyYjMjc4ODA7JiMzMDA1ODsmIzIxNDk1OyBbRktdPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMi42MDcxIiB4PSIxNi4zNCIgeT0iMTMzLjg4NTciPiYjMzAzMzA7JiMyNzg4MDsmIzM0ODkyOyYjMzAwNTg7JiMyMTQ5NTsgW0ZLXTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxNi4zNCIgeT0iMTUwLjE4MjYiPiYjMjA4Mzc7JiMzMzY1NTsmIzI2MDg1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxNi4zNCIgeT0iMTY2LjQ3OTUiPiYjMjA4Mzc7JiMzMzY1NTsmIzI1OTY4OyYjMzczMjc7PC90ZXh0PjwvZz48IS0tY2xhc3MgY29uLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iY29uIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOC42MDcxIiB4PSIxMS4wNCIgeT0iMjUwLjc3NjkiLz48ZWxsaXBzZSBjeD0iMzguMDEzMyIgY3k9IjI2Ni43NzY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik00Mi4xMjI3LDI3Mi43NzY5IEwzNC40MDM5LDI3Mi43NzY5IEwzNC40MDM5LDI2MC4zODYzIEw0Mi4xMjI3LDI2MC4zODYzIEw0Mi4xMjI3LDI2Mi41NDI1IEwzNi44NTcxLDI2Mi41NDI1IEwzNi44NTcxLDI2NS4yMTQ0IEw0MS42MjI3LDI2NS4yMTQ0IEw0MS42MjI3LDI2Ny4zNzA2IEwzNi44NTcxLDI2Ny4zNzA2IEwzNi44NTcxLDI3MC42MjA2IEw0Mi4xMjI3LDI3MC42MjA2IEw0Mi4xMjI3LDI3Mi43NzY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNTQuNjc0IiB5PSIyNzEuNjIzNiI+JiMyODA0MDsmIzM2MDI3OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMi4wNCIgeDI9IjEzOC42NDcxIiB5MT0iMjgyLjc3NjkiIHkyPSIyODIuNzc2OSIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iSUVfTUFOREFUT1JZIj48ZWxsaXBzZSBjeD0iMjIuMDQiIGN5PSIyOTYuNDI1MyIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg4Ljk5NjgiIHg9IjMxLjA0IiB5PSIyOTkuNzcyIj4mIzI4MDQwOyYjMzYwMjc7JiMzMDA1ODsmIzIxNDk1OyBbUEtdPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMi4wNCIgeDI9IjEzOC42NDcxIiB5MT0iMzA3LjA3MzgiIHkyPSIzMDcuMDczOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg4LjYwNzIiIHg9IjE3LjA0IiB5PSIzMjQuMDY4OSI+JiMyMDgzNzsmIzMzNjU1OyYjMzAwNTg7JiMyMTQ5NTsgW0ZLXTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxNy4wNCIgeT0iMzQwLjM2NTciPiYjMjgwNDA7JiMzNjAyNzsmIzI2MDg1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuNjA3MSIgeD0iMTcuMDQiIHk9IjM1Ni42NjI2Ij4mIzIxNDYyOyYjMjQzNDE7JiMyMDgwODsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsgW0ZLXTwvdGV4dD48L2c+PCEtLWNsYXNzIGNvbmQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJjb25kIiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzNi42ODA0IiB4PSI3IiB5PSI0NDAuOTY2OSIvPjxlbGxpcHNlIGN4PSIyNS4wMDY0IiBjeT0iNDU2Ljk2NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTI5LjExNTgsNDYyLjk2NjkgTDIxLjM5Nyw0NjIuOTY2OSBMMjEuMzk3LDQ1MC41NzYzIEwyOS4xMTU4LDQ1MC41NzYzIEwyOS4xMTU4LDQ1Mi43MzI1IEwyMy44NTAxLDQ1Mi43MzI1IEwyMy44NTAxLDQ1NS40MDQ0IEwyOC42MTU4LDQ1NS40MDQ0IEwyOC42MTU4LDQ1Ny41NjA2IEwyMy44NTAxLDQ1Ny41NjA2IEwyMy44NTAxLDQ2MC44MTA2IEwyOS4xMTU4LDQ2MC44MTA2IEwyOS4xMTU4LDQ2Mi45NjY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMzkuNjc0NSIgeT0iNDYxLjgxMzYiPiYjMjgwNDA7JiMzNjAyNzsmIzI2MTI2OyYjMzIwNDg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjgiIHgyPSIxNDIuNjgwNCIgeTE9IjQ3Mi45NjY5IiB5Mj0iNDcyLjk2NjkiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjE4IiBjeT0iNDg2LjYxNTMiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNjgwNCIgeD0iMjciIHk9IjQ4OS45NjIiPiYjMjgwNDA7JiMzNjAyNzsmIzMwMDU4OyYjMjE0OTU7IFtQSyxGS108L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIxOCIgY3k9IjUwMi45MTIyIiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjk5NjgiIHg9IjI3IiB5PSI1MDYuMjU4OSI+JiMyODA0MDsmIzM2MDI3OyYjMzQ4OTI7JiMzMDA1ODsmIzIxNDk1OyBbUEtdPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4IiB4Mj0iMTQyLjY4MDQiIHkxPSI1MTMuNTYwNiIgeTI9IjUxMy41NjA2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjYwNzEiIHg9IjEzIiB5PSI1MzAuNTU1NyI+JiMyMTY5NzsmIzMwNDQ2OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OyBbRktdPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEzIiB5PSI1NDYuODUyNiI+JiMyODA0MDsmIzM2MDI3OyYjMjU5Njg7JiMzNzMyNzs8L3RleHQ+PC9nPjwhLS1saW5rIHJjdiB0byBjb24tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImNyb3dmb290IiBkYXRhLXNvdXJjZS1saW5lPSIyOCIgaWQ9ImxuazUiPjxwYXRoIGNvZGVMaW5lPSIyOCIgZD0iTTc1LjM0LDE4Mi4wNTY5IEM3NS4zNCwyMDYuNjc2OSA3NS4zNCwyMDguNTY2OSA3NS4zNCwyMzIuMzc2OSIgZmlsbD0ibm9uZSIgaWQ9InJjdi1jb24iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzEuMzQiIHgyPSI3OS4zNCIgeTE9IjE3OC4wNTY5IiB5Mj0iMTc4LjA1NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzEuMzQiIHgyPSI3OS4zNCIgeTE9IjE4MS4wNTY5IiB5Mj0iMTgxLjA1NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzUuMzQiIHgyPSI3NS4zNCIgeTE9IjE4Mi4wNTY5IiB5Mj0iMTc0LjA1NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzUuMzQiIHgyPSI4MS4zNCIgeTE9IjI0Mi4zNzY5IiB5Mj0iMjUwLjM3NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzUuMzQiIHgyPSI2OS4zNCIgeTE9IjI0Mi4zNzY5IiB5Mj0iMjUwLjM3NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzUuMzQiIHgyPSI3NS4zNCIgeTE9IjI0Mi4zNzY5IiB5Mj0iMjUwLjM3NjkiLz48ZWxsaXBzZSBjeD0iNzUuMzQiIGN5PSIyMzYuMzc2OSIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iNzYuMzQiIHk9IjIxNi44NDM4Ij4mIzI4MDQwOyYjMzYwMjc7JiMzNTM1MjsmIzM3NjgyOzwvdGV4dD48L2c+PCEtLWxpbmsgY29uIHRvIGNvbmQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNCIgZGF0YS1saW5rLXR5cGU9ImNyb3dmb290IiBkYXRhLXNvdXJjZS1saW5lPSIyOSIgaWQ9ImxuazYiPjxwYXRoIGNvZGVMaW5lPSIyOSIgZD0iTTc1LjM0LDM3Mi4zMjY5IEM3NS4zNCwzOTYuMzc2OSA3NS4zNCwzOTguNDM2OSA3NS4zNCw0MjIuNDk2OSIgZmlsbD0ibm9uZSIgaWQ9ImNvbi1jb25kIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjcxLjM0IiB4Mj0iNzkuMzQiIHkxPSIzNjguMzI2OSIgeTI9IjM2OC4zMjY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjcxLjM0IiB4Mj0iNzkuMzQiIHkxPSIzNzEuMzI2OSIgeTI9IjM3MS4zMjY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc1LjM0IiB4Mj0iNzUuMzQiIHkxPSIzNzIuMzI2OSIgeTI9IjM2NC4zMjY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc1LjM0IiB4Mj0iODEuMzQiIHkxPSI0MzIuNDk2OSIgeTI9IjQ0MC40OTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc1LjM0IiB4Mj0iNjkuMzQiIHkxPSI0MzIuNDk2OSIgeTI9IjQ0MC40OTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc1LjM0IiB4Mj0iNzUuMzQiIHkxPSI0MzIuNDk2OSIgeTI9IjQ0MC40OTY5Ii8+PGVsbGlwc2UgY3g9Ijc1LjM0IiBjeT0iNDI2LjQ5NjkiIGZpbGw9Im5vbmUiIHJ4PSI0IiByeT0iNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1LjAyNzgiIHg9Ijc2LjM0IiB5PSI0MDcuMDMzOCI+Y29udGFpbnM8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIEF5YWlvS2JMVUJRanV5TWN0Ty1Sc255dHh0ZFNqRnpudXhnTnFuUXpSNVpDblBNUUx2OVBLZ2NXekJIcndPbFV4S194Zm1DUFM3TEEyZWQ1MmFOOVBHaExONWVBNDFORmZ3dndzaHpUOEpoMEV2UEJMdlZoLVNuVHBwUWxXMGN3MEdLWDhZeU16WTBCR2xHLWN4dUtuZmd3dU1MeEZyU2ptZHVxNXU5akppeEYwemlDYUtFcDZUS3Y4NGlXb2kyTXo0enhrY1ZncXpRRW5xc1JHVU9yVHE5S09EWnRSNFJWeW9xUkM2bkRtTWdqM2lXOGMzMkkxczRFY2pwdVZGT3dEMWtYcmkyejJtaENjWGZUdFZuZ2lFLWlPQVFqY0Y2b1BuQ05JMFdYY21BSzFiOGJZUGJ2bkcwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<details>
<summary>DDL: 消費関連テーブル</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- V012__create_consumption_tables.sql</span>

<span class="c1">-- 消費データ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;消費データ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;消費番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;入荷番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;消費日&quot;</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;取引先コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;備考&quot;</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成者&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新者&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_消費データ_入荷&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;入荷番号&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;入荷受入データ&quot;</span><span class="p">(</span><span class="ss">&quot;入荷番号&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_消費データ_取引先&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;取引先コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;取引先マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;取引先コード&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 消費明細データ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;消費明細データ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;消費番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;消費行番号&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;品目コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;消費数量&quot;</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;備考&quot;</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_消費明細_消費&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;消費番号&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;消費データ&quot;</span><span class="p">(</span><span class="ss">&quot;消費番号&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_消費明細_品目&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;品目コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;品目マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;品目コード&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;消費番号&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;消費行番号&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_消費データ_入荷番号&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;消費データ&quot;</span><span class="p">(</span><span class="ss">&quot;入荷番号&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_消費データ_取引先コード&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;消費データ&quot;</span><span class="p">(</span><span class="ss">&quot;取引先コード&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_消費データ_消費日&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;消費データ&quot;</span><span class="p">(</span><span class="ss">&quot;消費日&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_消費明細_品目コード&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;消費明細データ&quot;</span><span class="p">(</span><span class="ss">&quot;品目コード&quot;</span><span class="p">);</span>
</code></pre></div>

</details>

<h3 id="_11">入荷受入データとの紐付け<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>消費データは入荷受入データと紐付けられます。外注先から加工品が入荷した時点で、支給した材料の消費量を記録します。</p>
<h3 id="_12">消費率の計算<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>消費率（歩留まり率）は以下の計算式で算出されます：</p>
<div class="highlight"><pre><span></span><code>消費率 = 消費数量 ÷ 支給数量
</code></pre></div>
<p>この値は品質管理や原価計算において重要な指標となります。</p>
<h3 id="java_1">Java エンティティの定義<a class="headerlink" href="#java_1" title="Permanent link">&para;</a></h3>
<details>
<summary>消費データエンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/domain/model/subcontract/Consumption.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.supplier.Supplier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.purchase.Receiving</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Consumption</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">consumptionNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">receivingNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">consumptionDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">updatedBy</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Receiving</span><span class="w"> </span><span class="n">receiving</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Supplier</span><span class="w"> </span><span class="n">supplier</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ConsumptionDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>消費明細データエンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/domain/model/subcontract/ConsumptionDetail.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ConsumptionDetail</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">consumptionNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Consumption</span><span class="w"> </span><span class="n">consumption</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="mybatis-mapper-xml_1">MyBatis Mapper XML<a class="headerlink" href="#mybatis-mapper-xml_1" title="Permanent link">&para;</a></h3>
<details>
<summary>ConsumptionMapper.xml</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- src/main/resources/mapper/ConsumptionMapper.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.mapper.ConsumptionMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ConsumptionResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Consumption&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumptionNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;消費番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;receivingNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;入荷番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumptionDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;消費日&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;取引先コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成者&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新者&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Consumption&quot;</span>
<span class="w">            </span><span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">keyProperty=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">keyColumn=</span><span class="s">&quot;ID&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>(
<span class="w">            </span>&quot;消費番号&quot;,<span class="w"> </span>&quot;入荷番号&quot;,<span class="w"> </span>&quot;消費日&quot;,<span class="w"> </span>&quot;取引先コード&quot;,<span class="w"> </span>&quot;備考&quot;,<span class="w"> </span>&quot;作成者&quot;,<span class="w"> </span>&quot;更新者&quot;
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{consumptionNumber},
<span class="w">            </span>#{receivingNumber},
<span class="w">            </span>#{consumptionDate},
<span class="w">            </span>#{supplierCode},
<span class="w">            </span>#{remarks},
<span class="w">            </span>#{createdBy},
<span class="w">            </span>#{updatedBy}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByConsumptionNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;消費番号&quot;<span class="w"> </span>=<span class="w"> </span>#{consumptionNumber}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByReceivingNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;入荷番号&quot;<span class="w"> </span>=<span class="w"> </span>#{receivingNumber}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;消費日&quot;<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findBySupplierCode&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;取引先コード&quot;<span class="w"> </span>=<span class="w"> </span>#{supplierCode}<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;消費日&quot;<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;消費日&quot;<span class="w"> </span>DESC
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- PostgreSQL用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;postgresql&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>TRUNCATE<span class="w"> </span>TABLE<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>CASCADE
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- H2用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;h2&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>DELETE<span class="w"> </span>FROM<span class="w"> </span>&quot;消費データ&quot;
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<details>
<summary>ConsumptionDetailMapper.xml</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- src/main/resources/mapper/ConsumptionDetailMapper.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.mapper.ConsumptionDetailMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ConsumptionDetailResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.ConsumptionDetail&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumptionNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;消費番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;消費行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;品目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;消費数量&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insert&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.ConsumptionDetail&quot;</span>
<span class="w">            </span><span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">keyProperty=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">keyColumn=</span><span class="s">&quot;ID&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>&quot;消費明細データ&quot;<span class="w"> </span>(
<span class="w">            </span>&quot;消費番号&quot;,<span class="w"> </span>&quot;消費行番号&quot;,<span class="w"> </span>&quot;品目コード&quot;,<span class="w"> </span>&quot;消費数量&quot;,<span class="w"> </span>&quot;備考&quot;,<span class="w"> </span>&quot;作成者&quot;,<span class="w"> </span>&quot;更新者&quot;
<span class="w">        </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">            </span>#{consumptionNumber},
<span class="w">            </span>#{lineNumber},
<span class="w">            </span>#{itemCode},
<span class="w">            </span>#{quantity},
<span class="w">            </span>#{remarks},
<span class="w">            </span>#{createdBy},
<span class="w">            </span>#{updatedBy}
<span class="w">        </span>)
<span class="w">    </span><span class="nt">&lt;/insert&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findById&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費明細データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByConsumptionNumberAndLineNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費明細データ&quot;
<span class="w">        </span>WHERE<span class="w"> </span>&quot;消費番号&quot;<span class="w"> </span>=<span class="w"> </span>#{consumptionNumber}<span class="w"> </span>AND<span class="w"> </span>&quot;消費行番号&quot;<span class="w"> </span>=<span class="w"> </span>#{lineNumber}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByConsumptionNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費明細データ&quot;
<span class="w">        </span>WHERE<span class="w"> </span>&quot;消費番号&quot;<span class="w"> </span>=<span class="w"> </span>#{consumptionNumber}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;消費行番号&quot;
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findAll&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;ConsumptionDetailResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>&quot;消費明細データ&quot;<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>&quot;消費番号&quot;,<span class="w"> </span>&quot;消費行番号&quot;
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- PostgreSQL用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;postgresql&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>TRUNCATE<span class="w"> </span>TABLE<span class="w"> </span>&quot;消費明細データ&quot;<span class="w"> </span>CASCADE
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- H2用 DELETE --&gt;</span>
<span class="w">    </span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteAll&quot;</span><span class="w"> </span><span class="na">databaseId=</span><span class="s">&quot;h2&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>DELETE<span class="w"> </span>FROM<span class="w"> </span>&quot;消費明細データ&quot;
<span class="w">    </span><span class="nt">&lt;/delete&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<h3 id="mapper_1">Mapper インターフェース<a class="headerlink" href="#mapper_1" title="Permanent link">&para;</a></h3>
<details>
<summary>ConsumptionMapper</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/infrastructure/out/persistence/mapper/ConsumptionMapper.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.Consumption</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="p">;</span>

<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ConsumptionMapper</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="n">consumption</span><span class="p">);</span>
<span class="w">    </span><span class="n">Consumption</span><span class="w"> </span><span class="nf">findByConsumptionNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">consumptionNumber</span><span class="p">);</span>
<span class="w">    </span><span class="n">Consumption</span><span class="w"> </span><span class="nf">findByReceivingNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">receivingNumber</span><span class="p">);</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">findLatestConsumptionNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAll</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>ConsumptionDetailMapper</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/infrastructure/out/persistence/mapper/ConsumptionDetailMapper.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.ConsumptionDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Mapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.annotations.Param</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Mapper</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ConsumptionDetailMapper</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">ConsumptionDetail</span><span class="w"> </span><span class="n">detail</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ConsumptionDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByConsumptionNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">consumptionNumber</span><span class="p">);</span>
<span class="w">    </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">sumByPurchaseOrderAndItem</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;purchaseOrderNumber&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">,</span>
<span class="w">                                         </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;lineNumber&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">,</span>
<span class="w">                                         </span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;itemCode&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAll</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="_13">消費サービスの実装<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<details>
<summary>ConsumptionService</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/service/ConsumptionService.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command.ConsumptionCreateCommand</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command.ConsumptionDetailCommand</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.purchase.Receiving</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.RoundingMode</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.format.DateTimeFormatter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ConsumptionService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ConsumptionMapper</span><span class="w"> </span><span class="n">consumptionMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ConsumptionDetailMapper</span><span class="w"> </span><span class="n">consumptionDetailMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ReceivingMapper</span><span class="w"> </span><span class="n">receivingMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SupplyMapper</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SupplyDetailMapper</span><span class="w"> </span><span class="n">supplyDetailMapper</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 消費番号を生成する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateConsumptionNumber</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">consumptionDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CON-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">consumptionDate</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyyMM&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">latestNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumptionMapper</span><span class="p">.</span><span class="na">findLatestConsumptionNumber</span><span class="p">(</span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">latestNumber</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">latestNumber</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">latestNumber</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span>
<span class="w">            </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%04d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 消費データを作成する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Consumption</span><span class="w"> </span><span class="nf">createConsumption</span><span class="p">(</span><span class="n">ConsumptionCreateCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 入荷データの取得</span>
<span class="w">        </span><span class="n">Receiving</span><span class="w"> </span><span class="n">receiving</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">receivingMapper</span><span class="p">.</span><span class="na">findByReceivingNumber</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getReceivingNumber</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">receiving</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Receiving not found: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getReceivingNumber</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 関連する支給データを取得</span>
<span class="w">        </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">.</span><span class="na">findByPurchaseOrderDetail</span><span class="p">(</span>
<span class="w">                </span><span class="n">receiving</span><span class="p">.</span><span class="na">getPurchaseOrderNumber</span><span class="p">(),</span><span class="w"> </span><span class="n">receiving</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">supply</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Supply not found for receiving: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getReceivingNumber</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">supplyDetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailMapper</span><span class="p">.</span><span class="na">findBySupplyNumber</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyNumber</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 消費数量のバリデーション</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumptionDetailCommand</span><span class="w"> </span><span class="n">detailCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getDetails</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SupplyDetail</span><span class="w"> </span><span class="n">supplyDetail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">supplyDetails</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">())</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Consumption quantity exceeds supply quantity&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">consumptionNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateConsumptionNumber</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getConsumptionDate</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 消費ヘッダを作成</span>
<span class="w">        </span><span class="n">Consumption</span><span class="w"> </span><span class="n">consumption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Consumption</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">consumptionNumber</span><span class="p">(</span><span class="n">consumptionNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">receivingNumber</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getReceivingNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">consumptionDate</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getConsumptionDate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">remarks</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getRemarks</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">consumptionMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">consumption</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 消費明細を作成</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ConsumptionDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">lineNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ConsumptionDetailCommand</span><span class="w"> </span><span class="n">detailCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getDetails</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">lineNumber</span><span class="o">++</span><span class="p">;</span>

<span class="w">            </span><span class="n">ConsumptionDetail</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConsumptionDetail</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">consumptionNumber</span><span class="p">(</span><span class="n">consumptionNumber</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="n">lineNumber</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">remarks</span><span class="p">(</span><span class="n">detailCommand</span><span class="p">.</span><span class="na">getRemarks</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">consumptionDetailMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">detail</span><span class="p">);</span>

<span class="w">            </span><span class="n">details</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">detail</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">consumption</span><span class="p">.</span><span class="na">setDetails</span><span class="p">(</span><span class="n">details</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">consumption</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 消費率を計算する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">calculateConsumptionRate</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">.</span><span class="na">findBySupplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">supply</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Supply not found: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">supplyDetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailMapper</span><span class="p">.</span><span class="na">findBySupplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">);</span>
<span class="w">        </span><span class="n">SupplyDetail</span><span class="w"> </span><span class="n">targetDetail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetails</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">itemCode</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">findFirst</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Supply detail not found: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">itemCode</span><span class="p">));</span>

<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">supplyQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targetDetail</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">();</span>

<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalConsumption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumptionDetailMapper</span><span class="p">.</span><span class="na">sumByPurchaseOrderAndItem</span><span class="p">(</span>
<span class="w">                </span><span class="n">supply</span><span class="p">.</span><span class="na">getPurchaseOrderNumber</span><span class="p">(),</span>
<span class="w">                </span><span class="n">supply</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">(),</span>
<span class="w">                </span><span class="n">itemCode</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">totalConsumption</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">totalConsumption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">totalConsumption</span><span class="p">.</span><span class="na">divide</span><span class="p">(</span><span class="n">supplyQuantity</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">RoundingMode</span><span class="p">.</span><span class="na">HALF_UP</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="_14">コマンドクラス<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<details>
<summary>ConsumptionCreateCommand</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/port/in/command/ConsumptionCreateCommand.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ConsumptionCreateCommand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">receivingNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">consumptionDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ConsumptionDetailCommand</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>ConsumptionDetailCommand</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/port/in/command/ConsumptionDetailCommand.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ConsumptionDetailCommand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="tdd_1">TDD: 消費データのテスト<a class="headerlink" href="#tdd_1" title="Permanent link">&para;</a></h3>
<details>
<summary>ConsumptionServiceTest</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/test/java/com/example/pms/application/service/ConsumptionServiceTest.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.boot.test.autoconfigure.MybatisTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertyRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertySource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.containers.PostgreSQLContainer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Container</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Testcontainers</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@MybatisTest</span>
<span class="nd">@AutoConfigureTestDatabase</span><span class="p">(</span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AutoConfigureTestDatabase</span><span class="p">.</span><span class="na">Replace</span><span class="p">.</span><span class="na">NONE</span><span class="p">)</span>
<span class="nd">@Import</span><span class="p">({</span><span class="n">ConsumptionService</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">SupplyService</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">ReceivingService</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">PurchaseOrderService</span><span class="p">.</span><span class="na">class</span><span class="p">})</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;消費業務&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">ConsumptionServiceTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:15&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withDatabaseName</span><span class="p">(</span><span class="s">&quot;testdb&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withUsername</span><span class="p">(</span><span class="s">&quot;testuser&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withPassword</span><span class="p">(</span><span class="s">&quot;testpass&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@DynamicPropertySource</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureProperties</span><span class="p">(</span><span class="n">DynamicPropertyRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getJdbcUrl</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.username&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getUsername</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getPassword</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ConsumptionService</span><span class="w"> </span><span class="n">consumptionService</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// テストデータ準備は省略</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;消費データ作成&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ConsumptionCreation</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;入荷時に支給品の消費を記録できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">canRecordConsumptionOnReceiving</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange: 事前に支給・入荷データを作成（省略）</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">receivingNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RCV-202501-0001&quot;</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="n">ConsumptionCreateCommand</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConsumptionCreateCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">receivingNumber</span><span class="p">(</span><span class="n">receivingNumber</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">consumptionDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">details</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="n">ConsumptionDetailCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PRESS-001&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;95&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">Consumption</span><span class="w"> </span><span class="n">consumption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumptionService</span><span class="p">.</span><span class="na">createConsumption</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">consumption</span><span class="p">).</span><span class="na">isNotNull</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">consumption</span><span class="p">.</span><span class="na">getConsumptionNumber</span><span class="p">()).</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;CON-&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">consumption</span><span class="p">.</span><span class="na">getDetails</span><span class="p">()).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">consumption</span><span class="p">.</span><span class="na">getDetails</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getQuantity</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;95&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;消費数量は支給数量を超えてはならない&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">cannotConsumeMoreThanSupplied</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">receivingNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RCV-202501-0001&quot;</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// Act &amp; Assert</span>
<span class="w">            </span><span class="n">ConsumptionCreateCommand</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConsumptionCreateCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">receivingNumber</span><span class="p">(</span><span class="n">receivingNumber</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">consumptionDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUB-001&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">details</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="n">ConsumptionDetailCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;PRESS-001&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;150&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">consumptionService</span><span class="p">.</span><span class="na">createConsumption</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;exceeds supply quantity&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;消費率の計算&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ConsumptionRateCalculation</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;支給に対する消費率を計算できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">canCalculateConsumptionRate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange: 消費データを作成（省略）</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SUP-202501-0001&quot;</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumptionService</span><span class="p">.</span><span class="na">calculateConsumptionRate</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PRESS-001&quot;</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert: 95/100 = 0.95</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">rate</span><span class="p">).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;0.95&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="264">26.4 外注委託ワークフロー<a class="headerlink" href="#264" title="Permanent link">&para;</a></h2>
<h3 id="_15">外注委託の全体フロー<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjU5MHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDIxcHg7aGVpZ2h0OjU5MHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQyMSA1OTAiIHdpZHRoPSI0MjFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjI4MDY7JiMyNzg4MDsmIzIyOTk2OyYjMzUzNTE7JiMxMjUyNzsmIzEyNTQwOyYjMTI0NjM7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5Ljk5OTQiIHg9IjEzOS40NDciIHk9IjMyLjk5NTEiPiYjMjI4MDY7JiMyNzg4MDsmIzIyOTk2OyYjMzUzNTE7JiMxMjUyNzsmIzEyNTQwOyYjMTI0NjM7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7PC90ZXh0PjwvZz48ZWxsaXBzZSBjeD0iMTY4LjAwMDQiIGN5PSI1Ny4yOTY5IiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0yMjIuMDAwNiw4NC4xNDg0IEwyMjIuMDAwNiwxMDAuMjgxMyBMMjAyLjAwMDYsMTA0LjI4MTMgTDIyMi4wMDA2LDEwOC4yODEzIEwyMjIuMDAwNiwxMjQuNDE0MSBBMCwwIDAgMCAwIDIyMi4wMDA2LDEyNC40MTQxIEw0MDkuODkzNCwxMjQuNDE0MSBBMCwwIDAgMCAwIDQwOS44OTM0LDEyNC40MTQxIEw0MDkuODkzNCw5NC4xNDg0IEwzOTkuODkzNCw4NC4xNDg0IEwyMjIuMDAwNiw4NC4xNDg0IEEwLDAgMCAwIDAgMjIyLjAwMDYsODQuMTQ4NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTM5OS44OTM0LDg0LjE0ODQgTDM5OS44OTM0LDk0LjE0ODQgTDQwOS44OTM0LDk0LjE0ODQgTDM5OS44OTM0LDg0LjE0ODQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIyMjguMDAwNiIgeT0iMTAxLjIxNTMiPiYjMzAzMzA7JiMyNzg4MDsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNDM0OyYjMjAzMTY7JiMyNTEwNDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY2Ljg5MjgiIHg9IjIyOC4wMDA2IiB5PSIxMTYuMzQ4MSI+JiMxMjQ3MzsmIzEyNDg2OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNDczOyYjNjUzMDY7JiMyMDMxNjsmIzI1MTA0OyYjMjAwMTM7JiM4NTk0OyYjMzAzMzA7JiMyNzg4MDsmIzI4MTY4OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjguMDAwNCIgeD0iMTM0LjAwMDMiIHk9Ijg3LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIxNDQuMDAwMyIgeT0iMTA4LjQzNTUiPiYjMzAzMzA7JiMyNzg4MDsmIzIwMzE2OyYjMjUxMDQ7PC90ZXh0PjxwYXRoIGQ9Ik0yMjguMDAwNywxNDEuMjY1NiBMMjI4LjAwMDcsMTU3LjM5ODQgTDIwOC4wMDA3LDE2MS4zOTg0IEwyMjguMDAwNywxNjUuMzk4NCBMMjI4LjAwMDcsMTgxLjUzMTMgQTAsMCAwIDAgMCAyMjguMDAwNywxODEuNTMxMyBMMzUzLjAwMDgsMTgxLjUzMTMgQTAsMCAwIDAgMCAzNTMuMDAwOCwxODEuNTMxMyBMMzUzLjAwMDgsMTUxLjI2NTYgTDM0My4wMDA4LDE0MS4yNjU2IEwyMjguMDAwNywxNDEuMjY1NiBBMCwwIDAgMCAwIDIyOC4wMDA3LDE0MS4yNjU2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzQzLjAwMDgsMTQxLjI2NTYgTDM0My4wMDA4LDE1MS4yNjU2IEwzNTMuMDAwOCwxNTEuMjY1NiBMMzQzLjAwMDgsMTQxLjI2NTYiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIyMzQuMDAwNyIgeT0iMTU4LjMzMjUiPiYjMjU5MDM7JiMzMjEwMjsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNDM0OyYjMjAzMTY7JiMyNTEwNDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMjM0LjAwMDciIHk9IjE3My40NjUzIj4mIzI1OTAzOyYjMzIxMDI7JiMyNjEyNjsmIzMyMDQ4OyYjMTI0MzQ7JiMzMDMzMTsmIzM3NjgyOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDAwNSIgeD0iMTI4LjAwMDIiIHk9IjE0NC40MTQxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjAuMDAwNSIgeD0iMTM4LjAwMDIiIHk9IjE2NS41NTI3Ij4mIzI1OTAzOyYjMzIxMDI7JiMyMTY5NzsmIzIwOTg2OyYjMzM2NTU7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5Mi4wMDA1IiB4PSIxMjIuMDAwMiIgeT0iMjAxLjUzMTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Mi4wMDA1IiB4PSIxMzIuMDAwMiIgeT0iMjIyLjY2OTkiPiYjMjI4MDY7JiMyNzg4MDsmIzIwODA4OyYjMTIzOTE7JiMyMTE1MjsmIzI0MDM3OzwvdGV4dD48cGF0aCBkPSJNMjI4LjAwMDcsMjUyLjM1MTYgTDIyOC4wMDA3LDI2OC40ODQ0IEwyMDguMDAwNywyNzIuNDg0NCBMMjI4LjAwMDcsMjc2LjQ4NDQgTDIyOC4wMDA3LDI5Mi42MTcyIEEwLDAgMCAwIDAgMjI4LjAwMDcsMjkyLjYxNzIgTDM3OS4wMDA4LDI5Mi42MTcyIEEwLDAgMCAwIDAgMzc5LjAwMDgsMjkyLjYxNzIgTDM3OS4wMDA4LDI2Mi4zNTE2IEwzNjkuMDAwOCwyNTIuMzUxNiBMMjI4LjAwMDcsMjUyLjM1MTYgQTAsMCAwIDAgMCAyMjguMDAwNywyNTIuMzUxNiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTM2OS4wMDA4LDI1Mi4zNTE2IEwzNjkuMDAwOCwyNjIuMzUxNiBMMzc5LjAwMDgsMjYyLjM1MTYgTDM2OS4wMDA4LDI1Mi4zNTE2IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuMDAwMiIgeD0iMjM0LjAwMDciIHk9IjI2OS40MTg1Ij4mIzIwODM3OyYjMzM2NTU7JiMyMTQ2MzsmIzIwODM3OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMTI0MzQ7JiMyMDMxNjsmIzI1MTA0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSIyMzQuMDAwNyIgeT0iMjg0LjU1MTMiPiYjMjA4Mzc7JiMzMzY1NTsmIzI1OTY4OyYjMzczMjc7JiMxMjQzNDsmIzM1MzUyOyYjMzc2ODI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MC4wMDA1IiB4PSIxMjguMDAwMiIgeT0iMjU1LjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wMDA1IiB4PSIxMzguMDAwMiIgeT0iMjc2LjYzODciPiYjMjExNTI7JiMyNDAzNzsmIzIxNjk3OyYjMjA4Mzc7JiMzMzY1NTs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY4LjAwMDQiIHg9IjEzNC4wMDAzIiB5PSIzMTIuNjE3MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4LjAwMDQiIHg9IjE0NC4wMDAzIiB5PSIzMzMuNzU1OSI+JiMyMTQ2MzsmIzIwODM3OyYjMjY5MDg7JiMyNjYxOTs8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSIxNTQuMDgxMywzNjYuNTg1OSwxODEuOTE5NSwzNjYuNTg1OSwxOTMuOTE5NSwzNzguNTg1OSwxODEuOTE5NSwzOTAuNTg1OSwxNTQuMDgxMywzOTAuNTg1OSwxNDIuMDgxMywzNzguNTg1OSwxNTQuMDgxMywzNjYuNTg1OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuODM4MiIgeD0iMTU0LjA4MTMiIHk9IjM4Mi4zOTQiPiYjMjE1MTI7JiMyNjY4NDs/PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5LjAwODMiIHg9IjEyMy4wNzMiIHk9IjM3NS45OTE3Ij55ZXM8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMuNzAxNyIgeD0iMTkzLjkxOTUiIHk9IjM3NS45OTE3Ij5ubzwvdGV4dD48cGF0aCBkPSJNOTkuMDAwNCw0MDAuNTg1OSBMOTkuMDAwNCw0MTYuNzE4OCBMNzkuMDAwNCw0MjAuNzE4OCBMOTkuMDAwNCw0MjQuNzE4OCBMOTkuMDAwNCw0NDAuODUxNiBBMCwwIDAgMCAwIDk5LjAwMDQsNDQwLjg1MTYgTDIyNC4wMDA1LDQ0MC44NTE2IEEwLDAgMCAwIDAgMjI0LjAwMDUsNDQwLjg1MTYgTDIyNC4wMDA1LDQxMC41ODU5IEwyMTQuMDAwNSw0MDAuNTg1OSBMOTkuMDAwNCw0MDAuNTg1OSBBMCwwIDAgMCAwIDk5LjAwMDQsNDAwLjU4NTkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yMTQuMDAwNSw0MDAuNTg1OSBMMjE0LjAwMDUsNDEwLjU4NTkgTDIyNC4wMDA1LDQxMC41ODU5IEwyMTQuMDAwNSw0MDAuNTg1OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjAwMDEiIHg9IjEwNS4wMDA0IiB5PSI0MTcuNjUyOCI+JiMyNjkwODsmIzIxNDU0OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMTI0MzQ7JiMyMDMxNjsmIzI1MTA0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSIxMDUuMDAwNCIgeT0iNDMyLjc4NTYiPiYjMjY5MDg7JiMyMTQ1NDsmIzM3MzI5OyYjMzg5ODk7JiMxMjQzNDsmIzM1MzM2OyYjMzE2Mzk7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIxMSIgeT0iNDAzLjczNDQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIyMSIgeT0iNDI0Ljg3MyI+JiMyNjkwODsmIzIxNDU0OyYjMjA5NjY7JiMyOTcwMjs8L3RleHQ+PHBhdGggZD0iTTk5LjAwMDQsNDY3LjE0ODQgTDk5LjAwMDQsNDgzLjI4MTMgTDc5LjAwMDQsNDg3LjI4MTMgTDk5LjAwMDQsNDkxLjI4MTMgTDk5LjAwMDQsNTA3LjQxNDEgQTAsMCAwIDAgMCA5OS4wMDA0LDUwNy40MTQxIEwyMzcuMDAwNSw1MDcuNDE0MSBBMCwwIDAgMCAwIDIzNy4wMDA1LDUwNy40MTQxIEwyMzcuMDAwNSw0NzcuMTQ4NCBMMjI3LjAwMDUsNDY3LjE0ODQgTDk5LjAwMDQsNDY3LjE0ODQgQTAsMCAwIDAgMCA5OS4wMDA0LDQ2Ny4xNDg0IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjI3LjAwMDUsNDY3LjE0ODQgTDIyNy4wMDA1LDQ3Ny4xNDg0IEwyMzcuMDAwNSw0NzcuMTQ4NCBMMjI3LjAwMDUsNDY3LjE0ODQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIxMDUuMDAwNCIgeT0iNDg0LjIxNTMiPiYjMjgwNDA7JiMzNjAyNzsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNDM0OyYjMjAzMTY7JiMyNTEwNDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjEwNS4wMDA0IiB5PSI0OTkuMzQ4MSI+JiMyNTkwMzsmIzMyMTAyOyYjMjE2OTc7JiMxMjM5ODsmIzI4MDQwOyYjMzYwMjc7JiMxMjQzNDsmIzM1MzUyOyYjMzc2ODI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIxMSIgeT0iNDcwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIyMSIgeT0iNDkxLjQzNTUiPiYjMjgwNDA7JiMzNjAyNzsmIzM1MzUyOyYjMzc2ODI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIyNTcuMDAwNSIgeT0iNDAwLjU4NTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIyNjcuMDAwNSIgeT0iNDIxLjcyNDYiPiYjMTk5ODE7JiMzMzM5MTsmIzIwOTY2OyYjMjk3MDI7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIyNTcuMDAwNSIgeT0iNDYwLjg1MTYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSIyNjcuMDAwNSIgeT0iNDgxLjk5MDIiPiYjMzY4MjA7JiMyMTY5NzsmIzIwOTY2OyYjMjk3MDI7PC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMTY4LjAwMDQsNTEzLjQxNDEsMTgwLjAwMDQsNTI1LjQxNDEsMTY4LjAwMDQsNTM3LjQxNDEsMTU2LjAwMDQsNTI1LjQxNDEsMTY4LjAwMDQsNTEzLjQxNDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxlbGxpcHNlIGN4PSIxNjguMDAwNCIgY3k9IjU2OC40MTQxIiBmaWxsPSJub25lIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxlbGxpcHNlIGN4PSIxNjguMDAwNCIgY3k9IjU2OC40MTQxIiBmaWxsPSIjMjIyMjIyIiByeD0iNiIgcnk9IjYiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTY4LjAwMDQiIHgyPSIxNjguMDAwNCIgeTE9IjY3LjI5NjkiIHkyPSI4Ny4yOTY5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjQuMDAwNCw3Ny4yOTY5LDE2OC4wMDA0LDg3LjI5NjksMTcyLjAwMDQsNzcuMjk2OSwxNjguMDAwNCw4MS4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE2OC4wMDA0IiB4Mj0iMTY4LjAwMDQiIHkxPSIxMjEuMjY1NiIgeTI9IjE0NC40MTQxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjQuMDAwNCwxMzQuNDE0MSwxNjguMDAwNCwxNDQuNDE0MSwxNzIuMDAwNCwxMzQuNDE0MSwxNjguMDAwNCwxMzguNDE0MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNjguMDAwNCIgeDI9IjE2OC4wMDA0IiB5MT0iMTc4LjM4MjgiIHkyPSIyMDEuNTMxMyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTY0LjAwMDQsMTkxLjUzMTMsMTY4LjAwMDQsMjAxLjUzMTMsMTcyLjAwMDQsMTkxLjUzMTMsMTY4LjAwMDQsMTk1LjUzMTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTY4LjAwMDQiIHgyPSIxNjguMDAwNCIgeTE9IjIzNS41IiB5Mj0iMjU1LjUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2NC4wMDA0LDI0NS41LDE2OC4wMDA0LDI1NS41LDE3Mi4wMDA0LDI0NS41LDE2OC4wMDA0LDI0OS41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE2OC4wMDA0IiB4Mj0iMTY4LjAwMDQiIHkxPSIyODkuNDY4OCIgeTI9IjMxMi42MTcyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjQuMDAwNCwzMDIuNjE3MiwxNjguMDAwNCwzMTIuNjE3MiwxNzIuMDAwNCwzMDIuNjE3MiwxNjguMDAwNCwzMDYuNjE3MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NS4wMDAyIiB4Mj0iNDUuMDAwMiIgeTE9IjQzNy43MDMxIiB5Mj0iNDcwLjI5NjkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQxLjAwMDIsNDYwLjI5NjksNDUuMDAwMiw0NzAuMjk2OSw0OS4wMDAyLDQ2MC4yOTY5LDQ1LjAwMDIsNDY0LjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjkxLjAwMDciIHgyPSIyOTEuMDAwNyIgeTE9IjQzNC41NTQ3IiB5Mj0iNDYwLjg1MTYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI4Ny4wMDA3LDQ1MC44NTE2LDI5MS4wMDA3LDQ2MC44NTE2LDI5NS4wMDA3LDQ1MC44NTE2LDI5MS4wMDA3LDQ1NC44NTE2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE0Mi4wODEzIiB4Mj0iNDUuMDAwMiIgeTE9IjM3OC41ODU5IiB5Mj0iMzc4LjU4NTkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDUuMDAwMiIgeDI9IjQ1LjAwMDIiIHkxPSIzNzguNTg1OSIgeTI9IjQwMy43MzQ0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MS4wMDAyLDM5My43MzQ0LDQ1LjAwMDIsNDAzLjczNDQsNDkuMDAwMiwzOTMuNzM0NCw0NS4wMDAyLDM5Ny43MzQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE5My45MTk1IiB4Mj0iMjkxLjAwMDciIHkxPSIzNzguNTg1OSIgeTI9IjM3OC41ODU5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI5MS4wMDA3IiB4Mj0iMjkxLjAwMDciIHkxPSIzNzguNTg1OSIgeTI9IjQwMC41ODU5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyODcuMDAwNywzOTAuNTg1OSwyOTEuMDAwNyw0MDAuNTg1OSwyOTUuMDAwNywzOTAuNTg1OSwyOTEuMDAwNywzOTQuNTg1OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NS4wMDAyIiB4Mj0iNDUuMDAwMiIgeTE9IjUwNC4yNjU2IiB5Mj0iNTI1LjQxNDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDUuMDAwMiIgeDI9IjE1Ni4wMDA0IiB5MT0iNTI1LjQxNDEiIHkyPSI1MjUuNDE0MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTQ2LjAwMDQsNTIxLjQxNDEsMTU2LjAwMDQsNTI1LjQxNDEsMTQ2LjAwMDQsNTI5LjQxNDEsMTUwLjAwMDQsNTI1LjQxNDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjkxLjAwMDciIHgyPSIyOTEuMDAwNyIgeTE9IjQ5NC44MjAzIiB5Mj0iNTI1LjQxNDEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjkxLjAwMDciIHgyPSIxODAuMDAwNCIgeTE9IjUyNS40MTQxIiB5Mj0iNTI1LjQxNDEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE5MC4wMDA0LDUyMS40MTQxLDE4MC4wMDA0LDUyNS40MTQxLDE5MC4wMDA0LDUyOS40MTQxLDE4Ni4wMDA0LDUyNS40MTQxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE2OC4wMDA0IiB4Mj0iMTY4LjAwMDQiIHkxPSIzNDYuNTg1OSIgeTI9IjM2Ni41ODU5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNjQuMDAwNCwzNTYuNTg1OSwxNjguMDAwNCwzNjYuNTg1OSwxNzIuMDAwNCwzNTYuNTg1OSwxNjguMDAwNCwzNjAuNTg1OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNjguMDAwNCIgeDI9IjE2OC4wMDA0IiB5MT0iNTM3LjQxNDEiIHkyPSI1NTcuNDE0MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTY0LjAwMDQsNTQ3LjQxNDEsMTY4LjAwMDQsNTU3LjQxNDEsMTcyLjAwMDQsNTQ3LjQxNDEsMTY4LjAwMDQsNTUxLjQxNDEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48P3BsYW50dW1sLXNyYyBUTDlCUmk4bTREdHg1NXgyNU0zSGlySWdBUDVHZ0MyUkJmQzhhYk9EZjFHUWc5MUE5TnVSRmc4VkZhZDVOTWhpOUFqVWVPdURLYUZmblhnX0RwRGx0alhPbUdLNFFWLUhsT3hmZzFjRU5NQkNZRTRKZFB5ak9hbnUzNDBQZHZTbTA5Y1dpLTV2a3l5a2l2bWlLOGlPbVA5b2NTVDA0aUdtSFVjTXcwc1AxOFktOWFScldBd19fSVQ5eDVRSmhzZjNiaDZMMVAxdzBVRC1OOEdyUHk3eGEzdmVyRG80elpBWDh4YUpFZjlXeExobURrVGVxRjZZa3lObGhka0I1T2plOHRoUmV5ajFEYVA1NTZqTDFpVFE0ZzlyYm1TZDUyTkRNbEY4aDdDcTdCVUY1S0tid3RWUGl5VXJiMW5DS1NUWUZWeWkzTjRVZ0oxclpTZmZ4aFZWZlZLUURPVTFLcXNRNVNHZml1QThwRmxlbkhSSUxaMXI0b2x5aUNBNTlxVEFqWEo0bF9sWllvM1FUOV9xcm5DZ2IxNUNnS0stejZ2YlhwVXBtejJQU0RpSzNvUWxsNDM5blItY1VGSzM/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_16">外注委託ワークフローサービス<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<details>
<summary>SubcontractingWorkflowService</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/service/SubcontractingWorkflowService.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command.SubcontractOrderCommand</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.out.SubcontractStatus</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.purchase.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.RoundingMode</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.format.DateTimeFormatter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SubcontractingWorkflowService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">PurchaseOrderMapper</span><span class="w"> </span><span class="n">purchaseOrderMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">PurchaseOrderDetailMapper</span><span class="w"> </span><span class="n">purchaseOrderDetailMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SupplyMapper</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SupplyDetailMapper</span><span class="w"> </span><span class="n">supplyDetailMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ConsumptionDetailMapper</span><span class="w"> </span><span class="n">consumptionDetailMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">UnitPriceMapper</span><span class="w"> </span><span class="n">unitPriceMapper</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 発注番号を生成する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generatePurchaseOrderNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PO-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyyMM&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">latestNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purchaseOrderMapper</span><span class="p">.</span><span class="na">findLatestPurchaseOrderNumber</span><span class="p">(</span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">latestNumber</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">latestNumber</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">latestNumber</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span>
<span class="w">            </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%04d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 外注発注を作成する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="nf">createSubcontractOrder</span><span class="p">(</span><span class="n">SubcontractOrderCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generatePurchaseOrderNumber</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 単価を取得</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unitPrice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UnitPrice</span><span class="w"> </span><span class="n">priceEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unitPriceMapper</span><span class="p">.</span><span class="na">findEffectiveUnitPrice</span><span class="p">(</span>
<span class="w">                    </span><span class="n">command</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">(),</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="n">unitPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">priceEntity</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">priceEntity</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 発注ヘッダを作成</span>
<span class="w">        </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="n">purchaseOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">purchaseOrderNumber</span><span class="p">(</span><span class="n">purchaseOrderNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">orderDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getSupplierCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">PurchaseOrderStatus</span><span class="p">.</span><span class="na">CREATING</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">purchaseOrderMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">purchaseOrder</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 発注明細を作成</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">orderAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">().</span><span class="na">multiply</span><span class="p">(</span><span class="n">unitPrice</span><span class="p">);</span>
<span class="w">        </span><span class="n">PurchaseOrderDetail</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PurchaseOrderDetail</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">purchaseOrderNumber</span><span class="p">(</span><span class="n">purchaseOrderNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">orderQuantity</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">orderUnitPrice</span><span class="p">(</span><span class="n">unitPrice</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">orderAmount</span><span class="p">(</span><span class="n">orderAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">expectedReceivingDate</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getDeliveryDate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">completedFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">purchaseOrderDetailMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">detail</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 発注確定</span>
<span class="w">        </span><span class="n">purchaseOrderMapper</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span><span class="n">purchaseOrderNumber</span><span class="p">,</span><span class="w"> </span><span class="n">PurchaseOrderStatus</span><span class="p">.</span><span class="na">ORDERED</span><span class="p">);</span>
<span class="w">        </span><span class="n">purchaseOrder</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">PurchaseOrderStatus</span><span class="p">.</span><span class="na">ORDERED</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">purchaseOrder</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 外注委託状況を取得する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SubcontractStatus</span><span class="w"> </span><span class="nf">getSubcontractStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="n">purchaseOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purchaseOrderMapper</span><span class="p">.</span><span class="na">findByPurchaseOrderNumber</span><span class="p">(</span><span class="n">purchaseOrderNumber</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">purchaseOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Purchase order not found: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PurchaseOrderDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purchaseOrderDetailMapper</span><span class="p">.</span><span class="na">findByPurchaseOrderNumber</span><span class="p">(</span><span class="n">purchaseOrderNumber</span><span class="p">);</span>

<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">suppliedQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">acceptedQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">PurchaseOrderDetail</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">details</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyMapper</span><span class="p">.</span><span class="na">findByPurchaseOrderDetail</span><span class="p">(</span><span class="n">purchaseOrderNumber</span><span class="p">,</span><span class="w"> </span><span class="n">detail</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">());</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">supply</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">supplyDetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailMapper</span><span class="p">.</span><span class="na">findBySupplyNumber</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyNumber</span><span class="p">());</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SupplyDetail</span><span class="w"> </span><span class="n">supplyDetail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">supplyDetails</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">suppliedQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suppliedQuantity</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">());</span>

<span class="w">                    </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">consumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumptionDetailMapper</span><span class="p">.</span><span class="na">sumByPurchaseOrderAndItem</span><span class="p">(</span>
<span class="w">                            </span><span class="n">purchaseOrderNumber</span><span class="p">,</span><span class="w"> </span><span class="n">detail</span><span class="p">.</span><span class="na">getLineNumber</span><span class="p">(),</span><span class="w"> </span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">());</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">consumed</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">consumedQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">consumed</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getAcceptedQuantity</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">acceptedQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acceptedQuantity</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getAcceptedQuantity</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">yieldRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suppliedQuantity</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                </span><span class="o">?</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="p">.</span><span class="na">divide</span><span class="p">(</span><span class="n">suppliedQuantity</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">RoundingMode</span><span class="p">.</span><span class="na">HALF_UP</span><span class="p">)</span>
<span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SubcontractStatus</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">purchaseOrderNumber</span><span class="p">(</span><span class="n">purchaseOrderNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">purchaseOrder</span><span class="p">.</span><span class="na">getStatus</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">suppliedQuantity</span><span class="p">(</span><span class="n">suppliedQuantity</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">consumedQuantity</span><span class="p">(</span><span class="n">consumedQuantity</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">acceptedQuantity</span><span class="p">(</span><span class="n">acceptedQuantity</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">yieldRate</span><span class="p">(</span><span class="n">yieldRate</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="dto">コマンド・DTO クラス<a class="headerlink" href="#dto" title="Permanent link">&para;</a></h3>
<details>
<summary>SubcontractOrderCommand</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/port/in/command/SubcontractOrderCommand.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.port.in.command</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SubcontractOrderCommand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">deliveryDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>SubcontractStatus</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/application/port/out/SubcontractStatus.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.application.port.out</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.purchase.PurchaseOrderStatus</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 外注委託状況DTO</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SubcontractStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PurchaseOrderStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">suppliedQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">acceptedQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">yieldRate</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="_17">有償支給と無償支給の会計処理の違い<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>処理</th>
<th>有償支給</th>
<th>無償支給</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>支給時</strong></td>
<td>売上計上（材料を売却）</td>
<td>在庫移動のみ</td>
</tr>
<tr>
<td><strong>入荷時</strong></td>
<td>仕入計上（加工品を購入）</td>
<td>加工賃のみ計上</td>
</tr>
<tr>
<td><strong>消費税</strong></td>
<td>売上・仕入両方で課税</td>
<td>加工賃のみ課税</td>
</tr>
<tr>
<td><strong>在庫管理</strong></td>
<td>支給時に在庫減、入荷時に在庫増</td>
<td>在庫は自社のまま</td>
</tr>
</tbody>
</table>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjQ2N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTkwcHg7aGVpZ2h0OjQ2N3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDU5MCA0NjciIHdpZHRoPSI1OTBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjYzNzc7JiMyMDc2NzsmIzI1OTAzOyYjMzIxMDI7JiMxMjM5MjsmIzI4OTYxOyYjMjA3Njc7JiMyNTkwMzsmIzMyMTAyOyYjMTIzOTg7JiMyMDI1MDsmIzM1MzM2OyYjMjA5NjY7JiMyOTcwMjs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTUuOTk5MSIgeD0iMTk1LjU3NjMiIHk9IjMyLjk5NTEiPiYjMjYzNzc7JiMyMDc2NzsmIzI1OTAzOyYjMzIxMDI7JiMxMjM5MjsmIzI4OTYxOyYjMjA3Njc7JiMyNTkwMzsmIzMyMTAyOyYjMTIzOTg7JiMyMDI1MDsmIzM1MzM2OyYjMjA5NjY7JiMyOTcwMjs8L3RleHQ+PC9nPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjAuOTUzMSIgc3R5bGU9InN0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjU1Ny4xNTE3IiB4PSIxNSIgeT0iNTAuMDQyIi8+PHJlY3QgZmlsbD0iI0FERDhFNiIgaGVpZ2h0PSI0MDQuOTg0NCIgc3R5bGU9InN0cm9rZTojQUREOEU2O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjI3MC42NDU0IiB4PSIxNSIgeT0iNTAuMDQyIi8+PGVsbGlwc2UgY3g9Ijg1LjAwMDQiIGN5PSI4NS45OTUxIiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0xNjkuMDAwOCwxMDUuOTk1MSBMMTY5LjAwMDgsMTI5LjY5NDMgTDE0OS4wMDA4LDEzMy42OTQzIEwxNjkuMDAwOCwxMzcuNjk0MyBMMTY5LjAwMDgsMTYxLjM5MzYgQTAsMCAwIDAgMCAxNjkuMDAwOCwxNjEuMzkzNiBMMjgwLjY0NTQsMTYxLjM5MzYgQTAsMCAwIDAgMCAyODAuNjQ1NCwxNjEuMzkzNiBMMjgwLjY0NTQsMTE1Ljk5NTEgTDI3MC42NDU0LDEwNS45OTUxIEwxNjkuMDAwOCwxMDUuOTk1MSBBMCwwIDAgMCAwIDE2OS4wMDA4LDEwNS45OTUxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjcwLjY0NTQsMTA1Ljk5NTEgTDI3MC42NDU0LDExNS45OTUxIEwyODAuNjQ1NCwxMTUuOTk1MSBMMjcwLjY0NTQsMTA1Ljk5NTEiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjE3NS4wMDA4IiB5PSIxMjMuMDYyIj4mIzEyMzA0OyYjMjAxODE7JiMzNTM3OTsmIzEyMzA1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MC42NDQ2IiB4PSIxNzUuMDAwOCIgeT0iMTM4LjE5NDgiPiYjMjI3NzA7JiMyNTQ5OTsmIzM3MzI5OyAvICYjMjI3NzA7JiMxOTk3ODsmIzM5NjQwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MC42NDQ2IiB4PSIxNzUuMDAwOCIgeT0iMTUzLjMyNzYiPiYjMjI3NzA7JiMxOTk3ODsmIzIxNDA3OyYjMjAzODU7IC8gJiMzNTA2OTsmIzIxNjk3OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI4LjAwMDgiIHg9IjIxIiB5PSIxMTYuNzEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDguMDAwOCIgeD0iMzEiIHk9IjEzNy44NDg2Ij4mIzI2NDQ4OyYjMjYwMDk7JiMxMjQzNDsmIzIyODA2OyYjMjc4ODA7JiMyMDgwODsmIzEyMzk1OyYjMjI3NzA7JiMyMTM2NDs8L3RleHQ+PHBhdGggZD0iTTE1MS4wMDA3LDE3OC4yNDUxIEwxNTEuMDAwNywxOTQuMzc3OSBMMTMxLjAwMDcsMTk4LjM3NzkgTDE1MS4wMDA3LDIwMi4zNzc5IEwxNTEuMDAwNywyMTguNTEwNyBBMCwwIDAgMCAwIDE1MS4wMDA3LDIxOC41MTA3IEwyNjIuNjQ1MywyMTguNTEwNyBBMCwwIDAgMCAwIDI2Mi42NDUzLDIxOC41MTA3IEwyNjIuNjQ1MywxODguMjQ1MSBMMjUyLjY0NTMsMTc4LjI0NTEgTDE1MS4wMDA3LDE3OC4yNDUxIEEwLDAgMCAwIDAgMTUxLjAwMDcsMTc4LjI0NTEiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yNTIuNjQ1MywxNzguMjQ1MSBMMjUyLjY0NTMsMTg4LjI0NTEgTDI2Mi42NDUzLDE4OC4yNDUxIEwyNTIuNjQ1MywxNzguMjQ1MSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iMTU3LjAwMDciIHk9IjE5NS4zMTIiPiYjMTIzMDQ7JiMyMDE4MTsmIzM1Mzc5OyYjMTIzMDU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkwLjY0NDYiIHg9IjE1Ny4wMDA3IiB5PSIyMTAuNDQ0OCI+JiMyMDE4MTsmIzIwODM3OyYjMzk2NDA7IC8gJiMzNjAyMzsmIzI1NDk5OyYjMzczMjk7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5Mi4wMDA1IiB4PSIzOS4wMDAxIiB5PSIxODEuMzkzNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcyLjAwMDUiIHg9IjQ5LjAwMDEiIHk9IjIwMi41MzIyIj4mIzIxMTUyOyYjMjQwMzc7JiMyMTY5NzsmIzEyNDM0OyYjMzYwOTI7JiMyMDgzNzs8L3RleHQ+PGVsbGlwc2UgY3g9Ijg1LjAwMDQiIGN5PSIyNDkuNTEwNyIgZmlsbD0ibm9uZSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZWxsaXBzZSBjeD0iODUuMDAwNCIgY3k9IjI0OS41MTA3IiBmaWxsPSIjMjIyMjIyIiByeD0iNiIgcnk9IjYiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNSIgeDI9IjE1IiB5MT0iNTAuMDQyIiB5Mj0iNDU1LjAyNjQiLz48cmVjdCBmaWxsPSIjOTBFRTkwIiBoZWlnaHQ9IjQwNC45ODQ0IiBzdHlsZT0ic3Ryb2tlOiM5MEVFOTA7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjg0LjY0NTQiIHg9IjI4NS42NDU0IiB5PSI1MC4wNDIiLz48ZWxsaXBzZSBjeD0iMzU1LjY0NTkiIGN5PSIyODAuNTEwNyIgZmlsbD0iIzIyMjIyMiIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNDM5LjY0NjMsMzAwLjUxMDcgTDQzOS42NDYzLDMyNC4yMSBMNDE5LjY0NjMsMzI4LjIxIEw0MzkuNjQ2MywzMzIuMjEgTDQzOS42NDYzLDM1NS45MDkyIEEwLDAgMCAwIDAgNDM5LjY0NjMsMzU1LjkwOTIgTDU2NC42NDY0LDM1NS45MDkyIEEwLDAgMCAwIDAgNTY0LjY0NjQsMzU1LjkwOTIgTDU2NC42NDY0LDMxMC41MTA3IEw1NTQuNjQ2NCwzMDAuNTEwNyBMNDM5LjY0NjMsMzAwLjUxMDcgQTAsMCAwIDAgMCA0MzkuNjQ2MywzMDAuNTEwNyIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTU1NC42NDY0LDMwMC41MTA3IEw1NTQuNjQ2NCwzMTAuNTEwNyBMNTY0LjY0NjQsMzEwLjUxMDcgTDU1NC42NDY0LDMwMC41MTA3IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSI0NDUuNjQ2MyIgeT0iMzE3LjU3NzYiPiYjMTIzMDQ7JiMyMDE4MTsmIzM1Mzc5OyYjMTIzMDU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkwLjY0NDYiIHg9IjQ0NS42NDYzIiB5PSIzMzIuNzEwNCI+JiMzODkyODsmIzEyMzY5OyYjMjY0NDg7JiMyNjAwOTsgLyAmIzM1MDY5OyYjMjE2OTc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSI0NDUuNjQ2MyIgeT0iMzQ3Ljg0MzMiPiYjNjUyODg7JiMzMTAzODsmIzIwODY5OyYjMjUzOTE7JiMyNjM2NzsmIzEyMzk4OyYjMTI0MTU7JiM2NTI4OTs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOC4wMDA4IiB4PSIyOTEuNjQ1NCIgeT0iMzExLjIyNTYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDguMDAwOCIgeD0iMzAxLjY0NTQiIHk9IjMzMi4zNjQzIj4mIzI2NDQ4OyYjMjYwMDk7JiMxMjQzNDsmIzIyODA2OyYjMjc4ODA7JiMyMDgwODsmIzEyMzk1OyYjMzYwMjQ7JiMxOTk4Mjs8L3RleHQ+PHBhdGggZD0iTTQyNy42NDYyLDM3Mi43NjA3IEw0MjcuNjQ2MiwzODguODkzNiBMNDA3LjY0NjIsMzkyLjg5MzYgTDQyNy42NDYyLDM5Ni44OTM2IEw0MjcuNjQ2Miw0MTMuMDI2NCBBMCwwIDAgMCAwIDQyNy42NDYyLDQxMy4wMjY0IEw1NjUuMjkwOCw0MTMuMDI2NCBBMCwwIDAgMCAwIDU2NS4yOTA4LDQxMy4wMjY0IEw1NjUuMjkwOCwzODIuNzYwNyBMNTU1LjI5MDgsMzcyLjc2MDcgTDQyNy42NDYyLDM3Mi43NjA3IEEwLDAgMCAwIDAgNDI3LjY0NjIsMzcyLjc2MDciIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik01NTUuMjkwOCwzNzIuNzYwNyBMNTU1LjI5MDgsMzgyLjc2MDcgTDU2NS4yOTA4LDM4Mi43NjA3IEw1NTUuMjkwOCwzNzIuNzYwNyIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iNDMzLjY0NjIiIHk9IjM4OS44Mjc2Ij4mIzEyMzA0OyYjMjAxODE7JiMzNTM3OTsmIzEyMzA1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuNjQ0NyIgeD0iNDMzLjY0NjIiIHk9IjQwNC45NjA0Ij4mIzIyODA2OyYjMjc4ODA7JiMyMTE1MjsmIzI0MDM3OyYjMzYwMjc7IC8gJiMzNjAyMzsmIzI1NDk5OyYjMzczMjk7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDQuMDAwNiIgeD0iMzAzLjY0NTUiIHk9IjM3NS45MDkyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODQuMDAwNiIgeD0iMzEzLjY0NTUiIHk9IjM5Ny4wNDc5Ij4mIzIxMTUyOyYjMjQwMzc7JiMzNjAzNTsmIzEyNDM0OyYjMjU5MDM7JiMyNTE3MzsmIzEyMzU2OzwvdGV4dD48ZWxsaXBzZSBjeD0iMzU1LjY0NTkiIGN5PSI0NDQuMDI2NCIgZmlsbD0ibm9uZSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZWxsaXBzZSBjeD0iMzU1LjY0NTkiIGN5PSI0NDQuMDI2NCIgZmlsbD0iIzIyMjIyMiIgcng9IjYiIHJ5PSI2IiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjg1LjY0NTQiIHgyPSIyODUuNjQ1NCIgeTE9IjUwLjA0MiIgeTI9IjQ1NS4wMjY0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTcwLjI5MDgiIHgyPSI1NzAuMjkwOCIgeTE9IjUwLjA0MiIgeTI9IjQ1NS4wMjY0Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg1LjAwMDQiIHgyPSI4NS4wMDA0IiB5MT0iOTUuOTk1MSIgeTI9IjExNi43MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODEuMDAwNCwxMDYuNzEsODUuMDAwNCwxMTYuNzEsODkuMDAwNCwxMDYuNzEsODUuMDAwNCwxMTAuNzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODUuMDAwNCIgeDI9Ijg1LjAwMDQiIHkxPSIxNTAuNjc4NyIgeTI9IjE4MS4zOTM2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4MS4wMDA0LDE3MS4zOTM2LDg1LjAwMDQsMTgxLjM5MzYsODkuMDAwNCwxNzEuMzkzNiw4NS4wMDA0LDE3NS4zOTM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg1LjAwMDQiIHgyPSI4NS4wMDA0IiB5MT0iMjE1LjM2MjMiIHkyPSIyMzguNTEwNyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODEuMDAwNCwyMjguNTEwNyw4NS4wMDA0LDIzOC41MTA3LDg5LjAwMDQsMjI4LjUxMDcsODUuMDAwNCwyMzIuNTEwNyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzNTUuNjQ1OSIgeDI9IjM1NS42NDU5IiB5MT0iMjkwLjUxMDciIHkyPSIzMTEuMjI1NiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzUxLjY0NTksMzAxLjIyNTYsMzU1LjY0NTksMzExLjIyNTYsMzU5LjY0NTksMzAxLjIyNTYsMzU1LjY0NTksMzA1LjIyNTYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzU1LjY0NTkiIHgyPSIzNTUuNjQ1OSIgeTE9IjM0NS4xOTQzIiB5Mj0iMzc1LjkwOTIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM1MS42NDU5LDM2NS45MDkyLDM1NS42NDU5LDM3NS45MDkyLDM1OS42NDU5LDM2NS45MDkyLDM1NS42NDU5LDM2OS45MDkyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjM1NS42NDU5IiB4Mj0iMzU1LjY0NTkiIHkxPSI0MDkuODc3OSIgeTI9IjQzMy4wMjY0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNTEuNjQ1OSw0MjMuMDI2NCwzNTUuNjQ1OSw0MzMuMDI2NCwzNTkuNjQ1OSw0MjMuMDI2NCwzNTUuNjQ1OSw0MjcuMDI2NCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcxLjk5OTYiIHg9IjExNC4zMjI5IiB5PSI2Ni43NSI+JiMyNjM3NzsmIzIwNzY3OyYjMjU5MDM7JiMzMjEwMjs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTgiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzEuOTk5NiIgeD0iMzkxLjk2ODQiIHk9IjY2Ljc1Ij4mIzI4OTYxOyYjMjA3Njc7JiMyNTkwMzsmIzMyMTAyOzwvdGV4dD48P3BsYW50dW1sLXNyYyBWTDNESWlEMDZCcGxLbUh5MEVfcnZpTUJCbzRPajUxSUlUVFIzYnJEc2dIZUlER01qS2ZSLWFFV08yNmZERDNPRmlwY3NzbkVWR0t0MTZuMHFqbGkzWkZwcFUwZ2hpYUkteDEwN3gyTkhWOHpleUhCejU3WC1ITDd4em1wZUpyQmQxUDJzajV2elVlUWR6UGtQUXNlcXIwM053V09MVFlkbXRmbHpFdTk5WnFNVTYyT2JDblh4Q0ZaeVdHZlRJbkJRY1EwUURFOXJydGsxUkpmOGk0cGt2LXNOVWJPNFpXRUUtZHk1VUs4eDQ2eTZHYzJadF9XY0kxUGtQR283dUdncTFkMlFZZS1ISG1GOFoyY3ZINDIyTHhPUGF4LUFlX1JjcExtX1VRbHRQYWdvdWZNdEU1bUZVdzdTTVlOUHdUM1huOHRiLXdCeDI4cGNNb1dQUjI3MVVqbG5USUtSN1VIelJ5WDMtdjVlaFk0TUxyQXowQ3h2YVZiOGR6VE5sS04/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h2 id="265">26.5 リレーションと楽観ロックの設計<a class="headerlink" href="#265" title="Permanent link">&para;</a></h2>
<h3 id="mybatis-resultmap">MyBatis ネストした ResultMap によるリレーション設定<a class="headerlink" href="#mybatis-resultmap" title="Permanent link">&para;</a></h3>
<p>外注委託データは、支給→支給明細、消費→消費明細 の親子関係と、支給→発注明細、消費→支給 の参照関係を持ちます。MyBatis でこれらの関係を効率的に取得するための設定を実装します。</p>
<h4 id="resultmap">ネストした ResultMap の定義<a class="headerlink" href="#resultmap" title="Permanent link">&para;</a></h4>
<details>
<summary>SupplyMapper.xml（リレーション設定）</summary>

<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="cm">&lt;!-- src/main/resources/mapper/SupplyMapper.xml --&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.mapper.SupplyMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 支給データ ResultMap（明細・発注明細込み） --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;supplyWithRelationsResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Supply&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_支給番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;purchaseOrderNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_発注番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_発注行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_取引先コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_支給日&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierPersonCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_支給担当者コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyType&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_支給区分&quot;</span>
<span class="w">                </span><span class="na">typeHandler=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.typehandler.SupplyTypeTypeHandler&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_バージョン&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_作成者&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedBy&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_更新者&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 発注明細との N:1 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;purchaseOrderDetail&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.pms.domain.model.purchase.PurchaseOrderDetail&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;pod_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;purchaseOrderNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;pod_発注番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;pod_発注行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;pod_品目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;orderQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;pod_発注数量&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;unitPrice&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;pod_発注単価&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 取引先との N:1 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplier&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.pms.domain.model.supplier.Supplier&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sup_取引先コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierName&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sup_取引先名&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 支給明細との 1:N 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;details&quot;</span><span class="w"> </span><span class="na">ofType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.SupplyDetail&quot;</span>
<span class="w">                    </span><span class="na">resultMap=</span><span class="s">&quot;supplyDetailNestedResultMap&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 支給明細のネスト ResultMap --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;supplyDetailNestedResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.SupplyDetail&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_品目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給数&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;unitPrice&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給単価&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;amount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumedQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_消費済数量&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remainingQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_残数量&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_バージョン&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 品目マスタとの N:1 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;item&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.pms.domain.model.item.Item&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;i_品目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemName&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;i_品名&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;unit&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;i_単位&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- JOIN による一括取得クエリ --&gt;</span>
<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findWithRelationsBySupplyNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;supplyWithRelationsResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT
<span class="w">            </span>--<span class="w"> </span>支給データ
<span class="w">            </span>s.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>s_ID,
<span class="w">            </span>s.&quot;支給番号&quot;<span class="w"> </span>AS<span class="w"> </span>s_支給番号,
<span class="w">            </span>s.&quot;発注番号&quot;<span class="w"> </span>AS<span class="w"> </span>s_発注番号,
<span class="w">            </span>s.&quot;発注行番号&quot;<span class="w"> </span>AS<span class="w"> </span>s_発注行番号,
<span class="w">            </span>s.&quot;取引先コード&quot;<span class="w"> </span>AS<span class="w"> </span>s_取引先コード,
<span class="w">            </span>s.&quot;支給日&quot;<span class="w"> </span>AS<span class="w"> </span>s_支給日,
<span class="w">            </span>s.&quot;支給担当者コード&quot;<span class="w"> </span>AS<span class="w"> </span>s_支給担当者コード,
<span class="w">            </span>s.&quot;支給区分&quot;<span class="w"> </span>AS<span class="w"> </span>s_支給区分,
<span class="w">            </span>s.&quot;備考&quot;<span class="w"> </span>AS<span class="w"> </span>s_備考,
<span class="w">            </span>s.&quot;バージョン&quot;<span class="w"> </span>AS<span class="w"> </span>s_バージョン,
<span class="w">            </span>s.&quot;作成日時&quot;<span class="w"> </span>AS<span class="w"> </span>s_作成日時,
<span class="w">            </span>s.&quot;作成者&quot;<span class="w"> </span>AS<span class="w"> </span>s_作成者,
<span class="w">            </span>s.&quot;更新日時&quot;<span class="w"> </span>AS<span class="w"> </span>s_更新日時,
<span class="w">            </span>s.&quot;更新者&quot;<span class="w"> </span>AS<span class="w"> </span>s_更新者,
<span class="w">            </span>--<span class="w"> </span>発注明細データ
<span class="w">            </span>pod.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>pod_ID,
<span class="w">            </span>pod.&quot;発注番号&quot;<span class="w"> </span>AS<span class="w"> </span>pod_発注番号,
<span class="w">            </span>pod.&quot;発注行番号&quot;<span class="w"> </span>AS<span class="w"> </span>pod_発注行番号,
<span class="w">            </span>pod.&quot;品目コード&quot;<span class="w"> </span>AS<span class="w"> </span>pod_品目コード,
<span class="w">            </span>pod.&quot;発注数量&quot;<span class="w"> </span>AS<span class="w"> </span>pod_発注数量,
<span class="w">            </span>pod.&quot;発注単価&quot;<span class="w"> </span>AS<span class="w"> </span>pod_発注単価,
<span class="w">            </span>--<span class="w"> </span>取引先マスタ
<span class="w">            </span>sup.&quot;取引先コード&quot;<span class="w"> </span>AS<span class="w"> </span>sup_取引先コード,
<span class="w">            </span>sup.&quot;取引先名&quot;<span class="w"> </span>AS<span class="w"> </span>sup_取引先名,
<span class="w">            </span>--<span class="w"> </span>支給明細データ
<span class="w">            </span>sd.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>sd_ID,
<span class="w">            </span>sd.&quot;支給番号&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給番号,
<span class="w">            </span>sd.&quot;支給行番号&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給行番号,
<span class="w">            </span>sd.&quot;品目コード&quot;<span class="w"> </span>AS<span class="w"> </span>sd_品目コード,
<span class="w">            </span>sd.&quot;支給数&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給数,
<span class="w">            </span>sd.&quot;支給単価&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給単価,
<span class="w">            </span>sd.&quot;支給金額&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給金額,
<span class="w">            </span>sd.&quot;消費済数量&quot;<span class="w"> </span>AS<span class="w"> </span>sd_消費済数量,
<span class="w">            </span>sd.&quot;残数量&quot;<span class="w"> </span>AS<span class="w"> </span>sd_残数量,
<span class="w">            </span>sd.&quot;備考&quot;<span class="w"> </span>AS<span class="w"> </span>sd_備考,
<span class="w">            </span>sd.&quot;バージョン&quot;<span class="w"> </span>AS<span class="w"> </span>sd_バージョン,
<span class="w">            </span>--<span class="w"> </span>品目マスタ
<span class="w">            </span>i.&quot;品目コード&quot;<span class="w"> </span>AS<span class="w"> </span>i_品目コード,
<span class="w">            </span>i.&quot;品名&quot;<span class="w"> </span>AS<span class="w"> </span>i_品名,
<span class="w">            </span>i.&quot;単位&quot;<span class="w"> </span>AS<span class="w"> </span>i_単位
<span class="w">        </span>FROM<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>s
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;発注明細データ&quot;<span class="w"> </span>pod
<span class="w">            </span>ON<span class="w"> </span>s.&quot;発注番号&quot;<span class="w"> </span>=<span class="w"> </span>pod.&quot;発注番号&quot;<span class="w"> </span>AND<span class="w"> </span>s.&quot;発注行番号&quot;<span class="w"> </span>=<span class="w"> </span>pod.&quot;発注行番号&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;取引先マスタ&quot;<span class="w"> </span>sup<span class="w"> </span>ON<span class="w"> </span>s.&quot;取引先コード&quot;<span class="w"> </span>=<span class="w"> </span>sup.&quot;取引先コード&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>sd<span class="w"> </span>ON<span class="w"> </span>s.&quot;支給番号&quot;<span class="w"> </span>=<span class="w"> </span>sd.&quot;支給番号&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;品目マスタ&quot;<span class="w"> </span>i<span class="w"> </span>ON<span class="w"> </span>sd.&quot;品目コード&quot;<span class="w"> </span>=<span class="w"> </span>i.&quot;品目コード&quot;
<span class="w">            </span>AND<span class="w"> </span>i.&quot;適用開始日&quot;<span class="w"> </span>=<span class="w"> </span>(
<span class="w">                </span>SELECT<span class="w"> </span>MAX(&quot;適用開始日&quot;)<span class="w"> </span>FROM<span class="w"> </span>&quot;品目マスタ&quot;
<span class="w">                </span>WHERE<span class="w"> </span>&quot;品目コード&quot;<span class="w"> </span>=<span class="w"> </span>sd.&quot;品目コード&quot;
<span class="w">                </span>AND<span class="w"> </span>&quot;適用開始日&quot;<span class="w"> </span><span class="err">&lt;</span>=<span class="w"> </span>CURRENT_DATE
<span class="w">            </span>)
<span class="w">        </span>WHERE<span class="w"> </span>s.&quot;支給番号&quot;<span class="w"> </span>=<span class="w"> </span>#{supplyNumber}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>sd.&quot;支給行番号&quot;
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<details>
<summary>ConsumptionMapper.xml（リレーション設定）</summary>

<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="cm">&lt;!-- src/main/resources/mapper/ConsumptionMapper.xml --&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.mapper.ConsumptionMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 消費データ ResultMap（明細・支給データ込み） --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;consumptionWithRelationsResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Consumption&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumptionNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_消費番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_支給番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;receivingNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_入荷受入番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumptionDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_消費日&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_バージョン&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;c_更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 支給データとの N:1 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supply&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Supply&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_支給番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplierCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_取引先コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_支給日&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyType&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;s_支給区分&quot;</span>
<span class="w">                    </span><span class="na">typeHandler=</span><span class="s">&quot;com.example.pms.infrastructure.out.persistence.typehandler.SupplyTypeTypeHandler&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 入荷データとの N:1 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;receiving&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.pms.domain.model.purchase.Receiving&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;r_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;receivingNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;r_入荷受入番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;receivingDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;r_入荷日&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;receivedQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;r_入荷数量&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 消費明細との 1:N 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;collection</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;details&quot;</span><span class="w"> </span><span class="na">ofType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.ConsumptionDetail&quot;</span>
<span class="w">                    </span><span class="na">resultMap=</span><span class="s">&quot;consumptionDetailNestedResultMap&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 消費明細のネスト ResultMap --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;consumptionDetailNestedResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.ConsumptionDetail&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumptionNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_消費番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_消費行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyDetailId&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_支給明細ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;itemCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_品目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;consumedQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_消費数量&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;yieldRate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_歩留率&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remarks&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_備考&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;cd_バージョン&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 支給明細との N:1 関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyDetail&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.SupplyDetail&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_ID&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;supplyNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;lineNumber&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給行番号&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_支給数&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;remainingQuantity&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;sd_残数量&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- JOIN による一括取得クエリ --&gt;</span>
<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findWithRelationsByConsumptionNumber&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;consumptionWithRelationsResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT
<span class="w">            </span>--<span class="w"> </span>消費データ
<span class="w">            </span>c.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>c_ID,
<span class="w">            </span>c.&quot;消費番号&quot;<span class="w"> </span>AS<span class="w"> </span>c_消費番号,
<span class="w">            </span>c.&quot;支給番号&quot;<span class="w"> </span>AS<span class="w"> </span>c_支給番号,
<span class="w">            </span>c.&quot;入荷受入番号&quot;<span class="w"> </span>AS<span class="w"> </span>c_入荷受入番号,
<span class="w">            </span>c.&quot;消費日&quot;<span class="w"> </span>AS<span class="w"> </span>c_消費日,
<span class="w">            </span>c.&quot;備考&quot;<span class="w"> </span>AS<span class="w"> </span>c_備考,
<span class="w">            </span>c.&quot;バージョン&quot;<span class="w"> </span>AS<span class="w"> </span>c_バージョン,
<span class="w">            </span>c.&quot;作成日時&quot;<span class="w"> </span>AS<span class="w"> </span>c_作成日時,
<span class="w">            </span>c.&quot;更新日時&quot;<span class="w"> </span>AS<span class="w"> </span>c_更新日時,
<span class="w">            </span>--<span class="w"> </span>支給データ
<span class="w">            </span>s.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>s_ID,
<span class="w">            </span>s.&quot;支給番号&quot;<span class="w"> </span>AS<span class="w"> </span>s_支給番号,
<span class="w">            </span>s.&quot;取引先コード&quot;<span class="w"> </span>AS<span class="w"> </span>s_取引先コード,
<span class="w">            </span>s.&quot;支給日&quot;<span class="w"> </span>AS<span class="w"> </span>s_支給日,
<span class="w">            </span>s.&quot;支給区分&quot;<span class="w"> </span>AS<span class="w"> </span>s_支給区分,
<span class="w">            </span>--<span class="w"> </span>入荷データ
<span class="w">            </span>r.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>r_ID,
<span class="w">            </span>r.&quot;入荷受入番号&quot;<span class="w"> </span>AS<span class="w"> </span>r_入荷受入番号,
<span class="w">            </span>r.&quot;入荷日&quot;<span class="w"> </span>AS<span class="w"> </span>r_入荷日,
<span class="w">            </span>r.&quot;入荷数量&quot;<span class="w"> </span>AS<span class="w"> </span>r_入荷数量,
<span class="w">            </span>--<span class="w"> </span>消費明細データ
<span class="w">            </span>cd.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>cd_ID,
<span class="w">            </span>cd.&quot;消費番号&quot;<span class="w"> </span>AS<span class="w"> </span>cd_消費番号,
<span class="w">            </span>cd.&quot;消費行番号&quot;<span class="w"> </span>AS<span class="w"> </span>cd_消費行番号,
<span class="w">            </span>cd.&quot;支給明細ID&quot;<span class="w"> </span>AS<span class="w"> </span>cd_支給明細ID,
<span class="w">            </span>cd.&quot;品目コード&quot;<span class="w"> </span>AS<span class="w"> </span>cd_品目コード,
<span class="w">            </span>cd.&quot;消費数量&quot;<span class="w"> </span>AS<span class="w"> </span>cd_消費数量,
<span class="w">            </span>cd.&quot;歩留率&quot;<span class="w"> </span>AS<span class="w"> </span>cd_歩留率,
<span class="w">            </span>cd.&quot;備考&quot;<span class="w"> </span>AS<span class="w"> </span>cd_備考,
<span class="w">            </span>cd.&quot;バージョン&quot;<span class="w"> </span>AS<span class="w"> </span>cd_バージョン,
<span class="w">            </span>--<span class="w"> </span>支給明細データ
<span class="w">            </span>sd.&quot;ID&quot;<span class="w"> </span>AS<span class="w"> </span>sd_ID,
<span class="w">            </span>sd.&quot;支給番号&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給番号,
<span class="w">            </span>sd.&quot;支給行番号&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給行番号,
<span class="w">            </span>sd.&quot;支給数&quot;<span class="w"> </span>AS<span class="w"> </span>sd_支給数,
<span class="w">            </span>sd.&quot;残数量&quot;<span class="w"> </span>AS<span class="w"> </span>sd_残数量
<span class="w">        </span>FROM<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>c
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;支給データ&quot;<span class="w"> </span>s<span class="w"> </span>ON<span class="w"> </span>c.&quot;支給番号&quot;<span class="w"> </span>=<span class="w"> </span>s.&quot;支給番号&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;入荷受入データ&quot;<span class="w"> </span>r<span class="w"> </span>ON<span class="w"> </span>c.&quot;入荷受入番号&quot;<span class="w"> </span>=<span class="w"> </span>r.&quot;入荷受入番号&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;消費明細データ&quot;<span class="w"> </span>cd<span class="w"> </span>ON<span class="w"> </span>c.&quot;消費番号&quot;<span class="w"> </span>=<span class="w"> </span>cd.&quot;消費番号&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>sd<span class="w"> </span>ON<span class="w"> </span>cd.&quot;支給明細ID&quot;<span class="w"> </span>=<span class="w"> </span>sd.&quot;ID&quot;
<span class="w">        </span>WHERE<span class="w"> </span>c.&quot;消費番号&quot;<span class="w"> </span>=<span class="w"> </span>#{consumptionNumber}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>cd.&quot;消費行番号&quot;
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<h4 id="_18">リレーション設定のポイント<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>設定項目</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;collection&gt;</code></td>
<td>支給→支給明細、消費→消費明細 の 1:N 関連</td>
</tr>
<tr>
<td><code>&lt;association&gt;</code></td>
<td>支給→発注明細、消費→支給、消費明細→支給明細 の N:1 関連</td>
</tr>
<tr>
<td>エイリアス</td>
<td><code>s_</code>（支給）、<code>sd_</code>（支給明細）、<code>c_</code>（消費）、<code>cd_</code>（消費明細）</td>
</tr>
<tr>
<td>残数量管理</td>
<td>支給明細の残数量を消費時に更新</td>
</tr>
</tbody>
</table>
<h3 id="_19">楽観ロックの実装<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>支給と消費は同時に複数ユーザーが操作する可能性があり、特に残数量の整合性を保つために楽観ロックが重要です。</p>
<h4 id="flyway">Flyway マイグレーション: バージョンカラム追加<a class="headerlink" href="#flyway" title="Permanent link">&para;</a></h4>
<details>
<summary>V012__add_subcontract_version_columns.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- src/main/resources/db/migration/V012__add_subcontract_version_columns.sql</span>

<span class="c1">-- 支給データテーブルにバージョンカラムを追加</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;支給データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- 支給明細データテーブルにバージョンカラムと残数量を追加</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;消費済数量&quot;</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;残数量&quot;</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- 残数量の初期値を設定（支給数と同じ）</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="ss">&quot;残数量&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;支給数&quot;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="ss">&quot;残数量&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;残数量&quot;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- 消費データテーブルにバージョンカラムを追加</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;消費データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- 消費明細データテーブルにバージョンカラムを追加</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;消費明細データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- コメント追加</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;支給データ&quot;</span><span class="p">.</span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;楽観ロック用バージョン番号&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="p">.</span><span class="ss">&quot;消費済数量&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;消費済の数量&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="p">.</span><span class="ss">&quot;残数量&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;未消費の残数量&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;支給明細データ&quot;</span><span class="p">.</span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;楽観ロック用バージョン番号&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;消費データ&quot;</span><span class="p">.</span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;楽観ロック用バージョン番号&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;消費明細データ&quot;</span><span class="p">.</span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;楽観ロック用バージョン番号&#39;</span><span class="p">;</span>
</code></pre></div>

</details>

<h4 id="_20">エンティティへのバージョンフィールド追加<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<details>
<summary>Supply.java（バージョンフィールド追加）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/domain/model/subcontract/Supply.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.supplier.Supplier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.purchase.PurchaseOrderDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Supply</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">purchaseOrderNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">supplyDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplierPersonCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyType</span><span class="w"> </span><span class="n">supplyType</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">updatedBy</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 楽観ロック用バージョン</span>
<span class="w">    </span><span class="nd">@Builder.Default</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PurchaseOrderDetail</span><span class="w"> </span><span class="n">purchaseOrderDetail</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Supplier</span><span class="w"> </span><span class="n">supplier</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Builder.Default</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>SupplyDetail.java（バージョン・残数量追加）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/domain/model/subcontract/SupplyDetail.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.item.Item</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SupplyDetail</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">itemCode</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">remainingQuantity</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">remarks</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 楽観ロック用バージョン</span>
<span class="w">    </span><span class="nd">@Builder.Default</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Supply</span><span class="w"> </span><span class="n">supply</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 消費可能かどうかを判定</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">canConsume</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">requestedQuantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">remainingQuantity</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">requestedQuantity</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="mybatis-mapper">MyBatis Mapper: 楽観ロック対応の更新<a class="headerlink" href="#mybatis-mapper" title="Permanent link">&para;</a></h4>
<details>
<summary>SupplyDetailMapper.xml（楽観ロック対応 UPDATE）</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 消費数量更新（楽観ロック対応） --&gt;</span>
<span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateConsumedQuantityWithOptimisticLock&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>UPDATE<span class="w"> </span>&quot;支給明細データ&quot;
<span class="w">    </span>SET
<span class="w">        </span>&quot;消費済数量&quot;<span class="w"> </span>=<span class="w"> </span>&quot;消費済数量&quot;<span class="w"> </span>+<span class="w"> </span>#{consumedQuantity},
<span class="w">        </span>&quot;残数量&quot;<span class="w"> </span>=<span class="w"> </span>&quot;残数量&quot;<span class="w"> </span>-<span class="w"> </span>#{consumedQuantity},
<span class="w">        </span>&quot;更新日時&quot;<span class="w"> </span>=<span class="w"> </span>CURRENT_TIMESTAMP,
<span class="w">        </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>+<span class="w"> </span>1
<span class="w">    </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="w">    </span>AND<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>#{version}
<span class="w">    </span>AND<span class="w"> </span>&quot;残数量&quot;<span class="w"> </span>&gt;=<span class="w"> </span>#{consumedQuantity}
<span class="nt">&lt;/update&gt;</span>

<span class="cm">&lt;!-- 残数量チェック付き更新（楽観ロック + 業務制約） --&gt;</span>
<span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;consumeWithValidation&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>UPDATE<span class="w"> </span>&quot;支給明細データ&quot;
<span class="w">    </span>SET
<span class="w">        </span>&quot;消費済数量&quot;<span class="w"> </span>=<span class="w"> </span>&quot;消費済数量&quot;<span class="w"> </span>+<span class="w"> </span>#{consumedQuantity},
<span class="w">        </span>&quot;残数量&quot;<span class="w"> </span>=<span class="w"> </span>&quot;残数量&quot;<span class="w"> </span>-<span class="w"> </span>#{consumedQuantity},
<span class="w">        </span>&quot;更新日時&quot;<span class="w"> </span>=<span class="w"> </span>CURRENT_TIMESTAMP,
<span class="w">        </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>+<span class="w"> </span>1
<span class="w">    </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="w">    </span>AND<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>#{version}
<span class="w">    </span>AND<span class="w"> </span>&quot;残数量&quot;<span class="w"> </span>&gt;=<span class="w"> </span>#{consumedQuantity}
<span class="nt">&lt;/update&gt;</span>

<span class="cm">&lt;!-- 現在のバージョン取得 --&gt;</span>
<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findVersionById&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;java.lang.Integer&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>FROM<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="nt">&lt;/select&gt;</span>

<span class="cm">&lt;!-- 残数量取得 --&gt;</span>
<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findRemainingQuantityById&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;java.math.BigDecimal&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT<span class="w"> </span>&quot;残数量&quot;<span class="w"> </span>FROM<span class="w"> </span>&quot;支給明細データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="nt">&lt;/select&gt;</span>
</code></pre></div>

</details>

<details>
<summary>ConsumptionMapper.xml（楽観ロック対応 UPDATE）</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 楽観ロック対応の更新 --&gt;</span>
<span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateWithOptimisticLock&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.pms.domain.model.subcontract.Consumption&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>UPDATE<span class="w"> </span>&quot;消費データ&quot;
<span class="w">    </span>SET
<span class="w">        </span>&quot;消費日&quot;<span class="w"> </span>=<span class="w"> </span>#{consumptionDate},
<span class="w">        </span>&quot;備考&quot;<span class="w"> </span>=<span class="w"> </span>#{remarks},
<span class="w">        </span>&quot;更新日時&quot;<span class="w"> </span>=<span class="w"> </span>CURRENT_TIMESTAMP,
<span class="w">        </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>+<span class="w"> </span>1
<span class="w">    </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="w">    </span>AND<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>#{version}
<span class="nt">&lt;/update&gt;</span>

<span class="cm">&lt;!-- 現在のバージョン取得 --&gt;</span>
<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findVersionById&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;java.lang.Integer&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>FROM<span class="w"> </span>&quot;消費データ&quot;<span class="w"> </span>WHERE<span class="w"> </span>&quot;ID&quot;<span class="w"> </span>=<span class="w"> </span>#{id}
<span class="nt">&lt;/select&gt;</span>
</code></pre></div>

</details>

<h4 id="repository">Repository 実装: 楽観ロック対応<a class="headerlink" href="#repository" title="Permanent link">&para;</a></h4>
<details>
<summary>SupplyDetailRepositoryImpl.java（楽観ロック対応）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/pms/infrastructure/persistence/repository/SupplyDetailRepositoryImpl.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.out.SupplyDetailRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.exception.InsufficientQuantityException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.exception.OptimisticLockException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.SupplyDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.mapper.SupplyDetailMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="nd">@Repository</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SupplyDetailRepositoryImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">SupplyDetailRepository</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SupplyDetailMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">consumeQuantity</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">updatedCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">updateConsumedQuantityWithOptimisticLock</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">updatedCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 更新失敗の原因を特定</span>
<span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">currentVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">findVersionById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentVersion</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OptimisticLockException</span><span class="p">(</span><span class="s">&quot;支給明細&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">remainingQuantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">findRemainingQuantityById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">remainingQuantity</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">consumedQuantity</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsufficientQuantityException</span><span class="p">(</span>
<span class="w">                        </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;支給明細ID %d の残数量が不足しています（残数: %s, 要求: %s）&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">remainingQuantity</span><span class="p">,</span><span class="w"> </span><span class="n">consumedQuantity</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OptimisticLockException</span><span class="p">(</span><span class="s">&quot;支給明細&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">currentVersion</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">SupplyDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// その他のメソッド...</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="tdd_2">TDD: 楽観ロックのテスト<a class="headerlink" href="#tdd_2" title="Permanent link">&para;</a></h4>
<details>
<summary>SupplyDetailRepositoryOptimisticLockTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/test/java/com/example/pms/infrastructure/persistence/repository/SupplyDetailRepositoryOptimisticLockTest.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.pms.infrastructure.out.persistence.repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.out.SupplyDetailRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.application.port.out.SupplyRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.exception.InsufficientQuantityException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.exception.OptimisticLockException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.Supply</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.SupplyDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.domain.model.subcontract.SupplyType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.pms.testsetup.BaseIntegrationTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;支給明細リポジトリ - 楽観ロック&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">SupplyDetailRepositoryOptimisticLockTest</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">BaseIntegrationTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyRepository</span><span class="w"> </span><span class="n">supplyRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyDetailRepository</span><span class="w"> </span><span class="n">supplyDetailRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">supplyRepository</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;消費数量更新の楽観ロック&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ConsumeQuantityOptimisticLock</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;同じバージョンで消費できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">canConsumeWithSameVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSupply</span><span class="p">(</span><span class="s">&quot;SUP-2025-0001&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSupplyDetail</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyNumber</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">));</span>

<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">fetched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">consumeQuantity</span><span class="p">(</span>
<span class="w">                    </span><span class="n">fetched</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;30&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="n">fetched</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">updated</span><span class="p">.</span><span class="na">getConsumedQuantity</span><span class="p">()).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;30&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">updated</span><span class="p">.</span><span class="na">getRemainingQuantity</span><span class="p">()).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;70&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">updated</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;異なるバージョンで消費すると楽観ロック例外が発生する&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">throwsExceptionWhenVersionMismatch</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSupply</span><span class="p">(</span><span class="s">&quot;SUP-2025-0002&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSupplyDetail</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyNumber</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">));</span>

<span class="w">            </span><span class="c1">// ユーザーAが取得</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">detailA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="c1">// ユーザーBが取得</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">detailB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">get</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// ユーザーAが消費（成功）</span>
<span class="w">            </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">consumeQuantity</span><span class="p">(</span>
<span class="w">                    </span><span class="n">detailA</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;30&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="n">detailA</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Act &amp; Assert: ユーザーBが古いバージョンで消費（失敗）</span>
<span class="w">            </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">consumeQuantity</span><span class="p">(</span>
<span class="w">                            </span><span class="n">detailB</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;40&quot;</span><span class="p">),</span>
<span class="w">                            </span><span class="n">detailB</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">OptimisticLockException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;他のユーザーによって更新されています&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;残数量を超える消費は残数量不足例外が発生する&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">throwsExceptionWhenInsufficientQuantity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSupply</span><span class="p">(</span><span class="s">&quot;SUP-2025-0003&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSupplyDetail</span><span class="p">(</span><span class="n">supply</span><span class="p">.</span><span class="na">getSupplyNumber</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">));</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">fetched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">detail</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">get</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// Act &amp; Assert</span>
<span class="w">            </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">consumeQuantity</span><span class="p">(</span>
<span class="w">                            </span><span class="n">fetched</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;150&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// 残数量100を超える</span>
<span class="w">                            </span><span class="n">fetched</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span>
<span class="w">                    </span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">InsufficientQuantityException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;残数量が不足しています&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Supply</span><span class="w"> </span><span class="nf">createSupply</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Supply</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">purchaseOrderNumber</span><span class="p">(</span><span class="s">&quot;PO-2025-0001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierCode</span><span class="p">(</span><span class="s">&quot;SUP-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplyDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplierPersonCode</span><span class="p">(</span><span class="s">&quot;EMP-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplyType</span><span class="p">(</span><span class="n">SupplyType</span><span class="p">.</span><span class="na">FREE</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">supplyRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">supply</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">supply</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SupplyDetail</span><span class="w"> </span><span class="nf">createSupplyDetail</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">supplyNumber</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lineNumber</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SupplyDetail</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">supplyNumber</span><span class="p">(</span><span class="n">supplyNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="n">lineNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="s">&quot;MAT-001&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;500&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">amount</span><span class="p">(</span><span class="n">quantity</span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;500&quot;</span><span class="p">)))</span>
<span class="w">                </span><span class="p">.</span><span class="na">consumedQuantity</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">remainingQuantity</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">detail</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">detail</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="_21">消費処理における楽観ロックの考慮<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>消費処理では、支給明細の残数量を更新するため、楽観ロックと業務制約（残数量チェック）を組み合わせた処理が必要です。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9Ijc5OXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6OTQzcHg7aGVpZ2h0Ojc5OXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDk0MyA3OTkiIHdpZHRoPSI5NDNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjgwNDA7JiMzNjAyNzsmIzIwOTY2OyYjMjk3MDI7JiMxMjM5MjsmIzI3MDA1OyYjMzUyNTE7JiMxMjUyNTsmIzEyNDgzOyYjMTI0NjM7PC90aXRsZT48ZGVmcy8+PGc+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOS45OTk0IiB4PSI0MDIuNTY5NiIgeT0iMjcuOTk1MSI+JiMyODA0MDsmIzM2MDI3OyYjMjA5NjY7JiMyOTcwMjsmIzEyMzkyOyYjMjcwMDU7JiMzNTI1MTsmIzEyNTI1OyYjMTI0ODM7JiMxMjQ2Mzs8L3RleHQ+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI0MjQuMzM1OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iOTI2LjEzODUiIHg9IjEwIiB5PSIyODAuMjU3OCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMTkwLjYwMTYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjkwNi4xMzg1IiB4PSIyMCIgeT0iNDUwLjA1NDciLz48ZyBjbGFzcz0icGFydGljaXBhbnQtbGlmZWxpbmUiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbnN1bWVTdmMiIGlkPSJwYXJ0MS1saWZlbGluZSI+PGc+PHRpdGxlPi4uLi4uLjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjYxNyIgd2lkdGg9IjgiIHg9Ijc0Ljk5OTgiIHk9IjEwNC41OTM4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNzgiIHgyPSI3OCIgeTE9IjEwNC41OTM4IiB5Mj0iNzIxLjU5MzgiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MiIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iU0RSZXBvIiBpZD0icGFydDItbGlmZWxpbmUiPjxnPjx0aXRsZT4uLi4uLi4uLi48L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI2MTciIHdpZHRoPSI4IiB4PSI0NjQuMTQ4NyIgeT0iMTA0LjU5MzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI0NjcuMTQ5IiB4Mj0iNDY3LjE0OSIgeTE9IjEwNC41OTM4IiB5Mj0iNzIxLjU5MzgiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29uUmVwbyIgaWQ9InBhcnQzLWxpZmVsaW5lIj48Zz48dGl0bGU+Li4uLi4uLjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjYxNyIgd2lkdGg9IjgiIHg9IjYwMC4xNDgzIiB5PSIxMDQuNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjYwMy4xNDg1IiB4Mj0iNjAzLjE0ODUiIHkxPSIxMDQuNTkzOCIgeTI9IjcyMS41OTM4Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQtbGlmZWxpbmUiIGRhdGEtZW50aXR5LXVpZD0icGFydDQiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRCIiBpZD0icGFydDQtbGlmZWxpbmUiPjxnPjx0aXRsZT5EQjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjYxNyIgd2lkdGg9IjgiIHg9Ijg5NC4xMzg1IiB5PSIxMDQuNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9Ijg5OC4xMzg1IiB4Mj0iODk4LjEzODUiIHkxPSIxMDQuNTkzOCIgeTI9IjcyMS41OTM4Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29uc3VtZVN2YyIgaWQ9InBhcnQxLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTcuOTk5NiIgeD0iMzAiIHk9IjczLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIzNyIgeT0iOTMuMjkyIj4mIzI4MDQwOyYjMzYwMjc7JiMxMjQ2OTsmIzEyNTQwOyYjMTI0OTk7JiMxMjQ3Mzs8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb25zdW1lU3ZjIiBpZD0icGFydDEtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5Ny45OTk2IiB4PSIzMCIgeT0iNzIwLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIzNyIgeT0iNzQwLjU4ODkiPiYjMjgwNDA7JiMzNjAyNzsmIzEyNDY5OyYjMTI1NDA7JiMxMjQ5OTsmIzEyNDczOzwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlNEUmVwbyIgaWQ9InBhcnQyLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM5Ljk5OTUiIHg9IjM5OC4xNDkiIHk9IjczLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iNDA1LjE0OSIgeT0iOTMuMjkyIj4mIzI1OTAzOyYjMzIxMDI7JiMyNjEyNjsmIzMyMDQ4OyYjMTI1MjI7JiMxMjUwOTsmIzEyNDcyOyYjMTI0ODg7JiMxMjUyMjs8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJTRFJlcG8iIGlkPSJwYXJ0Mi10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzOS45OTk1IiB4PSIzOTguMTQ5IiB5PSI3MjAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSI0MDUuMTQ5IiB5PSI3NDAuNTg4OSI+JiMyNTkwMzsmIzMyMTAyOyYjMjYxMjY7JiMzMjA0ODsmIzEyNTIyOyYjMTI1MDk7JiMxMjQ3MjsmIzEyNDg4OyYjMTI1MjI7PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29uUmVwbyIgaWQ9InBhcnQzLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTExLjk5OTYiIHg9IjU0OC4xNDg1IiB5PSI3My4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iNTU1LjE0ODUiIHk9IjkzLjI5MiI+JiMyODA0MDsmIzM2MDI3OyYjMTI1MjI7JiMxMjUwOTsmIzEyNDcyOyYjMTI0ODg7JiMxMjUyMjs8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb25SZXBvIiBpZD0icGFydDMtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTEuOTk5NiIgeD0iNTQ4LjE0ODUiIHk9IjcyMC41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iNTU1LjE0ODUiIHk9Ijc0MC41ODg5Ij4mIzI4MDQwOyYjMzYwMjc7JiMxMjUyMjsmIzEyNTA5OyYjMTI0NzI7JiMxMjQ4ODsmIzEyNTIyOzwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDQiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRCIiBpZD0icGFydDQtaGVhZCI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjAuMzg0OCIgeD0iODg0Ljk0NjIiIHk9IjEwMS4yOTIiPkRCPC90ZXh0PjxwYXRoIGQ9Ik04ODAuMTM4NSw1Mi4yOTY5IEM4ODAuMTM4NSw0Mi4yOTY5IDg5OC4xMzg1LDQyLjI5NjkgODk4LjEzODUsNDIuMjk2OSBDODk4LjEzODUsNDIuMjk2OSA5MTYuMTM4NSw0Mi4yOTY5IDkxNi4xMzg1LDUyLjI5NjkgTDkxNi4xMzg1LDc4LjI5NjkgQzkxNi4xMzg1LDg4LjI5NjkgODk4LjEzODUsODguMjk2OSA4OTguMTM4NSw4OC4yOTY5IEM4OTguMTM4NSw4OC4yOTY5IDg4MC4xMzg1LDg4LjI5NjkgODgwLjEzODUsNzguMjk2OSBMODgwLjEzODUsNTIuMjk2OSIgZmlsbD0iI0UyRTJGMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTg4MC4xMzg1LDUyLjI5NjkgQzg4MC4xMzg1LDYyLjI5NjkgODk4LjEzODUsNjIuMjk2OSA4OTguMTM4NSw2Mi4yOTY5IEM4OTguMTM4NSw2Mi4yOTY5IDkxNi4xMzg1LDYyLjI5NjkgOTE2LjEzODUsNTIuMjk2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ0IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJEQiIgaWQ9InBhcnQ0LXRhaWwiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwLjM4NDgiIHg9Ijg4NC45NDYyIiB5PSI3MzMuNTg4OSI+REI8L3RleHQ+PHBhdGggZD0iTTg4MC4xMzg1LDc0Ni44OTA2IEM4ODAuMTM4NSw3MzYuODkwNiA4OTguMTM4NSw3MzYuODkwNiA4OTguMTM4NSw3MzYuODkwNiBDODk4LjEzODUsNzM2Ljg5MDYgOTE2LjEzODUsNzM2Ljg5MDYgOTE2LjEzODUsNzQ2Ljg5MDYgTDkxNi4xMzg1LDc3Mi44OTA2IEM5MTYuMTM4NSw3ODIuODkwNiA4OTguMTM4NSw3ODIuODkwNiA4OTguMTM4NSw3ODIuODkwNiBDODk4LjEzODUsNzgyLjg5MDYgODgwLjEzODUsNzgyLjg5MDYgODgwLjEzODUsNzcyLjg5MDYgTDg4MC4xMzg1LDc0Ni44OTA2IiBmaWxsPSIjRTJFMkYwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODgwLjEzODUsNzQ2Ljg5MDYgQzg4MC4xMzg1LDc1Ni44OTA2IDg5OC4xMzg1LDc1Ni44OTA2IDg5OC4xMzg1LDc1Ni44OTA2IEM4OTguMTM4NSw3NTYuODkwNiA5MTYuMTM4NSw3NTYuODkwNiA5MTYuMTM4NSw3NDYuODkwNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ1Ni4xNDg3LDEzMS43MjY2LDQ2Ni4xNDg3LDEzNS43MjY2LDQ1Ni4xNDg3LDEzOS43MjY2LDQ2MC4xNDg3LDEzNS43MjY2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc4Ljk5OTgiIHgyPSI0NjIuMTQ4NyIgeTE9IjEzNS43MjY2IiB5Mj0iMTM1LjcyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTYuNzIzNiIgeD0iODUuOTk5OCIgeT0iMTMwLjY2MDYiPmZpbmRCeUlkKHN1cHBseURldGFpbElkKTwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0NCIgaWQ9Im1zZzIiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODg2LjEzODUsMTYwLjg1OTQsODk2LjEzODUsMTY0Ljg1OTQsODg2LjEzODUsMTY4Ljg1OTQsODkwLjEzODUsMTY0Ljg1OTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDY4LjE0ODciIHgyPSI4OTIuMTM4NSIgeTE9IjE2NC44NTk0IiB5Mj0iMTY0Ljg1OTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjEuNzI1NiIgeD0iNDc1LjE0ODciIHk9IjE1OS43OTM1Ij5TRUxFQ1QgLi4uIFdIRVJFIElEID0gPzwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQ0IiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzMiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDc5LjE0ODcsMTg5Ljk5MjIsNDY5LjE0ODcsMTkzLjk5MjIsNDc5LjE0ODcsMTk3Ljk5MjIsNDc1LjE0ODcsMTkzLjk5MjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDczLjE0ODciIHgyPSI4OTcuMTM4NSIgeTE9IjE5My45OTIyIiB5Mj0iMTkzLjk5MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjEuMDAwMyIgeD0iNDg1LjE0ODciIHk9IjE4OC45MjYzIj4mIzI1OTAzOyYjMzIxMDI7JiMyNjEyNjsmIzMyMDQ4OyYjNjUyODg7JiMxMjQ5NjsmIzEyNTQwOyYjMTI0NzI7JiMxMjUxOTsmIzEyNTMxOyYjMTI1Mzk7JiMyNzUzMTsmIzI1OTY4OyYjMzczMjc7JiMzNjc5NjsmIzEyNDE1OyYjNjUyODk7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDIiIGRhdGEtZW50aXR5LTI9InBhcnQxIiBpZD0ibXNnNCI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4OS45OTk4LDIxOS4xMjUsNzkuOTk5OCwyMjMuMTI1LDg5Ljk5OTgsMjI3LjEyNSw4NS45OTk4LDIyMy4xMjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iODMuOTk5OCIgeDI9IjQ2Ny4xNDg3IiB5MT0iMjIzLjEyNSIgeTI9IjIyMy4xMjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Mi41OTU3IiB4PSI5NS45OTk4IiB5PSIyMTguMDU5MSI+U3VwcGx5RGV0YWlsPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDEiIGRhdGEtZW50aXR5LTI9InBhcnQxIiBpZD0ibXNnNSI+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc4Ljk5OTgiIHgyPSIxMjAuOTk5OCIgeTE9IjI1Mi4yNTc4IiB5Mj0iMjUyLjI1NzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTIwLjk5OTgiIHgyPSIxMjAuOTk5OCIgeTE9IjI1Mi4yNTc4IiB5Mj0iMjY1LjI1NzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzkuOTk5OCIgeDI9IjEyMC45OTk4IiB5MT0iMjY1LjI1NzgiIHkyPSIyNjUuMjU3OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODkuOTk5OCwyNjEuMjU3OCw3OS45OTk4LDI2NS4yNTc4LDg5Ljk5OTgsMjY5LjI1NzgsODUuOTk5OCwyNjUuMjU3OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9Ijg1Ljk5OTgiIHk9IjI0Ny4xOTE5Ij4mIzI3NTMxOyYjMjU5Njg7JiMzNzMyNzsmIzEyNDgxOyYjMTI0NTU7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48L2c+PHBhdGggZD0iTTEwLDI4MC4yNTc4IEw3NC40NDI5LDI4MC4yNTc4IEw3NC40NDI5LDI4Ny4zOTA2IEw2NC40NDI5LDI5Ny4zOTA2IEwxMCwyOTcuMzkwNiBMMTAsMjgwLjI1NzgiIGZpbGw9IiNFRUVFRUUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNDI0LjMzNTkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjkyNi4xMzg1IiB4PSIxMCIgeT0iMjgwLjI1NzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkuNDQyOSIgeD0iMjUiIHk9IjI5My4zMjQ3Ij5hbHQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMy4xNDY5IiB4PSI4OS40NDI5IiB5PSIyOTIuNDY4MyI+WyYjMjc1MzE7JiMyNTk2ODsmIzM3MzI3OyAmZ3Q7PSAmIzI4MDQwOyYjMzYwMjc7JiMyNTk2ODsmIzM3MzI3O108L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzYiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTkyLjE0ODMsMzE0LjUyMzQsNjAyLjE0ODMsMzE4LjUyMzQsNTkyLjE0ODMsMzIyLjUyMzQsNTk2LjE0ODMsMzE4LjUyMzQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzguOTk5OCIgeDI9IjU5OC4xNDgzIiB5MT0iMzE4LjUyMzQiIHkyPSIzMTguNTIzNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNC43NDQxIiB4PSI4NS45OTk4IiB5PSIzMTMuNDU3NSI+c2F2ZShjb25zdW1wdGlvbik8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDQiIGlkPSJtc2c3Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg4Ni4xMzg1LDM0My42NTYzLDg5Ni4xMzg1LDM0Ny42NTYzLDg4Ni4xMzg1LDM1MS42NTYzLDg5MC4xMzg1LDM0Ny42NTYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjYwNC4xNDgzIiB4Mj0iODkyLjEzODUiIHkxPSIzNDcuNjU2MyIgeTI9IjM0Ny42NTYzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUxLjk5NDciIHg9IjYxMS4xNDgzIiB5PSIzNDIuNTkwMyI+SU5TRVJUIElOVE8gJiMyODA0MDsmIzM2MDI3OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQ0IiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzgiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjE1LjE0ODMsMzcyLjc4OTEsNjA1LjE0ODMsMzc2Ljc4OTEsNjE1LjE0ODMsMzgwLjc4OTEsNjExLjE0ODMsMzc2Ljc4OTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNjA5LjE0ODMiIHgyPSI4OTcuMTM4NSIgeTE9IjM3Ni43ODkxIiB5Mj0iMzc2Ljc4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOC43NTczIiB4PSI2MjEuMTQ4MyIgeT0iMzcxLjcyMzEiPk9LPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDEiIGRhdGEtZW50aXR5LTI9InBhcnQyIiBpZD0ibXNnOSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0NTYuMTQ4Nyw0MDEuOTIxOSw0NjYuMTQ4Nyw0MDUuOTIxOSw0NTYuMTQ4Nyw0MDkuOTIxOSw0NjAuMTQ4Nyw0MDUuOTIxOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3OC45OTk4IiB4Mj0iNDYyLjE0ODciIHkxPSI0MDUuOTIxOSIgeTI9IjQwNS45MjE5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU1LjUzNzYiIHg9Ijg1Ljk5OTgiIHk9IjQwMC44NTYiPmNvbnN1bWVRdWFudGl0eShpZCwgcXVhbnRpdHksIHZlcnNpb24pPC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDIiIGRhdGEtZW50aXR5LTI9InBhcnQ0IiBpZD0ibXNnMTAiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODg2LjEzODUsNDMxLjA1NDcsODk2LjEzODUsNDM1LjA1NDcsODg2LjEzODUsNDM5LjA1NDcsODkwLjEzODUsNDM1LjA1NDciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDY4LjE0ODciIHgyPSI4OTIuMTM4NSIgeTE9IjQzNS4wNTQ3IiB5Mj0iNDM1LjA1NDciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MDUuOTg5OCIgeD0iNDc1LjE0ODciIHk9IjQyOS45ODg4Ij5VUERBVEUgLi4uIFdIRVJFIElEID0gPyBBTkQgJiMxMjQ5NjsmIzEyNTQwOyYjMTI0NzI7JiMxMjUxOTsmIzEyNTMxOyA9ID8gQU5EICYjMjc1MzE7JiMyNTk2ODsmIzM3MzI3OyAmZ3Q7PSA/PC90ZXh0PjwvZz48cGF0aCBkPSJNMjAsNDUwLjA1NDcgTDg0LjQ0MjksNDUwLjA1NDcgTDg0LjQ0MjksNDU3LjE4NzUgTDc0LjQ0MjksNDY3LjE4NzUgTDIwLDQ2Ny4xODc1IEwyMCw0NTAuMDU0NyIgZmlsbD0iI0VFRUVFRSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIxOTAuNjAxNiIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iOTA2LjEzODUiIHg9IjIwIiB5PSI0NTAuMDU0NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOS40NDI5IiB4PSIzNSIgeT0iNDYzLjEyMTYiPmFsdDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuMDU0NCIgeD0iOTkuNDQyOSIgeT0iNDYyLjI2NTEiPlsmIzI2MzU2OyYjMjYwMzI7JiMyNTEwNDsmIzIxMTUxO108L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQ0IiBkYXRhLWVudGl0eS0yPSJwYXJ0MiIgaWQ9Im1zZzExIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ3OS4xNDg3LDQ4NC4zMjAzLDQ2OS4xNDg3LDQ4OC4zMjAzLDQ3OS4xNDg3LDQ5Mi4zMjAzLDQ3NS4xNDg3LDQ4OC4zMjAzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjQ3My4xNDg3IiB4Mj0iODk3LjEzODUiIHkxPSI0ODguMzIwMyIgeTI9IjQ4OC4zMjAzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTkuMjcxMSIgeD0iNDg1LjE0ODciIHk9IjQ4My4yNTQ0Ij4mIzI2MzU2OyYjMjYwMzI7JiMyNTEwNDsmIzIxMTUxOyYjNjUyODg7MSYjMjAyMTQ7JiM2NTI4OTs8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDEiIGlkPSJtc2cxMiI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4OS45OTk4LDUxMy40NTMxLDc5Ljk5OTgsNTE3LjQ1MzEsODkuOTk5OCw1MjEuNDUzMSw4NS45OTk4LDUxNy40NTMxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjgzLjk5OTgiIHgyPSI0NjcuMTQ4NyIgeTE9IjUxNy40NTMxIiB5Mj0iNTE3LjQ1MzEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOC43NTczIiB4PSI5NS45OTk4IiB5PSI1MTIuMzg3MiI+T0s8L3RleHQ+PC9nPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSIyMCIgeDI9IjkyNi4xMzg1IiB5MT0iNTI2LjQ1MzEiIHkyPSI1MjYuNDUzMSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzMuNjk0OCIgeD0iMjUiIHk9IjUzNi42NjM2Ij5bJiMxMjQ5NjsmIzEyNTQwOyYjMTI0NzI7JiMxMjUxOTsmIzEyNTMxOyYjMTk5ODE7JiMxOTk2ODsmIzMzMjY4OyBvciAmIzI3NTMxOyYjMjU5Njg7JiMzNzMyNzsmIzE5OTgxOyYjMzYyNzU7XTwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDQiIGRhdGEtZW50aXR5LTI9InBhcnQyIiBpZD0ibXNnMTMiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDc5LjE0ODcsNTU3LjM5MDYsNDY5LjE0ODcsNTYxLjM5MDYsNDc5LjE0ODcsNTY1LjM5MDYsNDc1LjE0ODcsNTYxLjM5MDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iNDczLjE0ODciIHgyPSI4OTcuMTM4NSIgeTE9IjU2MS4zOTA2IiB5Mj0iNTYxLjM5MDYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OS4yNzExIiB4PSI0ODUuMTQ4NyIgeT0iNTU2LjMyNDciPiYjMjYzNTY7JiMyNjAzMjsmIzIyODMzOyYjMjU5NDM7JiM2NTI4ODswJiMyMDIxNDsmIzY1Mjg5OzwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzE0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijg5Ljk5OTgsNTg2LjUyMzQsNzkuOTk5OCw1OTAuNTIzNCw4OS45OTk4LDU5NC41MjM0LDg1Ljk5OTgsNTkwLjUyMzQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iODMuOTk5OCIgeDI9IjQ2Ny4xNDg3IiB5MT0iNTkwLjUyMzQiIHkyPSI1OTAuNTIzNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2NS4xNDg5IiB4PSI5NS45OTk4IiB5PSI1ODUuNDU3NSI+T3B0aW1pc3RpY0xvY2tFeGNlcHRpb24gLyBJbnN1ZmZpY2llbnRRdWFudGl0eUV4Y2VwdGlvbjwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzE1Ij48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzguOTk5OCIgeDI9IjEyMC45OTk4IiB5MT0iNjE5LjY1NjMiIHkyPSI2MTkuNjU2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMjAuOTk5OCIgeDI9IjEyMC45OTk4IiB5MT0iNjE5LjY1NjMiIHkyPSI2MzIuNjU2MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3OS45OTk4IiB4Mj0iMTIwLjk5OTgiIHkxPSI2MzIuNjU2MyIgeTI9IjYzMi42NTYzIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4OS45OTk4LDYyOC42NTYzLDc5Ljk5OTgsNjMyLjY1NjMsODkuOTk5OCw2MzYuNjU2Myw4NS45OTk4LDYzMi42NTYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iODUuOTk5OCIgeT0iNjE0LjU5MDMiPiYjMTI1MjU7JiMxMjU0MDsmIzEyNTIzOyYjMTI0OTY7JiMxMjQ4MzsmIzEyNDYzOzwvdGV4dD48L2c+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjEwIiB4Mj0iOTM2LjEzODUiIHkxPSI2NDguNjU2MyIgeTI9IjY0OC42NTYzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMy45MzAxIiB4PSIxNSIgeT0iNjU4Ljg2NjciPlsmIzI3NTMxOyYjMjU5Njg7JiMzNzMyNzsgJmx0OyAmIzI4MDQwOyYjMzYwMjc7JiMyNTk2ODsmIzM3MzI3O108L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzE2Ij48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzguOTk5OCIgeDI9IjEyMC45OTk4IiB5MT0iNjgzLjU5MzgiIHkyPSI2ODMuNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMjAuOTk5OCIgeDI9IjEyMC45OTk4IiB5MT0iNjgzLjU5MzgiIHkyPSI2OTYuNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3OS45OTk4IiB4Mj0iMTIwLjk5OTgiIHkxPSI2OTYuNTkzOCIgeTI9IjY5Ni41OTM4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4OS45OTk4LDY5Mi41OTM4LDc5Ljk5OTgsNjk2LjU5MzgsODkuOTk5OCw3MDAuNTkzOCw4NS45OTk4LDY5Ni41OTM4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTkyLjMyNzYiIHg9Ijg1Ljk5OTgiIHk9IjY3OC41Mjc4Ij5JbnN1ZmZpY2llbnRRdWFudGl0eUV4Y2VwdGlvbjwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgWExESFJ6OUc2N3RsaF9aMjRxaXNyRFY1UkxkTjlaT2tjbTljcHhNejk4clRNc2FYeVlRellVMkNaYUlkOWlSdWVpbmVURVdPbU8za25ybWV6TWJfbVNqalFKajB6akpzVmJfRkVUeXZ6dENxSHFWV1RVaC1wendtclhtcmRmM2dQLV9KUnh6dklsMHRXWjVuSnBaRWFla0VmY1lNUjNZRzJmZzlVcVBtZC0yTm5Gc0wwamM2QlRFbUlfaWVMclFjc2ItVFpDd1F0amlOZXRRQnUyeTRsb1RrYi0wd1ZNVl92T0dpaWlvdjU3RXdBR2poTHNMN2xZX1IyNTgycG1lMnB0Nm4xNVhQM3U1TmVRMFBBYi1IckJIVGlZb3o4WTE3cmRIOU5VQTJYZDZobUF6MkpqbU1qX0FHb01IV3h2UU81SzRJTzBxc0U4NjdiR0hRU2ZvQkZqTkw2RGltcmRYQ0NGTWl2dHJfdlhzcl9qT0VfSnp6S1pzX3czLURZMlhDQjk0bzlsSENZcV9zSE9XNEx1Yng3OE9Zd3F2U1dWTXJDQ0pXVW5Paks2X0JQUEhNTUNyb0RERE91aUJJbjBMZjlvVGN5X0lIdHVMOTJaS3N1VmQ0WUdYaXpfUl9CMHlPcURxSUpMRHBBY2JETk9RN3VTU29iNTdIUGpvTjB4WHRIelpDWXBDMW1FUUUwNUNzSC1VTjNEVzhGN2ROemJ3dGw3ZlpVRjFYOWhuNFpPUHRPejNoQkNZN3BlVHFVaU1jbzBWVHZ1RmtPeF9NMWhDTzJ3MmRWa1RxRms3bXVtX2x3MHFibDd1NThTcmFOeEZmN2NvUm9XRm5hTzlPSTcwRDlEZktBRDN6RzhPcFNKTWdCeFd3UjhWZmJkdmJDeDF4V21tcjYybHN4a09MVG9VMk1vbzM4bHkzPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_22">消費サービスの実装<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<details>
<summary>ConsumptionService.java（楽観ロック対応）</summary>

<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * 消費処理（楽観ロック対応）</span>
<span class="cm"> */</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Consumption</span><span class="w"> </span><span class="nf">processConsumption</span><span class="p">(</span><span class="n">ConsumptionRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 支給明細を取得</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">supplyDetail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getSupplyDetailId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;支給明細が見つかりません&quot;</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// 残数量の事前チェック（楽観的）</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">canConsume</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getConsumedQuantity</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsufficientQuantityException</span><span class="p">(</span>
<span class="w">                </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;残数量が不足しています（残数: %s, 要求: %s）&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getRemainingQuantity</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getConsumedQuantity</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 歩留率の計算</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">yieldRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateYieldRate</span><span class="p">(</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">getConsumedQuantity</span><span class="p">(),</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">getProducedQuantity</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 消費データ作成</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">consumption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Consumption</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">consumptionNumber</span><span class="p">(</span><span class="n">generateConsumptionNumber</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">supplyNumber</span><span class="p">(</span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getSupplyNumber</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">receivingNumber</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getReceivingNumber</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">consumptionDate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getConsumptionDate</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="n">consumptionRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">consumption</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 消費明細作成</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">consumptionDetail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConsumptionDetail</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">consumptionNumber</span><span class="p">(</span><span class="n">consumption</span><span class="p">.</span><span class="na">getConsumptionNumber</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">lineNumber</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">supplyDetailId</span><span class="p">(</span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">itemCode</span><span class="p">(</span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getItemCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">consumedQuantity</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getConsumedQuantity</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">yieldRate</span><span class="p">(</span><span class="n">yieldRate</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="n">consumptionDetailRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">consumptionDetail</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 支給明細の残数量を更新（楽観ロック）</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">supplyDetailRepository</span><span class="p">.</span><span class="na">consumeQuantity</span><span class="p">(</span>
<span class="w">                </span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">getConsumedQuantity</span><span class="p">(),</span>
<span class="w">                </span><span class="n">supplyDetail</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">OptimisticLockException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentUpdateException</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;他のユーザーが同時に消費処理を行いました。画面を更新して再度お試しください。&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InsufficientQuantityException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentUpdateException</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;他のユーザーが先に消費処理を行ったため、残数量が不足しています。&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">consumption</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">calculateYieldRate</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">consumed</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">produced</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">consumed</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">produced</span><span class="p">.</span><span class="na">divide</span><span class="p">(</span><span class="n">consumed</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">RoundingMode</span><span class="p">.</span><span class="na">HALF_UP</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">multiply</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="_23">楽観ロックのベストプラクティス（外注委託向け）<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>ポイント</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>残数量と楽観ロックの組み合わせ</strong></td>
<td>WHERE 条件で両方をチェック</td>
</tr>
<tr>
<td><strong>エラー原因の特定</strong></td>
<td>バージョン不一致か残数量不足かを判別</td>
</tr>
<tr>
<td><strong>歩留率の記録</strong></td>
<td>消費時に歩留率を計算・記録</td>
</tr>
<tr>
<td><strong>有償/無償支給の区別</strong></td>
<td>会計処理が異なるため支給区分を保持</td>
</tr>
<tr>
<td><strong>トランザクション境界</strong></td>
<td>消費→消費明細→支給明細更新を1トランザクションで</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="266">26.6 まとめ<a class="headerlink" href="#266" title="Permanent link">&para;</a></h2>
<p>本章では、外注委託管理（支給から消費まで）の DB 設計と実装について学びました。</p>
<h3 id="_24">学んだこと<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>支給業務の設計</strong></li>
<li>支給データと支給明細データの親子関係</li>
<li>有償支給と無償支給の区別</li>
<li>
<p>発注明細との紐付け</p>
</li>
<li>
<p><strong>消費業務の設計</strong></p>
</li>
<li>入荷時の消費記録</li>
<li>歩留まり率の計算</li>
<li>
<p>支給数量を超えない消費のバリデーション</p>
</li>
<li>
<p><strong>命名規則のパターン</strong></p>
</li>
<li><strong>DB（日本語）</strong>: テーブル名、カラム名、ENUM 型・値は日本語</li>
<li><strong>Java（英語）</strong>: クラス名、フィールド名、enum 値は英語</li>
<li><strong>MyBatis resultMap</strong>: 日本語カラムと英語プロパティのマッピング</li>
<li><strong>TypeHandler</strong>: 日本語 ENUM 値と英語 enum の相互変換</li>
</ol>
<h3 id="_25">テーブル一覧<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>テーブル名（日本語）</th>
<th>Java エンティティ</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>支給データ</td>
<td>Supply</td>
<td>外注先への支給情報</td>
</tr>
<tr>
<td>支給明細データ</td>
<td>SupplyDetail</td>
<td>支給品目の明細</td>
</tr>
<tr>
<td>消費データ</td>
<td>Consumption</td>
<td>支給品の消費報告</td>
</tr>
<tr>
<td>消費明細データ</td>
<td>ConsumptionDetail</td>
<td>消費品目の明細</td>
</tr>
</tbody>
</table>
<h3 id="enum">ENUM 一覧<a class="headerlink" href="#enum" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>DB ENUM 型（日本語）</th>
<th>Java Enum</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr>
<td>支給区分</td>
<td>SupplyType</td>
<td>有償支給→PAID, 無償支給→FREE</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>