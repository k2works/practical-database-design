
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../chapter10/">
      
      
        <link rel="next" href="../chapter12/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>第11章 共通処理の設計 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#11" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第11章 共通処理の設計
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-setup-instruction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    プロジェクトセットアップ手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" checked>
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        共通処理の全体像
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="共通処理の全体像">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        共通処理の役割
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#111" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1 赤黒処理の設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.1 赤黒処理の設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        赤黒処理とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        なぜ赤黒処理が必要か
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        伝票区分の定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#er" class="md-nav__link">
    <span class="md-ellipsis">
      
        赤黒処理の ER 図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        マイグレーション：赤黒処理関連テーブルの作成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        赤黒処理エンティティの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        赤黒処理サービスの実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#112" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2 自動採番の設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.2 自動採番の設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        採番の要件
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        採番パターン
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        採番形式の種類
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#er_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        採番テーブルの ER 図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        マイグレーション：採番テーブルの作成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        採番サービスの実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#113" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3 監査カラムの設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3 監査カラムの設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        監査カラムとは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        監査カラムの種類
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        論理削除の考え方
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        監査カラム用エンティティ基底クラス
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        MyBatis インターセプターによる自動設定
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#114" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4 履歴テーブルの設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4 履歴テーブルの設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        履歴管理の種類
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#er_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        変更履歴テーブルの ER 図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        マイグレーション：履歴テーブルの作成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        履歴サービスの実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        業務システムでの使い分け
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        第11章のまとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第11章のまとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        学んだこと
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        テーブル一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum" class="md-nav__link">
    <span class="md-ellipsis">
      
        ENUM 一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#er_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        共通処理 ER 図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        次章の予告
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter22-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 Axon CQRS/ESの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_18" >
        
          
          <label class="md-nav__link" for="__nav_1_18" id="__nav_1_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（FAS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（PMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="11">第11章：共通処理の設計<a class="headerlink" href="#11" title="Permanent link">&para;</a></h1>
<p>販売管理システムでは、赤黒処理、自動採番、監査カラム、履歴管理といった共通的な処理が多くの業務で横断的に使用されます。本章では、これらの共通処理のデータベース設計と実装を行います。</p>
<h2 id="_1">共通処理の全体像<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>共通処理は、業務データの整合性、追跡可能性、運用効率を高めるための基盤機能です。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjI0NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjQ2cHg7aGVpZ2h0OjI0NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY0NiAyNDUiIHdpZHRoPSI2NDZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjA4NDk7JiMzNjg5MDsmIzIwOTY2OyYjMjk3MDI7JiMxMjM5ODsmIzIwMzAxOyYjMzI2MjI7JiMxMjM4OTsmIzEyMzY5OzwvdGl0bGU+PGRlZnMvPjxnPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMSI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSIyNTMuMjAwMyIgeT0iMjIuOTk1MSI+JiMyMDg0OTsmIzM2ODkwOyYjMjA5NjY7JiMyOTcwMjsmIzEyMzk4OyYjMjAzMDE7JiMzMjYyMjsmIzEyMzg5OyYjMTIzNjk7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjczLjI5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNTUyIiB4PSI4My4yNCIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIzMzEuMjQwMSIgeT0iNTkuMjkyIj4mIzI2OTg5OyYjMjEyMDk7JiMyMDk2NjsmIzI5NzAyOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiM5MEVFOTAiIGhlaWdodD0iNzMuMyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjQ1NSIgeD0iNjkuMjQiIHk9IjE2Ni41ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjI2OC43NDAxIiB5PSIxODEuNTgyIj4mIzIwODQ5OyYjMzY4OTA7JiMyMDk2NjsmIzI5NzAyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBvcmRlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4ub3JkZXIiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc1Ljk5OTgiIHg9Ijk5LjI0IiB5PSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTA5LjI0IiB5PSI5NS4yOTIiPiYjMjE0NjM7JiMyNzg4MDsmIzMxNjQ5OyYjMjk3MDI7PC90ZXh0PjwvZz48IS0tZW50aXR5IHNoaXBtZW50LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi5zaGlwbWVudCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzUuOTk5OCIgeD0iMjEwLjI0IiB5PSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMjIwLjI0IiB5PSI5NS4yOTIiPiYjMjA5ODY7JiMzMzY1NTsmIzMxNjQ5OyYjMjk3MDI7PC90ZXh0PjwvZz48IS0tZW50aXR5IHNhbGVzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi5zYWxlcyIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzUuOTk5OCIgeD0iMzIxLjI0IiB5PSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMzMxLjI0IiB5PSI5NS4yOTIiPiYjMjI3NzA7JiMxOTk3ODsmIzMxNjQ5OyYjMjk3MDI7PC90ZXh0PjwvZz48IS0tZW50aXR5IGJpbGxpbmctLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLmJpbGxpbmciIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDA2Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijc1Ljk5OTgiIHg9IjQzMi4yNCIgeT0iNzkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjQ0Mi4yNCIgeT0iOTUuMjkyIj4mIzM1NTMxOyYjMjc3MTQ7JiMzMTY0OTsmIzI5NzAyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBwYXltZW50LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi5wYXltZW50IiBkYXRhLXNvdXJjZS1saW5lPSI4IiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3NS45OTk4IiB4PSI1NDMuMjQiIHk9Ijc5LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI1NTMuMjQiIHk9Ijk1LjI5MiI+JiMyNTkwMzsmIzI1MTczOyYjMzE2NDk7JiMyOTcwMjs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgcmVkYmxhY2stLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLnJlZGJsYWNrIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMDkiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzUuOTk5OCIgeD0iMjEwLjI0IiB5PSIyMDEuNTg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjIyMC4yNCIgeT0iMjE3LjU4MiI+JiMzNjE5NjsmIzQwNjU4OyYjMjA5NjY7JiMyOTcwMjs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbnVtYmVyaW5nLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi5udW1iZXJpbmciIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAxMCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3NS45OTk4IiB4PSI0MzIuMjQiIHk9IjIwMS41ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iNDQyLjI0IiB5PSIyMTcuNTgyIj4mIzMzMjU4OyYjMjEyMDU7JiMyNTUwNTsmIzMwMDU4OzwvdGV4dD48L2c+PCEtLWVudGl0eSBhdWRpdC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uYXVkaXQiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS45OTk3IiB4PSI4NS4yNCIgeT0iMjAxLjU4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI5NS4yNCIgeT0iMjE3LjU4MiI+JiMzMDQzNTsmIzI2NjE5OyYjMTI0NTk7JiMxMjUyMTsmIzEyNTEyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBoaXN0b3J5LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi5oaXN0b3J5IiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzUuOTk5OCIgeD0iMzIxLjI0IiB5PSIyMDEuNTg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjMzMS4yNCIgeT0iMjE3LjU4MiI+JiMyMzY1MzsmIzI3NTA4OyYjMzE2NDk7JiMyOTcwMjs8L3RleHQ+PC9nPjwhLS1saW5rIG9yZGVyIHRvIG51bWJlcmluZy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDEwIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGlkPSJsbmsxMyI+PHBhdGggZD0iTTE0My43NSwxMDEuNjg2OSBDMTUzLjMsMTE1LjY5NjkgMTcyLjU4LDE0MC4yNTY5IDE5Ni4yNCwxNTAuNTg2OSBDMjQwLjY3LDE2OS45ODY5IDM2OS41NSwxMzkuODA2OSA0MTQuMjQsMTU4LjU4NjkgQzQzNS40OSwxNjcuNTI2OSA0NDkuODg4NywxODMuNjMyOSA0NTkuMzg4NywxOTYuNDAyOSIgZmlsbD0ibm9uZSIgaWQ9Im9yZGVyLXRvLW51bWJlcmluZyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDYyLjk3LDIwMS4yMTY5LDQ2MC44MDc0LDE5MS42MDg0LDQ1OS45ODU2LDE5Ny4yMDUyLDQ1NC4zODg4LDE5Ni4zODM0LDQ2Mi45NywyMDEuMjE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjE5Ny4yNCIgeT0iMTQ2LjY1MzgiPiYjMjE0NjM7JiMyNzg4MDsmIzMwMDU4OyYjMjE0OTU7JiMyOTk4MzsmIzI1MTA0OzwvdGV4dD48L2c+PCEtLWxpbmsgb3JkZXIgdG8gYXVkaXQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAxMSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE5IiBpZD0ibG5rMTQiPjxwYXRoIGQ9Ik05OC44Nyw5NS4yMjY5IEM3My45NSw5OS45MDY5IDQzLjIzLDExMC4zMzY5IDI3LjI0LDEzMy41ODY5IEM2LDE2NC40NzY5IDUwLjYyMzIsMTg2LjM3NDIgODguMTczMiwxOTkuMjI0MiIgZmlsbD0ibm9uZSIgaWQ9Im9yZGVyLXRvLWF1ZGl0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5My44NSwyMDEuMTY2OSw4Ni42Mjk5LDE5NC40Njg0LDg5LjExOTMsMTk5LjU0OCw4NC4wMzk3LDIwMi4wMzc0LDkzLjg1LDIwMS4xNjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMjguMjQiIHk9IjE0Ni42NTM4Ij4mIzMwNDM1OyYjMjY2MTk7JiMyNDc3MzsmIzIyNTc3OyYjMjAxODQ7JiMxOTk4Mjs8L3RleHQ+PC9nPjwhLS1saW5rIHNhbGVzIHRvIHJlZGJsYWNrLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMDkiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgaWQ9ImxuazE1Ij48cGF0aCBkPSJNMzM5LjUzLDEwMS45NzY5IEMzMjYuNSwxMDkuNTg2OSAzMDkuNjEsMTIwLjc0NjkgMjk3LjI0LDEzMy41ODY5IEMyNzcuMDIsMTU0LjU3NjkgMjYzLjM4MzEsMTc5LjgxMSAyNTUuNjkzMSwxOTUuNzgxIiBmaWxsPSJub25lIiBpZD0ic2FsZXMtdG8tcmVkYmxhY2siIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI1My4wOSwyMDEuMTg2OSwyNjAuNTk4NiwxOTQuODEzNCwyNTUuMjU5MiwxOTYuNjgxOSwyNTMuMzkwNywxOTEuMzQyNiwyNTMuMDksMjAxLjE4NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSIyOTguMjQiIHk9IjE0Ni42NTM4Ij4mIzIwMjUzOyYjMzEwODA7JiMzNTMzMDsmIzI3NDkxOzwvdGV4dD48L2c+PCEtLWxpbmsgc2FsZXMgdG8gaGlzdG9yeS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEyIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjEiIGlkPSJsbmsxNiI+PHBhdGggZD0iTTM1OS4yNCwxMDEuNjk2OSBDMzU5LjI0LDEyNC4zMDY5IDM1OS4yNCwxNzIuMjU2OSAzNTkuMjQsMTk1LjE2NjkiIGZpbGw9Im5vbmUiIGlkPSJzYWxlcy10by1oaXN0b3J5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNTkuMjQsMjAxLjE2NjksMzYzLjI0LDE5Mi4xNjY5LDM1OS4yNCwxOTYuMTY2OSwzNTUuMjQsMTkyLjE2NjksMzU5LjI0LDIwMS4xNjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iMzYwLjI0IiB5PSIxNDYuNjUzOCI+JiMyMjc5MzsmIzI2MzU2OyYjMjM2NTM7JiMyNzUwODs8L3RleHQ+PC9nPjwhLS1saW5rIGJpbGxpbmcgdG8gbnVtYmVyaW5nLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMTAiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMiIgaWQ9ImxuazE3Ij48cGF0aCBkPSJNNDY4LjA0LDEwMS43NzY5IEM0NjYuMzQsMTEwLjI2NjkgNDY0LjE0LDEyMi42NDY5IDQ2My4yNCwxMzMuNTg2OSBDNDYxLjI1LDE1Ny43NTY5IDQ2NC4zNDE1LDE4MC4xOTI4IDQ2Ny4wNjE1LDE5NS4yMjI4IiBmaWxsPSJub25lIiBpZD0iYmlsbGluZy10by1udW1iZXJpbmciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ2OC4xMywyMDEuMTI2OSw0NzAuNDYzNCwxOTEuNTU4NCw0NjcuMjM5NiwxOTYuMjA2OCw0NjIuNTkxMiwxOTIuOTgzLDQ2OC4xMywyMDEuMTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjQ2NC4yNCIgeT0iMTQ2LjY1MzgiPiYjMzU1MzE7JiMyNzcxNDsmIzMwMDU4OyYjMjE0OTU7JiMyOTk4MzsmIzI1MTA0OzwvdGV4dD48L2c+PCEtLWxpbmsgcGF5bWVudCB0byBudW1iZXJpbmctLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNyIgZGF0YS1lbnRpdHktMj0iZW50MDAxMCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0ibG5rMTgiPjxwYXRoIGQ9Ik01NzYuNzUsMTAxLjgxNjkgQzU3MS4wNiwxMTQuMjU2OSA1NjAuMzgsMTM1LjMyNjkgNTQ3LjI0LDE1MC41ODY5IEM1MjkuNDIsMTcxLjI4NjkgNTA4Ljc5NTEsMTg2LjY4MjggNDkyLjA4NTEsMTk3LjgwMjgiIGZpbGw9Im5vbmUiIGlkPSJwYXltZW50LXRvLW51bWJlcmluZyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDg3LjA5LDIwMS4xMjY5LDQ5Ni43OTg2LDE5OS40NzA4LDQ5MS4yNTI1LDE5OC4zNTY4LDQ5Mi4zNjY1LDE5Mi44MTA3LDQ4Ny4wOSwyMDEuMTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjU2MC40IiB5PSIxNDYuNjUzOCI+JiMyNTkwMzsmIzI1MTczOyYjMzAwNTg7JiMyMTQ5NTsmIzI5OTgzOyYjMjUxMDQ7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBQUDdCSmk5MDU4UnRWT2Y5TlZDMkJqb3d5SUtBZFMzNEtpWXFCOFduNEdXWTRZdVE2WV80MEM0UVg4MmZPWTBZSnpGRWpCbzVQUFoyNkJScFZKZHBkXy1Pb0RHVzg2TGRWVkxDQWN6LXd6ZWpKQnJMdEx6RHRPQmo1a3VhMlNFNGdVWjlLOUVmRkk2cmZ3cWRXbWlmZU0wTG9BSnZHQi02X2hKRk5YSzNQQjBBU0dHaEZxNXpCYTBaWFI5Zmc5aUg3dG53WXJrSEFuZXFFMHA2RFVlSzFIWDdjZVJxOUNVcV9LNmhiZTJwSWZ3RGxsb05Nam5FMWFUZEE5YW9KcDY0LWN3M3VGanJsUm9GWjcwR1hjZlNLbkJkNFEtQ0lDc1laUnZsWkhaTlMtYXVuRmlhVmNUMGtxa3RFN1BCeHN3Zm5ubWJmd0JUYmV2RDlwQ1hRR2VQUFdSZERxYlBNbzBNRXpiRjFTVTBic2dESTdGa2p4bHFmWU04UjdHZVJSLWJmSkJmRVR4b3FMaXE5NU9WYXc4VEdpX3hWVjdqT0owaXFpYjBDN1k4cE0tbExUZ1BSTERBbEVJM0lGbVFPWUhVLTg3QUJvRWVWbTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_2">共通処理の役割<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>処理</th>
<th>役割</th>
<th>主な利用場面</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>赤黒処理</strong></td>
<td>確定済み伝票の訂正</td>
<td>売上・仕入の金額訂正、取消</td>
</tr>
<tr>
<td><strong>自動採番</strong></td>
<td>一意な番号の発行</td>
<td>伝票番号の自動生成</td>
</tr>
<tr>
<td><strong>監査カラム</strong></td>
<td>変更者・日時の記録</td>
<td>全テーブル共通</td>
</tr>
<tr>
<td><strong>履歴管理</strong></td>
<td>変更前後の状態保存</td>
<td>マスタ変更、重要データ</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="111">11.1 赤黒処理の設計<a class="headerlink" href="#111" title="Permanent link">&para;</a></h2>
<h3 id="_3">赤黒処理とは<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>赤黒処理は、確定済みの伝票を訂正する際に使用する会計的手法です。元の伝票を「赤伝票」でマイナス計上し、正しい内容を「黒伝票」で再計上します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjM2NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzY4cHg7aGVpZ2h0OjM2NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM2OCAzNjUiIHdpZHRoPSIzNjhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMzYxOTY7JiM0MDY1ODsmIzIwOTY2OyYjMjk3MDI7JiMxMjM5ODsmIzI3MDEwOyYjMjQ1NjU7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMTMzLjgzNzYiIHk9IjMyLjk5NTEiPiYjMzYxOTY7JiM0MDY1ODsmIzIwOTY2OyYjMjk3MDI7JiMxMjM5ODsmIzI3MDEwOyYjMjQ1NjU7PC90ZXh0PjwvZz48ZWxsaXBzZSBjeD0iODcuMDAwNSIgY3k9IjU3LjI5NjkiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE4My4wMDEsODQuMTQ4NCBMMTgzLjAwMSwxMDAuMjgxMyBMMTYzLjAwMSwxMDQuMjgxMyBMMTgzLjAwMSwxMDguMjgxMyBMMTgzLjAwMSwxMjQuNDE0MSBBMCwwIDAgMCAwIDE4My4wMDEsMTI0LjQxNDEgTDM1Ni42NzQ5LDEyNC40MTQxIEEwLDAgMCAwIDAgMzU2LjY3NDksMTI0LjQxNDEgTDM1Ni42NzQ5LDk0LjE0ODQgTDM0Ni42NzQ5LDg0LjE0ODQgTDE4My4wMDEsODQuMTQ4NCBBMCwwIDAgMCAwIDE4My4wMDEsODQuMTQ4NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTM0Ni42NzQ5LDg0LjE0ODQgTDM0Ni42NzQ5LDk0LjE0ODQgTDM1Ni42NzQ5LDk0LjE0ODQgTDM0Ni42NzQ5LDg0LjE0ODQiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi41MTIzIiB4PSIxODkuMDAxIiB5PSIxMDEuMjE1MyI+JiMyMDM2Mzs6ICYjMjI3NzA7JiMxOTk3ODsmIzM3MzI5OyYjMzg5ODk7JiMxMjM5ODsmIzM1NDkyOyYjMTI0MjY7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Mi42NzM5IiB4PSIxODkuMDAxIiB5PSIxMTYuMzQ4MSI+MTAwLDAwMCYjMjA4NzA7ICYjODU5NDsgMTIwLDAwMCYjMjA4NzA7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTIuMDAxIiB4PSIxMSIgeT0iODcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMi4wMDEiIHg9IjIxIiB5PSIxMDguNDM1NSI+JiMzMDkwNjsmIzIzNDUwOyYjMjgxNjg7JiMxMjQxNTsmIzIwMjUzOyYjMzEwODA7JiMxMjM5ODsmIzM1NDkyOyYjMTI0MjY7JiMzMDMzMDsmIzM1MjExOzwvdGV4dD48cGF0aCBkPSJNMTQ3LjAwMDcsMTM0LjQxNDEgTDE0Ny4wMDA3LDE1OC4xMTMzIEwxMjcuMDAwNywxNjIuMTEzMyBMMTQ3LjAwMDcsMTY2LjExMzMgTDE0Ny4wMDA3LDE4OS44MTI1IEEwLDAgMCAwIDAgMTQ3LjAwMDcsMTg5LjgxMjUgTDI1OS4wMDA4LDE4OS44MTI1IEEwLDAgMCAwIDAgMjU5LjAwMDgsMTg5LjgxMjUgTDI1OS4wMDA4LDE0NC40MTQxIEwyNDkuMDAwOCwxMzQuNDE0MSBMMTQ3LjAwMDcsMTM0LjQxNDEgQTAsMCAwIDAgMCAxNDcuMDAwNywxMzQuNDE0MSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTI0OS4wMDA4LDEzNC40MTQxIEwyNDkuMDAwOCwxNDQuNDE0MSBMMjU5LjAwMDgsMTQ0LjQxNDEgTDI0OS4wMDA4LDEzNC40MTQxIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSIxNTMuMDAwNyIgeT0iMTUxLjQ4MSI+JiMyMDgwMzsmIzIwMjUzOyYjMzEwODA7JiMxMjM5MjsmIzIxNTE2OyYjMzg5ODk7JiMxMjM5MTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMTUzLjAwMDciIHk9IjE2Ni42MTM4Ij4mIzEyNTEwOyYjMTI0NTI7JiMxMjQ5MDsmIzEyNDczOyYjMzUzMzY7JiMxOTk3ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzEuNDQ5MiIgeD0iMTUzLjAwMDciIHk9IjE4MS43NDY2Ij4tMTAwLDAwMCYjMjA4NzA7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4MC4wMDA1IiB4PSI0Ny4wMDAzIiB5PSIxNDUuMTI4OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjAwMDUiIHg9IjU3LjAwMDMiIHk9IjE2Ni4yNjc2Ij4mIzM2MTk2OyYjMjAyNTM7JiMzMTA4MDsmIzIwMzE2OyYjMjUxMDQ7PC90ZXh0PjxwYXRoIGQ9Ik0xNDcuMDAwNywxOTkuODEyNSBMMTQ3LjAwMDcsMjIzLjUxMTcgTDEyNy4wMDA3LDIyNy41MTE3IEwxNDcuMDAwNywyMzEuNTExNyBMMTQ3LjAwMDcsMjU1LjIxMDkgQTAsMCAwIDAgMCAxNDcuMDAwNywyNTUuMjEwOSBMMjQ2LjAwMDgsMjU1LjIxMDkgQTAsMCAwIDAgMCAyNDYuMDAwOCwyNTUuMjEwOSBMMjQ2LjAwMDgsMjA5LjgxMjUgTDIzNi4wMDA4LDE5OS44MTI1IEwxNDcuMDAwNywxOTkuODEyNSBBMCwwIDAgMCAwIDE0Ny4wMDA3LDE5OS44MTI1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjM2LjAwMDgsMTk5LjgxMjUgTDIzNi4wMDA4LDIwOS44MTI1IEwyNDYuMDAwOCwyMDkuODEyNSBMMjM2LjAwMDgsMTk5LjgxMjUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjE1My4wMDA3IiB5PSIyMTYuODc5NCI+JiMyNzQ5MTsmIzEyMzc1OyYjMTIzNTY7JiMzNzMyOTsmIzM4OTg5OyYjMTIzOTE7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjE1My4wMDA3IiB5PSIyMzIuMDEyMiI+JiMxMjUwMzsmIzEyNTIxOyYjMTI0NzM7JiMzNTMzNjsmIzE5OTc4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Ny42NTA5IiB4PSIxNTMuMDAwNyIgeT0iMjQ3LjE0NSI+KzEyMCwwMDAmIzIwODcwOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODAuMDAwNSIgeD0iNDcuMDAwMyIgeT0iMjEwLjUyNzMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MC4wMDA1IiB4PSI1Ny4wMDAzIiB5PSIyMzEuNjY2Ij4mIzQwNjU4OyYjMjAyNTM7JiMzMTA4MDsmIzIwMzE2OyYjMjUxMDQ7PC90ZXh0PjxwYXRoIGQ9Ik0xNDEuMDAwNywyNzIuMDYyNSBMMTQxLjAwMDcsMjg4LjE5NTMgTDEyMS4wMDA3LDI5Mi4xOTUzIEwxNDEuMDAwNywyOTYuMTk1MyBMMTQxLjAwMDcsMzEyLjMyODEgQTAsMCAwIDAgMCAxNDEuMDAwNywzMTIuMzI4MSBMMjc0LjUxMywzMTIuMzI4MSBBMCwwIDAgMCAwIDI3NC41MTMsMzEyLjMyODEgTDI3NC41MTMsMjgyLjA2MjUgTDI2NC41MTMsMjcyLjA2MjUgTDE0MS4wMDA3LDI3Mi4wNjI1IEEwLDAgMCAwIDAgMTQxLjAwMDcsMjcyLjA2MjUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yNjQuNTEzLDI3Mi4wNjI1IEwyNjQuNTEzLDI4Mi4wNjI1IEwyNzQuNTEzLDI4Mi4wNjI1IEwyNjQuNTEzLDI3Mi4wNjI1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNTEyMyIgeD0iMTQ3LjAwMDciIHk9IjI4OS4xMjk0Ij4mIzI0MDQ2OyYjMzg5ODk7ICsyMCwwMDAmIzIwODcwOyYjMTIzNjQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjE0Ny4wMDA3IiB5PSIzMDQuMjYyMiI+JiMzMjAyMDsmIzIyNjc5OyYjMTIzOTI7JiMxMjM3NTsmIzEyMzkwOyYjMzUzMzY7JiMxOTk3ODs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY4LjAwMDQiIHg9IjUzLjAwMDMiIHk9IjI3NS4yMTA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDguMDAwNCIgeD0iNjMuMDAwMyIgeT0iMjk2LjM0OTYiPiYjMzIwODA7JiMyNjUyNDsmIzMwOTA2OyYjMzU0Njk7PC90ZXh0PjxlbGxpcHNlIGN4PSI4Ny4wMDA1IiBjeT0iMzQzLjMyODEiIGZpbGw9Im5vbmUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGVsbGlwc2UgY3g9Ijg3LjAwMDUiIGN5PSIzNDMuMzI4MSIgZmlsbD0iIzIyMjIyMiIgcng9IjYiIHJ5PSI2IiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg3LjAwMDUiIHgyPSI4Ny4wMDA1IiB5MT0iNjcuMjk2OSIgeTI9Ijg3LjI5NjkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgzLjAwMDUsNzcuMjk2OSw4Ny4wMDA1LDg3LjI5NjksOTEuMDAwNSw3Ny4yOTY5LDg3LjAwMDUsODEuMjk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ny4wMDA1IiB4Mj0iODcuMDAwNSIgeTE9IjEyMS4yNjU2IiB5Mj0iMTQ1LjEyODkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgzLjAwMDUsMTM1LjEyODksODcuMDAwNSwxNDUuMTI4OSw5MS4wMDA1LDEzNS4xMjg5LDg3LjAwMDUsMTM5LjEyODkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODcuMDAwNSIgeDI9Ijg3LjAwMDUiIHkxPSIxNzkuMDk3NyIgeTI9IjIxMC41MjczIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI4My4wMDA1LDIwMC41MjczLDg3LjAwMDUsMjEwLjUyNzMsOTEuMDAwNSwyMDAuNTI3Myw4Ny4wMDA1LDIwNC41MjczIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijg3LjAwMDUiIHgyPSI4Ny4wMDA1IiB5MT0iMjQ0LjQ5NjEiIHkyPSIyNzUuMjEwOSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iODMuMDAwNSwyNjUuMjEwOSw4Ny4wMDA1LDI3NS4yMTA5LDkxLjAwMDUsMjY1LjIxMDksODcuMDAwNSwyNjkuMjEwOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4Ny4wMDA1IiB4Mj0iODcuMDAwNSIgeTE9IjMwOS4xNzk3IiB5Mj0iMzMyLjMyODEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgzLjAwMDUsMzIyLjMyODEsODcuMDAwNSwzMzIuMzI4MSw5MS4wMDA1LDMyMi4zMjgxLDg3LjAwMDUsMzI2LjMyODEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48P3BsYW50dW1sLXNyYyBUUDNGSWlEMDQ4Vmwtbkh4aHFCZ0NSdkFCWHdBNVlJTGtpU1VKNVJKYUFPR1lyWUtNaDJEU0lzT1duWWl6S19WblNka1BqXzI5SU5MMlh2ZGNGYy10bW5mYWlDNkJoOU9sR3J1RHY2SDFxdWc0ZlNsQ3VHd0NXanJIcjZjQmF5d3c5WmlqR2Fvdk1KMXFzaW56eTVQdmt5dHlleGZiTThNV25sOGdxTUh6N1FIdEk4RHQ2eGs3bjBKdnZ5ejRfRmZLcHVGTEZUU3RWUk5xdlBURHVtam1wMnV2LTRsUnUzaEVyTTlhQWFwaFVadm5xWnVxSVFLZHo1QXBOV0tiakh4b21PdzFaUzY2ZTN4TVoxVkFvcngtcVVZZ1ZoQ193ZFlTR2hFNDlwSkFjWTk3MDl6LUNNaFJRSUtNSUo2OF9zSU9qUl80XzRickduU01xLTM0cmdzVkJ4VzR3cldmSVhQR1A1LVJVbGU2bTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_4">なぜ赤黒処理が必要か<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>方式</th>
<th>メリット</th>
<th>デメリット</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>物理削除</strong></td>
<td>シンプル</td>
<td>監査証跡なし、復元不可</td>
</tr>
<tr>
<td><strong>論理削除</strong></td>
<td>証跡保持</td>
<td>集計時に除外処理必要</td>
</tr>
<tr>
<td><strong>赤黒処理</strong></td>
<td>監査証跡完全、会計的に正確</td>
<td>伝票数増加</td>
</tr>
</tbody>
</table>
<p>会計領域では、一度確定した伝票を直接修正することは認められません。赤黒処理により、すべての変更履歴が伝票として残り、監査対応が可能になります。</p>
<h3 id="_5">伝票区分の定義<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNUQVRFIiBoZWlnaHQ9IjUxOHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDY1cHg7aGVpZ2h0OjUxOHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQ2NSA1MTgiIHdpZHRoPSI0NjVweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjAyNTM7JiMzMTA4MDsmIzIxMzA2OyYjMjA5OTg7JiMxMjM5ODsmIzM2OTgzOyYjMzEyMjc7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMTc2LjUwMDMiIHk9IjIyLjk5NTEiPiYjMjAyNTM7JiMzMTA4MDsmIzIxMzA2OyYjMjA5OTg7JiMxMjM5ODsmIzM2OTgzOyYjMzEyMjc7PC90ZXh0PjwvZz48Zz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwLjI2NTYiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA0LjAwMDYiIHg9IjE2MyIgeT0iMTI0LjI5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxNjMiIHgyPSIyNjcuMDAwNiIgeTE9IjE1MC41OTM4IiB5Mj0iMTUwLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy45OTk5IiB4PSIyMDEuMDAwNCIgeT0iMTQyLjI5MiI+JiMzNjg5MDsmIzI0MTIwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NC4wMDA2IiB4PSIxNjgiIHk9IjE2Ni43MzI0Ij4mIzM2ODkwOyYjMjQxMjA7JiMxMjM5ODsmIzI2OTg5OyYjMjEyMDk7JiMyMDI1MzsmIzMxMDgwOzwvdGV4dD48L2c+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MC4yNjU2IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC4wMDA5IiB4PSIxNDUiIHk9IjI1MS41NjY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTQ1IiB4Mj0iMjg1LjAwMDkiIHkxPSIyNzcuODYzOCIgeTI9IjI3Ny44NjM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iMjAxLjAwMDUiIHk9IjI2OS41NjIiPiYjMzYxOTY7JiMyMDI1Mzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIwLjAwMDkiIHg9IjE1MCIgeT0iMjk0LjAwMjQiPiYjMjA4MDM7JiMyMDI1MzsmIzMxMDgwOyYjMTIzOTg7JiMxMjUxMDsmIzEyNDUyOyYjMTI0OTA7JiMxMjQ3MzsmIzM1MzM2OyYjMTk5Nzg7PC90ZXh0PjwvZz48Zz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUwLjI2NTYiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE2LjAwMDciIHg9IjciIHk9IjM3OC44MjY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNyIgeDI9IjEyMy4wMDA3IiB5MT0iNDA1LjEyMzgiIHkyPSI0MDUuMTIzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3Ljk5OTkiIHg9IjUxLjAwMDQiIHk9IjM5Ni44MjIiPiYjNDA2NTg7JiMyMDI1Mzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTYuMDAwNyIgeD0iMTIiIHk9IjQyMS4yNjI0Ij4mIzI3NDkxOyYjMTIzNzU7JiMxMjM1NjsmIzIwODY5OyYjMjM0ODE7JiMxMjM5MTsmIzM1MzM2OyYjMTk5Nzg7PC90ZXh0PjwvZz48ZWxsaXBzZSBjeD0iMjE1IiBjeT0iNTMuMjk2OSIgZmlsbD0iIzIyMjIyMiIgcng9IjEwIiByeT0iMTAiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZWxsaXBzZSBjeD0iMjE1IiBjeT0iNTAxLjA5NjkiIGZpbGw9Im5vbmUiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGVsbGlwc2UgY3g9IjIxNSIgY3k9IjUwMS4wOTY5IiBmaWxsPSIjMjIyMjIyIiByeD0iNiIgcnk9IjYiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4yIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgaWQ9ImVudDAwMDMiPjxwYXRoIGQ9Ik0zMjAsMjU2LjU2NjkgTDMyMCwyNzIuNjk2OSBMMjg1LjM1LDI3Ni42OTY5IEwzMjAsMjgwLjY5NjkgTDMyMCwyOTYuODMyNSBBMCwwIDAgMCAwIDMyMCwyOTYuODMyNSBMNDU4LjAwMDEsMjk2LjgzMjUgQTAsMCAwIDAgMCA0NTguMDAwMSwyOTYuODMyNSBMNDU4LjAwMDEsMjY2LjU2NjkgTDQ0OC4wMDAxLDI1Ni41NjY5IEwzMjAsMjU2LjU2NjkgQTAsMCAwIDAgMCAzMjAsMjU2LjU2NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NDguMDAwMSwyNTYuNTY2OSBMNDQ4LjAwMDEsMjY2LjU2NjkgTDQ1OC4wMDAxLDI2Ni41NjY5IEw0NDguMDAwMSwyNTYuNTY2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjMyNiIgeT0iMjczLjYzMzgiPiYjMzczMjk7JiMzODk4OTsmIzEyMzk5OyYjMjA4MDM7JiMyMDI1MzsmIzMxMDgwOyYjMTIzOTg7JiMzNjAwMDsmIzI1OTY4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSIzMjYiIHk9IjI4OC43NjY2Ij4mIzY1Mjg4OyYjMTI1MTA7JiMxMjQ1MjsmIzEyNDkwOyYjMTI0NzM7JiMyMDUxNjsmIzY1Mjg5OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01ONSIgZGF0YS1zb3VyY2UtbGluZT0iMjEiIGlkPSJlbnQwMDA2Ij48cGF0aCBkPSJNMTU4LDM4My44MjY5IEwxNTgsMzk5Ljk2NjkgTDEyMy4yMiw0MDMuOTY2OSBMMTU4LDQwNy45NjY5IEwxNTgsNDI0LjA5MjUgQTAsMCAwIDAgMCAxNTgsNDI0LjA5MjUgTDI5Ni4wMDAxLDQyNC4wOTI1IEEwLDAgMCAwIDAgMjk2LjAwMDEsNDI0LjA5MjUgTDI5Ni4wMDAxLDM5My44MjY5IEwyODYuMDAwMSwzODMuODI2OSBMMTU4LDM4My44MjY5IEEwLDAgMCAwIDAgMTU4LDM4My44MjY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjg2LjAwMDEsMzgzLjgyNjkgTDI4Ni4wMDAxLDM5My44MjY5IEwyOTYuMDAwMSwzOTMuODI2OSBMMjg2LjAwMDEsMzgzLjgyNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy4wMDAxIiB4PSIxNjQiIHk9IjQwMC44OTM4Ij4mIzM1MzMwOyYjMjc0OTE7JiMyNDQ2MDsmIzEyMzk4OyYjMjc0OTE7JiMxMjM3NTsmIzEyMzU2OyYjMzczMjk7JiMzODk4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMTY0IiB5PSI0MTYuMDI2NiI+JiM2NTI4ODsmIzEyNTAzOyYjMTI1MjE7JiMxMjQ3MzsmIzIwNTE2OyYjNjUyODk7PC90ZXh0PjwvZz48IS0tbGluayAqc3RhcnQqIHRvID8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDIiIGRhdGEtZW50aXR5LTI9ImVudDAwMDIiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0ibG5rMyI+PHBhdGggZD0iTTIxNSw2My42NjY5IEMyMTUsNzcuNjE2OSAyMTUsOTguMzI2OSAyMTUsMTE4LjA0NjkiIGZpbGw9Im5vbmUiIGlkPSIqc3RhcnQqLXRvLSYjMzY4OTA7JiMyNDEyMDsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIxNSwxMjQuMDQ2OSwyMTksMTE1LjA0NjksMjE1LDExOS4wNDY5LDIxMSwxMTUuMDQ2OSwyMTUsMTI0LjA0NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgPz8gdG8gPz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjUiIGlkPSJsbms0Ij48cGF0aCBkPSJNMTgxLjE5LDE3NC43ODY5IEMxNzIuMjcsMTgzLjEyNjkgMTYzLjgxLDE5My4yMzY5IDE1OSwyMDQuNTY2OSBDMTUxLjcsMjIxLjc4NjkgMTU4Ljc4MzQsMjM0LjM5NDQgMTczLjI4MzQsMjQ3LjIwNDQiIGZpbGw9Im5vbmUiIGlkPSImIzM2ODkwOyYjMjQxMjA7LXRvLSYjMzYxOTY7JiMyMDI1MzsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3Ny43OCwyNTEuMTc2OSwxNzMuNjgzNSwyNDIuMjIwNCwxNzQuMDMyOCwyNDcuODY2NSwxNjguMzg2OCwyNDguMjE1OCwxNzcuNzgsMjUxLjE3NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIxNjAiIHk9IjIxNy42MzM4Ij4mIzM1MzMwOyYjMjc0OTE7JiMxMjM2NDsmIzI0NTE3OyYjMzUyMDE7PC90ZXh0PjwvZz48IS0tbGluayA/PyB0byA/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAyIiBkYXRhLWVudGl0eS0yPSJlbnQwMDAzIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImxuazUiPjxwYXRoIGQ9Ik0yMjQuNDMsMTc0Ljk2NjkgQzIyOC42LDE4OC42MDY5IDIzMi4xMywyMDUuOTM2OSAyMzAsMjIxLjU2NjkgQzIyOC42NiwyMzEuNDI2OSAyMjcuNzA4OCwyMzYuMjYyNCAyMjQuOTk4OCwyNDUuNDQyNCIgZmlsbD0ibm9uZSIgaWQ9IiYjMzY4OTA7JiMyNDEyMDstdG8tJiMzNjE5NjsmIzIwMjUzOy0xIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMjMuMywyNTEuMTk2OSwyMjkuNjg0NSwyNDMuNjk3NiwyMjQuNzE1NiwyNDYuNDAxNSwyMjIuMDExOCwyNDEuNDMyNiwyMjMuMywyNTEuMTk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjIzMS42NCIgeT0iMjE3LjYzMzgiPiYjMjE0NjI7JiMyODA0MDsmIzEyMzY0OyYjMjQ1MTc7JiMzNTIwMTs8L3RleHQ+PC9nPjwhLS1saW5rID8/IHRvID8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDQiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBpZD0ibG5rNiI+PHBhdGggZD0iTTE4NS43MiwzMDIuMTQ2OSBDMTU5LjM4LDMyNC4xNDY5IDEyNS40NjUsMzUyLjQ3MDYgOTkuMDY1LDM3NC41MjA2IiBmaWxsPSJub25lIiBpZD0iJiMzNjE5NjsmIzIwMjUzOy10by0mIzQwNjU4OyYjMjAyNTM7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5NC40NiwzNzguMzY2OSwxMDMuOTMxNywzNzUuNjY3NSw5OC4yOTc1LDM3NS4xNjE3LDk4LjgwMzQsMzY5LjUyNzUsOTQuNDYsMzc4LjM2NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTQ5Ljk4IiB5PSIzNDQuODkzOCI+JiMzNTMzMDsmIzI3NDkxOyYjMjA4Njk7JiMyMzQ4MTsmIzEyMzkxOyYjMjA4Nzc7JiMzNTMzNjsmIzE5OTc4OzwvdGV4dD48L2c+PCEtLWxpbmsgPz8gdG8gKmVuZCotLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0ibG5rOCI+PHBhdGggZD0iTTI1MC4wNSwzMDEuOTQ2OSBDMjczLjAyLDMyMC4xMDY5IDMwMS4xLDM0Ny4yMDY5IDMxNCwzNzguODI2OSBDMzIyLjQ0LDM5OS41MTY5IDMyNC4yLDQwOS4yMjY5IDMxNCw0MjkuMDk2OSBDMjk0Ljk3LDQ2Ni4xNjY5IDI1Mi4xOTg3LDQ4Ni4wNjk1IDIzMC45MTg3LDQ5NC4yNjk1IiBmaWxsPSJub25lIiBpZD0iJiMzNjE5NjsmIzIwMjUzOy10by0qZW5kKiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjI1LjMyLDQ5Ni40MjY5LDIzNS4xNTYzLDQ5Ni45MjMzLDIyOS45ODU2LDQ5NC42MjksMjMyLjI3OTgsNDg5LjQ1ODMsMjI1LjMyLDQ5Ni40MjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMzIyLjAxIiB5PSI0MDguNTMzOCI+JiMyMTQ2MjsmIzI4MDQwOyYjMTIzOTg7JiMxMjQxNTsmIzEyMzk4OyYjMjI1ODA7JiMyMTUxMjs8L3RleHQ+PC9nPjwhLS1saW5rID8/IHRvICplbmQqLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDQiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImxuazkiPjxwYXRoIGQ9Ik0xMDMuNjMsNDI5LjQ2NjkgQzEzOC4xOCw0NTEuMzc2OSAxODEuMjQzNSw0NzguNjgyOCAyMDAuOTYzNSw0OTEuMTkyOCIgZmlsbD0ibm9uZSIgaWQ9IiYjNDA2NTg7JiMyMDI1MzstdG8tKmVuZCoiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwNi4wMyw0OTQuNDA2OSwyMDAuNTczLDQ4Ni4yMDgsMjAxLjgwNzksNDkxLjcyODUsMTk2LjI4NzUsNDkyLjk2MzQsMjA2LjAzLDQ5NC40MDY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjw/cGxhbnR1bWwtc3JjIFJQMURKaUNtNDhOdFNtZ2xhTmUxNWJtNGlJRDA5VEhBQTBVZTRuOTJJU01GMTFMOGUyOUk2WE9EMkY2SmpYNHpwN0hJUHpLaHVESEU0cjRzalpwcHZkbHBSRFJER3VGRGFsanZGb0hfSjl3QkZDaHV6dG1tMFRaVXM2NnJzWFJCTWRTS253MGtqZ2RWS2Zac1h0SHNnd1FCVFp1V0ZXRFBiNGVITWtkbTJSYkZLcVN5eXR5clQ3d0pWZGNiMWlnRU9va3NqNEJ4MFFxMHhKUFE4bjV3aXhYVHc5T1JKZ3dnWGtHdzU4c0czeVpqaDhscE1BTGpYN21nSi1menE4SzdpMjhqei11WUZyeDFENGFoRDBjV3FKR0RUYkpWRnAxUFNxXzdXa3BhQ2RsaTg3LWpQWDNsbFZKdzNIUTlMcXIzaE0ySGQ4QkhzNkt2d1l6R3NPNEV6a0ZkdHJ3aWZibUtpOGxzb3BoajVtMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<table>
<thead>
<tr>
<th>伝票区分</th>
<th>説明</th>
<th>金額の符号</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>通常</strong></td>
<td>通常の業務伝票</td>
<td>正</td>
</tr>
<tr>
<td><strong>赤伝</strong></td>
<td>元伝票を打ち消す伝票</td>
<td>負（マイナス）</td>
</tr>
<tr>
<td><strong>黒伝</strong></td>
<td>訂正後の内容を計上する伝票</td>
<td>正</td>
</tr>
</tbody>
</table>
<h3 id="er">赤黒処理の ER 図<a class="headerlink" href="#er" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjU1MHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzEwcHg7aGVpZ2h0OjU1MHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMxMCA1NTAiIHdpZHRoPSIzMTBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMzYxOTY7JiM0MDY1ODsmIzIwOTY2OyYjMjk3MDI7JiMxMjM5ODtFUiYjMjIyNTk7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjM0MzQiIHg9Ijk2LjAxODMiIHk9IjIyLjk5NTEiPiYjMzYxOTY7JiM0MDY1ODsmIzIwOTY2OyYjMjk3MDI7JiMxMjM5ODtFUiYjMjIyNTk7PC90ZXh0PjwvZz48IS0tY2xhc3MgPz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMTAuOTY4OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTU3Ljk5OTUiIHg9IjUxLjY5IiB5PSI0NC4yOTY5Ii8+PGVsbGlwc2UgY3g9IjY2LjY5IiBjeT0iNjAuMjk2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNNzAuNzk5NCw2Ni4yOTY5IEw2My4wODA2LDY2LjI5NjkgTDYzLjA4MDYsNTMuOTA2MyBMNzAuNzk5NCw1My45MDYzIEw3MC43OTk0LDU2LjA2MjUgTDY1LjUzMzgsNTYuMDYyNSBMNjUuNTMzOCw1OC43MzQ0IEw3MC4yOTk0LDU4LjczNDQgTDcwLjI5OTQsNjAuODkwNiBMNjUuNTMzOCw2MC44OTA2IEw2NS41MzM4LDY0LjE0MDYgTDcwLjc5OTQsNjQuMTQwNiBMNzAuNzk5NCw2Ni4yOTY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI1Ljk5OTUiIHg9IjgwLjY5IiB5PSI2NS4xNDM2Ij4mIzM2MTk2OyYjNDA2NTg7JiMyMDk2NjsmIzI5NzAyOyYjMjM2NTM7JiMyNzUwODsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNTIuNjkiIHgyPSIyMDguNjg5NSIgeTE9Ijc2LjI5NjkiIHkyPSI3Ni4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuMTEzMyIgeD0iNTcuNjkiIHk9IjkzLjI5MiI+SUQgJiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjUyLjY5IiB4Mj0iMjA4LjY4OTUiIHkxPSIxMDAuNTkzOCIgeTI9IjEwMC41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuMDA4NSIgeD0iNTcuNjkiIHk9IjExNy41ODg5Ij4mIzIwOTY2OyYjMjk3MDI7JiMzMDA1ODsmIzIxNDk1OyAmIzE3MTtVSyYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI1Ny42OSIgeT0iMTMzLjg4NTciPiYjMjA5NjY7JiMyOTcwMjsmIzI2MDg1OyYjMjYxNzg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjU3LjY5IiB5PSIxNTAuMTgyNiI+JiMyMDI1MzsmIzMxMDgwOyYjMzEyNzg7JiMyMTAyOTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNTcuNjkiIHk9IjE2Ni40Nzk1Ij4mIzIwODAzOyYjMjAyNTM7JiMzMTA4MDsmIzMwMDU4OyYjMjE0OTU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjU3LjY5IiB5PSIxODIuNzc2NCI+JiMzNjE5NjsmIzIwMjUzOyYjMzEwODA7JiMzMDA1ODsmIzIxNDk1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI1Ny42OSIgeT0iMTk5LjA3MzIiPiYjNDA2NTg7JiMyMDI1MzsmIzMxMDgwOyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iNTcuNjkiIHk9IjIxNS4zNzAxIj4mIzIwOTY2OyYjMjk3MDI7JiMyOTcwMjsmIzMwMDAxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSI1Ny42OSIgeT0iMjMxLjY2NyI+JiMyMDk2NjsmIzI5NzAyOyYjMzI3NzM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjU3LjY5IiB5PSIyNDcuOTYzOSI+JiMyMDMxNjsmIzI1MTA0OyYjMjYwODU7JiMyNjE3ODs8L3RleHQ+PC9nPjwhLS1jbGFzcyA/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjEwLjk2ODgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMC44MTQxIiB4PSI3MC4yOCIgeT0iMzMyLjI2NjkiLz48ZWxsaXBzZSBjeD0iOTMuNzQ2NSIgY3k9IjM0OC4yNjY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik05Ny44NTU5LDM1NC4yNjY5IEw5MC4xMzcxLDM1NC4yNjY5IEw5MC4xMzcxLDM0MS44NzYyIEw5Ny44NTU5LDM0MS44NzYyIEw5Ny44NTU5LDM0NC4wMzI1IEw5Mi41OTAzLDM0NC4wMzI1IEw5Mi41OTAzLDM0Ni43MDQ0IEw5Ny4zNTU5LDM0Ni43MDQ0IEw5Ny4zNTU5LDM0OC44NjA2IEw5Mi41OTAzLDM0OC44NjA2IEw5Mi41OTAzLDM1Mi4xMTA2IEw5Ny44NTU5LDM1Mi4xMTA2IEw5Ny44NTU5LDM1NC4yNjY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMTA5LjYyNzkiIHk9IjM1My4xMTM2Ij4mIzIyNzcwOyYjMTk5Nzg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjcxLjI4IiB4Mj0iMTkwLjA5NDEiIHkxPSIzNjQuMjY2OSIgeTI9IjM2NC4yNjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuMTEzMyIgeD0iNzYuMjgiIHk9IjM4MS4yNjIiPklEICYjMTcxO1BLJiMxODc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3MS4yOCIgeDI9IjE5MC4wOTQxIiB5MT0iMzg4LjU2MzciIHkyPSIzODguNTYzNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3LjAwODUiIHg9Ijc2LjI4IiB5PSI0MDUuNTU4OSI+JiMyMjc3MDsmIzE5OTc4OyYjMzAwNTg7JiMyMTQ5NTsgJiMxNzE7VUsmIzE4Nzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjgxNDEiIHg9Ijc2LjI4IiB5PSI0MjEuODU1NyI+JiMzOTAxNTsmIzIzNDU4OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OyAmIzE3MTtGSyYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSI3Ni4yOCIgeT0iNDM4LjE1MjYiPiYjMjI3NzA7JiMxOTk3ODsmIzI2MDg1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI3Ni4yOCIgeT0iNDU0LjQ0OTUiPiYjMjI3NzA7JiMxOTk3ODsmIzM3MzI5OyYjMzg5ODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9Ijc2LjI4IiB5PSI0NzAuNzQ2NCI+JiMyODA0MDsmIzM2MDI3OyYjMzEyNDY7JiMzODk4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iNzYuMjgiIHk9IjQ4Ny4wNDMyIj4mIzIxNTEyOyYjMzUzMzY7JiMzNzMyOTsmIzM4OTg5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI3Ni4yOCIgeT0iNTAzLjM0MDEiPiYjMjAyNTM7JiMzMTA4MDsmIzIxMzA2OyYjMjA5OTg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9Ijc2LjI4IiB5PSI1MTkuNjM3Ij4mIzIwODAzOyYjMjAyNTM7JiMzMTA4MDsmIzMwMDU4OyYjMjE0OTU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9Ijc2LjI4IiB5PSI1MzUuOTMzOSI+JiMxMjQ3MzsmIzEyNDg2OyYjMTI1NDA7JiMxMjQ3OTsmIzEyNDczOzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01ONyIgZGF0YS1zb3VyY2UtbGluZT0iMzYiIGlkPSJlbnQwMDA4Ij48cGF0aCBkPSJNMjI2LDQwMi40ODY5IEwyMjYsNDMzLjc1NjkgTDE5MS40MSw0MzcuNzU2OSBMMjI2LDQ0MS43NTY5IEwyMjYsNDczLjAxODEgQTAsMCAwIDAgMCAyMjYsNDczLjAxODEgTDMwMy4zNzk5LDQ3My4wMTgxIEEwLDAgMCAwIDAgMzAzLjM3OTksNDczLjAxODEgTDMwMy4zNzk5LDQxMi40ODY5IEwyOTMuMzc5OSw0MDIuNDg2OSBMMjI2LDQwMi40ODY5IEEwLDAgMCAwIDAgMjI2LDQwMi40ODY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjkzLjM3OTksNDAyLjQ4NjkgTDI5My4zNzk5LDQxMi40ODY5IEwzMDMuMzc5OSw0MTIuNDg2OSBMMjkzLjM3OTksNDAyLjQ4NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2LjM3OTkiIHg9IjIzMiIgeT0iNDE5LjU1MzgiPiYjMjAyNTM7JiMzMTA4MDsmIzIxMzA2OyYjMjA5OTg7OjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNC44MjMzIiB4PSIyMzIiIHk9IjQzNC42ODY2Ij4tICYjMzY4OTA7JiMyNDEyMDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQuODIzMyIgeD0iMjMyIiB5PSI0NDkuODE5NCI+LSAmIzM2MTk2OyYjMjAyNTM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0LjgyMzMiIHg9IjIzMiIgeT0iNDY0Ljk1MjIiPi0gJiM0MDY1ODsmIzIwMjUzOzwvdGV4dD48L2c+PCEtLWxpbmsgPz8/Pz8/Pz8/IHRvID8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDIiIGRhdGEtZW50aXR5LTI9ImVudDAwMDMiIGRhdGEtbGluay10eXBlPSJjcm93Zm9vdCIgZGF0YS1zb3VyY2UtbGluZT0iMzEiIGlkPSJsbms0Ij48cGF0aCBjb2RlTGluZT0iMzEiIGQ9Ik00MC41NjIyLDI0NC42NzgyIEMyOC4wMjIyLDI2MS41OTgyIDI3LjY0LDI2NS44MDY5IDIwLjY5LDI4NS4yNjY5IEM2LDMyNi40MzY5IDMxLjA2MTYsMzYwLjkzMDcgNjMuOTAxNiwzODkuMzYwNyIgZmlsbD0ibm9uZSIgaWQ9IiYjMzYxOTY7JiM0MDY1ODsmIzIwOTY2OyYjMjk3MDI7JiMyMzY1MzsmIzI3NTA4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5Oy0mIzIyNzcwOyYjMTk5Nzg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjQ2LjUxNjUiIHgyPSI0Ni40NTk2IiB5MT0iMjM2LjY0NDEiIHkyPSIyMjYuNjQ0MyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0Ni41MTY1IiB4Mj0iNTYuMTAwNCIgeTE9IjIzNi42NDQxIiB5Mj0iMjMzLjc4OTUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNDYuNTE2NSIgeDI9IjUxLjI4IiB5MT0iMjM2LjY0NDEiIHkyPSIyMzAuMjE2OSIvPjxlbGxpcHNlIGN4PSI0Mi45NDQiIGN5PSIyNDEuNDY0NiIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjY5LjU0MzkiIHgyPSI2NC4zMDc3IiB5MT0iMzg4Ljk1NDYiIHkyPSIzOTUuMDAzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjY3LjI3NTgiIHgyPSI2Mi4wMzk2IiB5MT0iMzg2Ljk5MTEiIHkyPSIzOTMuMDM5NCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2My45MDE2IiB4Mj0iNjkuOTUiIHkxPSIzODkuMzYwNyIgeTI9IjM5NC41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iMjEuNjkiIHk9IjI5OC4zMzM4Ij4mIzIwODAzOyYjMjAyNTM7JiMzMTA4MDsmIzMwMDU4OyYjMjE0OTU7PC90ZXh0PjwvZz48IS0tbGluayA/Pz8/Pz8/Pz8gdG8gPz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImNyb3dmb290IiBkYXRhLXNvdXJjZS1saW5lPSIzMiIgaWQ9ImxuazUiPjxwYXRoIGNvZGVMaW5lPSIzMiIgZD0iTTEyNy44MTMxLDI3My43NjQzIEMxMjcuNjQzMSwyODMuNzM0MyAxMjcuOCwyNzUuNjk2OSAxMjcuNjksMjg1LjI2NjkgQzEyNy41MiwzMDAuMzk2OSAxMjcuMzk4MSwzMDEuMzY4IDEyNy41ODgxLDMxNy4wMzgiIGZpbGw9Im5vbmUiIGlkPSImIzM2MTk2OyYjNDA2NTg7JiMyMDk2NjsmIzI5NzAyOyYjMjM2NTM7JiMyNzUwODsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTstJiMyMjc3MDsmIzE5OTc4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5Oy0xIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyNy45ODM2IiB4Mj0iMTIyLjEyMDkiIHkxPSIyNjMuNzY1NyIgeTI9IjI1NS42NjQ2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyNy45ODM2IiB4Mj0iMTM0LjExOTEiIHkxPSIyNjMuNzY1NyIgeTI9IjI1NS44NjkyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyNy45ODM2IiB4Mj0iMTI4LjEyIiB5MT0iMjYzLjc2NTciIHkyPSIyNTUuNzY2OSIvPjxlbGxpcHNlIGN4PSIxMjcuODgxMyIgY3k9IjI2OS43NjQ4IiBmaWxsPSJub25lIiByeD0iNCIgcnk9IjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTI3LjYzNjYiIHgyPSIxMjcuNzciIHkxPSIzMjEuMDM3NyIgeTI9IjMzMi4wMzY5Ii8+PGVsbGlwc2UgY3g9IjEyNy42MzY2IiBjeT0iMzIxLjAzNzciIGZpbGw9Im5vbmUiIHJ4PSI0IiByeT0iNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMzEuNzIxMiIgeDI9IjEyMy43MjE4IiB5MT0iMzI3Ljk4ODciIHkyPSIzMjguMDg1NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjEyOC42OSIgeT0iMjk4LjMzMzgiPiYjMzYxOTY7JiMyMDI1MzsmIzMxMDgwOyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PC9nPjwhLS1saW5rID8/Pz8/Pz8/PyB0byA/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAyIiBkYXRhLWVudGl0eS0yPSJlbnQwMDAzIiBkYXRhLWxpbmstdHlwZT0iY3Jvd2Zvb3QiIGRhdGEtc291cmNlLWxpbmU9IjMzIiBpZD0ibG5rNiI+PHBhdGggY29kZUxpbmU9IjMzIiBkPSJNMjAxLjgzMTgsMjcyLjc4MjIgQzIwNS44MjE4LDI4OC4xOTIyIDIwMi40LDI4Ni43MDY5IDE5OC42OSwzMDIuMjY2OSBDMTk2LjMyLDMxMi4xOTY5IDE5OC40NDQ3LDMwOC4yMDE0IDE5NC42ODQ3LDMxOC4wNjE0IiBmaWxsPSJub25lIiBpZD0iJiMzNjE5NjsmIzQwNjU4OyYjMjA5NjY7JiMyOTcwMjsmIzIzNjUzOyYjMjc1MDg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7LSYjMjI3NzA7JiMxOTk3ODsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTstMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxOTkuMzI1MyIgeDI9IjE5MS41MTE1IiB5MT0iMjYzLjEwMTUiIHkyPSIyNTYuODYwOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxOTkuMzI1MyIgeDI9IjIwMy4xMjg1IiB5MT0iMjYzLjEwMTUiIHkyPSIyNTMuODUyOSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxOTkuMzI1MyIgeDI9IjE5Ny4zMiIgeTE9IjI2My4xMDE1IiB5Mj0iMjU1LjM1NjkiLz48ZWxsaXBzZSBjeD0iMjAwLjgyOTIiIGN5PSIyNjguOTA5OSIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE5My4yNTk0IiB4Mj0iMTg5LjM0IiB5MT0iMzIxLjc5ODgiIHkyPSIzMzIuMDc2OSIvPjxlbGxpcHNlIGN4PSIxOTMuMjU5NCIgY3k9IjMyMS43OTg4IiBmaWxsPSJub25lIiByeD0iNCIgcnk9IjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTk0LjUwMjciIHgyPSIxODcuMDI3OCIgeTE9IjMyOS43NjQ2IiB5Mj0iMzI2LjkxNDIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIyMDEuNzEiIHk9IjI5OC4zMzM4Ij4mIzQwNjU4OyYjMjAyNTM7JiMzMTA4MDsmIzMwMDU4OyYjMjE0OTU7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBBeWFpb0tiTFVCNXJvU2xUYXZ3c0J0aS1lVXJudXBoTmVBVXBEdERuZlVRTFA5UEtlYVctdFJacXNUZWpadmxSN3BWbFVUb3FOdzZRb3pENW1TT2NtRGxFWmFqTmJta1l3RmRLTEtfeGptRTVHcTcyNEI1ZHF2Uy1jemQ0ek1KRnRFVEJMcG5WaVV2Zm5yQWtmd3RESzN2TzBuVkc4WEctcTVPS0ZqSHE4OWdvNFNmdnFUM0F6TUpsZDZTVDR3ME1yQ0FUX05KbmZZU3hrZDB4NUlvRHdqSU4ydlNfTlJWZVNURGNhOVJjSmcybTZ6VzdPQUwwMncyaWItcUpOb3hpdk5nc2hVRjVmanRGTF9JMUU0eWRUQm5PcUc2TFdSWndRUy1rZm5yajZCdnl0QkpwU05DUm41NTBEaVo1LTRBdURiek5qd082bXBUTTJiWDIzd3lYLVRXQ0dHem9pV24xWm9Va2xGb0lMOE1ZcEZJQzRlTnlEN0dEQUE1Wm5RTWh5QjlYcmpDVEV1MENZNkQwOGMwM1dINlBlVzBvMlcwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_6">マイグレーション：赤黒処理関連テーブルの作成<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<details>
<summary>V018__create_redblack_tables.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- src/main/resources/db/migration/V018__create_redblack_tables.sql</span>

<span class="c1">-- 伝票区分</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="err">伝票区分</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;通常&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;赤伝&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;黒伝&#39;</span><span class="p">);</span>

<span class="c1">-- 赤黒処理履歴データ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;赤黒処理履歴データ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;処理番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;処理日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;伝票種別&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;元伝票番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;赤伝票番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;黒伝票番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="w">    </span><span class="ss">&quot;処理理由&quot;</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;処理者&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="c1">-- 売上データに伝票区分を追加</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;売上データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="ss">&quot;伝票区分&quot;</span><span class="w"> </span><span class="err">伝票区分</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;通常&#39;</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;売上データ&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="ss">&quot;元伝票番号&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_赤黒処理履歴_元伝票番号&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;赤黒処理履歴データ&quot;</span><span class="p">(</span><span class="ss">&quot;元伝票番号&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_赤黒処理履歴_処理日時&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;赤黒処理履歴データ&quot;</span><span class="p">(</span><span class="ss">&quot;処理日時&quot;</span><span class="p">);</span>

<span class="c1">-- テーブルコメント</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;赤黒処理履歴データ&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;確定済み伝票の訂正履歴を管理するテーブル&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;赤黒処理履歴データ&quot;</span><span class="p">.</span><span class="ss">&quot;伝票種別&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;対象伝票の種類（売上、仕入、請求、支払）&#39;</span><span class="p">;</span>
</code></pre></div>

</details>

<h3 id="_7">赤黒処理エンティティの実装<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<details>
<summary>伝票区分 ENUM</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/SlipType.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Getter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 伝票区分.</span>
<span class="cm"> */</span>
<span class="nd">@Getter</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">SlipType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">NORMAL</span><span class="p">(</span><span class="s">&quot;通常&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">RED</span><span class="p">(</span><span class="s">&quot;赤伝&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">BLACK</span><span class="p">(</span><span class="s">&quot;黒伝&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">displayName</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 表示名から伝票区分を取得.</span>
<span class="cm">     *</span>
<span class="cm">     * @param displayName 表示名</span>
<span class="cm">     * @return 伝票区分</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">SlipType</span><span class="w"> </span><span class="nf">fromDisplayName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">displayName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SlipType</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="na">displayName</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">displayName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Unknown slip type: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">displayName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 赤伝かどうか.</span>
<span class="cm">     *</span>
<span class="cm">     * @return 赤伝の場合true</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RED</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 符号を取得（赤伝はマイナス）.</span>
<span class="cm">     *</span>
<span class="cm">     * @return 赤伝は-1、それ以外は1</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getSign</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RED</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>赤黒処理履歴エンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/RedBlackHistory.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 赤黒処理履歴.</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedBlackHistory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/** ID. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 処理番号. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">processNumber</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 処理日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">processDateTime</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 伝票種別. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">slipCategory</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 元伝票番号. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">originalSlipNumber</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 赤伝票番号. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">redSlipNumber</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 黒伝票番号. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">blackSlipNumber</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 処理理由. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">processReason</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 処理者. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">processedBy</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 作成日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="_8">赤黒処理サービスの実装<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Note:</strong> 以下のサービス層コードは参考実装例です。実際のシステムでは要件に応じてカスタマイズしてください。</p>
</blockquote>
<details>
<summary>赤黒処理サービス</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/application/service/RedBlackService.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.sales.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.infrastructure.persistence.mapper.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.format.DateTimeFormatter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RedBlackService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">RedBlackHistoryMapper</span><span class="w"> </span><span class="n">redBlackHistoryMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SalesMapper</span><span class="w"> </span><span class="n">salesMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SalesDetailMapper</span><span class="w"> </span><span class="n">salesDetailMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">NumberingService</span><span class="w"> </span><span class="n">numberingService</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 処理番号を生成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateProcessNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;RB-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">format</span><span class="p">(</span>
<span class="w">                </span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyyMMdd&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">latestNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redBlackHistoryMapper</span><span class="p">.</span><span class="na">findLatestProcessNumber</span><span class="p">(</span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">latestNumber</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span>
<span class="w">                    </span><span class="n">latestNumber</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">latestNumber</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span>
<span class="w">            </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentSequence</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%04d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sequence</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 売上の赤黒処理を実行</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RedBlackResult</span><span class="w"> </span><span class="nf">processSalesRedBlack</span><span class="p">(</span><span class="n">RedBlackInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 元伝票を取得</span>
<span class="w">        </span><span class="n">Sales</span><span class="w"> </span><span class="n">originalSales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">salesMapper</span><span class="p">.</span><span class="na">findBySalesNumber</span><span class="p">(</span>
<span class="w">                </span><span class="n">input</span><span class="p">.</span><span class="na">getOriginalSlipNumber</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">originalSales</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;元伝票が見つかりません: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">getOriginalSlipNumber</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">originalSales</span><span class="p">.</span><span class="na">getSlipType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">SlipType</span><span class="p">.</span><span class="na">NORMAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;通常伝票以外は赤黒処理できません&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SalesDetail</span><span class="o">&gt;</span><span class="w"> </span><span class="n">originalDetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">salesDetailMapper</span>
<span class="w">                </span><span class="p">.</span><span class="na">findBySalesNumber</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getOriginalSlipNumber</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 赤伝票を作成（元伝票のマイナス）</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">redSlipNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numberingService</span><span class="p">.</span><span class="na">generateSalesNumber</span><span class="p">();</span>
<span class="w">        </span><span class="n">Sales</span><span class="w"> </span><span class="n">redSales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createRedSales</span><span class="p">(</span><span class="n">originalSales</span><span class="p">,</span><span class="w"> </span><span class="n">redSlipNumber</span><span class="p">);</span>
<span class="w">        </span><span class="n">salesMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">redSales</span><span class="p">);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SalesDetail</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">originalDetails</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">SalesDetail</span><span class="w"> </span><span class="n">redDetail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createRedDetail</span><span class="p">(</span><span class="n">detail</span><span class="p">,</span><span class="w"> </span><span class="n">redSlipNumber</span><span class="p">);</span>
<span class="w">            </span><span class="n">salesDetailMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">redDetail</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 黒伝票を作成（訂正後の内容）</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">blackSlipNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getCorrectedData</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">blackSlipNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numberingService</span><span class="p">.</span><span class="na">generateSalesNumber</span><span class="p">();</span>
<span class="w">            </span><span class="n">Sales</span><span class="w"> </span><span class="n">blackSales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createBlackSales</span><span class="p">(</span>
<span class="w">                    </span><span class="n">originalSales</span><span class="p">,</span><span class="w"> </span><span class="n">blackSlipNumber</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">getCorrectedData</span><span class="p">());</span>
<span class="w">            </span><span class="n">salesMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">blackSales</span><span class="p">);</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">CorrectedDetailData</span><span class="w"> </span><span class="n">correctedDetail</span><span class="w"> </span><span class="p">:</span>
<span class="w">                    </span><span class="n">input</span><span class="p">.</span><span class="na">getCorrectedData</span><span class="p">().</span><span class="na">getDetails</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">SalesDetail</span><span class="w"> </span><span class="n">blackDetail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createBlackDetail</span><span class="p">(</span>
<span class="w">                        </span><span class="n">correctedDetail</span><span class="p">,</span><span class="w"> </span><span class="n">blackSlipNumber</span><span class="p">);</span>
<span class="w">                </span><span class="n">salesDetailMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">blackDetail</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 赤黒処理履歴を記録</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">processNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateProcessNumber</span><span class="p">();</span>
<span class="w">        </span><span class="n">RedBlackHistory</span><span class="w"> </span><span class="n">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedBlackHistory</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">processNumber</span><span class="p">(</span><span class="n">processNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">processDateTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">slipCategory</span><span class="p">(</span><span class="s">&quot;売上&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">originalSlipNumber</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getOriginalSlipNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">redSlipNumber</span><span class="p">(</span><span class="n">redSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">blackSlipNumber</span><span class="p">(</span><span class="n">blackSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">processReason</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getProcessReason</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">processedBy</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getProcessedBy</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">redBlackHistoryMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">history</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RedBlackResult</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">processNumber</span><span class="p">(</span><span class="n">processNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">originalSlipNumber</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">getOriginalSlipNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">redSlipNumber</span><span class="p">(</span><span class="n">redSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">blackSlipNumber</span><span class="p">(</span><span class="n">blackSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="nf">createRedSales</span><span class="p">(</span><span class="n">Sales</span><span class="w"> </span><span class="n">original</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">redSlipNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesNumber</span><span class="p">(</span><span class="n">redSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">customerCode</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getCustomerCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesDate</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getSalesDate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesAmount</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getSalesAmount</span><span class="p">().</span><span class="na">negate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">taxAmount</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getTaxAmount</span><span class="p">().</span><span class="na">negate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalAmount</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">().</span><span class="na">negate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">slipType</span><span class="p">(</span><span class="n">SlipType</span><span class="p">.</span><span class="na">RED</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">originalSlipNumber</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getSalesNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">SalesStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SalesDetail</span><span class="w"> </span><span class="nf">createRedDetail</span><span class="p">(</span><span class="n">SalesDetail</span><span class="w"> </span><span class="n">original</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">String</span><span class="w"> </span><span class="n">redSlipNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SalesDetail</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesNumber</span><span class="p">(</span><span class="n">redSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">detailNumber</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getDetailNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">productCode</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getProductCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">().</span><span class="na">negate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">amount</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getAmount</span><span class="p">().</span><span class="na">negate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="nf">createBlackSales</span><span class="p">(</span><span class="n">Sales</span><span class="w"> </span><span class="n">original</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">blackSlipNumber</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">CorrectedSalesData</span><span class="w"> </span><span class="n">correctedData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesNumber</span><span class="p">(</span><span class="n">blackSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">customerCode</span><span class="p">(</span><span class="n">correctedData</span><span class="p">.</span><span class="na">getCustomerCode</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                        </span><span class="o">?</span><span class="w"> </span><span class="n">correctedData</span><span class="p">.</span><span class="na">getCustomerCode</span><span class="p">()</span>
<span class="w">                        </span><span class="p">:</span><span class="w"> </span><span class="n">original</span><span class="p">.</span><span class="na">getCustomerCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesDate</span><span class="p">(</span><span class="n">correctedData</span><span class="p">.</span><span class="na">getSalesDate</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                        </span><span class="o">?</span><span class="w"> </span><span class="n">correctedData</span><span class="p">.</span><span class="na">getSalesDate</span><span class="p">()</span>
<span class="w">                        </span><span class="p">:</span><span class="w"> </span><span class="n">original</span><span class="p">.</span><span class="na">getSalesDate</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesAmount</span><span class="p">(</span><span class="n">correctedData</span><span class="p">.</span><span class="na">getSalesAmount</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">taxAmount</span><span class="p">(</span><span class="n">correctedData</span><span class="p">.</span><span class="na">getTaxAmount</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalAmount</span><span class="p">(</span><span class="n">correctedData</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">slipType</span><span class="p">(</span><span class="n">SlipType</span><span class="p">.</span><span class="na">BLACK</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">originalSlipNumber</span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="na">getSalesNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">SalesStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SalesDetail</span><span class="w"> </span><span class="nf">createBlackDetail</span><span class="p">(</span><span class="n">CorrectedDetailData</span><span class="w"> </span><span class="n">correctedDetail</span><span class="p">,</span>
<span class="w">                                           </span><span class="n">String</span><span class="w"> </span><span class="n">blackSlipNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SalesDetail</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">salesNumber</span><span class="p">(</span><span class="n">blackSlipNumber</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">detailNumber</span><span class="p">(</span><span class="n">correctedDetail</span><span class="p">.</span><span class="na">getDetailNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">productCode</span><span class="p">(</span><span class="n">correctedDetail</span><span class="p">.</span><span class="na">getProductCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">quantity</span><span class="p">(</span><span class="n">correctedDetail</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">unitPrice</span><span class="p">(</span><span class="n">correctedDetail</span><span class="p">.</span><span class="na">getUnitPrice</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">amount</span><span class="p">(</span><span class="n">correctedDetail</span><span class="p">.</span><span class="na">getAmount</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 赤黒処理履歴を取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RedBlackHistory</span><span class="w"> </span><span class="nf">findByProcessNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">processNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">redBlackHistoryMapper</span><span class="p">.</span><span class="na">findByProcessNumber</span><span class="p">(</span><span class="n">processNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 元伝票番号で赤黒処理履歴を検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">RedBlackHistory</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByOriginalSlipNumber</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">originalSlipNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">redBlackHistoryMapper</span><span class="p">.</span><span class="na">findByOriginalSlipNumber</span><span class="p">(</span><span class="n">originalSlipNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="112">11.2 自動採番の設計<a class="headerlink" href="#112" title="Permanent link">&para;</a></h2>
<h3 id="_9">採番の要件<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>要件</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>一意性</strong></td>
<td>同一種別内で重複しない</td>
</tr>
<tr>
<td><strong>連番性</strong></td>
<td>基本的に連番で発行</td>
</tr>
<tr>
<td><strong>可読性</strong></td>
<td>年月や種別が識別可能</td>
</tr>
<tr>
<td><strong>拡張性</strong></td>
<td>将来の要件変更に対応</td>
</tr>
</tbody>
</table>
<h3 id="_10">採番パターン<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjMyNXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTU2cHg7aGVpZ2h0OjMyNXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDE1NiAzMjUiIHdpZHRoPSIxNTZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjU1MDU7JiMzMDA1ODsmIzEyNDk3OyYjMTI0Nzk7JiMxMjU0MDsmIzEyNTMxOyYjMTIzOTg7JiMyMDM2Mzs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEuOTk5NSIgeD0iMTguMjcyIiB5PSIyMi45OTUxIj4mIzI1NTA1OyYjMzAwNTg7JiMxMjQ5NzsmIzEyNDc5OyYjMTI1NDA7JiMxMjUzMTsmIzEyMzk4OyYjMjAzNjM7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJOMSIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxwYXRoIGQ9Ik03LDQ0LjI5NjkgTDcsMzExLjU1NDcgTDE0Mi41NDM1LDMxMS41NTQ3IEwxNDIuNTQzNSw1NC4yOTY5IEwxMzIuNTQzNSw0NC4yOTY5IEw3LDQ0LjI5NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMzIuNTQzNSw0NC4yOTY5IEwxMzIuNTQzNSw1NC4yOTY5IEwxNDIuNTQzNSw1NC4yOTY5IEwxMzIuNTQzNSw0NC4yOTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjEzIiB5PSI2MS4zNjM4Ij4mIzIyNzcwOyYjMTk5Nzg7JiMyMDI1MzsmIzMxMDgwOyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA3LjU4NjQiIHg9IjEzIiB5PSI3Ni40OTY2Ij5TTC0yMDI1MDEtMDAwMTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3Ny42MTkyIiB4PSIxMyIgeT0iOTEuNjI5NCI+JiM5NTAwOyYjOTQ3MjsmIzk0NzI7IFNMOiAmIzIyNzcwOyYjMTk5Nzg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS43NTA1IiB4PSIxMyIgeT0iMTA2Ljc2MjIiPiYjOTUwMDsmIzk0NzI7JiM5NDcyOyAyMDI1MDE6ICYjMjQxODA7JiMyNjM3Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTUuMjA4NSIgeD0iMTMiIHk9IjEyMS44OTUiPiYjOTQ5MjsmIzk0NzI7JiM5NDcyOyAwMDAxOiAmIzM2ODk5OyYjMzAwNTg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQuMTMyMyIgeD0iMTMiIHk9IjEzNy4wMjc4Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjEzIiB5PSIxNTIuMTYwNiI+JiMyMTQ2MzsmIzI3ODgwOyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEzLjA5NjIiIHg9IjEzIiB5PSIxNjcuMjkzNSI+T1JELTIwMjUtMDAwMDE8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMzk5OSIgeD0iMTMiIHk9IjE4Mi40MjYzIj4mIzk1MDA7JiM5NDcyOyYjOTQ3MjsgT1JEOiAmIzIxNDYzOyYjMjc4ODA7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk1LjIwODUiIHg9IjEzIiB5PSIxOTcuNTU5MSI+JiM5NTAwOyYjOTQ3MjsmIzk0NzI7IDIwMjU6ICYjMjQxODA7JiMyNDIzMDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAzLjQ3OTUiIHg9IjEzIiB5PSIyMTIuNjkxOSI+JiM5NDkyOyYjOTQ3MjsmIzk0NzI7IDAwMDAxOiAmIzM2ODk5OyYjMzAwNTg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQuMTMyMyIgeD0iMTMiIHk9IjIyNy44MjQ3Ij4mIzE2MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjEzIiB5PSIyNDIuOTU3NSI+JiMzNTUzMTsmIzI3NzE0OyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0LjU0MzUiIHg9IjEzIiB5PSIyNTguMDkwMyI+SU5WLTIwMjUwMS0wMDAxPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0LjU3NjIiIHg9IjEzIiB5PSIyNzMuMjIzMSI+JiM5NTAwOyYjOTQ3MjsmIzk0NzI7IElOVjogJiMzNTUzMTsmIzI3NzE0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEuNzUwNSIgeD0iMTMiIHk9IjI4OC4zNTYiPiYjOTUwMDsmIzk0NzI7JiM5NDcyOyAyMDI1MDE6ICYjMjQxODA7JiMyNjM3Njs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTUuMjA4NSIgeD0iMTMiIHk9IjMwMy40ODg4Ij4mIzk0OTI7JiM5NDcyOyYjOTQ3MjsgMDAwMTogJiMzNjg5OTsmIzMwMDU4OzwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgQXlhaW9LYkxVRFF0eUZkS0xPLVI5cHZrc2wtdVVTX1p2aXNGNnpTenNUVkRuUE1OTnZBZ2E1WWl1NlY4ZlFOclRGNmM5cGt3ZGtvUC10cGYyZzN3Zl90UmpSSXVXZHJxWkdvQ0owcUNUR3FDMzBvdjdhc1B5c1hBMG4wZjFGak9BSzFxODBiMmIwOGJUY3Z2RGdTM0EzNDVBVzdJUkFObWljNG5xNjBrYTV0enF2empIalpZNy1HMmpXUGEyT2VqRzBjV1FNMzVRRFEwQk5jd1FuY2c5UVlzbDVaVF9Nblo0em1NSnh5bTc5dTFvYldmRzVJSng5bEtsMUc1SzNXMjAwMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_11">採番形式の種類<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>採番形式</th>
<th>説明</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>YEARLY</strong></td>
<td>年次でリセット</td>
<td>ORD-2025-00001</td>
</tr>
<tr>
<td><strong>MONTHLY</strong></td>
<td>月次でリセット</td>
<td>SL-202501-0001</td>
</tr>
<tr>
<td><strong>DAILY</strong></td>
<td>日次でリセット</td>
<td>SL-20250115-0001</td>
</tr>
<tr>
<td><strong>SEQUENTIAL</strong></td>
<td>リセットなし連番</td>
<td>SEQ-000001</td>
</tr>
</tbody>
</table>
<h3 id="er_1">採番テーブルの ER 図<a class="headerlink" href="#er_1" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjQ4NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzI3cHg7aGVpZ2h0OjQ4NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyNyA0ODUiIHdpZHRoPSIzMjdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjU1MDU7JiMzMDA1ODsmIzMxNjQ5OyYjMjk3MDI7JiMxMjM5ODtFUiYjMjIyNTk7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjM0MzQiIHg9IjEwNC4zNjkxIiB5PSIyMi45OTUxIj4mIzI1NTA1OyYjMzAwNTg7JiMzMTY0OTsmIzI5NzAyOyYjMTIzOTg7RVImIzIyMjU5OzwvdGV4dD48L2c+PCEtLWNsYXNzID8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIxMC45Njg4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEuMjAzOCIgeD0iMTEuNCIgeT0iNDQuMjk2OSIvPjxlbGxpcHNlIGN4PSIzNS4wNDE4IiBjeT0iNjAuMjk2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMzkuMTUxMiw2Ni4yOTY5IEwzMS40MzI1LDY2LjI5NjkgTDMxLjQzMjUsNTMuOTA2MyBMMzkuMTUxMiw1My45MDYzIEwzOS4xNTEyLDU2LjA2MjUgTDMzLjg4NTYsNTYuMDYyNSBMMzMuODg1Niw1OC43MzQ0IEwzOC42NTEyLDU4LjczNDQgTDM4LjY1MTIsNjAuODkwNiBMMzMuODg1Niw2MC44OTA2IEwzMy44ODU2LDY0LjE0MDYgTDM5LjE1MTIsNjQuMTQwNiBMMzkuMTUxMiw2Ni4yOTY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNTAuOTYyMyIgeT0iNjUuMTQzNiI+JiMyNTUwNTsmIzMwMDU4OyYjMTI1MTA7JiMxMjQ3MzsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMi40IiB4Mj0iMTMxLjYwMzgiIHkxPSI3Ni4yOTY5IiB5Mj0iNzYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS4yMDM4IiB4PSIxNy40IiB5PSI5My4yOTIiPiYjMjU1MDU7JiMzMDA1ODsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsgJiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyLjQiIHgyPSIxMzEuNjAzOCIgeTE9IjEwMC41OTM4IiB5Mj0iMTAwLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxNy40IiB5PSIxMTcuNTg4OSI+JiMyNTUwNTsmIzMwMDU4OyYjMjE1MTc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjE3LjQiIHk9IjEzMy44ODU3Ij4mIzEyNTAzOyYjMTI1MjQ7JiMxMjUwMTsmIzEyNDUxOyYjMTI0ODM7JiMxMjQ2MzsmIzEyNDczOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxNy40IiB5PSIxNTAuMTgyNiI+JiMyNTUwNTsmIzMwMDU4OyYjMjQ0MTg7JiMyNDMzNTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iMTcuNCIgeT0iMTY2LjQ3OTUiPiYjMjY2ODk7JiMyNTk2ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEuOTk5OCIgeD0iMTcuNCIgeT0iMTgyLjc3NjQiPiYjMjk2OTQ7JiMyMjMxMjsmIzIwNTE2OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIxNy40IiB5PSIxOTkuMDczMiI+JiMyNjM2ODsmIzMyMDY2OyYjMjU1MDU7JiMzMDA1ODsmIzI2MDg1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIxNy40IiB5PSIyMTUuMzcwMSI+JiMxMjUyMjsmIzEyNDc1OyYjMTI0ODM7JiMxMjQ4ODsmIzIzNTUwOyYjMzU5Mzc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjE3LjQiIHk9IjIzMS42NjciPiYjMjAzMTY7JiMyNTEwNDsmIzI2MDg1OyYjMjYxNzg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjE3LjQiIHk9IjI0Ny45NjM5Ij4mIzI2MzU2OyYjMjYwMzI7JiMyNjA4NTsmIzI2MTc4OzwvdGV4dD48L2c+PCEtLWNsYXNzID8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTQ1Ljc4MTMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOS45OTk2IiB4PSI3IiB5PSIzMzIuMjY2OSIvPjxlbGxpcHNlIGN4PSIyMiIgY3k9IjM0OC4yNjY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0yNi4xMDk0LDM1NC4yNjY5IEwxOC4zOTA2LDM1NC4yNjY5IEwxOC4zOTA2LDM0MS44NzYzIEwyNi4xMDk0LDM0MS44NzYzIEwyNi4xMDk0LDM0NC4wMzI1IEwyMC44NDM4LDM0NC4wMzI1IEwyMC44NDM4LDM0Ni43MDQ0IEwyNS42MDk0LDM0Ni43MDQ0IEwyNS42MDk0LDM0OC44NjA2IEwyMC44NDM4LDM0OC44NjA2IEwyMC44NDM4LDM1Mi4xMTA2IEwyNi4xMDk0LDM1Mi4xMTA2IEwyNi4xMDk0LDM1NC4yNjY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMzYiIHk9IjM1My4xMTM2Ij4mIzI1NTA1OyYjMzAwNTg7JiMyMzY1MzsmIzI3NTA4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTM1Ljk5OTYiIHkxPSIzNjQuMjY2OSIgeTI9IjM2NC4yNjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuMTEzMyIgeD0iMTMiIHk9IjM4MS4yNjIiPklEICYjMTcxO1BLJiMxODc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4IiB4Mj0iMTM1Ljk5OTYiIHkxPSIzODguNTYzOCIgeTI9IjM4OC41NjM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjgxNDEiIHg9IjEzIiB5PSI0MDUuNTU4OSI+JiMyNTUwNTsmIzMwMDU4OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OyAmIzE3MTtGSyYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMyIgeT0iNDIxLjg1NTciPiYjMjU1MDU7JiMzMDA1ODsmIzI0MTgwOyYjMjYzNzY7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEzIiB5PSI0MzguMTUyNiI+JiMyNjM2ODsmIzMyMDY2OyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTMiIHk9IjQ1NC40NDk1Ij4mIzIwMzE2OyYjMjUxMDQ7JiMyNjA4NTsmIzI2MTc4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMyIgeT0iNDcwLjc0NjQiPiYjMjYzNTY7JiMyNjAzMjsmIzI2MDg1OyYjMjYxNzg7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU41IiBkYXRhLXNvdXJjZS1saW5lPSIzMCIgaWQ9ImVudDAwMDYiPjxwYXRoIGQ9Ik0xNjcuOTIsMTA2Ljk0NjkgTDE2Ny45MiwxNDUuNzc2OSBMMTMyLjgsMTQ5Ljc3NjkgTDE2Ny45MiwxNTMuNzc2OSBMMTY3LjkyLDE5Mi42MTA5IEEwLDAgMCAwIDAgMTY3LjkyLDE5Mi42MTA5IEwzMjAuMDgxNywxOTIuNjEwOSBBMCwwIDAgMCAwIDMyMC4wODE3LDE5Mi42MTA5IEwzMjAuMDgxNywxMTYuOTQ2OSBMMzEwLjA4MTcsMTA2Ljk0NjkgTDE2Ny45MiwxMDYuOTQ2OSBBMCwwIDAgMCAwIDE2Ny45MiwxMDYuOTQ2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTMxMC4wODE3LDEwNi45NDY5IEwzMTAuMDgxNywxMTYuOTQ2OSBMMzIwLjA4MTcsMTE2Ljk0NjkgTDMxMC4wODE3LDEwNi45NDY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Ni4zNzk5IiB4PSIxNzMuOTIiIHk9IjEyNC4wMTM4Ij4mIzI1NTA1OyYjMzAwNTg7JiMyNDQxODsmIzI0MzM1Ozo8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTguMzYzMyIgeD0iMTczLjkyIiB5PSIxMzkuMTQ2NiI+LSBZRUFSTFkgKCYjMjQxODA7JiMyNzQyNTspPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMy4xNzI0IiB4PSIxNzMuOTIiIHk9IjE1NC4yNzk0Ij4tIE1PTlRITFkgKCYjMjYzNzY7JiMyNzQyNTspPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg3LjAyMDEiIHg9IjE3My45MiIgeT0iMTY5LjQxMjIiPi0gREFJTFkgKCYjMjYwODU7JiMyNzQyNTspPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS4xNjE3IiB4PSIxNzMuOTIiIHk9IjE4NC41NDUiPi0gU0VRVUVOVElBTCAoJiMzNjg5OTsmIzMwMDU4Oyk8L3RleHQ+PC9nPjwhLS1saW5rID8/Pz8/IHRvID8/Pz8/Pz8tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImNyb3dmb290IiBkYXRhLXNvdXJjZS1saW5lPSIyNyIgaWQ9ImxuazQiPjxwYXRoIGNvZGVMaW5lPSIyNyIgZD0iTTcyLDI2My42NjY5IEM3MiwyODkuMjY2OSA3MiwyOTAuMDc2OSA3MiwzMTMuNzc2OSIgZmlsbD0ibm9uZSIgaWQ9IiYjMjU1MDU7JiMzMDA1ODsmIzEyNTEwOyYjMTI0NzM7JiMxMjQ3OTstJiMyNTUwNTsmIzMwMDU4OyYjMjM2NTM7JiMyNzUwODsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjgiIHgyPSI3NiIgeTE9IjI1OS42NjY5IiB5Mj0iMjU5LjY2NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjgiIHgyPSI3NiIgeTE9IjI2Mi42NjY5IiB5Mj0iMjYyLjY2NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzIiIHgyPSI3MiIgeTE9IjI2My42NjY5IiB5Mj0iMjU1LjY2NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzIiIHgyPSI3OCIgeTE9IjMyMy43NzY5IiB5Mj0iMzMxLjc3NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzIiIHgyPSI2NiIgeTE9IjMyMy43NzY5IiB5Mj0iMzMxLjc3NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNzIiIHgyPSI3MiIgeTE9IjMyMy43NzY5IiB5Mj0iMzMxLjc3NjkiLz48ZWxsaXBzZSBjeD0iNzIiIGN5PSIzMTcuNzc2OSIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iNzMiIHk9IjI5OC4zMzM4Ij4mIzI1NTA1OyYjMzAwNTg7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBWUDNGSWE5MTVDUnR2b2JjZ09seDBZQTJ1OHFhaXA5UmtDekEyOE11Y3ozV0VXRHJNdkhrSkM5QlMzQ1htbG8zSGFYZzN0RVFrVktNcFVXNFRRRU12X2xjZEV5dGRyTW0zbEQ0TjdmLXV5N2xVTnh6NUFpekN5RFI4dTF5cUlmT256ZjRUZURxV2xJTGI0NGhUOEhpWWtvU0hBRVJReDRPNjhQc1VGcTJhM01IVFA0cmFCUUhDUUh6a1Z4YnBzeHZqMFIyZ3VoNjBGcFFkQmx0dEJ1M3VUaC00cnMtNFNzRWwyNTNOakdzU3RYX19aeHF1NnRjMmdTa0pONURHUko2dWNnV1h2QzBDMXpzbkVDT3NQYzJONjBkNHh6OGxfelhISmJ3VHA4TWhnRHZyNW54X1p5dnM1NmJPWFlieVh5YTRIODgxb1lNaDNtdkFrbVZNQUlxNXNweUhzaUhDNFpFWjZUSUVIOUljNXFsQjlOclpOSHNMS2FJTXFrOVU3OFhJQ1FiaTZya3hQWmZSM0FVOGc0RmtvcWxYY0xaa3FIYlZtODA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_12">マイグレーション：採番テーブルの作成<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<details>
<summary>V019__create_numbering_tables.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- src/main/resources/db/migration/V019__create_numbering_tables.sql</span>

<span class="c1">-- 採番マスタ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;採番マスタ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;採番コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;採番名&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;プレフィックス&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;採番形式&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="c1">-- YEARLY, MONTHLY, DAILY, SEQUENTIAL</span>
<span class="w">    </span><span class="ss">&quot;桁数&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;現在値&quot;</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;最終採番日&quot;</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;リセット対象&quot;</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="c1">-- 採番履歴データ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;採番履歴データ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;採番コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;採番年月&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;最終番号&quot;</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ss">&quot;fk_採番履歴_採番マスタ&quot;</span>
<span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;採番コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;採番マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;採番コード&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;採番コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;採番年月&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 初期データ</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="ss">&quot;採番マスタ&quot;</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;採番コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;採番名&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プレフィックス&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;採番形式&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;桁数&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="s1">&#39;SALES&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;売上番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;ORDER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;受注番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ORD&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YEARLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;SHIPMENT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;出荷番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SHP&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;INVOICE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;請求番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;INV&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;RECEIPT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;入金番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;RC&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;PURCHASE_ORDER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;発注番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;PO&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;PURCHASE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;仕入番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;PU&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;PAYMENT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;支払番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;PAY&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;STOCKTAKING&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;棚卸番号&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ST&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_採番履歴_採番年月&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;採番履歴データ&quot;</span><span class="p">(</span><span class="ss">&quot;採番年月&quot;</span><span class="p">);</span>

<span class="c1">-- テーブルコメント</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;採番マスタ&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;伝票番号の採番ルールを管理するマスタテーブル&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;採番履歴データ&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;年月別の採番状況を記録するテーブル&#39;</span><span class="p">;</span>
</code></pre></div>

</details>

<h3 id="_13">採番サービスの実装<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Note:</strong> 以下のサービス層コードは参考実装例です。実際のシステムでは要件に応じてカスタマイズしてください。</p>
</blockquote>
<details>
<summary>採番形式 ENUM</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/NumberingFormat.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Getter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>

<span class="nd">@Getter</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">NumberingFormat</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">YEARLY</span><span class="p">(</span><span class="s">&quot;年次&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">MONTHLY</span><span class="p">(</span><span class="s">&quot;月次&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">DAILY</span><span class="p">(</span><span class="s">&quot;日次&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">SEQUENTIAL</span><span class="p">(</span><span class="s">&quot;連番&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">displayName</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">NumberingFormat</span><span class="w"> </span><span class="nf">fromDisplayName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">displayName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">NumberingFormat</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">values</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">format</span><span class="p">.</span><span class="na">displayName</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">displayName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">format</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;Unknown numbering format: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">displayName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>採番マスタエンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/NumberingMaster.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 採番マスタ.</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NumberingMaster</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/** 採番コード. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">numberingCode</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 採番名. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">numberingName</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** プレフィックス. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 採番形式. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">format</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 桁数. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">digits</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 現在値. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">currentValue</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 最終採番日. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">lastNumberingDate</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** リセット対象. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">resetTarget</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 作成日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 更新日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>採番履歴エンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/NumberingHistory.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 採番履歴.</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NumberingHistory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/** ID. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 採番コード. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">numberingCode</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 採番年月. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">yearMonth</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 最終番号. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">lastNumber</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 作成日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 更新日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>採番サービス</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/application/service/NumberingService.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.infrastructure.persistence.mapper.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.format.DateTimeFormatter</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NumberingService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">NumberingMasterMapper</span><span class="w"> </span><span class="n">numberingMasterMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">NumberingHistoryMapper</span><span class="w"> </span><span class="n">numberingHistoryMapper</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 次の番号を取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getNextNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">numberingCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NumberingMaster</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numberingMasterMapper</span>
<span class="w">                </span><span class="p">.</span><span class="na">findByNumberingCode</span><span class="p">(</span><span class="n">numberingCode</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">master</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;採番マスタが見つかりません: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">numberingCode</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">today</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">yearMonth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getYearMonth</span><span class="p">(</span><span class="n">today</span><span class="p">,</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="na">getFormat</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 履歴を取得または作成</span>
<span class="w">        </span><span class="n">NumberingHistory</span><span class="w"> </span><span class="n">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numberingHistoryMapper</span>
<span class="w">                </span><span class="p">.</span><span class="na">findByCodeAndYearMonth</span><span class="p">(</span><span class="n">numberingCode</span><span class="p">,</span><span class="w"> </span><span class="n">yearMonth</span><span class="p">);</span>

<span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">nextNumber</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">history</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 新規年月の場合、1から開始</span>
<span class="w">            </span><span class="n">nextNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="n">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NumberingHistory</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">numberingCode</span><span class="p">(</span><span class="n">numberingCode</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">yearMonth</span><span class="p">(</span><span class="n">yearMonth</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">lastNumber</span><span class="p">(</span><span class="n">nextNumber</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">numberingHistoryMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">history</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 既存の場合、インクリメント</span>
<span class="w">            </span><span class="n">nextNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">history</span><span class="p">.</span><span class="na">getLastNumber</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="n">numberingHistoryMapper</span><span class="p">.</span><span class="na">incrementLastNumber</span><span class="p">(</span><span class="n">history</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 番号をフォーマット</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">formatNumber</span><span class="p">(</span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">yearMonth</span><span class="p">,</span><span class="w"> </span><span class="n">nextNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getYearMonth</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">NumberingFormat</span><span class="w"> </span><span class="n">format</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">YEARLY</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyy&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MONTHLY</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyyMM&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">DAILY</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyyMMdd&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">SEQUENTIAL</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;0000&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">formatNumber</span><span class="p">(</span><span class="n">NumberingMaster</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">yearMonth</span><span class="p">,</span>
<span class="w">                                 </span><span class="kt">long</span><span class="w"> </span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">sequenceFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;%0&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="na">getDigits</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;d&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">sequenceFormat</span><span class="p">,</span><span class="w"> </span><span class="n">number</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">master</span><span class="p">.</span><span class="na">getFormat</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NumberingFormat</span><span class="p">.</span><span class="na">SEQUENTIAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="na">getPrefix</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sequence</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="na">getPrefix</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yearMonth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sequence</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 売上番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateSalesNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;SALES&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 受注番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateOrderNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;ORDER&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 出荷番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateShipmentNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;SHIPMENT&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 請求番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateInvoiceNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;INVOICE&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 入金番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateReceiptNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;RECEIPT&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 発注番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generatePurchaseOrderNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;PURCHASE_ORDER&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 仕入番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generatePurchaseNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;PURCHASE&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 支払番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generatePaymentNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;PAYMENT&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/** 棚卸番号を生成 */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateStocktakingNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getNextNumber</span><span class="p">(</span><span class="s">&quot;STOCKTAKING&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="113">11.3 監査カラムの設計<a class="headerlink" href="#113" title="Permanent link">&para;</a></h2>
<h3 id="_14">監査カラムとは<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>すべてのテーブルに共通して設ける、データの作成・更新に関する情報を記録するカラムです。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjI4NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzU2cHg7aGVpZ2h0OjI4NnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM1NiAyODYiIHdpZHRoPSIzNTZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMzA0MzU7JiMyNjYxOTsmIzEyNDU5OyYjMTI1MjE7JiMxMjUxMjsmIzEyMzk4OyYjMjcwODM7JiMyNTEwNDs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEuOTk5NSIgeD0iMTE1LjMzMTkiIHk9IjIyLjk5NTEiPiYjMzA0MzU7JiMyNjYxOTsmIzEyNDU5OyYjMTI1MjE7JiMxMjUxMjsmIzEyMzk4OyYjMjcwODM7JiMyNTEwNDs8L3RleHQ+PC9nPjwhLS1jbGFzcyBiYXNlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iYmFzZSIgZGF0YS1zb3VyY2UtbGluZT0iMyIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjM1LjI2NTYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3My41MDU2IiB4PSI3IiB5PSI0NC4yOTY5Ii8+PGVsbGlwc2UgY3g9IjQ3Ljg3NzciIGN5PSI2MC4yOTY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik01MC44NDY0LDY1LjkzNzUgUTUwLjI2ODMsNjYuMjM0NCA0OS42Mjc3LDY2LjM3NSBRNDguOTg3LDY2LjUzMTMgNDguMjgzOSw2Ni41MzEzIFE0NS43ODM5LDY2LjUzMTMgNDQuNDU1OCw2NC44OTA2IFE0My4xNDMzLDYzLjIzNDQgNDMuMTQzMyw2MC4xMDk0IFE0My4xNDMzLDU2Ljk4NDQgNDQuNDU1OCw1NS4zMjgxIFE0NS43ODM5LDUzLjY3MTkgNDguMjgzOSw1My42NzE5IFE0OC45ODcsNTMuNjcxOSA0OS42Mjc3LDUzLjgyODEgUTUwLjI4MzksNTMuOTg0NCA1MC44NDY0LDU0LjI4MTMgTDUwLjg0NjQsNTcgUTUwLjIyMTQsNTYuNDIxOSA0OS42Mjc3LDU2LjE1NjMgUTQ5LjAzMzksNTUuODc1IDQ4LjQwODksNTUuODc1IFE0Ny4wNjUyLDU1Ljg3NSA0Ni4zNzc3LDU2Ljk1MzEgUTQ1LjY5MDIsNTguMDE1NiA0NS42OTAyLDYwLjEwOTQgUTQ1LjY5MDIsNjIuMjAzMSA0Ni4zNzc3LDYzLjI4MTMgUTQ3LjA2NTIsNjQuMzQzOCA0OC40MDg5LDY0LjM0MzggUTQ5LjAzMzksNjQuMzQzOCA0OS42Mjc3LDY0LjA3ODEgUTUwLjIyMTQsNjMuNzk2OSA1MC44NDY0LDYzLjIxODggTDUwLjg0NjQsNjUuOTM3NSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjY3LjYyODMiIHk9IjY1LjE0MzYiPiYjMjY5ODk7JiMyMTIwOTsmIzEyNDg2OyYjMTI1NDA7JiMxMjUwMjsmIzEyNTIzOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTc5LjUwNTYiIHkxPSI3Ni4yOTY5IiB5Mj0iNzYuMjk2OSIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX0ZJRUxEIj48ZWxsaXBzZSBjeD0iMTgiIGN5PSI4OS45NDUzIiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyLjI0NjEiIHg9IjI3IiB5PSI5My4yOTIiPklEOiBTRVJJQUwgJiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgiIHgyPSIxNzkuNTA1NiIgeTE9IjEwMC41OTM4IiB5Mj0iMTAwLjU5MzgiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19GSUVMRCI+PGVsbGlwc2UgY3g9IjE4IiBjeT0iMTE0LjI0MjIiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC45MDY5IiB4PSIyNyIgeT0iMTE3LjU4ODkiPiYjMjY5ODk7JiMyMTIwOTsmIzEyNDU5OyYjMTI1MjE7JiMxMjUxMjsxPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX0ZJRUxEIj48ZWxsaXBzZSBjeD0iMTgiIGN5PSIxMzAuNTM5MSIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjkwNjkiIHg9IjI3IiB5PSIxMzMuODg1NyI+JiMyNjk4OTsmIzIxMjA5OyYjMTI0NTk7JiMxMjUyMTsmIzEyNTEyOzI8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfRklFTEQiPjxlbGxpcHNlIGN4PSIxOCIgY3k9IjE0Ni44MzU5IiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMuMzUwNiIgeD0iMjciIHk9IjE1MC4xODI2Ij4uLi48L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgiIHgyPSIxNzkuNTA1NiIgeTE9IjE1Ny40ODQ0IiB5Mj0iMTU3LjQ4NDQiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19GSUVMRCI+PGVsbGlwc2UgY3g9IjE4IiBjeT0iMTcxLjEzMjgiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDYuMzA5MyIgeD0iMjciIHk9IjE3NC40Nzk1Ij4mIzIwMzE2OyYjMjUxMDQ7JiMyNjA4NTsmIzI2MTc4OzogVElNRVNUQU1QPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX0ZJRUxEIj48ZWxsaXBzZSBjeD0iMTgiIGN5PSIxODcuNDI5NyIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOS42NTYxIiB4PSIyNyIgeT0iMTkwLjc3NjQiPiYjMjAzMTY7JiMyNTEwNDsmIzMyNzczOzogVkFSQ0hBUjwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19GSUVMRCI+PGVsbGlwc2UgY3g9IjE4IiBjeT0iMjAzLjcyNjYiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDYuMzA5MyIgeD0iMjciIHk9IjIwNy4wNzMyIj4mIzI2MzU2OyYjMjYwMzI7JiMyNjA4NTsmIzI2MTc4OzogVElNRVNUQU1QPC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iUFVCTElDX0ZJRUxEIj48ZWxsaXBzZSBjeD0iMTgiIGN5PSIyMjAuMDIzNCIgZmlsbD0ibm9uZSIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExOS42NTYxIiB4PSIyNyIgeT0iMjIzLjM3MDEiPiYjMjYzNTY7JiMyNjAzMjsmIzMyNzczOzogVkFSQ0hBUjwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19GSUVMRCI+PGVsbGlwc2UgY3g9IjE4IiBjeT0iMjM2LjMyMDMiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDcuNTA1NiIgeD0iMjciIHk9IjIzOS42NjciPiYjMjEwNjY7JiMzODUwMDsmIzEyNTAxOyYjMTI1MjE7JiMxMjQ2NDs6IEJPT0xFQU48L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJQVUJMSUNfRklFTEQiPjxlbGxpcHNlIGN4PSIxOCIgY3k9IjI1Mi42MTcyIiBmaWxsPSJub25lIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ2LjMwOTMiIHg9IjI3IiB5PSIyNTUuOTYzOSI+JiMyMTA2NjsmIzM4NTAwOyYjMjYwODU7JiMyNjE3ODs6IFRJTUVTVEFNUDwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IlBVQkxJQ19GSUVMRCI+PGVsbGlwc2UgY3g9IjE4IiBjeT0iMjY4LjkxNDEiIGZpbGw9Im5vbmUiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuNjU2MSIgeD0iMjciIHk9IjI3Mi4yNjA3Ij4mIzIxMDY2OyYjMzg1MDA7JiMzMjc3Mzs6IFZBUkNIQVI8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjMiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBpZD0iZW50MDAwNCI+PHBhdGggZD0iTTIxNS44NCwxMTEuNTM2OSBMMjE1Ljg0LDE1Ny45MzY5IEwxODAuODcsMTYxLjkzNjkgTDIxNS44NCwxNjUuOTM2OSBMMjE1Ljg0LDIxMi4zMzM4IEEwLDAgMCAwIDAgMjE1Ljg0LDIxMi4zMzM4IEwzNDkuNjYzNCwyMTIuMzMzOCBBMCwwIDAgMCAwIDM0OS42NjM0LDIxMi4zMzM4IEwzNDkuNjYzNCwxMjEuNTM2OSBMMzM5LjY2MzQsMTExLjUzNjkgTDIxNS44NCwxMTEuNTM2OSBBMCwwIDAgMCAwIDIxNS44NCwxMTEuNTM2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTMzOS42NjM0LDExMS41MzY5IEwzMzkuNjYzNCwxMjEuNTM2OSBMMzQ5LjY2MzQsMTIxLjUzNjkgTDMzOS42NjM0LDExMS41MzY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS4zOCIgeD0iMjIxLjg0IiB5PSIxMjguNjAzOCI+JiMzMDQzNTsmIzI2NjE5OyYjMTI0NTk7JiMxMjUyMTsmIzEyNTEyOzo8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyLjgyMzQiIHg9IjIyMS44NCIgeT0iMTQzLjczNjYiPi0gJiMxMjM1NjsmIzEyMzg4OyYjMjAzMTY7JiMyNTEwNDsmIzEyMzczOyYjMTI0Mjg7JiMxMjM4MzsmIzEyMzYzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OS44MjMzIiB4PSIyMjEuODQiIHk9IjE1OC44Njk0Ij4tICYjMzU1MDQ7JiMxMjM2NDsmIzIwMzE2OyYjMjUxMDQ7JiMxMjM3NTsmIzEyMzgzOyYjMTIzNjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi44MjM0IiB4PSIyMjEuODQiIHk9IjE3NC4wMDIyIj4tICYjMTIzNTY7JiMxMjM4ODsmIzI2MzU2OyYjMjYwMzI7JiMxMjM3MzsmIzEyNDI4OyYjMTIzODM7JiMxMjM2Mzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTkuODIzMyIgeD0iMjIxLjg0IiB5PSIxODkuMTM1Ij4tICYjMzU1MDQ7JiMxMjM2NDsmIzI2MzU2OyYjMjYwMzI7JiMxMjM3NTsmIzEyMzgzOyYjMTIzNjM7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi44MjM0IiB4PSIyMjEuODQiIHk9IjIwNC4yNjc4Ij4tICYjMzU1NDI7JiMyOTcwMjsmIzIxMDY2OyYjMzg1MDA7JiMxMjM3MzsmIzEyNDI4OyYjMTIzODM7JiMxMjM2Mzs8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIEF5YWlvS2JMVTN2eHlSRnZrbnl0aE54U2xGOW55dUI3WlVrVUJVei1yWjYxWW9pdjl4NnVNNDdmc1RBckp4amRGY3ZrVXpveXZ0N3BqQ1ZEZ3ZLSzRlaUxhWEFCS25NZ2tSR0xGNXNpNTg5VFdwbVRWSEhpUjBBeXhVb3VUN00xbWIxakM3Q0RDT01DVzQ5d1VkZUd2S19zcFc1US1jcHdxY1NwY3dtS0dabnpOT0QzNzdxM3UzOGw2YmdqNUM4U1d2bXo3OEQwSGl0VXljcFExY3BBOEo5ZW9menNUaHNTa1VIbnlySUdwS3FSaDFJU19GcnpOMXR6dTVCT0o4QjhlOVhLb3lNTGJyLUlnYjJLY1B2SGVmMlYxV3U1QmhHV2pFQklMTlpTc0ZBdVNHZDR3T3lSZnB2a3dkZFNFRnpuT3BUR3dpTWczT3lSVXMxSXEtN1k0MnFHdnNGTDBmRDJRN2NuVWpocDJNckdwbzVoSVNyQktHMHY1MDAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_15">監査カラムの種類<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カラム</th>
<th>型</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>作成日時</strong></td>
<td>TIMESTAMP</td>
<td>レコード作成日時</td>
</tr>
<tr>
<td><strong>作成者</strong></td>
<td>VARCHAR</td>
<td>レコード作成者</td>
</tr>
<tr>
<td><strong>更新日時</strong></td>
<td>TIMESTAMP</td>
<td>最終更新日時</td>
</tr>
<tr>
<td><strong>更新者</strong></td>
<td>VARCHAR</td>
<td>最終更新者</td>
</tr>
<tr>
<td><strong>削除フラグ</strong></td>
<td>BOOLEAN</td>
<td>論理削除フラグ</td>
</tr>
<tr>
<td><strong>削除日時</strong></td>
<td>TIMESTAMP</td>
<td>論理削除日時</td>
</tr>
<tr>
<td><strong>削除者</strong></td>
<td>VARCHAR</td>
<td>論理削除実行者</td>
</tr>
</tbody>
</table>
<h3 id="_16">論理削除の考え方<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjI2NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjI2cHg7aGVpZ2h0OjI2NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYyNiAyNjQiIHdpZHRoPSI2MjZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjkyODk7JiMyOTcwMjsmIzIxMDY2OyYjMzg1MDA7IHZzICYjMzU1NDI7JiMyOTcwMjsmIzIxMDY2OyYjMzg1MDA7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5LjIwNjUiIHg9IjIzNi44NTE3IiB5PSIyMi45OTUxIj4mIzI5Mjg5OyYjMjk3MDI7JiMyMTA2NjsmIzM4NTAwOyB2cyAmIzM1NTQyOyYjMjk3MDI7JiMyMTA2NjsmIzM4NTAwOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0iI0ZGQ0NDQyIgaGVpZ2h0PSIyMDUuODMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxODQiIHg9IjIxMC45MSIgeT0iNTIuNDQ2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIyNzQuOTEwMSIgeT0iNjcuNDQyIj4mIzI5Mjg5OyYjMjk3MDI7JiMyMTA2NjsmIzM4NTAwOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI4IiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0NDRkZDQyIgaGVpZ2h0PSIyMTMuOTgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIyMDIiIHg9IjQxOC45MSIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI0OTEuOTEwMSIgeT0iNTkuMjkyIj4mIzM1NTQyOyYjMjk3MDI7JiMyMTA2NjsmIzM4NTAwOzwvdGV4dD48L2c+PCEtLWVudGl0eSBwaHlzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi5waHlzIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzOC41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTEuNDQ4MSIgeD0iMjI3LjE5IiB5PSI4Ny40NDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMxLjQ0ODEiIHg9IjIzNy4xOSIgeT0iMTAzLjQ0MiI+REVMRVRFIEZST00gJiMzOTAxNTsmIzIzNDU4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDAuNjg2NSIgeD0iMjM3LjE5IiB5PSIxMTkuNzM4OSI+V0hFUkUgSUQgPSAxPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLkdNTjQiIGRhdGEtc291cmNlLWxpbmU9IjUiIGlkPSJlbnQwMDA1Ij48cGF0aCBkPSJNMjQ2LjkxLDIwMi4wMDY5IEwyNDYuOTEsMjQyLjI3MjUgQTAsMCAwIDAgMCAyNDYuOTEsMjQyLjI3MjUgTDM1OC45MTAxLDI0Mi4yNzI1IEEwLDAgMCAwIDAgMzU4LjkxMDEsMjQyLjI3MjUgTDM1OC45MTAxLDIxMi4wMDY5IEwzNDguOTEwMSwyMDIuMDA2OSBMMzA2LjkxLDIwMi4wMDY5IEwzMDIuOTEsMTI2LjQ2NjkgTDI5OC45MSwyMDIuMDA2OSBMMjQ2LjkxLDIwMi4wMDY5IEEwLDAgMCAwIDAgMjQ2LjkxLDIwMi4wMDY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzQ4LjkxMDEsMjAyLjAwNjkgTDM0OC45MTAxLDIxMi4wMDY5IEwzNTguOTEwMSwyMTIuMDA2OSBMMzQ4LjkxMDEsMjAyLjAwNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjI1Mi45MSIgeT0iMjE5LjA3MzgiPiYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMjM0MzY7JiMyMDg0MDsmIzI4MDQwOyYjMjE0MzU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjI1Mi45MSIgeT0iMjM0LjIwNjYiPiYjMjQ0ODk7JiMyMDgwMzsmIzE5OTgxOyYjMjE0ODc7PC90ZXh0PjwvZz48IS0tZW50aXR5IGxvZ2ljLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi5sb2dpYyIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTQuODkwNiIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTcwLjA5NjQiIHg9IjQzNC44NiIgeT0iNzkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg4Ljg5NDQiIHg9IjQ0NC44NiIgeT0iOTUuMjkyIj5VUERBVEUgJiMzOTAxNTsmIzIzNDU4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTAuMDk2NCIgeD0iNDQ0Ljg2IiB5PSIxMTEuNTg4OSI+U0VUICYjMjEwNjY7JiMzODUwMDsmIzEyNTAxOyYjMTI1MjE7JiMxMjQ2NDsgPSB0cnVlPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC42ODY1IiB4PSI0NDQuODYiIHk9IjEyNy44ODU3Ij5XSEVSRSBJRCA9IDE8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uR01OOSIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGlkPSJlbnQwMDEwIj48cGF0aCBkPSJNNDQ0LjQxLDIwMi4wMDY5IEw0NDQuNDEsMjQyLjI3MjUgQTAsMCAwIDAgMCA0NDQuNDEsMjQyLjI3MjUgTDU5NS40MTAyLDI0Mi4yNzI1IEEwLDAgMCAwIDAgNTk1LjQxMDIsMjQyLjI3MjUgTDU5NS40MTAyLDIxMi4wMDY5IEw1ODUuNDEwMiwyMDIuMDA2OSBMNTIzLjkxLDIwMi4wMDY5IEw1MTkuOTEsMTM0LjYxNjkgTDUxNS45MSwyMDIuMDA2OSBMNDQ0LjQxLDIwMi4wMDY5IEEwLDAgMCAwIDAgNDQ0LjQxLDIwMi4wMDY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNTg1LjQxMDIsMjAyLjAwNjkgTDU4NS40MTAyLDIxMi4wMDY5IEw1OTUuNDEwMiwyMTIuMDA2OSBMNTg1LjQxMDIsMjAyLjAwNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjQ1MC40MSIgeT0iMjE5LjA3MzgiPiYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyYjMjA0NDU7JiMyNTM0NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMwLjAwMDIiIHg9IjQ1MC40MSIgeT0iMjM0LjIwNjYiPiYjMjQ1MTc7JiMzNTIwMTsmIzEyMzk1OyYjMjQ1NDA7JiMxMjM3NjsmIzEyMzkwOyYjMjQ0ODk7JiMyMDgwMzsmIzIxNDg3OyYjMzMwMjE7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJOMSIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDEyIj48cGF0aCBkPSJNNiw3MS40NzY5IEw2LDE0Mi4wMDgxIEwxOTEuODIzNCwxNDIuMDA4MSBMMTkxLjgyMzQsODEuNDc2OSBMMTgxLjgyMzQsNzEuNDc2OSBMNiw3MS40NzY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTgxLjgyMzQsNzEuNDc2OSBMMTgxLjgyMzQsODEuNDc2OSBMMTkxLjgyMzQsODEuNDc2OSBMMTgxLjgyMzQsNzEuNDc2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC4zOCIgeD0iMTIiIHk9Ijg4LjU0MzgiPiYjMzU1NDI7JiMyOTcwMjsmIzIxMDY2OyYjMzg1MDA7JiMxMjM5ODsmIzI3ODgwOyYjMjQ4NDc7JiMyODg1Nzs6PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NC44MjM0IiB4PSIxMiIgeT0iMTAzLjY3NjYiPi0gJiMyNjkwODsmIzMyMDM0OyYjMjYxNzg7JiMxMjM5NTsmIzIxMDY2OyYjMzg1MDA7JiMxMjUwMTsmIzEyNTIxOyYjMTI0NjQ7JiMxMjQzNDsmIzMyNzcxOyYjMjQ5NDI7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS44MjM0IiB4PSIxMiIgeT0iMTE4LjgwOTQiPi0gJiMxOTk2ODsmIzI0ODQ3OyYjMjEwNDY7JiMzMjAwNDsmIzEyMzkyOyYjMTIzOTg7JiMyNTk3MjsmIzIxNTEyOyYjMjQ2MTU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMi44MjM0IiB4PSIxMiIgeT0iMTMzLjk0MjIiPi0gJiMxMjQ3MzsmIzEyNDg4OyYjMTI1MjQ7JiMxMjU0MDsmIzEyNDcyOyYjMzI5MzM7JiMyMjgyMzsmIzIxMjcwOzwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgVFN2REltOUg1MFJXX1ZxTFhzZFRtZ3RHOGRJYWUyX0NRRUY2VDMzMVBhQWQ4MjltdlplclhnSzRJZThqNGxDM09tZUlLVmdPN3RFelR5UF9xSHFaS1FZcEV2cHRsM25nSWFyQnUxSXdKbGNJNWd1ZGpJUVNQaTdqTE1TeEdYYWZoaVJhOUN5OXlxNDFiYUFYMDF5dUhfNU85VzUyS0RtRzhvQTRtamtSQzdiaUt3aUhiVlZObkIwOHdxNU8wUHkwaUltUzd2dmJhUW9lNFhtZWdnZVMtTzdXQXU4X1k2dkpncVlEM1hrT3pGT3pBakVsQlpObVU3WDNJb19lT2U0bngtRUNHQzIzcDFYeEV5NUxwbFdMeDhlSC04YUlOMjZ1SV9ITlpiNHA5ejhWa2hJSUpDTl91T3RqMXJSS0VDbXN0OVA2ajF3cndxSXg5cmhoWHlnVEJseHFnRERfdGhSYkdfREtlYmRpaFNGbzlLU1YtVDRvaTZSVHdKVE9KVlV3NWVMNGx0RHBjMWFNWnVzN0VWdjNwTzdKcG5FanV4TEstaEhpaWJvUk51YS04aldhLTdjQTdCaHc0c3NzUVI2QTkzYTE3a0dSPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_17">監査カラム用エンティティ基底クラス<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<details>
<summary>Auditable 基底クラス</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/Auditable.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.experimental.SuperBuilder</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@SuperBuilder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Auditable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">updatedBy</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">deletedFlag</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">deletedAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">deletedBy</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 論理削除されているかどうか</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isDeleted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">deletedFlag</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">deletedFlag</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 論理削除を実行</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">softDelete</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">deletedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">deletedFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">deletedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">deletedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deletedBy</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 論理削除を復元</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">restore</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">deletedFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">deletedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">deletedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="mybatis">MyBatis インターセプターによる自動設定<a class="headerlink" href="#mybatis" title="Permanent link">&para;</a></h3>
<details>
<summary>監査インターセプター</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/infrastructure/persistence/AuditInterceptor.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.infrastructure.persistence</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common.Auditable</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.executor.Executor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.mapping.MappedStatement</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.mapping.SqlCommandType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.ibatis.plugin.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.Authentication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.security.core.context.SecurityContextHolder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Properties</span><span class="p">;</span>

<span class="nd">@Intercepts</span><span class="p">({</span>
<span class="w">    </span><span class="nd">@Signature</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executor</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;update&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">MappedStatement</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="na">class</span><span class="p">})</span>
<span class="p">})</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AuditInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Interceptor</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">intercept</span><span class="p">(</span><span class="n">Invocation</span><span class="w"> </span><span class="n">invocation</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">MappedStatement</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MappedStatement</span><span class="p">)</span><span class="w"> </span><span class="n">invocation</span><span class="p">.</span><span class="na">getArgs</span><span class="p">()</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invocation</span><span class="p">.</span><span class="na">getArgs</span><span class="p">()</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parameter</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Auditable</span><span class="w"> </span><span class="n">auditable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCurrentUser</span><span class="p">();</span>
<span class="w">            </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ms</span><span class="p">.</span><span class="na">getSqlCommandType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SqlCommandType</span><span class="p">.</span><span class="na">INSERT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">auditable</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">now</span><span class="p">);</span>
<span class="w">                </span><span class="n">auditable</span><span class="p">.</span><span class="na">setCreatedBy</span><span class="p">(</span><span class="n">currentUser</span><span class="p">);</span>
<span class="w">                </span><span class="n">auditable</span><span class="p">.</span><span class="na">setUpdatedAt</span><span class="p">(</span><span class="n">now</span><span class="p">);</span>
<span class="w">                </span><span class="n">auditable</span><span class="p">.</span><span class="na">setUpdatedBy</span><span class="p">(</span><span class="n">currentUser</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">auditable</span><span class="p">.</span><span class="na">getDeletedFlag</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">auditable</span><span class="p">.</span><span class="na">setDeletedFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ms</span><span class="p">.</span><span class="na">getSqlCommandType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SqlCommandType</span><span class="p">.</span><span class="na">UPDATE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">auditable</span><span class="p">.</span><span class="na">setUpdatedAt</span><span class="p">(</span><span class="n">now</span><span class="p">);</span>
<span class="w">                </span><span class="n">auditable</span><span class="p">.</span><span class="na">setUpdatedBy</span><span class="p">(</span><span class="n">currentUser</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">invocation</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCurrentUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Authentication</span><span class="w"> </span><span class="n">authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecurityContextHolder</span>
<span class="w">                </span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">getAuthentication</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">authentication</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">authentication</span><span class="p">.</span><span class="na">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">authentication</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;SYSTEM&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">plugin</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Plugin</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setProperties</span><span class="p">(</span><span class="n">Properties</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 設定プロパティがあれば処理</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="114">11.4 履歴テーブルの設計<a class="headerlink" href="#114" title="Permanent link">&para;</a></h2>
<h3 id="_18">履歴管理の種類<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>種類</th>
<th>説明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>変更履歴</strong></td>
<td>変更前後の値を記録</td>
<td>監査、デバッグ</td>
</tr>
<tr>
<td><strong>スナップショット</strong></td>
<td>特定時点の状態を保存</td>
<td>帳票再発行、分析</td>
</tr>
<tr>
<td><strong>イベントソーシング</strong></td>
<td>すべてのイベントを記録</td>
<td>完全な追跡、再構築</td>
</tr>
</tbody>
</table>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjI4NXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTA5cHg7aGVpZ2h0OjI4NXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDUwOSAyODUiIHdpZHRoPSI1MDlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjM2NTM7JiMyNzUwODsmIzMxNjQ5OyYjMjk3MDI7JiMxMjM5ODsmIzMxMjc4OyYjMzkwMDY7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMTk4LjUwMDIiIHk9IjIyLjk5NTEiPiYjMjM2NTM7JiMyNzUwODsmIzMxNjQ5OyYjMjk3MDI7JiMxMjM5ODsmIzMxMjc4OyYjMzkwMDY7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSIjQUREOEU2IiBoZWlnaHQ9IjIzNS4yNiIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjE1NCIgeD0iNyIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI1Ni4wMDAxIiB5PSI1OS4yOTIiPiYjMjI3OTM7JiMyNjM1NjsmIzIzNjUzOyYjMjc1MDg7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDA3Ij48cmVjdCBmaWxsPSIjOTBFRTkwIiBoZWlnaHQ9IjIyNy42OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjEzNiIgeD0iMTg1IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSIxOTcuMDAwMiIgeT0iNTkuMjkyIj4mIzEyNDczOyYjMTI0OTA7JiMxMjQ4MzsmIzEyNTAzOyYjMTI0NzE7JiMxMjUxOTsmIzEyNDgzOyYjMTI0ODg7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyNCIgaWQ9ImVudDAwMTIiPjxyZWN0IGZpbGw9IiNGMDgwODAiIGhlaWdodD0iMjI3LjY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTU4IiB4PSIzNDUiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI1Ljk5OTUiIHg9IjM2MS4wMDAzIiB5PSI1OS4yOTIiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMxMjQ3NzsmIzEyNTQwOyYjMTI0NzE7JiMxMjUzMTsmIzEyNDY0OzwvdGV4dD48L2c+PCEtLWVudGl0eSBjaGFuZ2UtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLmNoYW5nZSIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzguNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIyLjcxNjQiIHg9IjIyLjY0IiB5PSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAyLjcxNjQiIHg9IjMyLjY0IiB5PSI5NS4yOTIiPiYjMjI3OTM7JiMyNjM1NjsmIzIxMDY5Oy8mIzIyNzkzOyYjMjYzNTY7JiMyNDQ2MDsmIzEyNDM0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ni4xMTIxIiB4PSIzMi42NCIgeT0iMTExLjU4ODkiPkpTT05CJiMxMjM5MTsmIzIwNDQ1OyYjMjMzODQ7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLkdNTjQiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDA1Ij48cGF0aCBkPSJNMzAuMDksMTc3Ljg5NjkgTDMwLjA5LDI2My41NjA5IEEwLDAgMCAwIDAgMzAuMDksMjYzLjU2MDkgTDEzNy45MTMzLDI2My41NjA5IEEwLDAgMCAwIDAgMTM3LjkxMzMsMjYzLjU2MDkgTDEzNy45MTMzLDE4Ny44OTY5IEwxMjcuOTEzMywxNzcuODk2OSBMODgsMTc3Ljg5NjkgTDg0LDExOC4zNjY5IEw4MCwxNzcuODk2OSBMMzAuMDksMTc3Ljg5NjkgQTAsMCAwIDAgMCAzMC4wOSwxNzcuODk2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTEyNy45MTMzLDE3Ny44OTY5IEwxMjcuOTEzMywxODcuODk2OSBMMTM3LjkxMzMsMTg3Ljg5NjkgTDEyNy45MTMzLDE3Ny44OTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3OC40MTI2IiB4PSIzNi4wOSIgeT0iMTk0Ljk2MzgiPlVQREFURSYjMjYxNzg7JiMxMjM5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuODIzMyIgeD0iMzYuMDkiIHk9IjIxMC4wOTY2Ij4tICYjMjI3OTM7JiMyNjM1NjsmIzIxMDY5OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ni44MjMzIiB4PSIzNi4wOSIgeT0iMjI1LjIyOTQiPi0gJiMyMjc5MzsmIzI2MzU2OyYjMjQ0NjA7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYwLjgyMzMiIHg9IjM2LjA5IiB5PSIyNDAuMzYyMiI+LSAmIzIyNzkzOyYjMjYzNTY7JiMyOTcwMjsmIzMwMDAxOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOSIgeD0iMzYuMDkiIHk9IjI1NS40OTUiPiYjMTI0MzQ7JiMzNTM1MjsmIzM3NjgyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBzbmFwc2hvdC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLnNuYXBzaG90IiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzguNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTAzLjk5OTYiIHg9IjIwMSIgeT0iNzkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjIxMSIgeT0iOTUuMjkyIj4mIzI5MzA1OyYjMjM0NTA7JiMyNjE3ODsmIzI4ODU3OyYjMTIzOTg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjIxMSIgeT0iMTExLjU4ODkiPiYjMjkzNjY7JiMyNDkwNzsmIzEyNDM0OyYjMjA4NDA7JiMyMDQ0NTsmIzIzMzg0OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uR01OOSIgZGF0YS1zb3VyY2UtbGluZT0iMTciIGlkPSJlbnQwMDEwIj48cGF0aCBkPSJNMjA1LjU5LDE4NS40NTY5IEwyMDUuNTksMjU1Ljk4ODEgQTAsMCAwIDAgMCAyMDUuNTksMjU1Ljk4ODEgTDMwMC40MTMzLDI1NS45ODgxIEEwLDAgMCAwIDAgMzAwLjQxMzMsMjU1Ljk4ODEgTDMwMC40MTMzLDE5NS40NTY5IEwyOTAuNDEzMywxODUuNDU2OSBMMjU3LDE4NS40NTY5IEwyNTMsMTE4LjM2NjkgTDI0OSwxODUuNDU2OSBMMjA1LjU5LDE4NS40NTY5IEEwLDAgMCAwIDAgMjA1LjU5LDE4NS40NTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjkwLjQxMzMsMTg1LjQ1NjkgTDI5MC40MTMzLDE5NS40NTY5IEwzMDAuNDEzMywxOTUuNDU2OSBMMjkwLjQxMzMsMTg1LjQ1NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjIxMS41OSIgeT0iMjAyLjUyMzgiPiYjMTI1MTA7JiMxMjQ3MzsmIzEyNDc5OyYjMjM2NTM7JiMyNzUwODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuODIzMyIgeD0iMjExLjU5IiB5PSIyMTcuNjU2NiI+LSAmIzI2Mzc3OyYjMjExNzc7JiMzODI4MzsmIzIyOTg3OyYjMjYwODU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjczLjgyMzMiIHg9IjIxMS41OSIgeT0iMjMyLjc4OTQiPi0gJiMyNjM3NzsmIzIxMTc3OyYjMzIwNjY7JiMyMDEwMjsmIzI2MDg1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My44MjMzIiB4PSIyMTEuNTkiIHk9IjI0Ny45MjIyIj4tICYjMjA4NDA7JiMxMjQ1OTsmIzEyNTIxOyYjMTI1MTI7JiMyMDUxNjs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZXZlbnQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uZXZlbnQiIGRhdGEtc291cmNlLWxpbmU9IjI1IiBpZD0iZW50MDAxMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzOC41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTcuOTk5NiIgeD0iMzY1IiB5PSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMzc1IiB5PSI5NS4yOTIiPiYjMTIzNzc7JiMxMjQwOTsmIzEyMzkwOyYjMTIzOTg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjM3NSIgeT0iMTExLjU4ODkiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMxMjQzNDsmIzM1MzUyOyYjMzc2ODI7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uR01OMTQiIGRhdGEtc291cmNlLWxpbmU9IjI3IiBpZD0iZW50MDAxNSI+PHBhdGggZD0iTTM2MS41LDE4NS40NTY5IEwzNjEuNSwyNTUuOTg4MSBBMCwwIDAgMCAwIDM2MS41LDI1NS45ODgxIEw0ODYuNTAwMSwyNTUuOTg4MSBBMCwwIDAgMCAwIDQ4Ni41MDAxLDI1NS45ODgxIEw0ODYuNTAwMSwxOTUuNDU2OSBMNDc2LjUwMDEsMTg1LjQ1NjkgTDQyOCwxODUuNDU2OSBMNDI0LDExOC4zNjY5IEw0MjAsMTg1LjQ1NjkgTDM2MS41LDE4NS40NTY5IEEwLDAgMCAwIDAgMzYxLjUsMTg1LjQ1NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NzYuNTAwMSwxODUuNDU2OSBMNDc2LjUwMDEsMTk1LjQ1NjkgTDQ4Ni41MDAxLDE5NS40NTY5IEw0NzYuNTAwMSwxODUuNDU2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuODIzMyIgeD0iMzY3LjUiIHk9IjIwMi41MjM4Ij4tICYjMjAzMTY7JiMyNTEwNDsmIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ni44MjMzIiB4PSIzNjcuNSIgeT0iMjE3LjY1NjYiPi0gJiMyNjM1NjsmIzI2MDMyOyYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg2LjgyMzMiIHg9IjM2Ny41IiB5PSIyMzIuNzg5NCI+LSAmIzIxMDY2OyYjMzg1MDA7JiMxMjQ1MjsmIzEyNTA1OyYjMTI1MzE7JiMxMjQ4ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjAwMDEiIHg9IjM2Ny41IiB5PSIyNDcuOTIyMiI+JiMxMjM2MzsmIzEyNDI1OyYjMjkzNjY7JiMyNDkwNzsmIzEyNDM0OyYjMjA4Nzc7JiMyNzA4MzsmIzMxNjg5OzwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgVFAxUkltOTE2OFJsdnJTQ1RYdHpYZ204OFlnZXhoaFBSNTMxVGFFdFJZOWVQeVhRM28wSGNmcWVpM0lheE1JNUtWYlpGY1VjX0hWRFViWlRlaGtQYi16eGxfVHZwUllQODlXX05la3hYZElrUDI0RGJZRGhaZGpyV0wySUg0bkRad2cxNEFfT3VoSkhkR2xYYVRidUQ2UTY0dmk0UndFOGJicHAxLXB5TUVfcmJHRHdrQUJGQkN4RlhTNmdqYmxkX0V1dVhCS0taaUlLQUs2d09IQXlRZlljaU93TTVvUjdid1A0Y085TEh3Rk9EbUVzMy1tM1E2aVdBanlfZWVlalpud0hFbFhURXRQcEp1WmVRelpwSHBpMTJnMURPMWJXMzVXOXcxa21Ra1R6cTJVUUpYQVktcVpJUmRCZEg4TUlRaXJvTGRJUFVITHhNTk01eHpNNlU1QXdqZjZBNk1RMDJEWTVUdXNza2ZzZmdFQkN2ZmNjTXlwb1FiUUtoZHI1bGozc1V4Z2hBNkVXVE0ydG0yeHZSa0xfWldnbUNoMWRiSHRlUHdVREQtekI3X2VlNHFQSUlfV2VPOU4xS1gwdDdPeFdVZy1wM1doUDhkZ0dPbkl0RnlfNEdNNXVudWotc1gzNVhyeVlqcERra0g4R21MOXpzT0ZZcWRiSHBTZnhVdVppMW0wMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="er_2">変更履歴テーブルの ER 図<a class="headerlink" href="#er_2" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjI2MnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjM3cHg7aGVpZ2h0OjI2MnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYzNyAyNjIiIHdpZHRoPSI2MzdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjI3OTM7JiMyNjM1NjsmIzIzNjUzOyYjMjc1MDg7JiMxMjM5ODtFUiYjMjIyNTk7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0LjM0MzQiIHg9IjI1OS40NDg0IiB5PSIyMi45OTUxIj4mIzIyNzkzOyYjMjYzNTY7JiMyMzY1MzsmIzI3NTA4OyYjMTIzOTg7RVImIzIyMjU5OzwvdGV4dD48L2c+PCEtLWNsYXNzID8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMTAuOTY4OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTU1LjQ4NiIgeD0iNyIgeT0iNDQuMjk2OSIvPjxlbGxpcHNlIGN4PSIzMy40Njg5IiBjeT0iNjAuMjk2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMzcuNTc4Myw2Ni4yOTY5IEwyOS44NTk1LDY2LjI5NjkgTDI5Ljg1OTUsNTMuOTA2MyBMMzcuNTc4Myw1My45MDYzIEwzNy41NzgzLDU2LjA2MjUgTDMyLjMxMjYsNTYuMDYyNSBMMzIuMzEyNiw1OC43MzQ0IEwzNy4wNzgzLDU4LjczNDQgTDM3LjA3ODMsNjAuODkwNiBMMzIuMzEyNiw2MC44OTA2IEwzMi4zMTI2LDY0LjE0MDYgTDM3LjU3ODMsNjQuMTQwNiBMMzcuNTc4Myw2Ni4yOTY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iNTAuMDE3NSIgeT0iNjUuMTQzNiI+JiMyMjc5MzsmIzI2MzU2OyYjMjM2NTM7JiMyNzUwODsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjE2MS40ODYiIHkxPSI3Ni4yOTY5IiB5Mj0iNzYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU0LjExMzMiIHg9IjEzIiB5PSI5My4yOTIiPklEICYjMTcxO1BLJiMxODc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4IiB4Mj0iMTYxLjQ4NiIgeTE9IjEwMC41OTM4IiB5Mj0iMTAwLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIxMyIgeT0iMTE3LjU4ODkiPiYjMTI0ODY7JiMxMjU0MDsmIzEyNTAyOyYjMTI1MjM7JiMyMTUxNzs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuOTA4OSIgeD0iMTMiIHk9IjEzMy44ODU3Ij4mIzEyNTI0OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5O0lEPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEzIiB5PSIxNTAuMTgyNiI+JiMyNTgwNTsmIzIwMzE2OyYjMzEyNzg7JiMyMTAyOTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTMiIHk9IjE2Ni40Nzk1Ij4mIzIyNzkzOyYjMjYzNTY7JiMyNjA4NTsmIzI2MTc4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxMyIgeT0iMTgyLjc3NjQiPiYjMjI3OTM7JiMyNjM1NjsmIzMyNzczOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuNDg2IiB4PSIxMyIgeT0iMTk5LjA3MzIiPiYjMjI3OTM7JiMyNjM1NjsmIzIxMDY5OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyAoSlNPTkIpPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0My40ODYiIHg9IjEzIiB5PSIyMTUuMzcwMSI+JiMyMjc5MzsmIzI2MzU2OyYjMjQ0NjA7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7IChKU09OQik8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTMiIHk9IjIzMS42NjciPiYjMjI3OTM7JiMyNjM1NjsmIzI5NzAyOyYjMzAwMDE7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEzIiB5PSIyNDcuOTYzOSI+JiMyMDMxNjsmIzI1MTA0OyYjMjYwODU7JiMyNjE3ODs8L3RleHQ+PC9nPjwhLS1jbGFzcyA/Pz8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTciIGlkPSJlbnQwMDAzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIxMC45Njg4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkuOTk5NiIgeD0iMzE0Ljc0IiB5PSI0NC4yOTY5Ii8+PGVsbGlwc2UgY3g9IjMyOS43NCIgY3k9IjYwLjI5NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTMzMy44NDk0LDY2LjI5NjkgTDMyNi4xMzA2LDY2LjI5NjkgTDMyNi4xMzA2LDUzLjkwNjMgTDMzMy44NDk0LDUzLjkwNjMgTDMzMy44NDk0LDU2LjA2MjUgTDMyOC41ODM4LDU2LjA2MjUgTDMyOC41ODM4LDU4LjczNDQgTDMzMy4zNDk0LDU4LjczNDQgTDMzMy4zNDk0LDYwLjg5MDYgTDMyOC41ODM4LDYwLjg5MDYgTDMyOC41ODM4LDY0LjE0MDYgTDMzMy44NDk0LDY0LjE0MDYgTDMzMy44NDk0LDY2LjI5NjkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIzNDMuNzQiIHk9IjY1LjE0MzYiPiYjMjE4MzA7JiMyMTY5NzsmIzEyNTEwOyYjMTI0NzM7JiMxMjQ3OTsmIzIzNjUzOyYjMjc1MDg7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjMxNS43NCIgeDI9IjQ0My43Mzk2IiB5MT0iNzYuMjk2OSIgeTI9Ijc2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NC4xMTMzIiB4PSIzMjAuNzQiIHk9IjkzLjI5MiI+SUQgJiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMxNS43NCIgeDI9IjQ0My43Mzk2IiB5MT0iMTAwLjU5MzgiIHkyPSIxMDAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjMyMC43NCIgeT0iMTE3LjU4ODkiPiYjMjE4MzA7JiMyMTY5NzsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMzIwLjc0IiB5PSIxMzMuODg1NyI+JiMyNjM3NzsmIzIxMTc3OyYjMzgyODM7JiMyMjk4NzsmIzI2MDg1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIzMjAuNzQiIHk9IjE1MC4xODI2Ij4mIzI2Mzc3OyYjMjExNzc7JiMzMjA2NjsmIzIwMTAyOyYjMjYwODU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjMyMC43NCIgeT0iMTY2LjQ3OTUiPiYjMjE4MzA7JiMyMTY5NzsmIzIxNTE3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIzMjAuNzQiIHk9IjE4Mi43NzY0Ij4mIzIxODMwOyYjMjE2OTc7JiMyMTMwNjsmIzIwOTk4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy45OTk5IiB4PSIzMjAuNzQiIHk9IjE5OS4wNzMyIj4mIzIxMzM2OyYjMjAzODU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjMyMC43NCIgeT0iMjE1LjM3MDEiPiYjMzEyNDY7JiMyMTMwNjsmIzIwOTk4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIzMjAuNzQiIHk9IjIzMS42NjciPiYjMjAzMTY7JiMyNTEwNDsmIzI2MDg1OyYjMjYxNzg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjMyMC43NCIgeT0iMjQ3Ljk2MzkiPiYjMjAzMTY7JiMyNTEwNDsmIzMyNzczOzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01ONCIgZGF0YS1zb3VyY2UtbGluZT0iMzIiIGlkPSJlbnQwMDA1Ij48cGF0aCBkPSJNMTk3LjYzLDExNC41MTY5IEwxOTcuNjMsMTQ1Ljc4NjkgTDE2Mi45NSwxNDkuNzg2OSBMMTk3LjYzLDE1My43ODY5IEwxOTcuNjMsMTg1LjA0ODEgQTAsMCAwIDAgMCAxOTcuNjMsMTg1LjA0ODEgTDI3OS44NjU4LDE4NS4wNDgxIEEwLDAgMCAwIDAgMjc5Ljg2NTgsMTg1LjA0ODEgTDI3OS44NjU4LDEyNC41MTY5IEwyNjkuODY1OCwxMTQuNTE2OSBMMTk3LjYzLDExNC41MTY5IEEwLDAgMCAwIDAgMTk3LjYzLDExNC41MTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjY5Ljg2NTgsMTE0LjUxNjkgTDI2OS44NjU4LDEyNC41MTY5IEwyNzkuODY1OCwxMjQuNTE2OSBMMjY5Ljg2NTgsMTE0LjUxNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2LjM3OTkiIHg9IjIwMy42MyIgeT0iMTMxLjU4MzgiPiYjMjU4MDU7JiMyMDMxNjsmIzMxMjc4OyYjMjEwMjk7OjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS44MjEzIiB4PSIyMDMuNjMiIHk9IjE0Ni43MTY2Ij4tIElOU0VSVDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MS4yMzU4IiB4PSIyMDMuNjMiIHk9IjE2MS44NDk0Ij4tIFVQREFURTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1OC42NTg3IiB4PSIyMDMuNjMiIHk9IjE3Ni45ODIyIj4tIERFTEVURTwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01ONyIgZGF0YS1zb3VyY2UtbGluZT0iMzkiIGlkPSJlbnQwMDA4Ij48cGF0aCBkPSJNNDc5LjI0LDEyOS42NDY5IEw0NzkuMjQsMTQ1Ljc4NjkgTDQ0NS4wMywxNDkuNzg2OSBMNDc5LjI0LDE1My43ODY5IEw0NzkuMjQsMTY5LjkxMjUgQTAsMCAwIDAgMCA0NzkuMjQsMTY5LjkxMjUgTDYzMC4yNDAyLDE2OS45MTI1IEEwLDAgMCAwIDAgNjMwLjI0MDIsMTY5LjkxMjUgTDYzMC4yNDAyLDEzOS42NDY5IEw2MjAuMjQwMiwxMjkuNjQ2OSBMNDc5LjI0LDEyOS42NDY5IEEwLDAgMCAwIDAgNDc5LjI0LDEyOS42NDY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNjIwLjI0MDIsMTI5LjY0NjkgTDYyMC4yNDAyLDEzOS42NDY5IEw2MzAuMjQwMiwxMzkuNjQ2OSBMNjIwLjI0MDIsMTI5LjY0NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC4wMDAyIiB4PSI0ODUuMjQiIHk9IjE0Ni43MTM4Ij4mIzEyNDczOyYjMTI0OTA7JiMxMjQ4MzsmIzEyNTAzOyYjMTI0NzE7JiMxMjUxOTsmIzEyNDgzOyYjMTI0ODg7JiMyNjA0MTsmIzI0MzM1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuMDAwMSIgeD0iNDg1LjI0IiB5PSIxNjEuODQ2NiI+JiMyNjM3NzsmIzIxMTc3OyYjMjYzOTk7JiMzODI5MTsmIzEyMzkxOyYjMjM2NTM7JiMyNzUwODsmIzMxNjQ5OyYjMjk3MDI7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBUTDNISVc5SDQ3c1ZoeFlGelUwRlgwWjV4ZUNMOWNmX3E1UDJBQ0ktSDBJdmJ4UFRUS2ttcmE4Zlg0SVg0YUdaNUJFRjZVX1RfOGxra2pWNGloVHB2aW9TY0pEd01aX0kyN2tvVVJON0VXdC1zaURTTXFzbVFYVDBvLVhmX01ISGY5VDhYc1h5YWJFOEFZR1NaY3o1OFgwQTBMQko1d1lCejljTDdDNVZxRVhFSXRQSzBMdnNuWHlyaHpMY0xXQzJHcnZmeTdqM2FnX3AydWNPeFNvTmg2bWNUczhSZ3BEZkxGbkZ5YWdjVHpDMWlPRFI5VWJ5RGF6bVF4OW8za2EzNmRxbjZxSnZkSzBzcE91Nk5oRFBsWnpuMnduUDQ4d0lVc182VTYzd0ZFWnRpcWZLNzMzQjFFUlNaS1RyeTVmTmloMW1LcTN5akVBd0o1Uk5vNzd3dTUwZHNWdGJScnZ1dDFnNEkzSU1MMUNmME5SWm9kZkE1SzFIanJLMWpDbVV5R3RfczJ4QjNad1hVUUdLUUdNRFR3SkRBUlF1c3NWM1F2Y0xybnVkUlhicHBNMzhRelY1Y3R5TVZHQzA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_19">マイグレーション：履歴テーブルの作成<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<details>
<summary>V020__create_history_tables.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- src/main/resources/db/migration/V020__create_history_tables.sql</span>

<span class="c1">-- 変更履歴データ</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;変更履歴データ&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;テーブル名&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;レコードID&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;操作種別&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="c1">-- INSERT, UPDATE, DELETE</span>
<span class="w">    </span><span class="ss">&quot;変更日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;変更者&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;変更前データ&quot;</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;変更後データ&quot;</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;変更理由&quot;</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="c1">-- マスタ履歴データ（スナップショット方式の例）</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;商品マスタ履歴&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;ID&quot;</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;商品コード&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;有効開始日&quot;</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;有効終了日&quot;</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;商品名&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;商品区分&quot;</span><span class="w"> </span><span class="err">商品区分</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;単価&quot;</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="w">    </span><span class="ss">&quot;税区分&quot;</span><span class="w"> </span><span class="err">税区分</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成者&quot;</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;商品コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;有効開始日&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_変更履歴_テーブル名&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;変更履歴データ&quot;</span><span class="p">(</span><span class="ss">&quot;テーブル名&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_変更履歴_レコードID&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;変更履歴データ&quot;</span><span class="p">(</span><span class="ss">&quot;レコードID&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_変更履歴_変更日時&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;変更履歴データ&quot;</span><span class="p">(</span><span class="ss">&quot;変更日時&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_商品マスタ履歴_商品コード&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;商品マスタ履歴&quot;</span><span class="p">(</span><span class="ss">&quot;商品コード&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="ss">&quot;idx_商品マスタ履歴_有効期間&quot;</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;商品マスタ履歴&quot;</span><span class="p">(</span><span class="ss">&quot;有効開始日&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;有効終了日&quot;</span><span class="p">);</span>

<span class="c1">-- テーブルコメント</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;変更履歴データ&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;データ変更の履歴をJSONBで保存するテーブル&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;商品マスタ履歴&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;商品マスタのスナップショット履歴&#39;</span><span class="p">;</span>
</code></pre></div>

</details>

<h3 id="_20">履歴サービスの実装<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Note:</strong> 以下のサービス層コードは参考実装例です。実際のシステムでは要件に応じてカスタマイズしてください。</p>
</blockquote>
<details>
<summary>変更履歴エンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/ChangeHistory.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 変更履歴.</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ChangeHistory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/** ID. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** テーブル名. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">tableName</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** レコードID. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">recordId</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 操作種別. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">operationType</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 変更日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">changedAt</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 変更者. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">changedBy</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 変更前データ（JSON）. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">beforeData</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 変更後データ（JSON）. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">afterData</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 変更理由. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">changeReason</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 作成日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>商品マスタ履歴エンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/common/ProductHistory.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.product.ProductCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.product.TaxCategory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 商品マスタ履歴.</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProductHistory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/** ID. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 商品コード. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">productCode</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 有効開始日. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">validFromDate</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 有効終了日. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">validToDate</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 商品名. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">productName</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 商品区分. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ProductCategory</span><span class="w"> </span><span class="n">productCategory</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 単価. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 税区分. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TaxCategory</span><span class="w"> </span><span class="n">taxCategory</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 作成日時. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** 作成者. */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 指定日時点で有効かどうか.</span>
<span class="cm">     *</span>
<span class="cm">     * @param targetDate 対象日</span>
<span class="cm">     * @return 有効な場合true</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isValidOn</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">targetDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">targetDate</span><span class="p">.</span><span class="na">isBefore</span><span class="p">(</span><span class="n">validFromDate</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">validToDate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">targetDate</span><span class="p">.</span><span class="na">isAfter</span><span class="p">(</span><span class="n">validToDate</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>履歴サービス</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/application/service/HistoryService.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.sms.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.domain.model.common.ChangeHistory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.sms.infrastructure.persistence.mapper.ChangeHistoryMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HistoryService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ChangeHistoryMapper</span><span class="w"> </span><span class="n">changeHistoryMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 変更履歴を記録</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordChange</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">recordId</span><span class="p">,</span>
<span class="w">                             </span><span class="n">String</span><span class="w"> </span><span class="n">operationType</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">beforeData</span><span class="p">,</span>
<span class="w">                             </span><span class="n">Object</span><span class="w"> </span><span class="n">afterData</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">changedBy</span><span class="p">,</span>
<span class="w">                             </span><span class="n">String</span><span class="w"> </span><span class="n">changeReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">beforeJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beforeData</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                    </span><span class="o">?</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">beforeData</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">afterJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">afterData</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                    </span><span class="o">?</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">afterData</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">            </span><span class="n">ChangeHistory</span><span class="w"> </span><span class="n">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChangeHistory</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">tableName</span><span class="p">(</span><span class="n">tableName</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">recordId</span><span class="p">(</span><span class="n">recordId</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">operationType</span><span class="p">(</span><span class="n">operationType</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">changedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">changedBy</span><span class="p">(</span><span class="n">changedBy</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">beforeData</span><span class="p">(</span><span class="n">beforeJson</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">afterData</span><span class="p">(</span><span class="n">afterJson</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">changeReason</span><span class="p">(</span><span class="n">changeReason</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">changeHistoryMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">history</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;履歴データのシリアライズに失敗しました&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * INSERT履歴を記録</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordInsert</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">recordId</span><span class="p">,</span>
<span class="w">                             </span><span class="n">Object</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">changedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">recordChange</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">recordId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;INSERT&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">changedBy</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * UPDATE履歴を記録</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordUpdate</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">recordId</span><span class="p">,</span>
<span class="w">                             </span><span class="n">Object</span><span class="w"> </span><span class="n">beforeData</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">afterData</span><span class="p">,</span>
<span class="w">                             </span><span class="n">String</span><span class="w"> </span><span class="n">changedBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">changeReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">recordChange</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">recordId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UPDATE&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">beforeData</span><span class="p">,</span><span class="w"> </span><span class="n">afterData</span><span class="p">,</span><span class="w"> </span><span class="n">changedBy</span><span class="p">,</span><span class="w"> </span><span class="n">changeReason</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * DELETE履歴を記録</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordDelete</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">recordId</span><span class="p">,</span>
<span class="w">                             </span><span class="n">Object</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">changedBy</span><span class="p">,</span>
<span class="w">                             </span><span class="n">String</span><span class="w"> </span><span class="n">changeReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">recordChange</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">recordId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DELETE&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">changedBy</span><span class="p">,</span><span class="w"> </span><span class="n">changeReason</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * テーブルとレコードIDで履歴を検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ChangeHistory</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByTableAndRecordId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span>
<span class="w">                                                       </span><span class="n">String</span><span class="w"> </span><span class="n">recordId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">changeHistoryMapper</span><span class="p">.</span><span class="na">findByTableAndRecordId</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="w"> </span><span class="n">recordId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 期間で履歴を検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ChangeHistory</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByDateRange</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">fromDateTime</span><span class="p">,</span>
<span class="w">                                                </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">toDateTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">changeHistoryMapper</span><span class="p">.</span><span class="na">findByDateRange</span><span class="p">(</span><span class="n">fromDateTime</span><span class="p">,</span><span class="w"> </span><span class="n">toDateTime</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="_21">業務システムでの使い分け<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h2>
<p>赤黒処理、論理削除、変更履歴は、業務の性質に応じて使い分けます。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjIzMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTA0N3B4O2hlaWdodDoyMzJweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMDQ3IDIzMiIgd2lkdGg9IjEwNDdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPjMmIzEyMzg4OyYjMTIzOTg7JiMxMjQ1MDsmIzEyNTAzOyYjMTI1MjU7JiMxMjU0MDsmIzEyNDgxOyYjMTIzOTg7JiMyMDM1MTsmIzEyMzU2OyYjMjA5OTg7JiMxMjM2OTs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzcuNzQwNSIgeD0iNDI4LjEyOTciIHk9IjIyLjk5NTEiPjMmIzEyMzg4OyYjMTIzOTg7JiMxMjQ1MDsmIzEyNTAzOyYjMTI1MjU7JiMxMjU0MDsmIzEyNDgxOyYjMTIzOTg7JiMyMDM1MTsmIzEyMzU2OyYjMjA5OTg7JiMxMjM2OTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSIjQUREOEU2IiBoZWlnaHQ9IjE4Mi40MyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjIwNiIgeD0iNyIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSI2OC4wMDAyIiB5PSI1OS4yOTIiPiYjMjAyNTA7JiMzNTMzNjsmIzMxOTk1OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiM5MEVFOTAiIGhlaWdodD0iMTgyLjQzIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTc4IiB4PSIzNDMiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMuOTk5NiIgeD0iMzkwLjAwMDIiIHk9IjU5LjI5MiI+JiMxMjUxMDsmIzEyNDczOyYjMTI0Nzk7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJlbnQwMDEyIj48cmVjdCBmaWxsPSIjRjA4MDgwIiBoZWlnaHQ9IjE4Mi40MyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjE2NCIgeD0iNzg0IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSI4MTAuMDAwMiIgeT0iNTkuMjkyIj4mIzEyNDg4OyYjMTI1MjE7JiMxMjUzMTsmIzEyNDcwOyYjMTI0NjM7JiMxMjQ3MTsmIzEyNTE5OyYjMTI1MzE7PC90ZXh0PjwvZz48IS0tZW50aXR5IGFjY291bnRpbmctLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uYWNjb3VudGluZyIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczLjk5OTMiIHg9IjIzIiB5PSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUzLjk5OTMiIHg9IjMzIiB5PSI5NS4yOTIiPiYjMjI3NzA7JiMxOTk3ODsmIzEyNTM5OyYjMjAxODE7JiMyMDgzNzsmIzEyNTM5OyYjMzU1MzE7JiMyNzcxNDsmIzEyNTM5OyYjMjU5MDM7JiMyNTE3Mzs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi5HTU40IiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0iZW50MDAwNSI+PHBhdGggZD0iTTQ3LjUsMTcwLjQ1NjkgTDQ3LjUsMjEwLjcyMjUgQTAsMCAwIDAgMCA0Ny41LDIxMC43MjI1IEwxNzIuNTAwMSwyMTAuNzIyNSBBMCwwIDAgMCAwIDE3Mi41MDAxLDIxMC43MjI1IEwxNzIuNTAwMSwxODAuNDU2OSBMMTYyLjUwMDEsMTcwLjQ1NjkgTDExNCwxNzAuNDU2OSBMMTEwLDEwMS45NDY5IEwxMDYsMTcwLjQ1NjkgTDQ3LjUsMTcwLjQ1NjkgQTAsMCAwIDAgMCA0Ny41LDE3MC40NTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTYyLjUwMDEsMTcwLjQ1NjkgTDE2Mi41MDAxLDE4MC40NTY5IEwxNzIuNTAwMSwxODAuNDU2OSBMMTYyLjUwMDEsMTcwLjQ1NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUyLjAwMDEiIHg9IjUzLjUiIHk9IjE4Ny41MjM4Ij4mIzM2MTk2OyYjNDA2NTg7JiMyMDk2NjsmIzI5NzAyOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iNTMuNSIgeT0iMjAyLjY1NjYiPiYjNjUyODg7JiMzMDQzNTsmIzI2NjE5OyYjMzUzODg7JiMzNjMyMTsmIzI0NTE3OyYjMzg5MjA7JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbWFzdGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLm1hc3RlciIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ1Ljk5OTUiIHg9IjM1OSIgeT0iNzkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSIzNjkiIHk9Ijk1LjI5MiI+JiMyMTgzMDsmIzIxNjk3OyYjMTI1Mzk7JiMzOTAxNTsmIzIzNDU4OyYjMTI1Mzk7JiMyMDE4MTsmIzIwODM3OyYjMjA4MDg7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uR01OOSIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGlkPSJlbnQwMDEwIj48cGF0aCBkPSJNMzYxLjk5LDE3MC40NTY5IEwzNjEuOTksMjEwLjcyMjUgQTAsMCAwIDAgMCAzNjEuOTksMjEwLjcyMjUgTDUwMi4wMTUsMjEwLjcyMjUgQTAsMCAwIDAgMCA1MDIuMDE1LDIxMC43MjI1IEw1MDIuMDE1LDE4MC40NTY5IEw0OTIuMDE1LDE3MC40NTY5IEw0MzYsMTcwLjQ1NjkgTDQzMiwxMDEuOTQ2OSBMNDI4LDE3MC40NTY5IEwzNjEuOTksMTcwLjQ1NjkgQTAsMCAwIDAgMCAzNjEuOTksMTcwLjQ1NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00OTIuMDE1LDE3MC40NTY5IEw0OTIuMDE1LDE4MC40NTY5IEw1MDIuMDE1LDE4MC40NTY5IEw0OTIuMDE1LDE3MC40NTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTguOTYxNSIgeD0iMzY3Ljk5IiB5PSIxODcuNTIzOCI+JiMyMjc5MzsmIzI2MzU2OyYjMjM2NTM7JiMyNzUwODsmIzY1Mjg4O0pTT05CJiM2NTI4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE5LjAyNSIgeD0iMzY3Ljk5IiB5PSIyMDIuNjU2NiI+KyAmIzEyNDczOyYjMTI0OTA7JiMxMjQ4MzsmIzEyNTAzOyYjMTI0NzE7JiMxMjUxOTsmIzEyNDgzOyYjMTI0ODg7PC90ZXh0PjwvZz48IS0tZW50aXR5IHRyYW5zYWN0aW9uLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4udHJhbnNhY3Rpb24iIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAxMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzEuOTk5NSIgeD0iODAwIiB5PSI3OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjk5OTUiIHg9IjgxMCIgeT0iOTUuMjkyIj4mIzIxNDYzOyYjMjc4ODA7JiMxMjUzOTsmIzIwOTg2OyYjMzM2NTU7JiMxMjUzOTsmIzIyMzEyOyYjMjQyMzU7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi5HTU4xNCIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGlkPSJlbnQwMDE1Ij48cGF0aCBkPSJNODE1LjQ5LDE3MC40NTY5IEw4MTUuNDksMjEwLjcyMjUgQTAsMCAwIDAgMCA4MTUuNDksMjEwLjcyMjUgTDkxNi41MTUsMjEwLjcyMjUgQTAsMCAwIDAgMCA5MTYuNTE1LDIxMC43MjI1IEw5MTYuNTE1LDE4MC40NTY5IEw5MDYuNTE1LDE3MC40NTY5IEw4NzAsMTcwLjQ1NjkgTDg2NiwxMDEuOTQ2OSBMODYyLDE3MC40NTY5IEw4MTUuNDksMTcwLjQ1NjkgQTAsMCAwIDAgMCA4MTUuNDksMTcwLjQ1NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik05MDYuNTE1LDE3MC40NTY5IEw5MDYuNTE1LDE4MC40NTY5IEw5MTYuNTE1LDE4MC40NTY5IEw5MDYuNTE1LDE3MC40NTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSI4MjEuNDkiIHk9IjE4Ny41MjM4Ij4mIzM1NTQyOyYjMjk3MDI7JiMyMTA2NjsmIzM4NTAwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MC4wMjUiIHg9IjgyMS40OSIgeT0iMjAyLjY1NjYiPisgJiMzMDQzNTsmIzI2NjE5OyYjMTI0NTk7JiMxMjUyMTsmIzEyNTEyOzwvdGV4dD48L2c+PCEtLWVudGl0eSA/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE4IiBpZD0iZW50MDAxNyI+PGVsbGlwc2UgY3g9IjI3OCIgY3k9IjE5MC41OTY5IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjIzNi4wMDAyIiB5PSIyMjAuNTkyIj4mIzM2MTk2OyYjNDA2NTg7JiMyMDk2NjsmIzI5NzAyOyYjMjM2NTM7JiMyNzUwODs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgPz8/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjE5IiBpZD0iZW50MDAxOSI+PGVsbGlwc2UgY3g9IjU5MyIgY3k9IjE5MC41OTY5IiBmaWxsPSIjRjFGMUYxIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjU0NC4wMDAyIiB5PSIyMjAuNTkyIj4mIzIyNzkzOyYjMjYzNTY7JiMyMzY1MzsmIzI3NTA4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48L2c+PCEtLWVudGl0eSA/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgaWQ9ImVudDAwMjEiPjxlbGxpcHNlIGN4PSI3MjYiIGN5PSIxOTAuNTk2OSIgZmlsbD0iI0YxRjFGMSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI2OTEuMDAwMiIgeT0iMjIwLjU5MiI+JiMxMjUxMDsmIzEyNDczOyYjMTI0Nzk7JiMyMzY1MzsmIzI3NTA4OzwvdGV4dD48L2c+PCEtLWVudGl0eSA/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgaWQ9ImVudDAwMjMiPjxlbGxpcHNlIGN4PSIxMDA2IiBjeT0iMTkwLjU5NjkiIGZpbGw9IiNGMUYxRjEiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iOTcxLjAwMDIiIHk9IjIyMC41OTIiPiYjMzA0MzU7JiMyNjYxOTsmIzEyNDU5OyYjMTI1MjE7JiMxMjUxMjs8L3RleHQ+PC9nPjwhLS1saW5rIGFjY291bnRpbmcgdG8gPz8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMTciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxOCIgaWQ9ImxuazE4Ij48cGF0aCBkPSJNMTI3Ljk4LDEwMS45NDY5IEMxNjMuNywxMjIuODE2OSAyMzcuMjY5NCwxNjUuOCAyNjMuODQ5NCwxODEuMzMiIGZpbGw9Im5vbmUiIGlkPSJhY2NvdW50aW5nLXRvLSYjMzYxOTY7JiM0MDY1ODsmIzIwOTY2OyYjMjk3MDI7JiMyMzY1MzsmIzI3NTA4OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjY5LjAzLDE4NC4zNTY5LDI2My4yNzcxLDE3Ni4zNjI5LDI2NC43MTI5LDE4MS44MzQ1LDI1OS4yNDEzLDE4My4yNzAzLDI2OS4wMywxODQuMzU2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBtYXN0ZXIgdG8gPz8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDE5IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGlkPSJsbmsyMCI+PHBhdGggZD0iTTQ0OS4yMywxMDEuOTQ2OSBDNDgzLjMsMTIyLjcxNjkgNTUzLjA5NzgsMTY1LjI2MjMgNTc4LjkxNzgsMTgxLjAxMjMiIGZpbGw9Im5vbmUiIGlkPSJtYXN0ZXItdG8tJiMyMjc5MzsmIzI2MzU2OyYjMjM2NTM7JiMyNzUwODsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU4NC4wNCwxODQuMTM2OSw1NzguNDM5NywxNzYuMDM1Myw1NzkuNzcxNSwxODEuNTMzMSw1NzQuMjczNiwxODIuODY0OSw1ODQuMDQsMTg0LjEzNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgbWFzdGVyIHRvID8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDgiIGRhdGEtZW50aXR5LTI9ImVudDAwMjEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgaWQ9ImxuazIyIj48cGF0aCBkPSJNNDc0LjY4LDEwMi4wNzY5IEM1MjIuMjcsMTE0LjQxNjkgNjAxLjIyLDEzNi4zMzY5IDY2NywxNjEuNTk2OSBDNjg1LjQyLDE2OC42NjY5IDcwMC43NDYsMTc2LjI3MDkgNzEyLjA3NiwxODIuMjEwOSIgZmlsbD0ibm9uZSIgaWQ9Im1hc3Rlci10by0mIzEyNTEwOyYjMTI0NzM7JiMxMjQ3OTsmIzIzNjUzOyYjMjc1MDg7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3MTcuMzksMTg0Ljk5NjksNzExLjI3NjMsMTc3LjI3NTMsNzEyLjk2MTcsMTgyLjY3NTIsNzA3LjU2MTcsMTg0LjM2MDYsNzE3LjM5LDE4NC45OTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIHRyYW5zYWN0aW9uIHRvID8/Pz8/LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTMiIGRhdGEtZW50aXR5LTI9ImVudDAwMjMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgaWQ9ImxuazI0Ij48cGF0aCBkPSJNODgwLjk4LDEwMS45NDY5IEM5MTAuMTksMTIyLjQyNjkgOTY4Ljk4NzIsMTYzLjY0MjQgOTkyLjMwNzIsMTc5Ljk5MjQiIGZpbGw9Im5vbmUiIGlkPSJ0cmFuc2FjdGlvbi10by0mIzMwNDM1OyYjMjY2MTk7JiMxMjQ1OTsmIzEyNTIxOyYjMTI1MTI7IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5OTcuMjIsMTgzLjQzNjksOTkyLjE0NzEsMTc0Ljk5NSw5OTMuMTI2LDE4MC41NjY1LDk4Ny41NTQ1LDE4MS41NDU0LDk5Ny4yMiwxODMuNDM2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48P3BsYW50dW1sLXNyYyBQVDJ2SmlEMDQwUld0YS1uQ1lNWWVnRVdXMDg5OElYZVFPb25HZ0ltYmZuRFhJWmk5T2FER2ZtMUdIM2ExMkNCZVgwV1c4dG9DOURyZDhmTk9FcjAzakFEVGNTcXRfbWFKWDhBY1dRejBsZUo2Mk1XNXEwVldOZjBUVnhJX2NnMWxpbEMzRVo3V2cwZkNmNW1aMC04UlV5Z2lDckVtbU1RM1JrRGJlV2Nia0FuSkpBTkkyYmVNdjBiUkdFOWhGcFNWankzd2hSVDc0ak5VSDR1LXR4VHU4TF9MbEVqZDhZYTk5OWFNS3JYNGlTbjBRajRHVWlnOFVoTTMwZlVBcnR0WDZObEVhVVBEVnBqY1ByeXNSenIwemlCY2FOTUlkU0J2aFRkMkppWkNnMHRPN25tcTlYaUdMQ0tGQTNiQ2tuS3Z2MWt5UHV6YlZmNmJaT1pyOVFLOThlczJjOExveS1faTdoTFZ0cFhkQ05MYlVLdkJiWjNhb1pTSVZjYkQ0cEdRMEF6WnNmcEo2UzJWRzNRMEVDRFpEZlZQLUZGRUF6Z0tjOVdGQnBtNnBRZGlVbmRTRDBDWXNrUlZKZUhhNldJSmFlb1lRbHVOc3BFRUctQ01ObFRvcWY4d3dLNlhYRGpCZUlZR1U5ZVFjZnM5RVpVVEtCbF9FWHQtRWYtZ0NDRF9TWF9QdVRhcVZ5X20weTA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<table>
<thead>
<tr>
<th>データ種別</th>
<th>推奨方式</th>
<th>理由</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>会計系</strong></td>
<td>赤黒処理</td>
<td>監査対応、会計原則</td>
</tr>
<tr>
<td><strong>マスタ</strong></td>
<td>変更履歴 + スナップショット</td>
<td>変更追跡、過去参照</td>
</tr>
<tr>
<td><strong>トランザクション</strong></td>
<td>論理削除 + 監査カラム</td>
<td>運用効率、復元可能</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="11_1">第11章のまとめ<a class="headerlink" href="#11_1" title="Permanent link">&para;</a></h2>
<p>本章では、販売管理システム全般で使用される共通処理の DB 設計と実装について学びました。</p>
<h3 id="_22">学んだこと<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>赤黒処理の設計</strong></li>
<li>確定済み伝票の訂正方法</li>
<li>赤伝票（マイナス計上）と黒伝票（プラス計上）</li>
<li>
<p>監査証跡の確保</p>
</li>
<li>
<p><strong>自動採番の設計</strong></p>
</li>
<li>採番マスタによる柔軟な設定</li>
<li>年次・月次・日次・連番の対応</li>
<li>
<p>履歴による採番管理</p>
</li>
<li>
<p><strong>監査カラムの設計</strong></p>
</li>
<li>作成日時・作成者・更新日時・更新者</li>
<li>論理削除（削除フラグ・削除日時・削除者）</li>
<li>
<p>インターセプターによる自動設定</p>
</li>
<li>
<p><strong>履歴テーブルの設計</strong></p>
</li>
<li>変更履歴（変更前後の JSON 保存）</li>
<li>スナップショット方式の履歴</li>
<li>有効期間による履歴管理</li>
</ol>
<h3 id="_23">テーブル一覧<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>テーブル名（日本語）</th>
<th>Java エンティティ</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>赤黒処理履歴データ</td>
<td>RedBlackHistory</td>
<td>赤黒処理の履歴</td>
</tr>
<tr>
<td>採番マスタ</td>
<td>NumberingMaster</td>
<td>採番ルールの定義</td>
</tr>
<tr>
<td>採番履歴データ</td>
<td>NumberingHistory</td>
<td>年月別の採番状況</td>
</tr>
<tr>
<td>変更履歴データ</td>
<td>ChangeHistory</td>
<td>データ変更の履歴</td>
</tr>
<tr>
<td>商品マスタ履歴</td>
<td>ProductHistory</td>
<td>商品マスタのスナップショット</td>
</tr>
</tbody>
</table>
<h3 id="enum">ENUM 一覧<a class="headerlink" href="#enum" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>DB ENUM 型（日本語）</th>
<th>Java Enum</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr>
<td>伝票区分</td>
<td>SlipType</td>
<td>通常→NORMAL, 赤伝→RED, 黒伝→BLACK</td>
</tr>
</tbody>
</table>
<h3 id="er_3">共通処理 ER 図<a class="headerlink" href="#er_3" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9IjQxOXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6ODIycHg7aGVpZ2h0OjQxOXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDgyMiA0MTkiIHdpZHRoPSI4MjJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjA4NDk7JiMzNjg5MDsmIzIwOTY2OyYjMjk3MDI7IEVSJiMyMjI1OTs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NS4yMTc1IiB4PSIzNTYuNzY0MiIgeT0iMjIuOTk1MSI+JiMyMDg0OTsmIzM2ODkwOyYjMjA5NjY7JiMyOTcwMjsgRVImIzIyMjU5OzwvdGV4dD48L2c+PCEtLWNsYXNzID8/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjE0NS43ODEzIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEuMjAzOCIgeD0iMTEuNCIgeT0iNjguNzQ2OSIvPjxlbGxpcHNlIGN4PSIzNS4wNDE4IiBjeT0iODQuNzQ2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMzkuMTUxMiw5MC43NDY5IEwzMS40MzI1LDkwLjc0NjkgTDMxLjQzMjUsNzguMzU2MiBMMzkuMTUxMiw3OC4zNTYyIEwzOS4xNTEyLDgwLjUxMjUgTDMzLjg4NTYsODAuNTEyNSBMMzMuODg1Niw4My4xODQ0IEwzOC42NTEyLDgzLjE4NDQgTDM4LjY1MTIsODUuMzQwNiBMMzMuODg1Niw4NS4zNDA2IEwzMy44ODU2LDg4LjU5MDYgTDM5LjE1MTIsODguNTkwNiBMMzkuMTUxMiw5MC43NDY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNTAuOTYyMyIgeT0iODkuNTkzNiI+JiMyNTUwNTsmIzMwMDU4OyYjMTI1MTA7JiMxMjQ3MzsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMi40IiB4Mj0iMTMxLjYwMzgiIHkxPSIxMDAuNzQ2OSIgeTI9IjEwMC43NDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjIwMzgiIHg9IjE3LjQiIHk9IjExNy43NDIiPiYjMjU1MDU7JiMzMDA1ODsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTsgJiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyLjQiIHgyPSIxMzEuNjAzOCIgeTE9IjEyNS4wNDM3IiB5Mj0iMTI1LjA0MzciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxNy40IiB5PSIxNDIuMDM4OSI+JiMyNTUwNTsmIzMwMDU4OyYjMjE1MTc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjE3LjQiIHk9IjE1OC4zMzU3Ij4mIzEyNTAzOyYjMTI1MjQ7JiMxMjUwMTsmIzEyNDUxOyYjMTI0ODM7JiMxMjQ2MzsmIzEyNDczOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxNy40IiB5PSIxNzQuNjMyNiI+JiMyNTUwNTsmIzMwMDU4OyYjMjQ0MTg7JiMyNDMzNTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iMTcuNCIgeT0iMTkwLjkyOTUiPiYjMjY2ODk7JiMyNTk2ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEuOTk5OCIgeD0iMTcuNCIgeT0iMjA3LjIyNjQiPiYjMjk2OTQ7JiMyMjMxMjsmIzIwNTE2OzwvdGV4dD48L2c+PCEtLWNsYXNzID8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOS45OTk2IiB4PSI3IiB5PSIyOTguOTY2OSIvPjxlbGxpcHNlIGN4PSIyMiIgY3k9IjMxNC45NjY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0yNi4xMDk0LDMyMC45NjY5IEwxOC4zOTA2LDMyMC45NjY5IEwxOC4zOTA2LDMwOC41NzYzIEwyNi4xMDk0LDMwOC41NzYzIEwyNi4xMDk0LDMxMC43MzI1IEwyMC44NDM4LDMxMC43MzI1IEwyMC44NDM4LDMxMy40MDQ0IEwyNS42MDk0LDMxMy40MDQ0IEwyNS42MDk0LDMxNS41NjA2IEwyMC44NDM4LDMxNS41NjA2IEwyMC44NDM4LDMxOC44MTA2IEwyNi4xMDk0LDMxOC44MTA2IEwyNi4xMDk0LDMyMC45NjY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMzYiIHk9IjMxOS44MTM2Ij4mIzI1NTA1OyYjMzAwNTg7JiMyMzY1MzsmIzI3NTA4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTM1Ljk5OTYiIHkxPSIzMzAuOTY2OSIgeTI9IjMzMC45NjY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTQuMTEzMyIgeD0iMTMiIHk9IjM0Ny45NjIiPklEICYjMTcxO1BLJiMxODc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4IiB4Mj0iMTM1Ljk5OTYiIHkxPSIzNTUuMjYzOCIgeTI9IjM1NS4yNjM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjgxNDEiIHg9IjEzIiB5PSIzNzIuMjU4OSI+JiMyNTUwNTsmIzMwMDU4OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OyAmIzE3MTtGSyYjMTg3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMyIgeT0iMzg4LjU1NTciPiYjMjU1MDU7JiMzMDA1ODsmIzI0MTgwOyYjMjYzNzY7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEzIiB5PSI0MDQuODUyNiI+JiMyNjM2ODsmIzMyMDY2OyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PC9nPjwhLS1jbGFzcyA/Pz8/Pz8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjIxIiBpZD0iZW50MDAwNCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxOTQuNjcxOSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTU3Ljk5OTUiIHg9IjM1NSIgeT0iNDQuMjk2OSIvPjxlbGxpcHNlIGN4PSIzNzAiIGN5PSI2MC4yOTY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik0zNzQuMTA5NCw2Ni4yOTY5IEwzNjYuMzkwNiw2Ni4yOTY5IEwzNjYuMzkwNiw1My45MDYzIEwzNzQuMTA5NCw1My45MDYzIEwzNzQuMTA5NCw1Ni4wNjI1IEwzNjguODQzOCw1Ni4wNjI1IEwzNjguODQzOCw1OC43MzQ0IEwzNzMuNjA5NCw1OC43MzQ0IEwzNzMuNjA5NCw2MC44OTA2IEwzNjguODQzOCw2MC44OTA2IEwzNjguODQzOCw2NC4xNDA2IEwzNzQuMTA5NCw2NC4xNDA2IEwzNzQuMTA5NCw2Ni4yOTY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI1Ljk5OTUiIHg9IjM4NCIgeT0iNjUuMTQzNiI+JiMzNjE5NjsmIzQwNjU4OyYjMjA5NjY7JiMyOTcwMjsmIzIzNjUzOyYjMjc1MDg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM1NiIgeDI9IjUxMS45OTk1IiB5MT0iNzYuMjk2OSIgeTI9Ijc2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NC4xMTMzIiB4PSIzNjEiIHk9IjkzLjI5MiI+SUQgJiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjM1NiIgeDI9IjUxMS45OTk1IiB5MT0iMTAwLjU5MzgiIHkyPSIxMDAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3LjAwODUiIHg9IjM2MSIgeT0iMTE3LjU4ODkiPiYjMjA5NjY7JiMyOTcwMjsmIzMwMDU4OyYjMjE0OTU7ICYjMTcxO1VLJiMxODc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjM2MSIgeT0iMTMzLjg4NTciPiYjMjA5NjY7JiMyOTcwMjsmIzI2MDg1OyYjMjYxNzg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjM2MSIgeT0iMTUwLjE4MjYiPiYjMjAyNTM7JiMzMTA4MDsmIzMxMjc4OyYjMjEwMjk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjM2MSIgeT0iMTY2LjQ3OTUiPiYjMjA4MDM7JiMyMDI1MzsmIzMxMDgwOyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMzYxIiB5PSIxODIuNzc2NCI+JiMzNjE5NjsmIzIwMjUzOyYjMzEwODA7JiMzMDA1ODsmIzIxNDk1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIzNjEiIHk9IjE5OS4wNzMyIj4mIzQwNjU4OyYjMjAyNTM7JiMzMTA4MDsmIzMwMDU4OyYjMjE0OTU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjM2MSIgeT0iMjE1LjM3MDEiPiYjMjA5NjY7JiMyOTcwMjsmIzI5NzAyOyYjMzAwMDE7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjM2MSIgeT0iMjMxLjY2NyI+JiMyMDk2NjsmIzI5NzAyOyYjMzI3NzM7PC90ZXh0PjwvZz48IS0tY2xhc3MgPz8/Pz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjM0IiBpZD0iZW50MDAwNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxNzguMzc1IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTUuNDg2IiB4PSI2NjAuMjYiIHk9IjUyLjQ0NjkiLz48ZWxsaXBzZSBjeD0iNjg2LjcyODkiIGN5PSI2OC40NDY5IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwYXRoIGQ9Ik02OTAuODM4Myw3NC40NDY5IEw2ODMuMTE5NSw3NC40NDY5IEw2ODMuMTE5NSw2Mi4wNTYzIEw2OTAuODM4Myw2Mi4wNTYzIEw2OTAuODM4Myw2NC4yMTI1IEw2ODUuNTcyNiw2NC4yMTI1IEw2ODUuNTcyNiw2Ni44ODQ0IEw2OTAuMzM4Myw2Ni44ODQ0IEw2OTAuMzM4Myw2OS4wNDA2IEw2ODUuNTcyNiw2OS4wNDA2IEw2ODUuNTcyNiw3Mi4yOTA2IEw2OTAuODM4Myw3Mi4yOTA2IEw2OTAuODM4Myw3NC40NDY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iNzAzLjI3NzUiIHk9IjczLjI5MzYiPiYjMjI3OTM7JiMyNjM1NjsmIzIzNjUzOyYjMjc1MDg7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjY2MS4yNiIgeDI9IjgxNC43NDYiIHkxPSI4NC40NDY5IiB5Mj0iODQuNDQ2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU0LjExMzMiIHg9IjY2Ni4yNiIgeT0iMTAxLjQ0MiI+SUQgJiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjY2MS4yNiIgeDI9IjgxNC43NDYiIHkxPSIxMDguNzQzOCIgeTI9IjEwOC43NDM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNjY2LjI2IiB5PSIxMjUuNzM4OSI+JiMxMjQ4NjsmIzEyNTQwOyYjMTI1MDI7JiMxMjUyMzsmIzIxNTE3OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MC45MDg5IiB4PSI2NjYuMjYiIHk9IjE0Mi4wMzU3Ij4mIzEyNTI0OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5O0lEPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjY2Ni4yNiIgeT0iMTU4LjMzMjYiPiYjMjU4MDU7JiMyMDMxNjsmIzMxMjc4OyYjMjEwMjk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjY2Ni4yNiIgeT0iMTc0LjYyOTUiPiYjMjI3OTM7JiMyNjM1NjsmIzI2MDg1OyYjMjYxNzg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjY2Ni4yNiIgeT0iMTkwLjkyNjQiPiYjMjI3OTM7JiMyNjM1NjsmIzMyNzczOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuNDg2IiB4PSI2NjYuMjYiIHk9IjIwNy4yMjMyIj4mIzIyNzkzOyYjMjYzNTY7JiMyMTA2OTsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsgKEpTT05CKTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuNDg2IiB4PSI2NjYuMjYiIHk9IjIyMy41MjAxIj4mIzIyNzkzOyYjMjYzNTY7JiMyNDQ2MDsmIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsgKEpTT05CKTwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01ONyIgZGF0YS1zb3VyY2UtbGluZT0iNDkiIGlkPSJlbnQwMDA4Ij48cGF0aCBkPSJNMTY3LjkyLDk4Ljc5NjkgTDE2Ny45MiwxMzcuNjM2OSBMMTMyLjgsMTQxLjYzNjkgTDE2Ny45MiwxNDUuNjM2OSBMMTY3LjkyLDE4NC40NjA5IEEwLDAgMCAwIDAgMTY3LjkyLDE4NC40NjA5IEwzMjAuMDgxNywxODQuNDYwOSBBMCwwIDAgMCAwIDMyMC4wODE3LDE4NC40NjA5IEwzMjAuMDgxNywxMDguNzk2OSBMMzEwLjA4MTcsOTguNzk2OSBMMTY3LjkyLDk4Ljc5NjkgQTAsMCAwIDAgMCAxNjcuOTIsOTguNzk2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTMxMC4wODE3LDk4Ljc5NjkgTDMxMC4wODE3LDEwOC43OTY5IEwzMjAuMDgxNywxMDguNzk2OSBMMzEwLjA4MTcsOTguNzk2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTYuMzc5OSIgeD0iMTczLjkyIiB5PSIxMTUuODYzOCI+JiMyNTUwNTsmIzMwMDU4OyYjMjQ0MTg7JiMyNDMzNTs6PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4LjM2MzMiIHg9IjE3My45MiIgeT0iMTMwLjk5NjYiPi0gWUVBUkxZICgmIzI0MTgwOyYjMjc0MjU7KTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTMuMTcyNCIgeD0iMTczLjkyIiB5PSIxNDYuMTI5NCI+LSBNT05USExZICgmIzI2Mzc2OyYjMjc0MjU7KTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4Ny4wMjAxIiB4PSIxNzMuOTIiIHk9IjE2MS4yNjIyIj4tIERBSUxZICgmIzI2MDg1OyYjMjc0MjU7KTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzEuMTYxNyIgeD0iMTczLjkyIiB5PSIxNzYuMzk1Ij4tIFNFUVVFTlRJQUwgKCYjMzY4OTk7JiMzMDA1ODspPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4xMCIgZGF0YS1zb3VyY2UtbGluZT0iNTciIGlkPSJlbnQwMDExIj48cGF0aCBkPSJNNTQ4LjMxLDk4Ljc5NjkgTDU0OC4zMSwxMzcuNjM2OSBMNTEzLjQ5LDE0MS42MzY5IEw1NDguMzEsMTQ1LjYzNjkgTDU0OC4zMSwxODQuNDYwOSBBMCwwIDAgMCAwIDU0OC4zMSwxODQuNDYwOSBMNjI1LjY4OTksMTg0LjQ2MDkgQTAsMCAwIDAgMCA2MjUuNjg5OSwxODQuNDYwOSBMNjI1LjY4OTksMTA4Ljc5NjkgTDYxNS42ODk5LDk4Ljc5NjkgTDU0OC4zMSw5OC43OTY5IEEwLDAgMCAwIDAgNTQ4LjMxLDk4Ljc5NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik02MTUuNjg5OSw5OC43OTY5IEw2MTUuNjg5OSwxMDguNzk2OSBMNjI1LjY4OTksMTA4Ljc5NjkgTDYxNS42ODk5LDk4Ljc5NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2LjM3OTkiIHg9IjU1NC4zMSIgeT0iMTE1Ljg2MzgiPiYjMjAyNTM7JiMzMTA4MDsmIzMxMjc4OyYjMjEwMjk7OjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNC44MjMzIiB4PSI1NTQuMzEiIHk9IjEzMC45OTY2Ij4tICYjMjI3NzA7JiMxOTk3ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQuODIzMyIgeD0iNTU0LjMxIiB5PSIxNDYuMTI5NCI+LSAmIzIwMTgxOyYjMjA4Mzc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0LjgyMzMiIHg9IjU1NC4zMSIgeT0iMTYxLjI2MjIiPi0gJiMzNTUzMTsmIzI3NzE0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNC44MjMzIiB4PSI1NTQuMzEiIHk9IjE3Ni4zOTUiPi0gJiMyNTkwMzsmIzI1MTczOzwvdGV4dD48L2c+PCEtLWxpbmsgPz8/Pz8gdG8gPz8/Pz8/Py0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAyIiBkYXRhLWVudGl0eS0yPSJlbnQwMDAzIiBkYXRhLWxpbmstdHlwZT0iY3Jvd2Zvb3QiIGRhdGEtc291cmNlLWxpbmU9IjQ2IiBpZD0ibG5rNiI+PHBhdGggY29kZUxpbmU9IjQ2IiBkPSJNNzIsMjIyLjk3NjkgQzcyLDI1MC4zMTY5IDcyLDI1NC45ODY5IDcyLDI4MC41OTY5IiBmaWxsPSJub25lIiBpZD0iJiMyNTUwNTsmIzMwMDU4OyYjMTI1MTA7JiMxMjQ3MzsmIzEyNDc5Oy0mIzI1NTA1OyYjMzAwNTg7JiMyMzY1MzsmIzI3NTA4OyYjMTI0ODc7JiMxMjU0MDsmIzEyNDc5OyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2OCIgeDI9Ijc2IiB5MT0iMjE4Ljk3NjkiIHkyPSIyMTguOTc2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2OCIgeDI9Ijc2IiB5MT0iMjIxLjk3NjkiIHkyPSIyMjEuOTc2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3MiIgeDI9IjcyIiB5MT0iMjIyLjk3NjkiIHkyPSIyMTQuOTc2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3MiIgeDI9Ijc4IiB5MT0iMjkwLjU5NjkiIHkyPSIyOTguNTk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3MiIgeDI9IjY2IiB5MT0iMjkwLjU5NjkiIHkyPSIyOTguNTk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI3MiIgeDI9IjcyIiB5MT0iMjkwLjU5NjkiIHkyPSIyOTguNTk2OSIvPjxlbGxpcHNlIGN4PSI3MiIgY3k9IjI4NC41OTY5IiBmaWxsPSJub25lIiByeD0iNCIgcnk9IjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PD9wbGFudHVtbC1zcmMgWFBCVElXOTE1Q1Zsdm9kY0tZX3MxSTgyR29GeHE0Z3p5M3VoOEg5WVJvQTNSR1RKQXBFZ0pJZUJKM1VhQjNFTDRaendjNzVjeklzUVNLVEpZdUF6Y0ZDX0UtVnRkdEVFNzlHdDB2MTRJYnRiY2FHVlpEQzN3NVdYRHNLMDBiam9LRHcxejJIWlE4eU90TTZyWGpMRmswazRlZk9uUWMwS1h2RUpJX0RKS3EySUg4UVM5VzE2QU9tQTY2Yk9wTUE0aTVmYXJfbHZ2WnJmOTA3RHg1Rmo1SFo5NWFkZFlQODNVc0RDS2pCZlNtTVpBRVZxbzR4eDN6WW1aSGNVNE5UaDVQZ0UwUGZNWkFoQXUtSnhLRnJFRFRVamR2ZEZfT1RZX2NITU9CQUZvd1A2S3BnekthNnhTTWxlVUlGX0djOHc4MTRhT1hGOUcyQ25ldXg0ZVpoeEJhZVl3MllIOFFTYTV3U3RiTnl5T2RKR3d5NGJIYXpjeW1rM2paWmpXOXVkc2lycXRzNmxlRjFrMWZtZUVGNzREeUdvdnQ2eGZndHpMRWx1UHVodjc1LUZTNVlJR2hrX0puMjBoUDBTV0RsMXpHcVBYalI2THNqYUZJUTAxRnFFc3lnMjdyaHVDMGlQQXJDTXRJeGxCOVZPUzhMYWpwYngwZGtIQU5XU29wdzdvLWtxQksxQkx5Y29ZYlJNcExOOHNVQ0VfYlk0YVM1b0RvSnhybHV1UDhUc05JQ0hkSHF3SnFVcWZCODNsSVpJazNRV1YwNDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_24">次章の予告<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>第12章では、B 社事例を用いた財務会計データの作成に進みます。販売管理システムで設計したマスタ・トランザクションデータを、実際のビジネスシナリオに基づいて構築します。</p>
<hr />
<p><a href="../chapter10/">← 第10章：債務管理の設計</a> | <a href="../chapter12/">第12章：財務会計データ作成（B社事例） →</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>