
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../chapter21-orm/">
      
      
        <link rel="next" href="../../../assets/schemaspy-output/sms/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>第22章 Axon CQRS/ESの実装【ORM版】 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#22axon-cqrses-orm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第22章 Axon CQRS/ESの実装【ORM版】
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-setup-instruction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    プロジェクトセットアップ手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究5 AxonCQRS/ESの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" checked>
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    第22章 Axon CQRS/ESの実装【ORM版】
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 Axon CQRS/ESの実装【ORM版】
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#221-cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.1 CQRS/ES アーキテクチャの基礎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.1 CQRS/ES アーキテクチャの基礎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2211-cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.1.1 CQRS とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2212-event-sourcing" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.1.2 Event Sourcing とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2213" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.1.3 ヘキサゴナルアーキテクチャとの統合
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#222" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2 技術スタック
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.2 技術スタック">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2221-buildgradlekts" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2.1 build.gradle.kts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2222" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2.2 ディレクトリ構造
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#223-axon-jpa" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.3 Axon 設定クラス（JPA版）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.3 Axon 設定クラス（JPA版）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2231-axonconfigjava" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.3.1 AxonConfig.java
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2232-jpaconfigjava" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.3.2 JpaConfig.java
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#224" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4 ドメインモデルとイベント設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.4 ドメインモデルとイベント設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2241-journal-bounded-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.1 Journal Bounded Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.4.1 Journal Bounded Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        状態遷移図
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント一覧
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2242-api-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.2 イベント定義（API Layer）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.4.2 イベント定義（API Layer）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sealed-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        sealed interface によるイベントの型安全性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#record" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベント record の実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2243-domain-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.3 コマンド定義（Domain Layer）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2244-java" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.4 ドメインモデル（純粋な Java）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#225-aggregate-adapter-policy-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.5 Aggregate Adapter と Policy Handler
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.5 Aggregate Adapter と Policy Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2251-journalentry-aggregate-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.5.1 JournalEntry Aggregate Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2252-policy-handlerchoreography" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.5.2 Policy Handler（Choreography パターン）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#226-projection-read-modeljpa" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6 Projection と Read Model（JPA版）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.6 Projection と Read Model（JPA版）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2261-journalentry-projection" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6.1 JournalEntry Projection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2262-read-model-entityjpa" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6.2 Read Model Entity（JPA）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2263-jpa-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6.3 JPA Repository インターフェース
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#227-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7 REST API と統合テスト
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.7 REST API と統合テスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2271-rest-controllerinbound-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7.1 REST Controller（Inbound Adapter）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2272-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7.2 API エンドポイント一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2273-axon-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7.3 Axon Test による単体テスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#228" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8 まとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.8 まとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2281" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8.1 実装した機能一覧
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2282-mybatis-jpa" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8.2 MyBatis 版と JPA 版の比較
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2283-jpa" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8.3 JPA 版の利点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2284-cqrses" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8.4 財務会計システムにおける CQRS/ES の意義
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_18" >
        
          
          <label class="md-nav__link" for="__nav_1_18" id="__nav_1_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（FAS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/pms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（PMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="22axon-cqrses-orm">第22章：Axon CQRS/ES の実装【ORM版】<a class="headerlink" href="#22axon-cqrses-orm" title="Permanent link">&para;</a></h1>
<p>本章では、財務会計システムに <strong>CQRS（Command Query Responsibility Segregation）</strong> と <strong>Event Sourcing</strong> を実装します。Axon Framework を使用し、コマンド（書き込み）とクエリ（読み取り）を分離し、すべての状態変更をイベントとして記録するアーキテクチャを構築します。</p>
<p>研究 1 で構築したヘキサゴナルアーキテクチャの考え方を踏襲しつつ、<strong>ドメインモデルをフレームワークから分離</strong>し、Axon Aggregate Adapter を介して連携させます。Read Model の永続化には <strong>Spring Data JPA</strong> を使用します。</p>
<hr />
<h2 id="221-cqrses">22.1 CQRS/ES アーキテクチャの基礎<a class="headerlink" href="#221-cqrses" title="Permanent link">&para;</a></h2>
<h3 id="2211-cqrs">22.1.1 CQRS とは<a class="headerlink" href="#2211-cqrs" title="Permanent link">&para;</a></h3>
<p>CQRS（Command Query Responsibility Segregation）は、コマンド（書き込み）とクエリ（読み取り）の責務を分離するアーキテクチャパターンです。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjYzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzU5cHg7aGVpZ2h0OjYzNHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM1OSA2MzQiIHdpZHRoPSIzNTlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPkNRUlMgJiMxMjQ1MDsmIzEyNTQwOyYjMTI0NjE7JiMxMjQ4NjsmIzEyNDYzOyYjMTI0ODE7JiMxMjUxNTsmIzY1Mjg4OyYjMzYwMDE7JiMyMTIwOTsmIzIwMjUwOyYjMzUzMzY7JiMxMjQ3MTsmIzEyNDczOyYjMTI0ODY7JiMxMjUxMjsgSlBBJiMyOTI1NjsmIzY1Mjg5OzwvdGl0bGU+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNjM0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzU5IiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSI0Ij48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMxLjA5MDciIHg9IjEwIiB5PSIyMi45OTUxIj5DUVJTICYjMTI0NTA7JiMxMjU0MDsmIzEyNDYxOyYjMTI0ODY7JiMxMjQ2MzsmIzEyNDgxOyYjMTI1MTU7JiM2NTI4ODsmIzM2MDAxOyYjMjEyMDk7JiMyMDI1MDsmIzM1MzM2OyYjMTI0NzE7JiMxMjQ3MzsmIzEyNDg2OyYjMTI1MTI7IEpQQSYjMjkyNTY7JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIENvbW1hbmQgU2lkZSAoV3JpdGUpLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSAuV3JpdGUuIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwMiI+PHBhdGggZD0iTTI5LjU0NTMsNDMuMjk2OSBMMjA5LjMyNTYsNDMuMjk2OSBBMy43NSwzLjc1IDAgMCAxIDIxMS44MjU2LDQ1Ljc5NjkgTDIxOC44MjU2LDY1LjU5MzggTDIxOC41NDUzLDY1LjU5MzggQTIuNSwyLjUgMCAwIDEgMjIxLjA0NTMsNjguMDkzOCBMMjIxLjA0NTMsNDE2Ljk4NjkgQTIuNSwyLjUgMCAwIDEgMjE4LjU0NTMsNDE5LjQ4NjkgTDI5LjU0NTMsNDE5LjQ4NjkgQTIuNSwyLjUgMCAwIDEgMjcuMDQ1Myw0MTYuOTg2OSBMMjcuMDQ1Myw0NS43OTY5IEEyLjUsMi41IDAgMCAxIDI5LjU0NTMsNDMuMjk2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjcuMDQ1MyIgeDI9IjIxOC44MjU2IiB5MT0iNjUuNTkzOCIgeTI9IjY1LjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc4Ljc4MDMiIHg9IjMxLjA0NTMiIHk9IjU4LjI5MiI+Q29tbWFuZCBTaWRlIChXcml0ZSk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIFF1ZXJ5IFNpZGUgKFJlYWQpLS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuIiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMTAiPjxwYXRoIGQ9Ik02MC41NDUzLDQ0My40ODY5IEwyMDUuNjI2NCw0NDMuNDg2OSBBMy43NSwzLjc1IDAgMCAxIDIwOC4xMjY0LDQ0NS45ODY5IEwyMTUuMTI2NCw0NjUuNzgzNyBMMzM0LjU0NTMsNDY1Ljc4MzcgQTIuNSwyLjUgMCAwIDEgMzM3LjA0NTMsNDY4LjI4MzcgTDMzNy4wNDUzLDYyNC41NzY5IEEyLjUsMi41IDAgMCAxIDMzNC41NDUzLDYyNy4wNzY5IEw2MC41NDUzLDYyNy4wNzY5IEEyLjUsMi41IDAgMCAxIDU4LjA0NTMsNjI0LjU3NjkgTDU4LjA0NTMsNDQ1Ljk4NjkgQTIuNSwyLjUgMCAwIDEgNjAuNTQ1Myw0NDMuNDg2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTguMDQ1MyIgeDI9IjIxNS4xMjY0IiB5MT0iNDY1Ljc4MzciIHkyPSI0NjUuNzgzNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDQuMDgxMSIgeD0iNjIuMDQ1MyIgeT0iNDU4LjQ4MiI+UXVlcnkgU2lkZSAoUmVhZCk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUkVTVCBDb250cm9sbGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCBTaWRlIC5Xcml0ZS4uUkVTVCBDb250cm9sbGVyIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkuNjM0OCIgeD0iNjUuMjI1MyIgeT0iNzguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS42MzQ4IiB4PSI3NS4yMjUzIiB5PSIxMDEuMjkyIj5SRVNUIENvbnRyb2xsZXI8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQ29tbWFuZEdhdGV3YXktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUgLldyaXRlLi5Db21tYW5kR2F0ZXdheSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUzLjc5OTgiIHg9IjQ3LjE0NTMiIHk9IjE3NC41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMzLjc5OTgiIHg9IjU3LjE0NTMiIHk9IjE5Ny41OTIiPkNvbW1hbmRHYXRld2F5PC90ZXh0PjwvZz48IS0tZW50aXR5IEFnZ3JlZ2F0ZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNvbW1hbmQgU2lkZSAuV3JpdGUuLkFnZ3JlZ2F0ZSIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDYiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTMuMjg4MSIgeD0iNzQuNDA1MyIgeT0iMjcwLjg4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My4yODgxIiB4PSI4NC40MDUzIiB5PSIyOTMuODgyIj5BZ2dyZWdhdGU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgRXZlbnQgU3RvcmUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDb21tYW5kIFNpZGUgLldyaXRlLi5FdmVudCBTdG9yZSIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTAxLjg2NzIiIHg9IjY5LjExNTMiIHk9IjM2Ny4xODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODEuODY3MiIgeD0iNzkuMTE1MyIgeT0iMzkwLjE4MiI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgUHJvamVjdGlvbi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuLlByb2plY3Rpb24iIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS43ODEzIiB4PSI3NC4xNTUzIiB5PSI0NzguNDg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljc4MTMiIHg9Ijg0LjE1NTMiIHk9IjUwMS40ODIiPlByb2plY3Rpb248L3RleHQ+PC9nPjwhLS1lbnRpdHkgUmVhZCBNb2RlbCBEQi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuLlJlYWQgTW9kZWwgREIiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAxMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjcuMTI2IiB4PSIxMzMuNDg1MyIgeT0iNTc0Ljc3NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuMTI2IiB4PSIxNDMuNDg1MyIgeT0iNTk3Ljc3MiI+UmVhZCBNb2RlbCBEQjwvdGV4dD48L2c+PCEtLWVudGl0eSBKUEEgUmVwb3NpdG9yeS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IlF1ZXJ5IFNpZGUgLlJlYWQuLkpQQSBSZXBvc2l0b3J5IiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIxLjY3MDkiIHg9IjE5OS4yMDUzIiB5PSI0NzguNDg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMS42NzA5IiB4PSIyMDkuMjA1MyIgeT0iNTAxLjQ4MiI+SlBBIFJlcG9zaXRvcnk8L3RleHQ+PC9nPjwhLS1saW5rIFJFU1QgQ29udHJvbGxlciB0byBDb21tYW5kR2F0ZXdheS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA0IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgaWQ9ImxuazUiPjxwYXRoIGQ9Ik0xMjguOTQ1MywxMTQuNzM2OSBDMTI3Ljg2NTMsMTMxLjY0NjkgMTI2LjYxNjIsMTUxLjI2OSAxMjUuNTM2MiwxNjguMjQ5IiBmaWxsPSJub25lIiBpZD0iUkVTVCBDb250cm9sbGVyLXRvLUNvbW1hbmRHYXRld2F5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMjUuMTU1MywxNzQuMjM2OSwxMjkuNzE4NiwxNjUuNTA4OSwxMjUuNDcyNywxNjkuMjQ3LDEyMS43MzQ3LDE2NS4wMDExLDEyNS4xNTUzLDE3NC4yMzY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIENvbW1hbmRHYXRld2F5IHRvIEFnZ3JlZ2F0ZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA2IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImxuazciPjxwYXRoIGQ9Ik0xMjMuNDk1MywyMTEuMDM2OSBDMTIyLjk1NTMsMjI3Ljk0NjkgMTIyLjMzNjEsMjQ3LjU1OTkgMTIxLjc5NjEsMjY0LjUzOTkiIGZpbGw9Im5vbmUiIGlkPSJDb21tYW5kR2F0ZXdheS10by1BZ2dyZWdhdGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMS42MDUzLDI3MC41MzY5LDEyNS44ODk0LDI2MS42Njg2LDEyMS43NjQzLDI2NS41Mzk0LDExNy44OTM0LDI2MS40MTQzLDEyMS42MDUzLDI3MC41MzY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEFnZ3JlZ2F0ZSB0byBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA2IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA4IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImxuazkiPjxwYXRoIGQ9Ik0xMjAuODY1MywzMDcuMzM2OSBDMTIwLjY4NTMsMzI0LjIzNjkgMTIwLjQ3ODksMzQzLjg0NzIgMTIwLjI5ODksMzYwLjgyNzIiIGZpbGw9Im5vbmUiIGlkPSJBZ2dyZWdhdGUtdG8tRXZlbnQgU3RvcmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMC4yMzUzLDM2Ni44MjY5LDEyNC4zMzA1LDM1Ny44Njk4LDEyMC4yODgzLDM2MS44MjcyLDExNi4zMzEsMzU3Ljc4NSwxMjAuMjM1MywzNjYuODI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBFdmVudCBTdG9yZSB0byBQcm9qZWN0aW9uLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDgiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImxuazEyIj48cGF0aCBkPSJNMTE5Ljg4NTMsNDAzLjg5NjkgQzExOS42OTUzLDQyNC4yODY5IDExOS40NTEzLDQ1MS43MzcxIDExOS4yNjEzLDQ3Mi4xMTcxIiBmaWxsPSJub25lIiBpZD0iRXZlbnQgU3RvcmUtdG8tUHJvamVjdGlvbiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTE5LjIwNTMsNDc4LjExNjksMTIzLjI4OTEsNDY5LjE1NDYsMTE5LjI1Miw0NzMuMTE3MSwxMTUuMjg5NCw0NjkuMDgsMTE5LjIwNTMsNDc4LjExNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgUHJvamVjdGlvbiB0byBSZWFkIE1vZGVsIERCLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTEiIGRhdGEtZW50aXR5LTI9ImVudDAwMTMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgaWQ9ImxuazE0Ij48cGF0aCBkPSJNMTMzLjM1NTMsNTE0LjkyNjkgQzE0Ny4zMzUzLDUzMS44MzY5IDE2NC43MDE5LDU1Mi44MjI4IDE3OC43NDE5LDU2OS44MDI4IiBmaWxsPSJub25lIiBpZD0iUHJvamVjdGlvbi10by1SZWFkIE1vZGVsIERCIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxODIuNTY1Myw1NzQuNDI2OSwxNzkuOTEyOSw1NjQuOTQxOSwxNzkuMzc5Miw1NzAuNTczNSwxNzMuNzQ3Niw1NzAuMDM5OCwxODIuNTY1Myw1NzQuNDI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBSRVNUIENvbnRyb2xsZXIgdG8gSlBBIFJlcG9zaXRvcnktLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAxNSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBpZD0ibG5rMTYiPjxwYXRoIGQ9Ik0xNTkuMTk1MywxMTQuODY2OSBDMTc5LjIyNTMsMTI4LjQ4NjkgMjA0LjU0NTMsMTQ5LjMyNjkgMjE4LjA0NTMsMTc0LjU5NjkgQzI3My41MjUzLDI3OC40NjY5IDI2Ni44NDkzLDQyMS4zNTk4IDI2Mi40MDkzLDQ3Mi4wMDk4IiBmaWxsPSJub25lIiBpZD0iUkVTVCBDb250cm9sbGVyLXRvLUpQQSBSZXBvc2l0b3J5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNjEuODg1Myw0NzcuOTg2OSwyNjYuNjU2LDQ2OS4zNzA2LDI2Mi4zMjIsNDczLjAwNiwyNTguNjg2Niw0NjguNjcyLDI2MS44ODUzLDQ3Ny45ODY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEpQQSBSZXBvc2l0b3J5IHRvIFJlYWQgTW9kZWwgREItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxNSIgZGF0YS1lbnRpdHktMj0iZW50MDAxMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBpZD0ibG5rMTciPjxwYXRoIGQ9Ik0yNDguNDg1Myw1MTQuOTI2OSBDMjM3LjE5NTMsNTMxLjgzNjkgMjIzLjQxNzYsNTUyLjQ1NzMgMjEyLjA3NzYsNTY5LjQzNzMiIGZpbGw9Im5vbmUiIGlkPSJKUEEgUmVwb3NpdG9yeS10by1SZWFkIE1vZGVsIERCIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMDguNzQ1Myw1NzQuNDI2OSwyMTcuMDcwMSw1NjkuMTY0LDIxMS41MjIyLDU3MC4yNjg5LDIxMC40MTc0LDU2NC43MjEsMjA4Ljc0NTMsNTc0LjQyNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PD9wbGFudHVtbC1zcmMgVEwzQklpRDA1RHRGTHJwZ0hYVnoxUTc2QTBYMmNtV2tJWFBaU1djbm9UbW1jSWYxa1owMUlWNEJURUxadXFPNERvQmFScVFua193MjRyOHE1NktzVHl1dnp0M0VwSVFISUJkYTJWWUtmMkhHQTVWYkNPOTROdDRIbmlZbzd5YTl6b1VYZkFhOEI4ZjltaVFVdEpwNkxBSkNZWkxvTkQzNVdvdmhOSnBoeWFlTkJ4Z3lyRU5aaWd1TWhfVVZycFNWelV0WWdUQjVjb3hVNnE1djFtVjNtVFV5TWpQcG5iQlpwcUU0ZGFMOW1hSzBSWEdXUjF4QklFNU0zb3hPc0I3VDh4MThBNGJuWkRBM1ZkeVJuWWx2RmJUdXBkRUZoR0VqUVgyNjRhQzM2UzdsdDdCc2NJYUVoWTlmczVhZG9NWUFDYl9iUzkwN1JPb2tsM0tPSVplcjV1ajg2RlZFZnNNUkpKWWEwNkZPdFY3LWdzNGswR3djYjRONmtBY24xbHBmRFZpNj8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>CQRS の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>スケーラビリティ</strong></td>
<td>読み取りと書き込みを独立してスケール可能</td>
</tr>
<tr>
<td><strong>パフォーマンス</strong></td>
<td>読み取りに最適化されたモデルで高速クエリ</td>
</tr>
<tr>
<td><strong>複雑性の分離</strong></td>
<td>書き込みロジックと読み取りロジックを独立して開発</td>
</tr>
<tr>
<td><strong>監査対応</strong></td>
<td>Event Sourcing と組み合わせて完全な履歴を保持</td>
</tr>
</tbody>
</table>
<p><strong>財務会計システムでの CQRS の意義：</strong></p>
<ul>
<li><strong>監査証跡</strong>: すべての仕訳変更履歴を完全に保持</li>
<li><strong>複雑なクエリ</strong>: 試算表、財務諸表など多様なビューを効率的に生成</li>
<li><strong>データ整合性</strong>: イベントベースで一貫性を保証</li>
</ul>
<hr />
<h3 id="2212-event-sourcing">22.1.2 Event Sourcing とは<a class="headerlink" href="#2212-event-sourcing" title="Permanent link">&para;</a></h3>
<p>Event Sourcing は、アプリケーションの状態をイベントの連続として保存するパターンです。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUwMnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDIycHg7aGVpZ2h0OjUwMnB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQyMiA1MDIiIHdpZHRoPSI0MjJweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNTAyIiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNDIyIiB4PSIwIiB5PSIwIi8+PCEtLWVudGl0eSBDb21tYW5kLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ29tbWFuZCIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTEuOTU1MSIgeD0iOTcuNDMiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MS45NTUxIiB4PSIxMDcuNDMiIHk9IjI5Ljk5NTEiPkNvbW1hbmQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQWdncmVnYXRlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQWdncmVnYXRlIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI5My4yODgxIiB4PSI5Ni43NiIgeT0iMTIwLjI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuMjg4MSIgeD0iMTA2Ljc2IiB5PSIxNDMuMjg1MSI+QWdncmVnYXRlPC90ZXh0PjwvZz48IS0tZW50aXR5IERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkRvbWFpbiBNb2RlbCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTIwLjgwOTYiIHg9IjciIHk9IjIzMy41OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC44MDk2IiB4PSIxNyIgeT0iMjU2LjU4NTEiPkRvbWFpbiBNb2RlbDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2MC4xMDY0IiB4PSI2NC4zNSIgeT0iMzQ2Ljg5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTA2NCIgeD0iNzQuMzUiIHk9IjM2OS44ODUxIj5FdmVudDwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkV2ZW50IFN0b3JlIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDEuODY3MiIgeD0iMTExLjQ3IiB5PSI0NjAuMTgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxMjEuNDciIHk9IjQ4My4xNzUxIj5FdmVudCBTdG9yZTwvdGV4dD48L2c+PCEtLWxpbmsgQ29tbWFuZCB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJsbms0Ij48cGF0aCBkPSJNMTQzLjQsNDMuNTMgQzE0My40LDY0LjMyIDE0My40LDkyLjkxIDE0My40LDExMy44MSIgZmlsbD0ibm9uZSIgaWQ9IkNvbW1hbmQtdG8tQWdncmVnYXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNDMuNCwxMTkuODEsMTQ3LjQsMTEwLjgxLDE0My40LDExNC44MSwxMzkuNCwxMTAuODEsMTQzLjQsMTE5LjgxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTQuNTM1NyIgeD0iMTQ0LjQiIHk9Ijg2LjM1NjkiPjEuICYjMTI0Njc7JiMxMjUxMDsmIzEyNTMxOyYjMTI0ODk7JiMyMTQ2MzsmIzIwNDQ5OzwvdGV4dD48L2c+PCEtLWxpbmsgQWdncmVnYXRlIHRvIERvbWFpbiBNb2RlbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImxuazYiPjxwYXRoIGQ9Ik05Ni41LDE1My40MiBDODAuNjEsMTYwLjY1IDY0LjU4LDE3MS4yNyA1NS40LDE4Ni41OSBDNDYuOTEsMjAwLjc4IDQ5LjYwNTEsMjE0LjE1MzEgNTUuNTU1MSwyMjcuNzUzMSIgZmlsbD0ibm9uZSIgaWQ9IkFnZ3JlZ2F0ZS10by1Eb21haW4gTW9kZWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3Ljk2LDIzMy4yNSw1OC4wMTczLDIyMy40MDEzLDU1Ljk1NTksMjI4LjY2OTIsNTAuNjg4LDIyNi42MDc5LDU3Ljk2LDIzMy4yNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Ni41MzU4IiB4PSI1Ni40IiB5PSIxOTkuNjU2OSI+Mi4gJiMxMjQ5OTsmIzEyNDcyOyYjMTI0OTM7JiMxMjQ3MzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ4MzsmIzEyNDYzOyYjMjM0NTU7JiMzNDg5Mjs8L3RleHQ+PC9nPjwhLS1saW5rIERvbWFpbiBNb2RlbCB0byBFdmVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImxuazgiPjxwYXRoIGQ9Ik03MS42MiwyNzAuMTMgQzc2LjY3LDI5MC45MSA4My42NDU1LDMxOS42NjkxIDg4LjcxNTUsMzQwLjU2OTEiIGZpbGw9Im5vbmUiIGlkPSJEb21haW4gTW9kZWwtdG8tRXZlbnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjkwLjEzLDM0Ni40LDkxLjg5NTUsMzM2LjcxMDcsODguOTUxMywzNDEuNTQwOSw4NC4xMjEsMzM4LjU5NjcsOTAuMTMsMzQ2LjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NC41MzU3IiB4PSI4My41MiIgeT0iMzEyLjk1NjkiPjMuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyOTk4MzsmIzI1MTA0OzwvdGV4dD48L2c+PCEtLWxpbmsgRXZlbnQgdG8gRXZlbnQgU3RvcmUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNyIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJsbmsxMCI+PHBhdGggZD0iTTkwLjIzLDM4My40MSBDODcuOTIsMzk2Ljk0IDg2Ljg2LDQxNS43OCA5NC40LDQzMC4xOCBDMTAwLjkzLDQ0Mi42NiAxMDcuMzU1Miw0NDkuMjg5IDExOS4wNTUyLDQ1Ni42NjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudC10by1FdmVudCBTdG9yZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI0LjEzLDQ1OS44NywxMTguNjUxOCw0NTEuNjg1MywxMTkuOTAxLDQ1Ny4yMDI1LDExNC4zODM4LDQ1OC40NTE3LDEyNC4xMyw0NTkuODciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuNTM1OCIgeD0iOTUuNCIgeT0iNDI2LjI0NjkiPjQuICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyNzcwNDsmIzMyMTU0OyYjMjEyNzA7PC90ZXh0PjwvZz48IS0tbGluayBFdmVudCBTdG9yZSB0byBBZ2dyZWdhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOSIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJsbmsxMSI+PHBhdGggZD0iTTE4NS4xLDQ2MC4wOSBDMTkzLjgyLDQ1Mi4wNyAyMDIuNzgsNDQxLjc0IDIwNy40LDQzMC4xOCBDMjQ3LjY3LDMyOS42OCAyNTYuMjQsMjgzLjIyIDIwNy40LDE4Ni41OSBDMjAxLjE4LDE3NC4yNyAxOTUuMDQ4NCwxNjcuNjk5IDE4My43OTg0LDE2MC4yMjkiIGZpbGw9Im5vbmUiIGlkPSJFdmVudCBTdG9yZS10by1BZ2dyZWdhdGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE3OC44LDE1Ni45MSwxODQuMDg1LDE2NS4yMjA3LDE4Mi45NjU0LDE1OS42NzU4LDE4OC41MTAzLDE1OC41NTYyLDE3OC44LDE1Ni45MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3Mi41MzU4IiB4PSIyNDEuODkiIHk9IjMxMi45NTY5Ij41LiAmIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA4Nzc7JiMyOTk4MzsmIzY1Mjg4OyYjMjkzNjY7JiMyNDkwNzsmIzI0NDg5OyYjMjA4MDM7JiM2NTI4OTs8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIEF5eEVwMmo4QjRoQ0xLWkVwb3Q4cHFsREFtYWtnU245TElYQUpJdjlwNGxGSVVLZ1hZajlJYXBFSllfQUJ5ckJTU3hGb0l6SUs3UHAxSzRraGNaZF9EcFNuQm9LTTBMVE5KazVRQ1ZxekFCS3pDSUlyNVc1QW1MM0ZPTjdKUGlWRHl6eHQwbWFFdl9zSnQtb1ZvNE5pWGdtN2ZWeXRDSkNGME5WXzlKSzc5MHM4dzJzdmljRmN0T3lSa3Z6dEJKcFNWRFFDQmx2U1RGd2YtbGNsclpPbXVNYzFNb0FRbmRHMG8zam5ZMVJicG5rZFdjc2pVRnZiRmRGRVlQbW1VR0hRWE0ySV9BQm1FdXFHVE5uUkNFRXZ6amNGVXNQbmVNZzRERTNmZ1dRZHhScjBjcnhsd1ZaVVRVc1B3dFRKX1VqVkRoUV83dkY5bTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<p><strong>Event Sourcing の利点：</strong></p>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>完全な履歴</strong></td>
<td>すべての状態変更が記録される</td>
</tr>
<tr>
<td><strong>監査証跡</strong></td>
<td>いつ、誰が、何を変更したかが明確</td>
</tr>
<tr>
<td><strong>時間旅行</strong></td>
<td>過去の任意の時点の状態を再構築可能</td>
</tr>
<tr>
<td><strong>イベント駆動</strong></td>
<td>他システムとの連携が容易</td>
</tr>
</tbody>
</table>
<p><strong>財務会計システムでの Event Sourcing の意義：</strong></p>
<ul>
<li><strong>訂正仕訳の追跡</strong>: 修正履歴を完全に保持</li>
<li><strong>期末決算処理</strong>: 任意の時点での残高を再計算可能</li>
<li><strong>内部統制</strong>: SOX 法対応の監査証跡を自動生成</li>
</ul>
<hr />
<h3 id="2213">22.1.3 ヘキサゴナルアーキテクチャとの統合<a class="headerlink" href="#2213" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjQ4NnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTYzOHB4O2hlaWdodDo0ODZweDtiYWNrZ3JvdW5kOiNGRUZFRkU7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNjM4IDQ4NiIgd2lkdGg9IjE2MzhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iNDg2IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTYzOCIgeD0iMCIgeT0iMCIvPjwhLS1jbHVzdGVyIEhleGFnb25hbCBBcmNoaXRlY3R1cmUgKENRUlMvRVMgSlBBPyktLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyBKUEEuLiIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDIiPjxwYXRoIGQ9Ik01MTMuMTYsNiBMODMxLjU3Myw2IEEzLjc1LDMuNzUgMCAwIDEgODM0LjA3Myw4LjUgTDg0MS4wNzMsMjguMjk2OSBMMTYyOS4xNiwyOC4yOTY5IEEyLjUsMi41IDAgMCAxIDE2MzEuNjYsMzAuNzk2OSBMMTYzMS42Niw0NzcuMzkgQTIuNSwyLjUgMCAwIDEgMTYyOS4xNiw0NzkuODkgTDUxMy4xNiw0NzkuODkgQTIuNSwyLjUgMCAwIDEgNTEwLjY2LDQ3Ny4zOSBMNTEwLjY2LDguNSBBMi41LDIuNSAwIDAgMSA1MTMuMTYsNiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTEwLjY2IiB4Mj0iODQxLjA3MyIgeTE9IjI4LjI5NjkiIHkyPSIyOC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMxNy40MTMiIHg9IjUxNC42NiIgeT0iMjAuOTk1MSI+SGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAoQ1FSUy9FUyBKUEEmIzI5MjU2Oyk8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEluYm91bmQgQWRhcHRlcnMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyBKUEEuLi5JbmJvdW5kIEFkYXB0ZXJzIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwMyI+PHBhdGggZD0iTTU3My4xNiw0OSBMNzE1LjU1NDUsNDkgQTMuNzUsMy43NSAwIDAgMSA3MTguMDU0NSw1MS41IEw3MjUuMDU0NSw3MS4yOTY5IEw3NTAuMTYsNzEuMjk2OSBBMi41LDIuNSAwIDAgMSA3NTIuNjYsNzMuNzk2OSBMNzUyLjY2LDE0My44IEEyLjUsMi41IDAgMCAxIDc1MC4xNiwxNDYuMyBMNTczLjE2LDE0Ni4zIEEyLjUsMi41IDAgMCAxIDU3MC42NiwxNDMuOCBMNTcwLjY2LDUxLjUgQTIuNSwyLjUgMCAwIDEgNTczLjE2LDQ5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1NzAuNjYiIHgyPSI3MjUuMDU0NSIgeTE9IjcxLjI5NjkiIHkyPSI3MS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MS4zOTQ1IiB4PSI1NzQuNjYiIHk9IjYzLjk5NTEiPkluYm91bmQgQWRhcHRlcnM8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEFwcGxpY2F0aW9uIENvcmUtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyBKUEEuLi5BcHBsaWNhdGlvbiBDb3JlIiBkYXRhLXNvdXJjZS1saW5lPSIxMCIgaWQ9ImVudDAwMDUiPjxwYXRoIGQ9Ik01MzcuMTYsMTcwLjMgTDY2OC42MjM5LDE3MC4zIEEzLjc1LDMuNzUgMCAwIDEgNjcxLjEyMzksMTcyLjggTDY3OC4xMjM5LDE5Mi41OTY5IEwxMjUwLjE2LDE5Mi41OTY5IEEyLjUsMi41IDAgMCAxIDEyNTIuNjYsMTk1LjA5NjkgTDEyNTIuNjYsNDUzLjM5IEEyLjUsMi41IDAgMCAxIDEyNTAuMTYsNDU1Ljg5IEw1MzcuMTYsNDU1Ljg5IEEyLjUsMi41IDAgMCAxIDUzNC42Niw0NTMuMzkgTDUzNC42NiwxNzIuOCBBMi41LDIuNSAwIDAgMSA1MzcuMTYsMTcwLjMiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjUzNC42NiIgeDI9IjY3OC4xMjM5IiB5MT0iMTkyLjU5NjkiIHkyPSIxOTIuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzAuNDYzOSIgeD0iNTM4LjY2IiB5PSIxODUuMjk1MSI+QXBwbGljYXRpb24gQ29yZTwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQXBwbGljYXRpb24gTGF5ZXItLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyBKUEEuLi5BcHBsaWNhdGlvbiBDb3JlLkFwcGxpY2F0aW9uIExheWVyIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImVudDAwMDYiPjxwYXRoIGQ9Ik01NjEuMTYsMjEzLjMgTDcwMC4yMjU0LDIxMy4zIEEzLjc1LDMuNzUgMCAwIDEgNzAyLjcyNTQsMjE1LjggTDcwOS43MjU0LDIzNS41OTY5IEwxMDgyLjE2LDIzNS41OTY5IEEyLjUsMi41IDAgMCAxIDEwODQuNjYsMjM4LjA5NjkgTDEwODQuNjYsMzA4LjA5IEEyLjUsMi41IDAgMCAxIDEwODIuMTYsMzEwLjU5IEw1NjEuMTYsMzEwLjU5IEEyLjUsMi41IDAgMCAxIDU1OC42NiwzMDguMDkgTDU1OC42NiwyMTUuOCBBMi41LDIuNSAwIDAgMSA1NjEuMTYsMjEzLjMiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjU1OC42NiIgeDI9IjcwOS43MjU0IiB5MT0iMjM1LjU5NjkiIHkyPSIyMzUuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzguMDY1NCIgeD0iNTYyLjY2IiB5PSIyMjguMjk1MSI+QXBwbGljYXRpb24gTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIERvbWFpbiBMYXllci0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIEpQQS4uLkFwcGxpY2F0aW9uIENvcmUuRG9tYWluIExheWVyIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImVudDAwMTAiPjxwYXRoIGQ9Ik01NjkuMTYsMzM0LjU5IEw2NzguOTY3NiwzMzQuNTkgQTMuNzUsMy43NSAwIDAgMSA2ODEuNDY3NiwzMzcuMDkgTDY4OC40Njc2LDM1Ni44ODY5IEwxMDYyLjE2LDM1Ni44ODY5IEEyLjUsMi41IDAgMCAxIDEwNjQuNjYsMzU5LjM4NjkgTDEwNjQuNjYsNDI5LjM5IEEyLjUsMi41IDAgMCAxIDEwNjIuMTYsNDMxLjg5IEw1NjkuMTYsNDMxLjg5IEEyLjUsMi41IDAgMCAxIDU2Ni42Niw0MjkuMzkgTDU2Ni42NiwzMzcuMDkgQTIuNSwyLjUgMCAwIDEgNTY5LjE2LDMzNC41OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTY2LjY2IiB4Mj0iNjg4LjQ2NzYiIHkxPSIzNTYuODg2OSIgeTI9IjM1Ni44ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC44MDc2IiB4PSI1NzAuNjYiIHk9IjM0OS41ODUxIj5Eb21haW4gTGF5ZXI8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIEFQSSBMYXllci0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIEpQQS4uLkFwcGxpY2F0aW9uIENvcmUuQVBJIExheWVyIiBkYXRhLXNvdXJjZS1saW5lPSIyMyIgaWQ9ImVudDAwMTQiPjxwYXRoIGQ9Ik0xMTExLjE2LDIxMy4zIEwxMTg3LjIzMjMsMjEzLjMgQTMuNzUsMy43NSAwIDAgMSAxMTg5LjczMjMsMjE1LjggTDExOTYuNzMyMywyMzUuNTk2OSBMMTIyNi4xNiwyMzUuNTk2OSBBMi41LDIuNSAwIDAgMSAxMjI4LjY2LDIzOC4wOTY5IEwxMjI4LjY2LDMwOC4wOSBBMi41LDIuNSAwIDAgMSAxMjI2LjE2LDMxMC41OSBMMTExMS4xNiwzMTAuNTkgQTIuNSwyLjUgMCAwIDEgMTEwOC42NiwzMDguMDkgTDExMDguNjYsMjE1LjggQTIuNSwyLjUgMCAwIDEgMTExMS4xNiwyMTMuMyIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTEwOC42NiIgeDI9IjExOTYuNzMyMyIgeTE9IjIzNS41OTY5IiB5Mj0iMjM1LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzUuMDcyMyIgeD0iMTExMi42NiIgeT0iMjI4LjI5NTEiPkFQSSBMYXllcjwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgT3V0Ym91bmQgQWRhcHRlcnMtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyBKUEEuLi5PdXRib3VuZCBBZGFwdGVycyIgZGF0YS1zb3VyY2UtbGluZT0iMjgiIGlkPSJlbnQwMDE2Ij48cGF0aCBkPSJNMTI3OS4xNiwzMzQuNTkgTDE0MzQuOTM5MywzMzQuNTkgQTMuNzUsMy43NSAwIDAgMSAxNDM3LjQzOTMsMzM3LjA5IEwxNDQ0LjQzOTMsMzU2Ljg4NjkgTDE2MDUuMTYsMzU2Ljg4NjkgQTIuNSwyLjUgMCAwIDEgMTYwNy42NiwzNTkuMzg2OSBMMTYwNy42Niw0MjkuMzkgQTIuNSwyLjUgMCAwIDEgMTYwNS4xNiw0MzEuODkgTDEyNzkuMTYsNDMxLjg5IEEyLjUsMi41IDAgMCAxIDEyNzYuNjYsNDI5LjM5IEwxMjc2LjY2LDMzNy4wOSBBMi41LDIuNSAwIDAgMSAxMjc5LjE2LDMzNC41OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTI3Ni42NiIgeDI9IjE0NDQuNDM5MyIgeTE9IjM1Ni44ODY5IiB5Mj0iMzU2Ljg4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU0Ljc3OTMiIHg9IjEyODAuNjYiIHk9IjM0OS41ODUxIj5PdXRib3VuZCBBZGFwdGVyczwvdGV4dD48L2c+PCEtLWVudGl0eSBSRVNUIENvbnRyb2xsZXItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIEpQQS4uLkluYm91bmQgQWRhcHRlcnMuUkVTVCBDb250cm9sbGVyIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwNCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDkuNjM0OCIgeD0iNTg2Ljg0IiB5PSI4NCIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI3MTYuNDc0OCIgeT0iODkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcxNC40NzQ4IiB5PSI5MSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNzE0LjQ3NDgiIHk9Ijk1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjYzNDgiIHg9IjYwMS44NCIgeT0iMTE2Ljk5NTEiPlJFU1QgQ29udHJvbGxlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBBZ2dyZWdhdGUgQWRhcHRlci0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgSlBBLi4uQXBwbGljYXRpb24gQ29yZS5BcHBsaWNhdGlvbiBMYXllci5BZ2dyZWdhdGUgQWRhcHRlciIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGlkPSJlbnQwMDA3Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3My41MjY0IiB4PSI1NzQuOSIgeT0iMjQ4LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iNzI4LjQyNjQiIHk9IjI1My4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI3MjYuNDI2NCIgeT0iMjU1LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjcyNi40MjY0IiB5PSIyNTkuMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMy41MjY0IiB4PSI1ODkuOSIgeT0iMjgxLjI5NTEiPkFnZ3JlZ2F0ZSBBZGFwdGVyPC90ZXh0PjwvZz48IS0tZW50aXR5IFByb2plY3Rpb24tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIEpQQS4uLkFwcGxpY2F0aW9uIENvcmUuQXBwbGljYXRpb24gTGF5ZXIuUHJvamVjdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJlbnQwMDA4Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwOS43ODEzIiB4PSI3ODMuNzciIHk9IjI0OC4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9Ijg3My41NTEzIiB5PSIyNTMuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iODcxLjU1MTMiIHk9IjI1NS4zIi8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI4NzEuNTUxMyIgeT0iMjU5LjMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS43ODEzIiB4PSI3OTguNzciIHk9IjI4MS4yOTUxIj5Qcm9qZWN0aW9uPC90ZXh0PjwvZz48IS0tZW50aXR5IFBvbGljeSBIYW5kbGVyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyBKUEEuLi5BcHBsaWNhdGlvbiBDb3JlLkFwcGxpY2F0aW9uIExheWVyLlBvbGljeSBIYW5kbGVyIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgaWQ9ImVudDAwMDkiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwLjM0NDciIHg9IjkyOC40OSIgeT0iMjQ4LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTA0OC44MzQ3IiB5PSIyNTMuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTA0Ni44MzQ3IiB5PSIyNTUuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTA0Ni44MzQ3IiB5PSIyNTkuMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMC4zNDQ3IiB4PSI5NDMuNDkiIHk9IjI4MS4yOTUxIj5Qb2xpY3kgSGFuZGxlcjwvdGV4dD48L2c+PCEtLWVudGl0eSBEb21haW4gTW9kZWwtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIEpQQS4uLkFwcGxpY2F0aW9uIENvcmUuRG9tYWluIExheWVyLkRvbWFpbiBNb2RlbCIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGlkPSJlbnQwMDExIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MC44MDk2IiB4PSI1ODIuMjYiIHk9IjM2OS41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI3MDMuMDY5NiIgeT0iMzc0LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI3MDEuMDY5NiIgeT0iMzc2LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI3MDEuMDY5NiIgeT0iMzgwLjU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAwLjgwOTYiIHg9IjU5Ny4yNiIgeT0iNDAyLjU4NTEiPkRvbWFpbiBNb2RlbDwvdGV4dD48L2c+PCEtLWVudGl0eSBDb21tYW5kcy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgSlBBLi4uQXBwbGljYXRpb24gQ29yZS5Eb21haW4gTGF5ZXIuQ29tbWFuZHMiIGRhdGEtc291cmNlLWxpbmU9IjE5IiBpZD0iZW50MDAxMiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTkuMjQ5IiB4PSI3NTguMDQiIHk9IjM2OS41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSI4NTcuMjg5IiB5PSIzNzQuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9Ijg1NS4yODkiIHk9IjM3Ni41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iODU1LjI4OSIgeT0iMzgwLjU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzkuMjQ5IiB4PSI3NzMuMDQiIHk9IjQwMi41ODUxIj5Db21tYW5kczwvdGV4dD48L2c+PCEtLWVudGl0eSBWYWx1ZSBPYmplY3RzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iSGV4YWdvbmFsIEFyY2hpdGVjdHVyZSAuQ1FSUy5FUyBKUEEuLi5BcHBsaWNhdGlvbiBDb3JlLkRvbWFpbiBMYXllci5WYWx1ZSBPYmplY3RzIiBkYXRhLXNvdXJjZS1saW5lPSIyMCIgaWQ9ImVudDAwMTMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM2Ljg3MjEiIHg9IjkxMi4yMiIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjEwMjkuMDkyMSIgeT0iMzc0LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxMDI3LjA5MjEiIHk9IjM3Ni41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTAyNy4wOTIxIiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ni44NzIxIiB4PSI5MjcuMjIiIHk9IjQwMi41ODUxIj5WYWx1ZSBPYmplY3RzPC90ZXh0PjwvZz48IS0tZW50aXR5IEV2ZW50cy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgSlBBLi4uQXBwbGljYXRpb24gQ29yZS5BUEkgTGF5ZXIuRXZlbnRzIiBkYXRhLXNvdXJjZS1saW5lPSIyNCIgaWQ9ImVudDAwMTUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODcuNDAwNCIgeD0iMTEyNC45NiIgeT0iMjQ4LjMiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMTE5Mi4zNjA0IiB5PSIyNTMuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTE5MC4zNjA0IiB5PSIyNTUuMyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTE5MC4zNjA0IiB5PSIyNTkuMyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ3LjQwMDQiIHg9IjExMzkuOTYiIHk9IjI4MS4yOTUxIj5FdmVudHM8L3RleHQ+PC9nPjwhLS1lbnRpdHkgSlBBIFJlcG9zaXRvcnktLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJIZXhhZ29uYWwgQXJjaGl0ZWN0dXJlIC5DUVJTLkVTIEpQQS4uLk91dGJvdW5kIEFkYXB0ZXJzLkpQQSBSZXBvc2l0b3J5IiBkYXRhLXNvdXJjZS1saW5lPSIyOSIgaWQ9ImVudDAwMTciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQxLjY3MDkiIHg9IjEyOTIuODIiIHk9IjM2OS41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIxNDE0LjQ5MDkiIHk9IjM3NC41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTQxMi40OTA5IiB5PSIzNzYuNTkiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjE0MTIuNDkwOSIgeT0iMzgwLjU5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAxLjY3MDkiIHg9IjEzMDcuODIiIHk9IjQwMi41ODUxIj5KUEEgUmVwb3NpdG9yeTwvdGV4dD48L2c+PCEtLWVudGl0eSBFdmVudCBTdG9yZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkhleGFnb25hbCBBcmNoaXRlY3R1cmUgLkNRUlMuRVMgSlBBLi4uT3V0Ym91bmQgQWRhcHRlcnMuRXZlbnQgU3RvcmUiIGRhdGEtc291cmNlLWxpbmU9IjMwIiBpZD0iZW50MDAxOCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0Ni4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjEuODY3MiIgeD0iMTQ2OS43MyIgeT0iMzY5LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjE1NzEuNTk3MiIgeT0iMzc0LjU5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIxNTY5LjU5NzIiIHk9IjM3Ni41OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMTU2OS41OTcyIiB5PSIzODAuNTkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS44NjcyIiB4PSIxNDg0LjczIiB5PSI0MDIuNTg1MSI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjIyIiBkYXRhLXNvdXJjZS1saW5lPSIzOSIgaWQ9ImVudDAwMjMiPjxwYXRoIGQ9Ik0yODIuMTgsMjQzLjc1IEwyODIuMTgsMjk5LjE0ODQgQTAsMCAwIDAgMCAyODIuMTgsMjk5LjE0ODQgTDQ0NC41NywyOTkuMTQ4NCBMNjAyLjc0LDM2OS4xOCBMNDUyLjU3LDI5OS4xNDg0IEw0OTUuMTMzMiwyOTkuMTQ4NCBBMCwwIDAgMCAwIDQ5NS4xMzMyLDI5OS4xNDg0IEw0OTUuMTMzMiwyNTMuNzUgTDQ4NS4xMzMyLDI0My43NSBMMjgyLjE4LDI0My43NSBBMCwwIDAgMCAwIDI4Mi4xOCwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00ODUuMTMzMiwyNDMuNzUgTDQ4NS4xMzMyLDI1My43NSBMNDk1LjEzMzIsMjUzLjc1IEw0ODUuMTMzMiwyNDMuNzUiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC4wMDAyIiB4PSIyODguMTgiIHk9IjI2MC44MTY5Ij4mIzMyMDIwOyYjMzE4ODM7JiMxMjM5NDsmIzEyNDg5OyYjMTI1MTM7JiMxMjQ1MjsmIzEyNTMxOyYjMTI1MTQ7JiMxMjQ4NzsmIzEyNTIzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTEuOTUzMiIgeD0iMjg4LjE4IiB5PSIyNzUuOTQ5NyI+QXhvbiBGcmFtZXdvcmsgJiMxMjM5NTsmIzIwMzgxOyYjMjMzODQ7JiMxMjM3NTsmIzEyMzk0OyYjMTIzNTY7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMC4wMDAyIiB4PSIyODguMTgiIHk9IjI5MS4wODI1Ij4mIzEyNDk5OyYjMTI0NzI7JiMxMjQ5MzsmIzEyNDczOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDgzOyYjMTI0NjM7JiMxMjM5ODsmIzEyNDE1OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMjUiIGRhdGEtc291cmNlLWxpbmU9IjQ1IiBpZD0iZW50MDAyNiI+PHBhdGggZD0iTTYsMjQzLjc1IEw2LDI5OS4xNDg0IEwyNDcuMzIwOCwyOTkuMTQ4NCBMMjQ3LjMyMDgsMjUzLjc1IEwyMzcuMzIwOCwyNDMuNzUgTDYsMjQzLjc1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjM3LjMyMDgsMjQzLjc1IEwyMzcuMzIwOCwyNTMuNzUgTDI0Ny4zMjA4LDI1My43NSBMMjM3LjMyMDgsMjQzLjc1IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE0LjkxMTciIHg9IjEyIiB5PSIyNjAuODE2OSI+QXhvbiAmIzI5OTkyOyYjMTI0NTA7JiMxMjQ4MDsmIzEyNTAzOyYjMTI0Nzk7JiMxMjU0MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjIwLjMyMDgiIHg9IjEyIiB5PSIyNzUuOTQ5NyI+QEFnZ3JlZ2F0ZSwgQENvbW1hbmRIYW5kbGVyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1Ni4wMDAyIiB4PSIxMiIgeT0iMjkxLjA4MjUiPiYjMTI1MDE7JiMxMjUyNDsmIzEyNTQwOyYjMTI1MTI7JiMxMjUyNzsmIzEyNTQwOyYjMTI0NjM7JiMyMDM4MTsmIzIzMzg0OyYjMTI0MzQ7JiMyMTU2MDsmIzIxNDU0OzwvdGV4dD48L2c+PCEtLWxpbmsgUkVTVCBDb250cm9sbGVyIHRvIEFnZ3JlZ2F0ZSBBZGFwdGVyLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDQiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIzNCIgaWQ9ImxuazE5Ij48cGF0aCBkPSJNNjYxLjY2LDEzMC43MSBDNjYxLjY2LDE2MS42MyA2NjEuNjYsMjEwLjg1IDY2MS42NiwyNDEuODEiIGZpbGw9Im5vbmUiIGlkPSJSRVNUIENvbnRyb2xsZXItdG8tQWdncmVnYXRlIEFkYXB0ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY2MS42NiwyNDcuODEsNjY1LjY2LDIzOC44MSw2NjEuNjYsMjQyLjgxLDY1Ny42NiwyMzguODEsNjYxLjY2LDI0Ny44MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBBZ2dyZWdhdGUgQWRhcHRlciB0byBEb21haW4gTW9kZWwtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNyIgZGF0YS1lbnRpdHktMj0iZW50MDAxMSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjM1IiBpZD0ibG5rMjAiPjxwYXRoIGQ9Ik02NTkuOTcsMjk0Ljg4IEM2NTguMzYsMzE2LjIxIDY1Ni4zOTk2LDM0Mi4xMjY5IDY1NC43OTk2LDM2My40MTY5IiBmaWxsPSJub25lIiBpZD0iQWdncmVnYXRlIEFkYXB0ZXItdG8tRG9tYWluIE1vZGVsIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NTQuMzUsMzY5LjQsNjU5LjAxMzIsMzYwLjcyNTEsNjU0LjcyNDcsMzY0LjQxNDEsNjUxLjAzNTcsMzYwLjEyNTUsNjU0LjM1LDM2OS40IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIFByb2plY3Rpb24gdG8gSlBBIFJlcG9zaXRvcnktLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOCIgZGF0YS1lbnRpdHktMj0iZW50MDAxNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjM2IiBpZD0ibG5rMjEiPjxwYXRoIGQ9Ik04NjYuMzUsMjk0Ljk5IEM4NzkuMDcsMzA0LjA0IDg5NC44MywzMTMuNTEgOTEwLjY2LDMxOC41OSBDOTQzLjI5LDMyOS4wOCAxMDMwLjcsMzIyLjA0IDEwNjQuNjYsMzI2LjU5IEMxMTQzLjM4LDMzNy4xNCAxMjI2LjMxMiwzNTYuMTIzNCAxMjg2LjUzMiwzNzEuMzAzNCIgZmlsbD0ibm9uZSIgaWQ9IlByb2plY3Rpb24tdG8tSlBBIFJlcG9zaXRvcnkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyOTIuMzUsMzcyLjc3LDEyODQuNjAwNywzNjYuNjkxNSwxMjg3LjUwMTcsMzcxLjU0NzksMTI4Mi42NDUzLDM3NC40NDg4LDEyOTIuMzUsMzcyLjc3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEdNTjI1IHRvIEFnZ3JlZ2F0ZSBBZGFwdGVyLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMjYiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJhc3NvY2lhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iNDUiIGlkPSJsbmsyNyI+PHBhdGggZD0iTTE1NC4yMSwyNDMuNDQgQzE4MC4zOCwyMTguNDYgMjIxLjk2LDE4Mi43NiAyNjQuNjYsMTYyLjMgQzI3MS44NiwxNTguODUgMjc0LjIzLDE1OS4xOSAyODIuMTYsMTU4LjMgQzMyOS4yLDE1Mi45OSA0NDguMTMsMTUyLjk5IDQ5NS4xNiwxNTguMyBDNTU2LjgsMTY1LjI1IDYxMy4wMSwyMTYuOTYgNjQxLjY4LDI0OC4wMSIgZmlsbD0ibm9uZSIgaWQ9IkdNTjI1LUFnZ3JlZ2F0ZSBBZGFwdGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PC9nPjw/cGxhbnR1bWwtc3JjIFJMOUZRbkQxNUJfRmZ0Wk1ZdUI1Um8xVHJnc2pMMWtKdWdOYUNEYnpNVFRpUGZSUFlKUTh1RXVLajlJc2VmTnNLYjNuOERPUUsweUxuN3dPUHlaTlMzUFBvdkE0bFJvUHpfbHR0a29MMERrSEdBWHh4ZVBwX3l3UTF0eENxdkliZEtXYU5GNGtqQlpWMlBOaVlTMkxpTEhtVFRhaEZpT0lzLTBYbWk4QVJsNUcyWHczZV9uN2FLUFZ6bkoyRFZUMWxON0pReTNUY1pGUVVOTHowUHZMSUFrWUxNWTI0XzE0ZXFnQnhjUlRRc28wQXVMTUNldkhEVGRwMmlEOWFaWm9rT3dhaTFZNTFNRGtTdXR0S090cmQzMUs2N0FEX3NzUVJCRWN2NkVScTBBQld4SWlGZ25tNFNwdXRQUFQ3Yk5Mb2VqeENpM09TYnRQeExmVVFpazdGRXVYaEJTQXVOR2dUTXNyOGs0ekdKNTFMMzdoRkpyZDZOUGpLQ1Q0ZmY2TWdqeWlvVDJtOW9tTFBYTzZZdWt0T0V4T2l0U0p4REhHYlVyQy1qQ2ZjOTFNR3lpNFA3a1FGVmZ2RUZnLUl6YU5DWmphRmIzLVlTbUZDWF85bDJIcG9mbWotcFpCemZfMmZyOXJXQkJKbHR6RVhjVjdiMXFMZDZvUmFOYkItSmNQRlNmX2FKYVJydVJvME1OVkFCaldRNVRLczlTWE9jcGhTT2V2eXV3ekhlVVZBUlZrQnlXU0tOdjF2WlRSa2lKVVdBTm8xU2xOai14bG83b3JBM0Jsb0dvQThYLUs0VkN0bXpWZG11RnpvbXBfMDAwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>設計原則：</strong></p>
<ol>
<li><strong>ドメインモデルの純粋性</strong>: ドメインモデルは Axon に依存しない純粋な Java コード</li>
<li><strong>Aggregate Adapter</strong>: Axon Framework 用のアダプターを Application Layer に配置</li>
<li><strong>イベントは公開 API</strong>: イベントは他の Context から参照される公開 API として定義</li>
</ol>
<hr />
<h2 id="222">22.2 技術スタック<a class="headerlink" href="#222" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>カテゴリ</th>
<th>技術</th>
<th>バージョン</th>
</tr>
</thead>
<tbody>
<tr>
<td>言語</td>
<td>Java</td>
<td>21</td>
</tr>
<tr>
<td>フレームワーク</td>
<td>Spring Boot</td>
<td>3.4.1</td>
</tr>
<tr>
<td>CQRS/ES</td>
<td>Axon Framework</td>
<td>4.10.3</td>
</tr>
<tr>
<td>ORM</td>
<td>Spring Data JPA</td>
<td>3.4.1</td>
</tr>
<tr>
<td>API ドキュメント</td>
<td>SpringDoc OpenAPI</td>
<td>2.7.0</td>
</tr>
<tr>
<td>データベース</td>
<td>H2 (開発) / PostgreSQL (本番)</td>
<td>-</td>
</tr>
</tbody>
</table>
<h3 id="2221-buildgradlekts">22.2.1 build.gradle.kts<a class="headerlink" href="#2221-buildgradlekts" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: build.gradle.kts</summary>

<div class="highlight"><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Spring Boot</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-validation&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-data-jpa&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Axon Framework</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-spring-boot-starter:4.10.3&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exclude</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;org.axonframework&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;axon-server-connector&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// OpenAPI</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.springdoc:springdoc-openapi-starter-webmvc-ui:2.7.0&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Database</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;com.h2database:h2&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">runtimeOnly</span><span class="p">(</span><span class="s">&quot;org.postgresql:postgresql&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;org.axonframework:axon-test:4.10.3&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="2222">22.2.2 ディレクトリ構造<a class="headerlink" href="#2222" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: ディレクトリ構成</summary>

<div class="highlight"><pre><span></span><code>src/main/java/com/example/accounting/
├── app/                              # アプリケーション共通
│   └── RootController.java
├── config/                           # 設定クラス
│   ├── AxonConfig.java
│   ├── JpaConfig.java
│   └── OpenApiConfig.java
├── journal/                          # Journal Bounded Context（仕訳）
│   ├── api/
│   │   └── events/                   # 公開イベント API
│   │       ├── JournalEntryEvent.java     # sealed interface
│   │       ├── JournalEntryCreatedEvent.java
│   │       ├── JournalEntryApprovedEvent.java
│   │       └── JournalEntryPostedEvent.java
│   ├── adapter/
│   │   ├── inbound/rest/journals/    # Inbound Adapter (REST)
│   │   │   ├── JournalsController.java
│   │   │   └── protocol/             # Request/Response DTO
│   │   └── outbound/persistence/     # Outbound Adapter (JPA)
│   │       ├── entity/
│   │       │   ├── JournalEntryEntity.java
│   │       │   └── JournalLineEntity.java
│   │       └── repository/
│   │           └── JournalEntryJpaRepository.java
│   ├── application/
│   │   ├── aggregate/                # Axon Aggregate Adapter
│   │   │   └── JournalEntryAggregateAdapter.java
│   │   ├── policy/                   # イベントハンドラー（Choreography）
│   │   │   └── AccountEventHandler.java
│   │   └── query/                    # Projection
│   │       └── JournalEntryProjection.java
│   └── domain/
│       └── model/aggregate/journal/  # 純粋なドメインモデル
│           ├── JournalEntry.java
│           ├── JournalEntryCommands.java
│           ├── JournalEntryStatus.java
│           └── JournalLine.java
└── account/                          # Account Bounded Context（勘定科目）
    ├── api/events/
    │   ├── AccountEvent.java
    │   └── AccountBalanceUpdatedEvent.java
    ├── application/
    │   ├── aggregate/
    │   │   └── AccountAggregateAdapter.java
    │   └── policy/
    │       └── JournalEventHandler.java
    └── domain/model/aggregate/account/
        ├── Account.java
        └── AccountCommands.java
</code></pre></div>

</details>

<hr />
<h2 id="223-axon-jpa">22.3 Axon 設定クラス（JPA版）<a class="headerlink" href="#223-axon-jpa" title="Permanent link">&para;</a></h2>
<h3 id="2231-axonconfigjava">22.3.1 AxonConfig.java<a class="headerlink" href="#2231-axonconfigjava" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: AxonConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.common.jpa.EntityManagerProvider</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EmbeddedEventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.EventStore</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.Serializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.serialization.json.JacksonSerializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.spring.config.SpringAxonConfiguration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Axon Framework 設定（JPA版）</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AxonConfig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JPA ベースの Event Storage Engine</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="nf">eventStorageEngine</span><span class="p">(</span>
<span class="w">            </span><span class="n">EntityManagerProvider</span><span class="w"> </span><span class="n">entityManagerProvider</span><span class="p">,</span>
<span class="w">            </span><span class="n">Serializer</span><span class="w"> </span><span class="n">serializer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JpaEventStorageEngine</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">entityManagerProvider</span><span class="p">(</span><span class="n">entityManagerProvider</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">snapshotSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">eventSerializer</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Event Store</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EventStore</span><span class="w"> </span><span class="nf">eventStore</span><span class="p">(</span><span class="n">EventStorageEngine</span><span class="w"> </span><span class="n">eventStorageEngine</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EmbeddedEventStore</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">storageEngine</span><span class="p">(</span><span class="n">eventStorageEngine</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * JSON シリアライザー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Serializer</span><span class="w"> </span><span class="nf">eventSerializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JacksonSerializer</span><span class="p">.</span><span class="na">defaultSerializer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="2232-jpaconfigjava">22.3.2 JpaConfig.java<a class="headerlink" href="#2232-jpaconfigjava" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JpaConfig.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.config</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.config.EnableJpaAuditing</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JPA 設定</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableJpaRepositories</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;com.example.accounting.journal.adapter.outbound.persistence.repository&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;com.example.accounting.account.adapter.outbound.persistence.repository&quot;</span>
<span class="p">})</span>
<span class="nd">@EnableJpaAuditing</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JpaConfig</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="224">22.4 ドメインモデルとイベント設計<a class="headerlink" href="#224" title="Permanent link">&para;</a></h2>
<h3 id="2241-journal-bounded-context">22.4.1 Journal Bounded Context<a class="headerlink" href="#2241-journal-bounded-context" title="Permanent link">&para;</a></h3>
<p>仕訳の作成から転記完了までのライフサイクルを管理します。</p>
<h4 id="_1">状態遷移図<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNUQVRFIiBoZWlnaHQ9IjU3N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzE2cHg7aGVpZ2h0OjU3N3B4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDcxNiA1NzciIHdpZHRoPSI3MTZweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjAxODE7JiMzNTM3OTsmIzY1Mjg4O0pvdXJuYWwgRW50cnkmIzY1Mjg5OyYjMTIzOTg7JiMyOTM2NjsmIzI0OTA3OyYjMzY5ODM7JiMzMTIyNzs8L3RpdGxlPjxkZWZzLz48Zz48cmVjdCBmaWxsPSIjRkVGRUZFIiBoZWlnaHQ9IjU3NyIgc3R5bGU9InN0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjcxNiIgeD0iMCIgeT0iMCIvPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMyI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIyOS4wMzc1IiB4PSIyMzYuNTA0MyIgeT0iMjIuOTk1MSI+JiMyMDE4MTsmIzM1Mzc5OyYjNjUyODg7Sm91cm5hbCBFbnRyeSYjNjUyODk7JiMxMjM5ODsmIzI5MzY2OyYjMjQ5MDc7JiMzNjk4MzsmIzMxMjI3OzwvdGV4dD48L2c+PGVsbGlwc2UgY3g9IjI5Mi44NCIgY3k9IjUzLjI5NjkiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjE7Ii8+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2Ni42ODk1IiB4PSIyNTkuNDkiIHk9IjE0MC4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjU5LjQ5IiB4Mj0iMzI2LjE3OTUiIHkxPSIxNjYuNTkzOCIgeTI9IjE2Ni41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDYuNjg5NSIgeD0iMjY5LjQ5IiB5PSIxNTguMjkyIj5EUkFGVDwvdGV4dD48L2c+PGc+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1MCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjUuMTU0MyIgeD0iMjEwLjI2IiB5PSIyNjcuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIxMC4yNiIgeDI9IjM3NS40MTQzIiB5MT0iMjkzLjU5MzgiIHkyPSIyOTMuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NS4xNTQzIiB4PSIyMjAuMjYiIHk9IjI4NS4yOTIiPlBFTkRJTkdfQVBQUk9WQUw8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTAzLjY3MTkiIHg9IjciIHk9IjM5NC4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNyIgeDI9IjExMC42NzE5IiB5MT0iNDIwLjU5MzgiIHkyPSI0MjAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjY3MTkiIHg9IjE3IiB5PSI0MTIuMjkyIj5DQU5DRUxMRUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTYuNDEyMSIgeD0iMjI0LjYzIiB5PSIzOTQuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIyNC42MyIgeDI9IjMyMS4wNDIxIiB5MT0iNDIwLjU5MzgiIHkyPSI0MjAuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc2LjQxMjEiIHg9IjIzNC42MyIgeT0iNDEyLjI5MiI+QVBQUk9WRUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODkuNTAxIiB4PSI0OTIuMDkiIHk9IjM5NC4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDkyLjA5IiB4Mj0iNTgxLjU5MSIgeTE9IjQyMC41OTM4IiB5Mj0iNDIwLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS41MDEiIHg9IjUwMi4wOSIgeT0iNDEyLjI5MiI+UkVKRUNURUQ8L3RleHQ+PC9nPjxnPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTAiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzYuNTI2NCIgeD0iMjM0LjU3IiB5PSI1MjEuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjIzNC41NyIgeDI9IjMxMS4wOTY0IiB5MT0iNTQ3LjU5MzgiIHkyPSI1NDcuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2LjUyNjQiIHg9IjI0NC41NyIgeT0iNTM5LjI5MiI+UE9TVEVEPC90ZXh0PjwvZz48IS0tbGluayAqc3RhcnQqIHRvIERSQUZULS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDIiIGRhdGEtZW50aXR5LTI9ImVudDAwMDMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0ibG5rNCI+PHBhdGggZD0iTTI5Mi44NCw2My42NzY5IEMyOTIuODQsODAuNDA2OSAyOTIuODQsMTA5Ljg4NjkgMjkyLjg0LDEzMy45MjY5IiBmaWxsPSJub25lIiBpZD0iKnN0YXJ0Ki10by1EUkFGVCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjkyLjg0LDEzOS45MjY5LDI5Ni44NCwxMzAuOTI2OSwyOTIuODQsMTM0LjkyNjksMjg4Ljg0LDEzMC45MjY5LDI5Mi44NCwxMzkuOTI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS41MTA3IiB4PSIyOTMuODQiIHk9IjEwNi4zNjM4Ij5Kb3VybmFsRW50cnlDcmVhdGVkPC90ZXh0PjwvZz48IS0tbGluayBEUkFGVCB0byBQRU5ESU5HX0FQUFJPVkFMLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDUiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0ibG5rNiI+PHBhdGggZD0iTTI5Mi44NCwxOTAuNjk2OSBDMjkyLjg0LDIxMi43MTY5IDI5Mi44NCwyMzguOTU2OSAyOTIuODQsMjYwLjk1NjkiIGZpbGw9Im5vbmUiIGlkPSJEUkFGVC10by1QRU5ESU5HX0FQUFJPVkFMIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyOTIuODQsMjY2Ljk1NjksMjk2Ljg0LDI1Ny45NTY5LDI5Mi44NCwyNjEuOTU2OSwyODguODQsMjU3Ljk1NjksMjkyLjg0LDI2Ni45NTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ3LjI0MDIiIHg9IjI5My44NCIgeT0iMjMzLjM2MzgiPkpvdXJuYWxFbnRyeVN1Ym1pdHRlZDwvdGV4dD48L2c+PCEtLWxpbmsgRFJBRlQgdG8gQ0FOQ0VMTEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDciIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0ibG5rOCI+PHBhdGggZD0iTTI1OS4wMiwxNjguODE2OSBDMjAzLjc4LDE3NC45NzY5IDk1LjU3LDE5NS45OTY5IDQ3Ljg0LDI2Ny4yOTY5IEMyMi4yNSwzMDUuNTE2OSAzNC43MDc1LDM1Ni40MTYyIDQ2LjQ2NzUsMzg4LjM2NjIiIGZpbGw9Im5vbmUiIGlkPSJEUkFGVC10by1DQU5DRUxMRUQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ4LjU0LDM5My45OTY5LDQ5LjE4NSwzODQuMTY5Miw0Ni44MTI5LDM4OS4zMDQ2LDQxLjY3NzQsMzg2LjkzMjUsNDguNTQsMzkzLjk5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMuNjc5MiIgeD0iNDguODQiIHk9IjI5Ni44NjM4Ij5Kb3VybmFsRW50cnlDYW5jZWxsZWQ8L3RleHQ+PC9nPjwhLS1saW5rIFBFTkRJTkdfQVBQUk9WQUwgdG8gQVBQUk9WRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNSIgZGF0YS1lbnRpdHktMj0iZW50MDAwOSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjgiIGlkPSJsbmsxMCI+PHBhdGggZD0iTTI4MC4wMSwzMTcuNjI2OSBDMjc1LjkxLDMyNi42NzY5IDI3MS44OSwzMzcuMjE2OSAyNjkuODQsMzQ3LjI5NjkgQzI2Ni43LDM2Mi42NDY5IDI2Ni43Njg4LDM3NC4yODIzIDI2OC4yNzg4LDM4OC4xMTIzIiBmaWxsPSJub25lIiBpZD0iUEVORElOR19BUFBST1ZBTC10by1BUFBST1ZFRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjY4LjkzLDM5NC4wNzY5LDI3MS45Mjk1LDM4NC42OTU5LDI2OC4zODczLDM4OS4xMDY0LDI2My45NzY4LDM4NS41NjQyLDI2OC45MywzOTQuMDc2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0Mi40MTYiIHg9IjI3MC44NCIgeT0iMzYwLjM2MzgiPkpvdXJuYWxFbnRyeUFwcHJvdmVkPC90ZXh0PjwvZz48IS0tbGluayBQRU5ESU5HX0FQUFJPVkFMIHRvIFJFSkVDVEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBpZD0ibG5rMTIiPjxwYXRoIGQ9Ik0zNTMuNjUsMzE3LjY5NjkgQzM3NC4zLDMyNi40NjY5IDM5Ny4zMiwzMzYuNzk2OSA0MTcuODQsMzQ3LjI5NjkgQzQ0NS41NywzNjEuNDg2OSA0NzAuNjA3NSwzNzYuMzE0IDQ5My42MDc1LDM5MC42NDQiIGZpbGw9Im5vbmUiIGlkPSJQRU5ESU5HX0FQUFJPVkFMLXRvLVJFSkVDVEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0OTguNywzOTMuODE2OSw0OTMuMTc2NSwzODUuNjYyNyw0OTQuNDU2MywzOTEuMTcyOSw0ODguOTQ2MSwzOTIuNDUyNiw0OTguNywzOTMuODE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNi45MTI2IiB4PSI0NDguOTIiIHk9IjM2MC4zNjM4Ij5Kb3VybmFsRW50cnlSZWplY3RlZDwvdGV4dD48L2c+PCEtLWxpbmsgUEVORElOR19BUFBST1ZBTCB0byBDQU5DRUxMRUQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNSIgZGF0YS1lbnRpdHktMj0iZW50MDAwNyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0ibG5rMTMiPjxwYXRoIGQ9Ik0yMTAuMDEsMzEzLjMyNjkgQzE3MS42MiwzMjMuNjE2OSAxMzAuOTcsMzM2LjI4NjkgMTE0Ljg0LDM0Ny4yOTY5IEM5Ny4yLDM1OS4zMjY5IDg1Ljc0MDksMzczLjU2NzUgNzUuODMwOSwzODkuMDA3NSIgZmlsbD0ibm9uZSIgaWQ9IlBFTkRJTkdfQVBQUk9WQUwtdG8tQ0FOQ0VMTEVEIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI3Mi41OSwzOTQuMDU2OSw4MC44MTc2LDM4OC42NDM0LDc1LjI5MDgsMzg5Ljg0OSw3NC4wODUxLDM4NC4zMjIyLDcyLjU5LDM5NC4wNTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzLjY3OTIiIHg9IjExNS44NCIgeT0iMzYwLjM2MzgiPkpvdXJuYWxFbnRyeUNhbmNlbGxlZDwvdGV4dD48L2c+PCEtLWxpbmsgQVBQUk9WRUQgdG8gUE9TVEVELS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDkiIGRhdGEtZW50aXR5LTI9ImVudDAwMTQiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImxuazE1Ij48cGF0aCBkPSJNMjcyLjg0LDQ0NC42OTY5IEMyNzIuODQsNDY2LjcxNjkgMjcyLjg0LDQ5Mi45NTY5IDI3Mi44NCw1MTQuOTU2OSIgZmlsbD0ibm9uZSIgaWQ9IkFQUFJPVkVELXRvLVBPU1RFRCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjcyLjg0LDUyMC45NTY5LDI3Ni44NCw1MTEuOTU2OSwyNzIuODQsNTE1Ljk1NjksMjY4Ljg0LDUxMS45NTY5LDI3Mi44NCw1MjAuOTU2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMy42OTA0IiB4PSIyNzMuODQiIHk9IjQ4Ny4zNjM4Ij5Kb3VybmFsRW50cnlQb3N0ZWQ8L3RleHQ+PC9nPjwhLS1saW5rIFJFSkVDVEVEIHRvIERSQUZULS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTEiIGRhdGEtZW50aXR5LTI9ImVudDAwMDMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImxuazE2Ij48cGF0aCBkPSJNNTc0LjYxLDM5NC4xMDY5IEM1ODkuNiwzODEuMjY2OSA2MDEuNjQsMzY0LjU4NjkgNTkzLjg0LDM0Ny4yOTY5IEM1NDQuNjYsMjM4LjM2NjkgNDAwLjE3NzMsMTkxLjU2NjIgMzMyLjQxNzMsMTc0Ljk0NjIiIGZpbGw9Im5vbmUiIGlkPSJSRUpFQ1RFRC10by1EUkFGVCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzI2LjU5LDE3My41MTY5LDMzNC4zNzgsMTc5LjU0NTcsMzMxLjQ0NjEsMTc0LjcwOCwzMzYuMjgzOCwxNzEuNzc2LDMyNi41OSwxNzMuNTE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMS4xMzYyIiB4PSI1NzYuOTEiIHk9IjI5Ni44NjM4Ij5Kb3VybmFsRW50cnlSZXZpc2VkPC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBBeXhFcDJqOEI0aENMS1hBSkN2RUJ5ZWxwS2pucGlfOUJyOUdUZEM1R0l3a2Fpb0lkNUk1OXhrZGxiWW4tVnNVM2dfeXFnQXluMW01cnhvSWVpaHRVcGVWRHd2eHRoTmpNTWx0b3lSanB2Vmx2a0FBcmVmTHFETXJLdDA5U2RHQktSMUlXNmUwZ3RTa0lhcWlJS3RYV2lZMUwwTXUtaGJ1LWhkN0VtTzQxRmM3RVZnV1FHV2tKU2hEQjQ3THVrcGV2LXBndS1GZ1djdnVPYnZvUWF1RUsyczZlSTFqNDB3NkJpVTJXZ0J5Q2JvUVdib3pOOXIzQzNHNWZNUWI5ZlZXcWFKT1dOMnRXOEYwRm5aSlhlM3lPZjN2U0ZqblhNWEdRYmJjU01lQTAwMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h4 id="_2">イベント一覧<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>イベント</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>JournalEntryCreatedEvent</code></td>
<td>仕訳が作成された</td>
</tr>
<tr>
<td><code>JournalEntrySubmittedEvent</code></td>
<td>仕訳が承認申請された</td>
</tr>
<tr>
<td><code>JournalEntryApprovedEvent</code></td>
<td>仕訳が承認された</td>
</tr>
<tr>
<td><code>JournalEntryRejectedEvent</code></td>
<td>仕訳が却下された</td>
</tr>
<tr>
<td><code>JournalEntryRevisedEvent</code></td>
<td>却下された仕訳が修正された</td>
</tr>
<tr>
<td><code>JournalEntryPostedEvent</code></td>
<td>仕訳が転記された（元帳に反映）</td>
</tr>
<tr>
<td><code>JournalEntryCancelledEvent</code></td>
<td>仕訳がキャンセルされた</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="2242-api-layer">22.4.2 イベント定義（API Layer）<a class="headerlink" href="#2242-api-layer" title="Permanent link">&para;</a></h3>
<h4 id="sealed-interface">sealed interface によるイベントの型安全性<a class="headerlink" href="#sealed-interface" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: JournalEntryEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry イベントの sealed interface</span>
<span class="cm"> * すべての JournalEntry イベントの親インターフェース</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">JournalEntryEvent</span><span class="w"> </span><span class="n">permits</span>
<span class="w">        </span><span class="n">JournalEntryCreatedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryApprovedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryRejectedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryRevisedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryPostedEvent</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">journalEntryId</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="record">イベント record の実装<a class="headerlink" href="#record" title="Permanent link">&para;</a></h4>
<details>
<summary>コード例: JournalEntryCreatedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳作成イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳明細データ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalLineData</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">,</span>
<span class="w">            </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalEntryApprovedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳承認イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntryApprovedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">approvedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalEntryPostedEvent.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳転記イベント</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntryPostedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">postedAt</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="2243-domain-layer">22.4.3 コマンド定義（Domain Layer）<a class="headerlink" href="#2243-domain-layer" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryCommands.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.TargetAggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry 集約へのコマンド定義</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryCommands</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">JournalEntryCommands</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳作成コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineInput</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalLineInput</span><span class="p">(</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">,</span>
<span class="w">                </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">,</span>
<span class="w">                </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳承認申請コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">SubmitJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳承認コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ApproveJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">comment</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳却下コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">RejectJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳転記コマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">PostJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳キャンセルコマンド</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">CancelJournalEntryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@TargetAggregateIdentifier</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="2244-java">22.4.4 ドメインモデル（純粋な Java）<a class="headerlink" href="#2244-java" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntry.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryCreatedEvent.JournalLineData</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry ドメインモデル（Axon 非依存）</span>
<span class="cm"> * 純粋なビジネスロジックのみを含む</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalEntry</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">        </span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="n">status</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ======== ファクトリメソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳作成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// バリデーション: 借方・貸方の合計が一致すること</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalDebit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalLineData</span><span class="p">::</span><span class="n">debitAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalCredit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalLineData</span><span class="p">::</span><span class="n">creditAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">totalDebit</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">totalCredit</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;Debit and credit amounts must be equal. Debit: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">totalDebit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, Credit: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">totalCredit</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Journal entry must have at least one line&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">                </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">                </span><span class="n">transactionDate</span><span class="p">,</span>
<span class="w">                </span><span class="n">description</span><span class="p">,</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">createdBy</span><span class="p">,</span>
<span class="w">                </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントからの再構築</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLine</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLine</span><span class="p">(</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">data</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">journalNumber</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">lines</span><span class="p">,</span>
<span class="w">                </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== 状態遷移メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認申請</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only draft journal entries can be submitted&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="nf">approve</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">comment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">PENDING_APPROVAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only pending journal entries can be approved&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 却下</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="nf">reject</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">PENDING_APPROVAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only pending journal entries can be rejected&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryRejectedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 転記</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">APPROVED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Only approved journal entries can be posted&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">,</span><span class="w"> </span><span class="n">postedBy</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセル</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">POSTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Posted journal entries cannot be cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Journal entry is already cancelled&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== イベント適用メソッド ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * イベントを適用して新しい状態を生成</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">JournalEntryEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">PENDING_APPROVAL</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">APPROVED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">REJECTED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryRevisedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">POSTED</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">CANCELLED</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 状態更新ヘルパー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="nf">withStatus</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="n">newStatus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">,</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">,</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="n">newStatus</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalEntryStatus.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳ステータス</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DRAFT</span><span class="p">,</span><span class="w">             </span><span class="c1">// 下書き</span>
<span class="w">    </span><span class="n">PENDING_APPROVAL</span><span class="p">,</span><span class="w">  </span><span class="c1">// 承認待ち</span>
<span class="w">    </span><span class="n">APPROVED</span><span class="p">,</span><span class="w">          </span><span class="c1">// 承認済み</span>
<span class="w">    </span><span class="n">REJECTED</span><span class="p">,</span><span class="w">          </span><span class="c1">// 却下</span>
<span class="w">    </span><span class="n">POSTED</span><span class="p">,</span><span class="w">            </span><span class="c1">// 転記済み</span>
<span class="w">    </span><span class="n">CANCELLED</span><span class="w">          </span><span class="c1">// キャンセル</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalLine.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 仕訳明細（Value Object）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalLine</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalLine</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">debitAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="n">debitAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">creditAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="n">creditAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">debitAmount</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Amounts cannot be negative&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="225-aggregate-adapter-policy-handler">22.5 Aggregate Adapter と Policy Handler<a class="headerlink" href="#225-aggregate-adapter-policy-handler" title="Permanent link">&para;</a></h2>
<h3 id="2251-journalentry-aggregate-adapter">22.5.1 JournalEntry Aggregate Adapter<a class="headerlink" href="#2251-journalentry-aggregate-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryAggregateAdapter.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryCreatedEvent.JournalLineData</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntryCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.CommandHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventsourcing.EventSourcingHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateIdentifier</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.modelling.command.AggregateLifecycle</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.spring.stereotype.Aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry Aggregate Adapter（Axon Framework 用）</span>
<span class="cm"> */</span>
<span class="nd">@Aggregate</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryAggregateAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@AggregateIdentifier</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntry</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Axon が使用するデフォルトコンストラクタ</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="nf">JournalEntryAggregateAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Command Handlers ========</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 集約作成コマンドハンドラー（コンストラクタ）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalEntryAggregateAdapter</span><span class="p">(</span><span class="n">CreateJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 仕訳番号を生成</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateJournalNumber</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// コマンドの明細をイベント用データに変換</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">lineDataList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ドメインモデルのファクトリメソッドを呼び出し</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">journalNumber</span><span class="p">,</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">lineDataList</span><span class="p">,</span>
<span class="w">                </span><span class="n">command</span><span class="p">.</span><span class="na">createdBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// イベントを発行</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認申請コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">SubmitJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">submittedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 承認コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">ApproveJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">approve</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">approvedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">comment</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 却下コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">RejectJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">reject</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">rejectedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 転記コマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">PostJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">postedBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * キャンセルコマンドハンドラー</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@CommandHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">CancelJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">cancel</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">        </span><span class="n">AggregateLifecycle</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Event Sourcing Handlers（状態復元）========</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntry</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventSourcingHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ======== Helper Methods ========</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateJournalNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 実際には連番生成サービスを使用</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;JE-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">).</span><span class="na">toUpperCase</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<p><strong>Axon アノテーション解説：</strong></p>
<table>
<thead>
<tr>
<th>アノテーション</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Aggregate</code></td>
<td>Event Sourcing 集約であることを宣言</td>
</tr>
<tr>
<td><code>@AggregateIdentifier</code></td>
<td>集約の識別子フィールド</td>
</tr>
<tr>
<td><code>@CommandHandler</code></td>
<td>コマンドを処理するメソッド</td>
</tr>
<tr>
<td><code>@EventSourcingHandler</code></td>
<td>イベントから状態を復元するメソッド</td>
</tr>
<tr>
<td><code>AggregateLifecycle.apply()</code></td>
<td>イベントを発行するメソッド</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="2252-policy-handlerchoreography">22.5.2 Policy Handler（Choreography パターン）<a class="headerlink" href="#2252-policy-handlerchoreography" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjI2NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjAwcHg7aGVpZ2h0OjI2NHB4O2JhY2tncm91bmQ6I0ZFRkVGRTsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYwMCAyNjQiIHdpZHRoPSI2MDBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjxyZWN0IGZpbGw9IiNGRUZFRkUiIGhlaWdodD0iMjY0IiBzdHlsZT0ic3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjAwIiB4PSIwIiB5PSIwIi8+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJKb3VybmFsIiBpZD0icGFydDEtbGlmZWxpbmUiPjxnPjx0aXRsZT5Kb3VybmFsIENvbnRleHQ8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxOTIuNjY0MSIgd2lkdGg9IjgiIHg9IjYyLjEwMyIgeT0iMzYuMjk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjY2IiB4Mj0iNjYiIHkxPSIzNi4yOTY5IiB5Mj0iMjI4Ljk2MDkiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MiIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQnVzIiBpZD0icGFydDItbGlmZWxpbmUiPjxnPjx0aXRsZT5FdmVudCBCdXM8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxOTIuNjY0MSIgd2lkdGg9IjgiIHg9IjI0Ny4wMzUyIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMjUwLjg3MTEiIHgyPSIyNTAuODcxMSIgeTE9IjM2LjI5NjkiIHkyPSIyMjguOTYwOSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJBY2NvdW50IiBpZD0icGFydDMtbGlmZWxpbmUiPjxnPjx0aXRsZT5BY2NvdW50IENvbnRleHQ8L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxOTIuNjY0MSIgd2lkdGg9IjgiIHg9IjQ2OC4xNzQzIiB5PSIzNi4yOTY5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iNDcyLjAxNzYiIHgyPSI0NzIuMDE3NiIgeTE9IjM2LjI5NjkiIHkyPSIyMjguOTYwOSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkpvdXJuYWwiIGlkPSJwYXJ0MS1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMi4yMDYxIiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4LjIwNjEiIHg9IjEyIiB5PSIyNC45OTUxIj5Kb3VybmFsIENvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQxIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJKb3VybmFsIiBpZD0icGFydDEtdGFpbCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjIuMjA2MSIgeD0iNSIgeT0iMjI3Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDguMjA2MSIgeD0iMTIiIHk9IjI0Ny45NTYxIj5Kb3VybmFsIENvbnRleHQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJCdXMiIGlkPSJwYXJ0Mi1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0LjMyODEiIHg9IjIwOC44NzExIiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjE1Ljg3MTEiIHk9IjI0Ljk5NTEiPkV2ZW50IEJ1czwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkJ1cyIgaWQ9InBhcnQyLXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODQuMzI4MSIgeD0iMjA4Ljg3MTEiIHk9IjIyNy45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAuMzI4MSIgeD0iMjE1Ljg3MTEiIHk9IjI0Ny45NTYxIj5FdmVudCBCdXM8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJBY2NvdW50IiBpZD0icGFydDMtaGVhZCI+PHJlY3QgZmlsbD0iI0UyRTJGMCIgaGVpZ2h0PSIzMC4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzAuMzEzNSIgeD0iNDA3LjAxNzYiIHk9IjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuMzEzNSIgeD0iNDE0LjAxNzYiIHk9IjI0Ljk5NTEiPkFjY291bnQgQ29udGV4dDwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LXRhaWwiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkFjY291bnQiIGlkPSJwYXJ0My10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMC4zMTM1IiB4PSI0MDcuMDE3NiIgeT0iMjI3Ljk2MDkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYuMzEzNSIgeD0iNDE0LjAxNzYiIHk9IjI0Ny45NTYxIj5BY2NvdW50IENvbnRleHQ8L3RleHQ+PC9nPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjU5My45NzAyIiB4PSIwIiB5PSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI1OTMuOTcwMiIgeTE9IjY2Ljg2MzMiIHkyPSI2Ni44NjMzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSI1OTMuOTcwMiIgeTE9IjY5Ljg2MzMiIHkyPSI2OS44NjMzIi8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iMTA5LjUyNiIgeD0iMjQyLjIyMjEiIHk9IjU2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMjQ4LjIyMjEiIHk9IjcyLjM2MzgiPiYjMjAxODE7JiMzNTM3OTsmIzM2NTc4OyYjMzUzNTI7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIzOS4wMzUyLDEwNi41NjI1LDI0OS4wMzUyLDExMC41NjI1LDIzOS4wMzUyLDExNC41NjI1LDI0My4wMzUyLDExMC41NjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjY2LjEwMyIgeDI9IjI0NS4wMzUyIiB5MT0iMTEwLjU2MjUiIHkyPSIxMTAuNTYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2MC45MzIxIiB4PSI3My4xMDMiIHk9IjEwNS40OTY2Ij5Kb3VybmFsRW50cnlQb3N0ZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQyIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzIiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDYwLjE3NDMsMTM1LjY5NTMsNDcwLjE3NDMsMTM5LjY5NTMsNDYwLjE3NDMsMTQzLjY5NTMsNDY0LjE3NDMsMTM5LjY5NTMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjUxLjAzNTIiIHgyPSI0NjYuMTc0MyIgeTE9IjEzOS42OTUzIiB5Mj0iMTM5LjY5NTMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjAuOTMyMSIgeD0iMjU4LjAzNTIiIHk9IjEzNC42Mjk0Ij5Kb3VybmFsRW50cnlQb3N0ZWRFdmVudDwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQzIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzMiPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NzIuMTc0MyIgeDI9IjUxNC4xNzQzIiB5MT0iMTY4LjgyODEiIHkyPSIxNjguODI4MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI1MTQuMTc0MyIgeDI9IjUxNC4xNzQzIiB5MT0iMTY4LjgyODEiIHkyPSIxODEuODI4MSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI0NzMuMTc0MyIgeDI9IjUxNC4xNzQzIiB5MT0iMTgxLjgyODEiIHkyPSIxODEuODI4MSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDgzLjE3NDMsMTc3LjgyODEsNDczLjE3NDMsMTgxLjgyODEsNDgzLjE3NDMsMTg1LjgyODEsNDc5LjE3NDMsMTgxLjgyODEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDcuNzk1OSIgeD0iNDc5LjE3NDMiIHk9IjE2My43NjIyIj51cGRhdGVCYWxhbmNlKCk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI2Mi4wMzUyLDIwNi45NjA5LDI1Mi4wMzUyLDIxMC45NjA5LDI2Mi4wMzUyLDIxNC45NjA5LDI1OC4wMzUyLDIxMC45NjA5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI1Ni4wMzUyIiB4Mj0iNDcxLjE3NDMiIHkxPSIyMTAuOTYwOSIgeTI9IjIxMC45NjA5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk3LjEzOTIiIHg9IjI2OC4wMzUyIiB5PSIyMDUuODk1Ij5BY2NvdW50QmFsYW5jZVVwZGF0ZWRFdmVudDwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgQXl4RXAyajhCNGhDTEtYQUpDdkVCeWVscEtqbnBpXzlCcjlHVGRDNUdJdWtlN0g5UGQ5Y0dNOVVZT0FJTHR2ZktMdllaZTlwVmJ2OVFhTTlhYTlZaUc5SzM1TVhRcmFnYTc4Z0JHT2gwVEFlcWV4OW9LMmhJYjNDV09mblNUZFFBWnBQRlZONVlpcWxUWXp3aU1CNnUtUWZadmxORmN4VWVzMWhvbUxwV0F1VG81MDVBdlpqaGRhYkhQSzEtU0tiZ0liV2d4YjBpYTE1QzhqbUF1SWZHNTVTTWYySU05QmdiOVlKYzlVU2dnNjloMFhZQkxHMGdZOEtoMW5ZODAwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<details>
<summary>コード例: JournalEventHandler.java（Account Context 内）</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.account.application.policy</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.account.domain.model.aggregate.account.AccountCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryPostedEvent</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Journal イベントに反応して勘定科目残高を更新する Policy Handler</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEventHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalEventHandler</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Policy: &quot;When a journal entry is posted, update account balances&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 仕訳の各明細に対して残高更新コマンドを発行</span>
<span class="w">        </span><span class="c1">// 実際には JournalEntryPostedEvent に明細情報を含めるか、</span>
<span class="w">        </span><span class="c1">// Read Model から取得する</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateAccountBalanceCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(),</span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="226-projection-read-modeljpa">22.6 Projection と Read Model（JPA版）<a class="headerlink" href="#226-projection-read-modeljpa" title="Permanent link">&para;</a></h2>
<h3 id="2261-journalentry-projection">22.6.1 JournalEntry Projection<a class="headerlink" href="#2261-journalentry-projection" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryProjection.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.application.query</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity.JournalEntryEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity.JournalLineEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.repository.JournalEntryJpaRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.eventhandling.EventHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.stream.Collectors</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry Projection（JPA を使用した Read Model の更新）</span>
<span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryProjection</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">JournalEntryJpaRepository</span><span class="w"> </span><span class="n">repository</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalEntryProjection</span><span class="p">(</span><span class="n">JournalEntryJpaRepository</span><span class="w"> </span><span class="n">repository</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">repository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryEntity</span><span class="p">();</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setJournalEntryId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setJournalNumber</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalNumber</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setTransactionDate</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setDescription</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">description</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;DRAFT&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCreatedBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">createdBy</span><span class="p">());</span>
<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setCreatedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">createdAt</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 明細をエンティティに変換</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">lineEntities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">var</span><span class="w"> </span><span class="n">lineEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineEntity</span><span class="p">();</span>
<span class="w">                    </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setAccountCode</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">accountCode</span><span class="p">());</span>
<span class="w">                    </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setAccountName</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">accountName</span><span class="p">());</span>
<span class="w">                    </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setDebitAmount</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">());</span>
<span class="w">                    </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setCreditAmount</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">());</span>
<span class="w">                    </span><span class="n">lineEntity</span><span class="p">.</span><span class="na">setJournalEntry</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">lineEntity</span><span class="p">;</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>

<span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">setLines</span><span class="p">(</span><span class="n">lineEntities</span><span class="p">);</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntrySubmittedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">()).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;PENDING_APPROVAL&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setSubmittedBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">submittedBy</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setSubmittedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">submittedAt</span><span class="p">());</span>
<span class="w">            </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">()).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;APPROVED&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setApprovedBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">approvedBy</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setApprovalComment</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">comment</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setApprovedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">approvedAt</span><span class="p">());</span>
<span class="w">            </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryRejectedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">()).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;REJECTED&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setRejectedBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">rejectedBy</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setRejectionReason</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setRejectedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">rejectedAt</span><span class="p">());</span>
<span class="w">            </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryPostedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">()).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;POSTED&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setFiscalPeriod</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setPostedBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">postedBy</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setPostedAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">postedAt</span><span class="p">());</span>
<span class="w">            </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">()).</span><span class="na">ifPresent</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="s">&quot;CANCELLED&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setCancelledBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setCancellationReason</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">setCancelledAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">cancelledAt</span><span class="p">());</span>
<span class="w">            </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="2262-read-model-entityjpa">22.6.2 Read Model Entity（JPA）<a class="headerlink" href="#2262-read-model-entityjpa" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryEntity.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry Read Model Entity（JPA）</span>
<span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;journal_entries&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryEntity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;journal_entry_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">36</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;journal_number&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;transaction_date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fiscal_period&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;created_by&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;submitted_by&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;submitted_at&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;approved_by&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;approval_comment&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;approved_at&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rejected_by&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rejection_reason&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rejected_at&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;posted_by&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;posted_at&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">postedAt</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cancelled_by&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cancellation_reason&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cancelled_at&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;journalEntry&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span><span class="w"> </span><span class="n">orphanRemoval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Getters and Setters</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getJournalEntryId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setJournalEntryId</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getJournalNumber</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setJournalNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">journalNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="nf">getTransactionDate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTransactionDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">transactionDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transactionDate</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getDescription</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">description</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDescription</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">description</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getStatus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getFiscalPeriod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFiscalPeriod</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCreatedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createdBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCreatedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreatedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSubmittedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSubmittedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">submittedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submittedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getSubmittedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSubmittedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">submittedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submittedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getApprovedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApprovedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">approvedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getApprovalComment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApprovalComment</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">approvalComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getApprovedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setApprovedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">approvedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approvedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRejectedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRejectionReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectionReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectionReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectionReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getRejectedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRejectedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">rejectedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rejectedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPostedBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">postedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPostedBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">postedBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">postedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">postedBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getPostedAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">postedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPostedAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">postedAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">postedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">postedAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancelledBy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledBy</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledBy</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCancellationReason</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancellationReason</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancellationReason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancellationReason</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getCancelledAt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCancelledAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">cancelledAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cancelledAt</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getLines</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLines</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalLineEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>コード例: JournalLineEntity.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalLine Read Model Entity（JPA）</span>
<span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;journal_lines&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalLineEntity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;journal_entry_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntryEntity</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;account_code&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;account_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;debit_amount&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">precision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;credit_amount&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">precision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Getters and Setters</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setId</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryEntity</span><span class="w"> </span><span class="nf">getJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setJournalEntry</span><span class="p">(</span><span class="n">JournalEntryEntity</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">journalEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journalEntry</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAccountCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAccountCode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">accountCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAccountName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAccountName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">accountName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getDebitAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDebitAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">debitAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getCreditAmount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCreditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">creditAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="2263-jpa-repository">22.6.3 JPA Repository インターフェース<a class="headerlink" href="#2263-jpa-repository" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryJpaRepository.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.entity.JournalEntryEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.EntityGraph</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.Query</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.repository.query.Param</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * JournalEntry JPA Repository</span>
<span class="cm"> */</span>
<span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">JournalEntryJpaRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ID で検索（明細を EAGER ロード）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@EntityGraph</span><span class="p">(</span><span class="n">attributePaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;lines&quot;</span><span class="p">})</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findWithLinesById</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * ステータスで検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 期間で検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByTransactionDateBetween</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">startDate</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">endDate</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 会計期間で検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByFiscalPeriod</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fiscalPeriod</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 勘定科目コードを含む仕訳を検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT DISTINCT je FROM JournalEntryEntity je JOIN je.lines l WHERE l.accountCode = :accountCode&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByAccountCode</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;accountCode&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳番号で検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">JournalEntryEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByJournalNumber</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalNumber</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="227-rest-api">22.7 REST API と統合テスト<a class="headerlink" href="#227-rest-api" title="Permanent link">&para;</a></h2>
<h3 id="2271-rest-controllerinbound-adapter">22.7.1 REST Controller（Inbound Adapter）<a class="headerlink" href="#2271-rest-controllerinbound-adapter" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalsController.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.inbound.rest.journals</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.inbound.rest.journals.protocol.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.adapter.outbound.persistence.repository.JournalEntryJpaRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryCreatedEvent.JournalLineData</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntryCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.Operation</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.swagger.v3.oas.annotations.tags.Tag</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.commandhandling.gateway.CommandGateway</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.ResponseEntity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CompletableFuture</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Journal REST Controller（Inbound Adapter）</span>
<span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/journals&quot;</span><span class="p">)</span>
<span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Journals&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Journal Entry management API&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalsController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">JournalEntryJpaRepository</span><span class="w"> </span><span class="n">repository</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JournalsController</span><span class="p">(</span><span class="n">CommandGateway</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">,</span><span class="w"> </span><span class="n">JournalEntryJpaRepository</span><span class="w"> </span><span class="n">repository</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">commandGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">repository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Command Side (Write) ==========</span>

<span class="w">    </span><span class="nd">@PostMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Create a new journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalCreateResponse</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalCreateRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">journalEntryId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">lineInputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">lines</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">accountCode</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">accountName</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">line</span><span class="p">.</span><span class="na">creditAmount</span><span class="p">()</span>
<span class="w">                </span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">                </span><span class="n">journalEntryId</span><span class="p">,</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">transactionDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">                </span><span class="n">lineInputs</span><span class="p">,</span>
<span class="w">                </span><span class="n">request</span><span class="p">.</span><span class="na">createdBy</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span>
<span class="w">                        </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CREATED</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JournalCreateResponse</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/submit&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Submit journal entry for approval&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalSubmitRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SubmitJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">submittedBy</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/approve&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Approve journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">approve</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalApproveRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ApproveJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">approvedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">comment</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/reject&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Reject journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">reject</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalRejectRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RejectJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">rejectedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/post&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Post journal entry to general ledger&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalPostRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">fiscalPeriod</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">postedBy</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/{id}/cancel&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cancel journal entry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@Valid</span><span class="w"> </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">JournalCancelRequest</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CancelJournalEntryCommand</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">cancelledBy</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">reason</span><span class="p">());</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="n">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ========== Query Side (Read) ==========</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get a journal entry by ID&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalGetResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findWithLinesById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">JournalGetResponse</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">entity</span><span class="p">)))</span>
<span class="w">                </span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">notFound</span><span class="p">().</span><span class="na">build</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get all journal entries&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalListResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalGetResponse</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JournalListResponse</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/status/{status}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Get journal entries by status&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JournalListResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getByStatus</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findByStatus</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">JournalGetResponse</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JournalListResponse</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h3 id="2272-api">22.7.2 API エンドポイント一覧<a class="headerlink" href="#2272-api" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>メソッド</th>
<th>パス</th>
<th>説明</th>
<th>種別</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/api/journals</code></td>
<td>仕訳作成</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/submit</code></td>
<td>承認申請</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/approve</code></td>
<td>承認</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/reject</code></td>
<td>却下</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/post</code></td>
<td>転記</td>
<td>Command</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/journals/{id}/cancel</code></td>
<td>キャンセル</td>
<td>Command</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/journals</code></td>
<td>仕訳一覧取得</td>
<td>Query</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/journals/{id}</code></td>
<td>仕訳詳細取得</td>
<td>Query</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/journals/status/{status}</code></td>
<td>ステータス別取得</td>
<td>Query</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="2273-axon-test">22.7.3 Axon Test による単体テスト<a class="headerlink" href="#2273-axon-test" title="Permanent link">&para;</a></h3>
<details>
<summary>コード例: JournalEntryAggregateTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.journal.application.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.api.events.JournalEntryCreatedEvent.JournalLineData</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.journal.domain.model.aggregate.journal.JournalEntryCommands.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.AggregateTestFixture</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.axonframework.test.aggregate.FixtureConfiguration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.BeforeEach</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.DisplayName</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Nested</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">JournalEntryAggregateTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FixtureConfiguration</span><span class="o">&lt;</span><span class="n">JournalEntryAggregateAdapter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fixture</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@BeforeEach</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fixture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AggregateTestFixture</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">JournalEntryAggregateAdapter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳作成&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CreateJournalEntry</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;貸借一致の仕訳を作成できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCreateBalancedJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="s">&quot;売上計上&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;1100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売掛金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;4100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上高&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;貸借不一致の場合はエラー&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRejectUnbalancedJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateJournalEntryCommand</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="s">&quot;不正な仕訳&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;1100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売掛金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineInput</span><span class="p">(</span><span class="s">&quot;4100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上高&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">5000</span><span class="p">))</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">givenNoPriorActivity</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳承認&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">ApproveJournalEntry</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;承認待ちの仕訳を承認できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldApprovePendingJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;JE-001&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="s">&quot;売上計上&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;1100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売掛金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;4100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上高&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">submittedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">submittedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ApproveJournalEntryCommand</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;manager-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;承認します&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳転記&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">PostJournalEntry</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;承認済みの仕訳を転記できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldPostApprovedJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;JE-001&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="s">&quot;売上計上&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;1100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売掛金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;4100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上高&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">submittedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntrySubmittedEvent</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">approvedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;manager-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OK&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">,</span><span class="w"> </span><span class="n">submittedEvent</span><span class="p">,</span><span class="w"> </span><span class="n">approvedEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PostJournalEntryCommand</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2024-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;system&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectSuccessfulHandlerExecution</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectEventsMatching</span><span class="p">(</span><span class="n">events</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">events</span><span class="p">.</span><span class="na">getPayload</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryPostedEvent</span>
<span class="w">                    </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;未承認の仕訳は転記できない&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotPostUnapprovedJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;je-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;JE-001&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">(),</span>
<span class="w">                    </span><span class="s">&quot;売上計上&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;1100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売掛金&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">),</span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">JournalLineData</span><span class="p">(</span><span class="s">&quot;4100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;売上高&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;user-1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">fixture</span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PostJournalEntryCommand</span><span class="p">(</span><span class="s">&quot;je-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2024-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;system&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">expectException</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<hr />
<h2 id="228">22.8 まとめ<a class="headerlink" href="#228" title="Permanent link">&para;</a></h2>
<h3 id="2281">22.8.1 実装した機能一覧<a class="headerlink" href="#2281" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>項目</th>
<th>内容</th>
<th>主要技術</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>CQRS/ES アーキテクチャ</strong></td>
<td>コマンドとクエリの分離</td>
<td>Axon Framework, Event Sourcing</td>
</tr>
<tr>
<td><strong>ドメイン設計</strong></td>
<td>イベント、コマンド、ドメインモデル</td>
<td>sealed interface, record</td>
</tr>
<tr>
<td><strong>Aggregate Adapter</strong></td>
<td>フレームワーク依存の分離</td>
<td>@Aggregate, @CommandHandler</td>
</tr>
<tr>
<td><strong>Projection</strong></td>
<td>Read Model の更新</td>
<td>@EventHandler, Spring Data JPA</td>
</tr>
<tr>
<td><strong>REST API</strong></td>
<td>Inbound Adapter, テスト</td>
<td>CommandGateway, Axon Test</td>
</tr>
</tbody>
</table>
<h3 id="2282-mybatis-jpa">22.8.2 MyBatis 版と JPA 版の比較<a class="headerlink" href="#2282-mybatis-jpa" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>MyBatis 版</th>
<th>JPA 版</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>設定</strong></td>
<td>MapperScan, XML マッピング</td>
<td>EnableJpaRepositories</td>
</tr>
<tr>
<td><strong>Event Store</strong></td>
<td>JdbcEventStorageEngine</td>
<td>JpaEventStorageEngine</td>
</tr>
<tr>
<td><strong>Repository</strong></td>
<td>Mapper インターフェース + XML</td>
<td>JpaRepository インターフェース</td>
</tr>
<tr>
<td><strong>Projection</strong></td>
<td>Mapper.insert/update</td>
<td>Repository.save</td>
</tr>
<tr>
<td><strong>エンティティ</strong></td>
<td>POJO</td>
<td>@Entity アノテーション</td>
</tr>
<tr>
<td><strong>リレーション</strong></td>
<td>手動結合</td>
<td>@OneToMany/@ManyToOne</td>
</tr>
<tr>
<td><strong>クエリ</strong></td>
<td>XML で SQL 定義</td>
<td>メソッド名規約 + @Query</td>
</tr>
</tbody>
</table>
<h3 id="2283-jpa">22.8.3 JPA 版の利点<a class="headerlink" href="#2283-jpa" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>利点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>コード量削減</strong></td>
<td>Spring Data JPA による自動実装</td>
</tr>
<tr>
<td><strong>型安全性</strong></td>
<td>コンパイル時にクエリメソッドをチェック</td>
</tr>
<tr>
<td><strong>リレーション管理</strong></td>
<td>@OneToMany によるカスケード操作</td>
</tr>
<tr>
<td><strong>監査機能</strong></td>
<td>@EnableJpaAuditing による自動タイムスタンプ</td>
</tr>
<tr>
<td><strong>N+1 対策</strong></td>
<td>@EntityGraph による EAGER ロード制御</td>
</tr>
</tbody>
</table>
<h3 id="2284-cqrses">22.8.4 財務会計システムにおける CQRS/ES の意義<a class="headerlink" href="#2284-cqrses" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>監査証跡</strong></td>
<td>すべての仕訳変更履歴を完全に保持</td>
</tr>
<tr>
<td><strong>内部統制</strong></td>
<td>SOX 法対応の監査ログを自動生成</td>
</tr>
<tr>
<td><strong>訂正仕訳</strong></td>
<td>修正履歴を完全に追跡可能</td>
</tr>
<tr>
<td><strong>期末決算</strong></td>
<td>任意の時点での残高を再計算可能</td>
</tr>
<tr>
<td><strong>試算表生成</strong></td>
<td>Read Model を使った高速クエリ</td>
</tr>
</tbody>
</table>
<p>CQRS/ES は導入コストが高いですが、監査要件が厳しい財務会計システムでは、その恩恵は大きくなります。JPA を使用することで、Read Model の管理が簡潔になり、Spring Data JPA の豊富な機能を活用できます。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>