
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="基幹業務システム（販売管理・財務会計・生産管理）のデータベース設計を体系的に解説">
      
      
        <meta name="author" content="k2works">
      
      
      
        <link rel="prev" href="../chapter17/">
      
      
        <link rel="next" href="../chapter19/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>第18章 勘定科目残高の設計 - 実践データベース設計：基幹業務システム編</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../docs/mkdocs/assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#18" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-header__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            実践データベース設計：基幹業務システム編
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第18章 勘定科目残高の設計
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践データベース設計

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="実践データベース設計：基幹業務システム編" class="md-nav__button md-logo" aria-label="実践データベース設計：基幹業務システム編" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    実践データベース設計：基幹業務システム編
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/practical-database-design" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    practical-database-design
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践データベース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践データベース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../techstack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アウトライン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    執筆ワークフロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    デプロイ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    デプロイ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy-fas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAS デモデプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第1部 基幹業務システムの全体像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    第1部 基幹業務システムの全体像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章 基幹業務システムとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章 基幹業務システムの業務領域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part1/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章 業務フローの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第2部 販売管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    第2部 販売管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章 販売管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章 受注・出荷・売上の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章 債権管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章 調達管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章 債務管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章 共通処理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章 販売管理データ設計（B社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" checked>
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第3部 財務会計システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    第3部 財務会計システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        概要
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#181" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1 日次勘定科目残高の設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.1 日次勘定科目残高の設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1811" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.1 日次残高テーブルの設計方針
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1812" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.2 複合主キーによる多次元管理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1813" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.3 マイグレーション
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1814" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.4 ドメインモデル
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1815" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.5 リポジトリインターフェース
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1816" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1.6 日計表の出力
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#182" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2 月次勘定科目残高の設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.2 月次勘定科目残高の設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1821" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.1 月次残高テーブルの設計方針
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1822" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.2 マイグレーション
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1823" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.3 ドメインモデル
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1824" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.4 リポジトリインターフェース
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1825" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.5 合計残高試算表の出力
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1826" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2.6 月次残高の繰越処理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#183" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3 残高更新のタイミング
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.3 残高更新のタイミング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1831" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3.1 更新方式の選択
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1832" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3.2 即時更新の実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1833" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3.3 仕訳入力時の残高更新フロー
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1834-tdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3.4 TDD によるテスト実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#184-er" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.4 ER図
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#185" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.5 リレーションと楽観ロックの設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.5 リレーションと楽観ロックの設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mybatis-resultmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        MyBatis ネストした ResultMap によるリレーション設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MyBatis ネストした ResultMap によるリレーション設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resultmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        ネストした ResultMap の定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        リレーション設定のポイント
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        楽観ロックの実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="楽観ロックの実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyway" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flyway マイグレーション: バージョンカラム追加
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        エンティティへのバージョンフィールド追加
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mybatis-mapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        MyBatis Mapper: 楽観ロック対応の更新
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository 実装: 楽観ロック対応
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        TDD: 楽観ロックのテスト
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        楽観ロックのベストプラクティス
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        残高更新における整合性確保
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="残高更新における整合性確保">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        更新パターンと楽観ロック
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        即時更新とバッチ処理の共存
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#186" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.6 まとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18.6 まとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        設計のポイント
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        次章の予告
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第4部 生産管理システム
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    第4部 生産管理システム
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章 生産管理システムの全体像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章 マスタ情報の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章 生産計画の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章 購買管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章 外注委託管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章 工程管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章 在庫管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章 品質管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章 製造原価管理の設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter31/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章 生産管理データ設計（E社事例）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章 APIサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    第5部 エンタープライズインテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    第5部 エンタープライズインテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter33.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第33章 システム統合の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter34.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第34章 メッセージングパターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter35.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第35章 システム間連携パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter36.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第36章 マスタデータ管理（MDM）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter37.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第37章 イベント駆動アーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter38.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第38章 API設計とサービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/chapter39.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第39章 データ連携の実装パターン
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 販売管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 販売管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study2-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study3-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 生産管理システム実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 生産管理システム実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究1 モノリスサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究2 JavaFXデスクトップアプリケーションの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究3 gRPCサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../study/study4-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    研究4 GraphQLサービスの実装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    研究 財務会計システムORM実装編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    研究 財務会計システムORM実装編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter14-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章 財務会計システムの全体像【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter15-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章 勘定科目の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter16-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章 仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter17-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章 自動仕訳の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter18-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章 勘定科目残高の設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter19-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章 赤黒とログの設計【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter20-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章 財務会計データ設計（D社事例）【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3-orm/chapter21-orm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章 APIサービスの実装【ORM版】
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    付録
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    付録
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/er-diagrams.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A 全体ER図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/table-definitions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    B テーブル定義一覧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/glossary.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C 用語集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    データベース
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    データベース
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../assets/schemaspy-output/sms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SchemaSpy ER図（SMS）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="18">第18章 勘定科目残高の設計<a class="headerlink" href="#18" title="Permanent link">&para;</a></h1>
<h2 id="_1">概要<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本章では、財務会計システムにおける勘定科目残高の設計を行います。残高管理は、仕訳データから各勘定科目の現在残高を効率的に把握するための仕組みです。日次残高と月次残高の2階層で管理し、日計表や合計残高試算表の出力に対応します。</p>
<h2 id="181">18.1 日次勘定科目残高の設計<a class="headerlink" href="#181" title="Permanent link">&para;</a></h2>
<h3 id="1811">18.1.1 日次残高テーブルの設計方針<a class="headerlink" href="#1811" title="Permanent link">&para;</a></h3>
<p>日次勘定科目残高は、仕訳データを起票日単位で集計した結果を保持するテーブルです。仕訳伝票を登録するたびに都度集計するのではなく、事前集計テーブルとして残高を保持することで、日計表の出力を高速化します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjIxMXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTgwN3B4O2hlaWdodDoyMTFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxODA3IDIxMSIgd2lkdGg9IjE4MDdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjYwODU7JiMyNzQyNTsmIzI3NTMxOyYjMzk2NDA7JiMxMjM5ODsmIzIyODEwOyYjMjc0MjU7JiMyMDgwMzsmIzMxNjQ5OyYjMjk3MDI7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5Ljk5OTQiIHg9IjgyNi45ODMyIiB5PSIyMi45OTUxIj4mIzI2MDg1OyYjMjc0MjU7JiMyNzUzMTsmIzM5NjQwOyYjMTIzOTg7JiMyMjgxMDsmIzI3NDI1OyYjMjA4MDM7JiMzMTY0OTsmIzI5NzAyOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Pz8/Pz8tLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9Ijg3LjMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI4NTkiIHg9IjciIHk9IjExNy45NDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSIzODAuNTAwMiIgeT0iMTMyLjk0MiI+JiMyNjA4NTsmIzI3NDI1OyYjMjEyMDg7JiMyMzQ1MDsmIzMxMTg1OyYjMzA0NDY7JiMyNzUzMTsmIzM5NjQwOzwvdGV4dD48L2c+PCEtLWVudGl0eSBkYXRlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uZGF0ZSIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjEuOTk5OCIgeD0iMjMiIHk9IjE1Mi45NDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDEuOTk5OCIgeD0iMzMiIHk9IjE3NS45NDIiPiYjMzYyMTU7JiMzMTA4MDsmIzI2MDg1OzwvdGV4dD48L2c+PCEtLWVudGl0eSBhY2NvdW50LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uYWNjb3VudCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE3Ljk5OTYiIHg9IjEyMCIgeT0iMTUyLjk0NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIxMzAiIHk9IjE3NS45NDIiPiYjMjEyMDg7JiMyMzQ1MDsmIzMxMTg1OyYjMzA0NDY7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0PjwvZz48IS0tZW50aXR5IHN1Yi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLnN1YiIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE3Ljk5OTYiIHg9IjI3MyIgeT0iMTUyLjk0NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIyODMiIHk9IjE3NS45NDIiPiYjMzUwMzY7JiMyMTE2MTsmIzMxMTg1OyYjMzA0NDY7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0PjwvZz48IS0tZW50aXR5IGRlcHQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi5kZXB0IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwNiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI4OS45OTk3IiB4PSI0MjYiIHk9IjE1Mi45NDY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNDM2IiB5PSIxNzUuOTQyIj4mIzM3MDk2OyYjMzgyNzI7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0PjwvZz48IS0tZW50aXR5IHByb2otLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi5wcm9qIiBkYXRhLXNvdXJjZS1saW5lPSI4IiBpZD0iZW50MDAwNyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNDUuOTk5NSIgeD0iNTUxIiB5PSIxNTIuOTQ2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSI1NjEiIHk9IjE3NS45NDIiPiYjMTI1MDM7JiMxMjUyNTsmIzEyNDcyOyYjMTI0NTU7JiMxMjQ2MzsmIzEyNDg4OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OzwvdGV4dD48L2c+PCEtLWVudGl0eSBjbG9zaW5nLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uY2xvc2luZyIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE3Ljk5OTYiIHg9IjczMiIgeT0iMTUyLjk0NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSI3NDIiIHk9IjE3NS45NDIiPiYjMjc3NzA7JiMzMTYzOTsmIzIwMTgxOyYjMzUzNzk7JiMxMjUwMTsmIzEyNTIxOyYjMTI0NjQ7PC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU45IiBkYXRhLXNvdXJjZS1saW5lPSIxMiIgaWQ9ImVudDAwMTAiPjxwYXRoIGQ9Ik04ODQuNzMsMTU4LjUzNjkgTDg4NC43MywxODMuNjY5NyBMOTgxLjI3OTgsMTgzLjY2OTcgTDk4MS4yNzk4LDE2OC41MzY5IEw5NzEuMjc5OCwxNTguNTM2OSBMODg0LjczLDE1OC41MzY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNOTcxLjI3OTgsMTU4LjUzNjkgTDk3MS4yNzk4LDE2OC41MzY5IEw5ODEuMjc5OCwxNjguNTM2OSBMOTcxLjI3OTgsMTU4LjUzNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NS41NDk4IiB4PSI4OTAuNzMiIHk9IjE3NS42MDM4Ij4yMDI0LTA0LTAxPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4xMiIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJlbnQwMDEzIj48cGF0aCBkPSJNMTAxNS44MiwxNTguNTM2OSBMMTAxNS44MiwxODMuNjY5NyBMMTEzMC4xNzUsMTgzLjY2OTcgTDExMzAuMTc1LDE2OC41MzY5IEwxMTIwLjE3NSwxNTguNTM2OSBMMTAxNS44MiwxNTguNTM2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTExMjAuMTc1LDE1OC41MzY5IEwxMTIwLjE3NSwxNjguNTM2OSBMMTEzMC4xNzUsMTY4LjUzNjkgTDExMjAuMTc1LDE1OC41MzY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTMuMzU1IiB4PSIxMDIxLjgyIiB5PSIxNzUuNjAzOCI+MTExMTAmIzY1Mjg4OyYjMjk2OTQ7JiMzNzMyOTsmIzY1Mjg5OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMTUiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAxNiI+PHBhdGggZD0iTTExNjUuMjIsMTU4LjUzNjkgTDExNjUuMjIsMTgzLjY2OTcgTDEyOTguNzgzMSwxODMuNjY5NyBMMTI5OC43ODMxLDE2OC41MzY5IEwxMjg4Ljc4MzEsMTU4LjUzNjkgTDExNjUuMjIsMTU4LjUzNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMjg4Ljc4MzEsMTU4LjUzNjkgTDEyODguNzgzMSwxNjguNTM2OSBMMTI5OC43ODMxLDE2OC41MzY5IEwxMjg4Ljc4MzEsMTU4LjUzNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIuNTYzMSIgeD0iMTE3MS4yMiIgeT0iMTc1LjYwMzgiPiYjMzEzNTQ7JiMyNTk5MTsmIzIzMzgzOyBvciAmIzM1MDM2OyYjMjExNjE7JiMzMTE4NTsmIzMwNDQ2OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMTgiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBpZD0iZW50MDAxOSI+PHBhdGggZD0iTTEzMzMuMzIsMTU4LjUzNjkgTDEzMzMuMzIsMTgzLjY2OTcgTDE0ODYuNjc1MSwxODMuNjY5NyBMMTQ4Ni42NzUxLDE2OC41MzY5IEwxNDc2LjY3NTEsMTU4LjUzNjkgTDEzMzMuMzIsMTU4LjUzNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xNDc2LjY3NTEsMTU4LjUzNjkgTDE0NzYuNjc1MSwxNjguNTM2OSBMMTQ4Ni42NzUxLDE2OC41MzY5IEwxNDc2LjY3NTEsMTU4LjUzNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzIuMzU1MSIgeD0iMTMzOS4zMiIgeT0iMTc1LjYwMzgiPjEwMTAwJiM2NTI4ODsmIzI2NDEyOyYjMzEwMzg7JiMyMTk0MjsmIzI2OTg5OyYjMzcwOTY7JiM2NTI4OTs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjIxIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgaWQ9ImVudDAwMjIiPjxwYXRoIGQ9Ik0xNTIxLjg5LDE1OC41MzY5IEwxNTIxLjg5LDE4My42Njk3IEwxNjM2LjEwNTQsMTgzLjY2OTcgTDE2MzYuMTA1NCwxNjguNTM2OSBMMTYyNi4xMDU0LDE1OC41MzY5IEwxNTIxLjg5LDE1OC41MzY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTYyNi4xMDU0LDE1OC41MzY5IEwxNjI2LjEwNTQsMTY4LjUzNjkgTDE2MzYuMTA1NCwxNjguNTM2OSBMMTYyNi4xMDU0LDE1OC41MzY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTMuMjE1NCIgeD0iMTUyNy44OSIgeT0iMTc1LjYwMzgiPiYjMzEzNTQ7JiMyNTk5MTsmIzIzMzgzOyBvciBQMDAxPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJHTU4yNCIgZGF0YS1zb3VyY2UtbGluZT0iMTciIGlkPSJlbnQwMDI1Ij48cGF0aCBkPSJNMTY3MS4wNCwxNTguNTM2OSBMMTY3MS4wNCwxODMuNjY5NyBMMTgwMC45NjU5LDE4My42Njk3IEwxODAwLjk2NTksMTY4LjUzNjkgTDE3OTAuOTY1OSwxNTguNTM2OSBMMTY3MS4wNCwxNTguNTM2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE3OTAuOTY1OSwxNTguNTM2OSBMMTc5MC45NjU5LDE2OC41MzY5IEwxODAwLjk2NTksMTY4LjUzNjkgTDE3OTAuOTY1OSwxNTguNTM2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOC45MjU5IiB4PSIxNjc3LjA0IiB5PSIxNzUuNjAzOCI+ZmFsc2UmIzY1Mjg4OyYjMzY4OTA7JiMyNDEyMDsmIzIwMTgxOyYjMzUzNzk7JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1saW5rIGRhdGUgdG8gR01OOS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDEwIiBkYXRhLWxpbmstdHlwZT0iYXNzb2NpYXRpb24iIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0ibG5rMTEiPjxwYXRoIGQ9Ik02MS4yNSwxNTIuNjQ2OSBDNzEsMTMwLjY5NjkgOTAuNjQsOTUuMTI2OSAxMjAuNSw3OS45NDY5IEMxOTIuNjEsNDMuMjk2OSA3NzQuMzcsNDcuNTg2OSA4NDguNSw3OS45NDY5IEM4ODUuNDgsOTYuMDk2OSA5MTMuNTIsMTM3LjI4NjkgOTI1Ljk1LDE1OC4zMTY5IiBmaWxsPSJub25lIiBpZD0iZGF0ZS1HTU45IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PC9nPjwhLS1saW5rIGFjY291bnQgdG8gR01OMTItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAxMyIgZGF0YS1saW5rLXR5cGU9ImFzc29jaWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImxuazE0Ij48cGF0aCBkPSJNMTkxLjM4LDE1Mi40NDY5IEMyMDcuMzMsMTMwLjMwNjkgMjM3LjM2LDk0LjUzNjkgMjczLjUsNzkuOTQ2OSBDMzQ2LjQ1LDUwLjUwNjkgOTA4Ljc5LDQ5LjkxNjkgOTgxLjUsNzkuOTQ2OSBDMTAyMC4yNSw5NS45NTY5IDEwNTEuMjEsMTM3LjIxNjkgMTA2NS4wOSwxNTguMjg2OSIgZmlsbD0ibm9uZSIgaWQ9ImFjY291bnQtR01OMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PCEtLWxpbmsgc3ViIHRvIEdNTjE1LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDUiIGRhdGEtZW50aXR5LTI9ImVudDAwMTYiIGRhdGEtbGluay10eXBlPSJhc3NvY2lhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJsbmsxNyI+PHBhdGggZD0iTTM0NC4zOCwxNTIuNDQ2OSBDMzYwLjMzLDEzMC4zMDY5IDM5MC4zNiw5NC41MzY5IDQyNi41LDc5Ljk0NjkgQzQ5OS4wNCw1MC42NjY5IDEwNTcuNDUsNTEuOTY2OSAxMTMwLjUsNzkuOTQ2OSBDMTE3MS44Niw5NS43OTY5IDEyMDYuOTUsMTM3LjEyNjkgMTIyMi44NywxNTguMjU2OSIgZmlsbD0ibm9uZSIgaWQ9InN1Yi1HTU4xNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48IS0tbGluayBkZXB0IHRvIEdNTjE4LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMTkiIGRhdGEtbGluay10eXBlPSJhc3NvY2lhdGlvbiIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGlkPSJsbmsyMCI+PHBhdGggZD0iTTQ4MC44NSwxNTIuNTM2OSBDNDkzLjczLDEzMC40NzY5IDUxOC41OSw5NC43OTY5IDU1MS41LDc5Ljk0NjkgQzYyNy4xNiw0NS44MjY5IDEyMjAuMzMsNTIuMDY2OSAxMjk4LjUsNzkuOTQ2OSBDMTM0Mi41NCw5NS42NTY5IDEzODEuNzMsMTM3LjA1NjkgMTM5OS42NiwxNTguMjI2OSIgZmlsbD0ibm9uZSIgaWQ9ImRlcHQtR01OMTgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48L2c+PCEtLWxpbmsgcHJvaiB0byBHTU4yMS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA3IiBkYXRhLWVudGl0eS0yPSJlbnQwMDIyIiBkYXRhLWxpbmstdHlwZT0iYXNzb2NpYXRpb24iIGRhdGEtc291cmNlLWxpbmU9IjE2IiBpZD0ibG5rMjMiPjxwYXRoIGQ9Ik02MzguNTQsMTUyLjc3NjkgQzY1Ny40MywxMzAuNTk2OSA2OTIuNzQsOTQuNDM2OSA3MzIuNSw3OS45NDY5IEM4MTEuMjIsNTEuMjc2OSAxNDA4Ljk4LDQ4LjE3NjkgMTQ4Ni41LDc5Ljk0NjkgQzE1MjUuNTEsOTUuOTM2OSAxNTU2Ljg5LDEzNy4yMDY5IDE1NzAuOTYsMTU4LjI4NjkiIGZpbGw9Im5vbmUiIGlkPSJwcm9qLUdNTjIxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PC9nPjwhLS1saW5rIGNsb3NpbmcgdG8gR01OMjQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOCIgZGF0YS1lbnRpdHktMj0iZW50MDAyNSIgZGF0YS1saW5rLXR5cGU9ImFzc29jaWF0aW9uIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImxuazI2Ij48cGF0aCBkPSJNODAzLjIsMTUyLjQ1NjkgQzgxOC45NCwxMzAuMzE2OSA4NDguNTksOTQuNTU2OSA4ODQuNSw3OS45NDY5IEM5NjEuOSw0OC40NjY5IDE1NTguNjIsNDkuNjc2OSAxNjM2LjUsNzkuOTQ2OSBDMTY3Ny4zMyw5NS44MjY5IDE3MTEuNiwxMzcuMTQ2OSAxNzI3LjExLDE1OC4yNjY5IiBmaWxsPSJub25lIiBpZD0iY2xvc2luZy1HTU4yNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjwvZz48P3BsYW50dW1sLXNyYyBSUDMxSmk5MDQ4UmxWT2VEVHZEMkZGYUtsYThqZk1BUWJoSkJvUFhXRG1oOEdKZEdhaWc1STBENGcxWVpEYVh1Y05NeHpDR2hFNTBFUk42cGJ5cnl5eXQtV3dqT0tyM2EtajVpNjBNVC1CTEZSbUNzeWszOXhXV0ZYbHBmTlgxQ0hTUUloVzlQSTUzTXdSRjB1LUNrVm13SWpXQXdKY0VScHNfa0ptMGs4Q2IyUEdhaHdNZ3dkVGVWYkFtZVFVejlJUFFEa2V1cGdmUzFVdlotMXJscllwR09hcWRpREI5OE1RYmJQOUl1YkNvZjdMOXhKRXF0SWJmUGxjT1FMdmN1eHFpVWtCeV9sU3E0aTF1YktzZWx6Z0lpNkxQTEx1S1JHVDBEaDIycGdidllQNUpzT1Q0UEFlY2JxbkNIUlo1TkZxRzRmMFg3dEF2UV83NFREeGxSTEpqN0dad1ctN0dQRUtxc1R2NVhlbEdveWRDWHdhdWc1aU1URDFoQy02WkRkQV84ZHlEY1prc3hnN2R6a05acXRLREU4MmtJUFliV1pYaVUyeURhOXczejBtMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="1812">18.1.2 複合主キーによる多次元管理<a class="headerlink" href="#1812" title="Permanent link">&para;</a></h3>
<p>日次残高テーブルは、以下の6つのカラムで複合主キーを構成します。</p>
<table>
<thead>
<tr>
<th>カラム</th>
<th>説明</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr>
<td>起票日</td>
<td>仕訳の起票日</td>
<td>2024-04-01</td>
</tr>
<tr>
<td>勘定科目コード</td>
<td>勘定科目マスタのコード</td>
<td>11110</td>
</tr>
<tr>
<td>補助科目コード</td>
<td>補助的な分類（空文字可）</td>
<td>空文字</td>
</tr>
<tr>
<td>部門コード</td>
<td>部門マスタのコード</td>
<td>10100</td>
</tr>
<tr>
<td>プロジェクトコード</td>
<td>プロジェクト単位管理（空文字可）</td>
<td>P001</td>
</tr>
<tr>
<td>決算仕訳フラグ</td>
<td>決算仕訳か否か</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>この設計により、同じ勘定科目でも以下の粒度で残高を分けて管理できます。</p>
<ul>
<li>部門別の売上高</li>
<li>プロジェクト別の原価</li>
<li>通常仕訳と決算仕訳の分離</li>
</ul>
<h3 id="1813">18.1.3 マイグレーション<a class="headerlink" href="#1813" title="Permanent link">&para;</a></h3>
<details>
<summary>V018__create_daily_account_balance_table.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- V018__create_daily_account_balance_table.sql</span>

<span class="c1">-- 日次勘定科目残高テーブル</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;起票日&quot;</span><span class="w">               </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;補助科目コード&quot;</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;部門コード&quot;</span><span class="w">            </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;00000&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="w">    </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;決算仕訳フラグ&quot;</span><span class="w">        </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;借方金額&quot;</span><span class="w">             </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;貸方金額&quot;</span><span class="w">             </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w">             </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w">             </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="ss">&quot;起票日&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;決算仕訳フラグ&quot;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;勘定科目マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;部門コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;部門マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;部門コード&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_daily_balance_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="p">(</span><span class="ss">&quot;起票日&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_daily_balance_account</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="p">(</span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_daily_balance_dept</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="p">(</span><span class="ss">&quot;部門コード&quot;</span><span class="p">);</span>

<span class="c1">-- UPSERT用トリガー関数</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">upsert_daily_account_balance</span><span class="p">()</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">$$</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="ss">&quot;起票日&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;決算仕訳フラグ&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;借方金額&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;貸方金額&quot;</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;起票日&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;00000&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;決算仕訳フラグ&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">FALSE</span><span class="p">),</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;貸借区分&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;借方&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;金額&quot;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;貸借区分&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;貸方&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;金額&quot;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="ss">&quot;起票日&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;決算仕訳フラグ&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span>
<span class="w">        </span><span class="ss">&quot;借方金額&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="p">.</span><span class="ss">&quot;借方金額&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;貸借区分&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;借方&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;金額&quot;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;貸方金額&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="p">.</span><span class="ss">&quot;貸方金額&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;貸借区分&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;貸方&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="ss">&quot;金額&quot;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">;</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="k">NEW</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="err">$$</span><span class="w"> </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span>

<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;仕訳データを起票日単位で集計した残高テーブル&#39;</span><span class="p">;</span>
</code></pre></div>

</details>

<h3 id="1814">18.1.4 ドメインモデル<a class="headerlink" href="#1814" title="Permanent link">&para;</a></h3>
<details>
<summary>DailyAccountBalance エンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/accounting/DailyAccountBalance.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 日次勘定科目残高エンティティ</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DailyAccountBalance</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">postingDate</span><span class="p">;</span><span class="w">           </span><span class="c1">// 起票日</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">subAccountCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 補助科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">departmentCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 部門コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">projectCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// プロジェクトコード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">closingJournalFlag</span><span class="p">;</span><span class="w">      </span><span class="c1">// 決算仕訳フラグ</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w">          </span><span class="c1">// 借方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w">         </span><span class="c1">// 貸方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 作成日時</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 更新日時</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 複合主キークラス</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Data</span>
<span class="w">    </span><span class="nd">@Builder</span>
<span class="w">    </span><span class="nd">@NoArgsConstructor</span>
<span class="w">    </span><span class="nd">@AllArgsConstructor</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Key</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">postingDate</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">subAccountCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">departmentCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">projectCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">closingJournalFlag</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 残高を計算する（借方 - 貸方）</span>
<span class="cm">     * 資産・費用科目の場合は正の値が残高増加を意味する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">creditAmount</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 指定した貸借区分での残高を取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getBalanceByType</span><span class="p">(</span><span class="n">DebitCreditType</span><span class="w"> </span><span class="n">debitCreditType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">debitCreditType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DebitCreditType</span><span class="p">.</span><span class="na">DEBIT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">creditAmount</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">debitAmount</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>DailyReportLine（日計表行）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/accounting/DailyReportLine.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 日計表の1行を表すDTO</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DailyReportLine</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">postingDate</span><span class="p">;</span><span class="w">           </span><span class="c1">// 起票日</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目名</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">bsplType</span><span class="p">;</span><span class="w">                 </span><span class="c1">// BSPL区分</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">debitCreditType</span><span class="p">;</span><span class="w">          </span><span class="c1">// 貸借区分</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitTotal</span><span class="p">;</span><span class="w">           </span><span class="c1">// 借方合計</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditTotal</span><span class="p">;</span><span class="w">          </span><span class="c1">// 貸方合計</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">balance</span><span class="p">;</span><span class="w">              </span><span class="c1">// 残高</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 勘定科目の性質に基づいた残高を計算</span>
<span class="cm">     * 借方科目（資産・費用）: 借方 - 貸方</span>
<span class="cm">     * 貸方科目（負債・資本・収益）: 貸方 - 借方</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">calculateBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;借方&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">debitCreditType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">debitTotal</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">creditTotal</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">creditTotal</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">debitTotal</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="1815">18.1.5 リポジトリインターフェース<a class="headerlink" href="#1815" title="Permanent link">&para;</a></h3>
<details>
<summary>DailyAccountBalanceRepository（Output Port）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/application/port/out/DailyAccountBalanceRepository.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.application.port.out</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.DailyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.DailyReportLine</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 日次勘定科目残高リポジトリ（Output Port）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">DailyAccountBalanceRepository</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 日次残高を保存（UPSERT）</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">upsert</span><span class="p">(</span><span class="n">DailyAccountBalance</span><span class="w"> </span><span class="n">balance</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 複合キーで検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">DailyAccountBalance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByKey</span><span class="p">(</span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 起票日で検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DailyAccountBalance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByPostingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">postingDate</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 勘定科目コードと期間で検索</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DailyAccountBalance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByAccountCodeAndDateRange</span><span class="p">(</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">fromDate</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">toDate</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 日計表データを取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DailyReportLine</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getDailyReport</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">postingDate</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 全件削除</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAll</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="1816">18.1.6 日計表の出力<a class="headerlink" href="#1816" title="Permanent link">&para;</a></h3>
<p>日計表は、特定日の全勘定科目について借方合計・貸方合計・残高を出力する帳票です。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjMxMHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjQ3cHg7aGVpZ2h0OjMxMHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY0NyAzMTAiIHdpZHRoPSI2NDdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjYwODU7JiMzNTMzNjsmIzM0OTIwOyYjMTIzOTg7JiMyNzA4MzsmIzM2ODk2OzwvdGl0bGU+PGRlZnMvPjxnPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMSI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjI3NC41MDAyIiB5PSIyMi45OTUxIj4mIzI2MDg1OyYjMzUzMzY7JiMzNDkyMDsmIzEyMzk4OyYjMjcwODM7JiMzNjg5Njs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/Pz8yMDI0PzQ/MT8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4yMDI0LjQuMS4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyNjAuNTkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2MzQiIHg9IjciIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTcwLjQ0NjgiIHg9IjIzOC43NzY2IiB5PSI1OS4yOTIiPiYjMjYwODU7JiMzNTMzNjsmIzM0OTIwOyYjNjUyODg7MjAyNCYjMjQxODA7NCYjMjYzNzY7MSYjMjYwODU7JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/Pz8/Pz8tLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLjIwMjQuNC4xLi4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMTkzLjU5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjYwIiB4PSIzMSIgeT0iODcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIxMTIuMDAwMiIgeT0iMTAyLjI5MiI+JiMyMTIwODsmIzIzNDUwOyYjMzExODU7JiMzMDQ0NjsmIzIxMDI5OyYjMzg1OTg7JiMzNTMzNjs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/Pz8tLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLjIwMjQuNC4xLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTEiIGlkPSJlbnQwMDA4Ij48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjczLjMiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIzMDIiIHg9IjMxNSIgeT0iMjA3LjU4NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iNDM4LjAwMDEiIHk9IjIyMi41ODIiPiYjMzg1OTg7JiMzNTMzNjsmIzM4OTE3OyYjMzA0NDY7PC90ZXh0PjwvZz48IS0tZW50aXR5IGMxLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLjIwMjQuNC4xLi4uLi4uLi4uLi5jMSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDcuOTk5OSIgeD0iMjI3IiB5PSIxMjIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3Ljk5OTkiIHg9IjIzNyIgeT0iMTM4LjI5MiI+JiMyOTY5NDsmIzM3MzI5OzwvdGV4dD48L2c+PCEtLWVudGl0eSBjMi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4yMDI0LjQuMS4uLi4uLi4uLi4uYzIiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDA1Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjYxLjk5OTgiIHg9IjQ3IiB5PSIxMjIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjU3IiB5PSIxMzguMjkyIj4mIzIyNzcwOyYjMjU0OTk7JiMzNzMyOTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgYzMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uMjAyNC40LjEuLi4uLi4uLi4uLmMzIiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwNiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0Ny45OTk5IiB4PSIxNDQiIHk9IjEyMi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iMTU0IiB5PSIxMzguMjkyIj4mIzIyNzcwOyYjMTk5Nzg7PC90ZXh0PjwvZz48IS0tZW50aXR5IGM0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLjIwMjQuNC4xLi4uLi4uLi4uLi5jNCIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMzMuMzUwNiIgeD0iNjEuMzIiIHk9IjI0Mi41ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMuMzUwNiIgeD0iNzEuMzIiIHk9IjI1OC41ODIiPi4uLjwvdGV4dD48L2c+PCEtLWVudGl0eSBkMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4yMDI0LjQuMS4uLi4uLi4uZDEiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3NS45OTk4IiB4PSIzMzEiIHk9IjI0Mi41ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMzQxIiB5PSIyNTguNTgyIj4mIzIwNTExOyYjMjYwNDE7JiMyMTUxMjsmIzM1MzM2OzwvdGV4dD48L2c+PCEtLWVudGl0eSBkMi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4yMDI0LjQuMS4uLi4uLi4uZDIiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAxMCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3NS45OTk4IiB4PSI0NDIiIHk9IjI0Mi41ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iNDUyIiB5PSIyNTguNTgyIj4mIzM2MDI0OyYjMjYwNDE7JiMyMTUxMjsmIzM1MzM2OzwvdGV4dD48L2c+PCEtLWVudGl0eSBkMy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4yMDI0LjQuMS4uLi4uLi4uZDMiIGRhdGEtc291cmNlLWxpbmU9IjE0IiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0Ny45OTk5IiB4PSI1NTMiIHk9IjI0Mi41ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iNTYzIiB5PSIyNTguNTgyIj4mIzI3NTMxOyYjMzk2NDA7PC90ZXh0PjwvZz48IS0tbGluayBjMSB0byBkMS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA5IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGlkPSJsbmsxMiI+PHBhdGggZD0iTTI2MS40NywxNDQuOTM2OSBDMjgzLjgxLDE2Ny4zMzY5IDMzMS42ODMsMjE1LjMyODYgMzU0LjE0MywyMzcuODQ4NiIgZmlsbD0ibm9uZSIgaWQ9ImMxLXRvLWQxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNTguMzgsMjQyLjA5NjksMzU0Ljg1NjcsMjMyLjg5OTgsMzU0Ljg0OTIsMjM4LjU1NjYsMzQ5LjE5MjMsMjM4LjU0OTEsMzU4LjM4LDI0Mi4wOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDUuNDg3MyIgeD0iMzA3LjQ2IiB5PSIxODcuNjUzOCI+NTAsMDAwPC90ZXh0PjwvZz48IS0tbGluayBjMSB0byBkMi0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEwIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGlkPSJsbmsxMyI+PHBhdGggZD0iTTI3NS40LDE0MC4xODY5IEMzMTAuMywxNDkuMTM2OSAzNzUuNTksMTY4LjY1NjkgNDI0LDE5OS41ODY5IEM0NDIuNzUsMjExLjU2NjkgNDU2Ljc2ODcsMjI1Ljg1MDUgNDY3LjA4ODcsMjM3LjU5MDUiIGZpbGw9Im5vbmUiIGlkPSJjMS10by1kMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDcxLjA1LDI0Mi4wOTY5LDQ2OC4xMTIzLDIzMi42OTY0LDQ2Ny43NDg5LDIzOC4zNDE1LDQ2Mi4xMDM3LDIzNy45NzgyLDQ3MS4wNSwyNDIuMDk2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ1LjQ4NzMiIHg9IjQwNy43OSIgeT0iMTg3LjY1MzgiPjEwLDAwMDwvdGV4dD48L2c+PCEtLWxpbmsgYzEgdG8gZDMtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNCIgZGF0YS1lbnRpdHktMj0iZW50MDAxMSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBpZD0ibG5rMTQiPjxwYXRoIGQ9Ik0yNzUuMTQsMTM0LjA0NjkgQzMyNy40MywxMzQuMzU2OSA0NTMuMDQsMTQxLjU3NjkgNTM1LDE5OS41ODY5IEM1NTEuMTMsMjExLjAwNjkgNTYxLjExMywyMjUuMTY0MSA1NjguMTgzLDIzNy4xMDQxIiBmaWxsPSJub25lIiBpZD0iYzEtdG8tZDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU3MS4yNCwyNDIuMjY2OSw1NzAuMDk2MywyMzIuNDg0Niw1NjguNjkyNSwyMzcuOTY0NSw1NjMuMjEyNiwyMzYuNTYwNyw1NzEuMjQsMjQyLjI2NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NS40ODczIiB4PSI1MjIuOTgiIHk9IjE4Ny42NTM4Ij40MCwwMDA8L3RleHQ+PC9nPjw/cGxhbnR1bWwtc3JjIE5TdXgyaTkwNDgzWEZnVE9LY2xPRjZtaWw0ajhIMElucTdHWW40OVQzVlhlTDhvVzhhNTFJMjRNNFNKQnc2d29iTFRtRDM0LXNjemMtQ1NnTXZLWU9iQ2xzZjVlbFJrc1ZCUHJrQnFJWDVoSGlGSGcyUVBZRWh3VllPOExaUHdFNmJpRzZWbi14ZWNleVJyQ2RIZHJ2LTVzN0JlLTlIdnRFdDN4dDM3cWNlZDRTN1pYdFI2OHozZW92Q0pldmkwNlJpaEFYc3oxRnBPckNLY0lPajI0dmktRlNPVWxzZjN6ckFZelA5Q0o3UDdOM3QxZGxmbEg4VllSbEJGQ1RfWC01ZmlBNVVXT0NpZmMydDJDeVlZN0NuWlpiMUdXLVBUSzhFcjUzbTAwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<details>
<summary>MyBatis Mapper XML（日計表クエリ）</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- DailyAccountBalanceMapper.xml --&gt;</span>
<span class="cm">&lt;!-- 日計表データ取得 --&gt;</span>
<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;getDailyReport&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;com.example.fas.domain.model.accounting.DailyReportLine&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT
<span class="w">        </span>d.&quot;起票日&quot;<span class="w"> </span>as<span class="w"> </span>postingDate,
<span class="w">        </span>d.&quot;勘定科目コード&quot;<span class="w"> </span>as<span class="w"> </span>accountCode,
<span class="w">        </span>a.&quot;勘定科目名&quot;<span class="w"> </span>as<span class="w"> </span>accountName,
<span class="w">        </span>a.&quot;BSPL区分&quot;<span class="w"> </span>as<span class="w"> </span>bsplType,
<span class="w">        </span>a.&quot;貸借区分&quot;<span class="w"> </span>as<span class="w"> </span>debitCreditType,
<span class="w">        </span>SUM(d.&quot;借方金額&quot;)<span class="w"> </span>as<span class="w"> </span>debitTotal,
<span class="w">        </span>SUM(d.&quot;貸方金額&quot;)<span class="w"> </span>as<span class="w"> </span>creditTotal,
<span class="w">        </span>CASE
<span class="w">            </span>WHEN<span class="w"> </span>a.&quot;貸借区分&quot;<span class="w"> </span>=<span class="w"> </span>&#39;借方&#39;<span class="w"> </span>THEN<span class="w"> </span>SUM(d.&quot;借方金額&quot;)<span class="w"> </span>-<span class="w"> </span>SUM(d.&quot;貸方金額&quot;)
<span class="w">            </span>ELSE<span class="w"> </span>SUM(d.&quot;貸方金額&quot;)<span class="w"> </span>-<span class="w"> </span>SUM(d.&quot;借方金額&quot;)
<span class="w">        </span>END<span class="w"> </span>as<span class="w"> </span>balance
<span class="w">    </span>FROM<span class="w"> </span>&quot;日次勘定科目残高&quot;<span class="w"> </span>d
<span class="w">    </span>JOIN<span class="w"> </span>&quot;勘定科目マスタ&quot;<span class="w"> </span>a<span class="w"> </span>ON<span class="w"> </span>d.&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>a.&quot;勘定科目コード&quot;
<span class="w">    </span>WHERE<span class="w"> </span>d.&quot;起票日&quot;<span class="w"> </span>=<span class="w"> </span>#{postingDate}
<span class="w">    </span>GROUP<span class="w"> </span>BY<span class="w"> </span>d.&quot;起票日&quot;,<span class="w"> </span>d.&quot;勘定科目コード&quot;,<span class="w"> </span>a.&quot;勘定科目名&quot;,<span class="w"> </span>a.&quot;BSPL区分&quot;,<span class="w"> </span>a.&quot;貸借区分&quot;
<span class="w">    </span>ORDER<span class="w"> </span>BY<span class="w"> </span>d.&quot;勘定科目コード&quot;
<span class="nt">&lt;/select&gt;</span>
</code></pre></div>

</details>

<h2 id="182">18.2 月次勘定科目残高の設計<a class="headerlink" href="#182" title="Permanent link">&para;</a></h2>
<h3 id="1821">18.2.1 月次残高テーブルの設計方針<a class="headerlink" href="#1821" title="Permanent link">&para;</a></h3>
<p>月次勘定科目残高は、日次残高を月単位で集計した結果を保持するテーブルです。決算期と月度で管理し、月初残高・当月借方・当月貸方・月末残高を保持します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjMzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MTMzN3B4O2hlaWdodDozMzRweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMzM3IDMzNCIgd2lkdGg9IjEzMzdweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjYzNzY7JiMyNzQyNTsmIzI3NTMxOyYjMzk2NDA7JiMxMjM5ODsmIzI3MDgzOyYjMzY4OTY7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iNjEyLjU2NTMiIHk9IjIyLjk5NTEiPiYjMjYzNzY7JiMyNzQyNTsmIzI3NTMxOyYjMzk2NDA7JiMxMjM5ODsmIzI3MDgzOyYjMzY4OTY7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMyIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjIyLjU5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTI5NSIgeD0iNyIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTEuOTk5NSIgeD0iNTk4LjUwMDIiIHk9IjU5LjI5MiI+JiMyNjM3NjsmIzI3NDI1OyYjMjEyMDg7JiMyMzQ1MDsmIzMxMTg1OyYjMzA0NDY7JiMyNzUzMTsmIzM5NjQwOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIxNTUuNTkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI1MzAiIHg9IjMxIiB5PSI4Ny4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjI2OC4wMDAxIiB5PSIxMDIuMjkyIj4mIzEyNDYxOyYjMTI1NDA7JiMzODkxNzsmIzMwNDQ2OzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgaWQ9ImVudDAwMTEiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNzMuMjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSI2OTMiIHg9IjU4NSIgeT0iMTY5LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iOTAzLjUwMDEiIHk9IjE4NC41OTIiPiYjMjc1MzE7JiMzOTY0MDsmIzM4OTE3OyYjMzA0NDY7PC90ZXh0PjwvZz48IS0tZW50aXR5IGsxLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLi4uLi5rMSIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA2Ljc5NTciIHg9IjQzOC42IiB5PSIxMjIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg2Ljc5NTciIHg9IjQ0OC42IiB5PSIxMzguMjkyIj4mIzI3NzcwOyYjMzE2Mzk7JiMyNjM5OTs6IDIwMjQ8L3RleHQ+PC9nPjwhLS1lbnRpdHkgazItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uLi4uLmsyIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2Ni4wNzQxIiB4PSI0Ni45NiIgeT0iMTIyLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0Ni4wNzQxIiB4PSI1Ni45NiIgeT0iMTM4LjI5MiI+JiMyNjM3NjsmIzI0MjMwOzogNDwvdGV4dD48L2c+PCEtLWVudGl0eSBrMy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLi4uLi4uazMiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDA2Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOS43MDI5IiB4PSIxNDguMTUiIHk9IjEyMi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5LjcwMjkiIHg9IjE1OC4xNSIgeT0iMTM4LjI5MiI+JiMyMTIwODsmIzIzNDUwOyYjMzExODU7JiMzMDQ0Njs6IDExMTEwPC90ZXh0PjwvZz48IS0tZW50aXR5IGs0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLi4uLi5rNCIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTAuMjE4NSIgeD0iMzEyLjg5IiB5PSIxMjIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwLjIxODUiIHg9IjMyMi44OSIgeT0iMTM4LjI5MiI+JiMzNTAzNjsmIzIxMTYxOyYjMzExODU7JiMzMDQ0Njs6IC08L3RleHQ+PC9nPjwhLS1lbnRpdHkgazUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uLi4uLms1IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBpZD0iZW50MDAwOCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDEuNzAzIiB4PSI0Ny4xNSIgeT0iMjA0LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MS43MDMiIHg9IjU3LjE1IiB5PSIyMjAuNTkyIj4mIzM3MDk2OyYjMzgyNzI7OiAxMDEwMDwvdGV4dD48L2c+PCEtLWVudGl0eSBrNi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLi4uLi4uazYiIGRhdGEtc291cmNlLWxpbmU9IjEwIiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTguMjE4NCIgeD0iMTgzLjg5IiB5PSIyMDQuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4LjIxODQiIHg9IjE5My44OSIgeT0iMjIwLjU5MiI+JiMxMjUwMzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ1NTsmIzEyNDYzOyYjMTI0ODg7OiAtPC90ZXh0PjwvZz48IS0tZW50aXR5IGs3LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLi4uLi5rNyIgZGF0YS1zb3VyY2UtbGluZT0iMTEiIGlkPSJlbnQwMDEwIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExOC40NzE0IiB4PSIzMzYuNzYiIHk9IjIwNC41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTguNDcxNCIgeD0iMzQ2Ljc2IiB5PSIyMjAuNTkyIj4mIzI3NzcwOyYjMzE2Mzk7JiMyMDE4MTsmIzM1Mzc5OzogZmFsc2U8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdjEtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uLi4uLnYxIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQzLjA2MDMiIHg9IjYwMS40NyIgeT0iMjA0LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjMuMDYwMyIgeD0iNjExLjQ3IiB5PSIyMjAuNTkyIj4mIzI2Mzc2OyYjMjEwMjE7JiMyNzUzMTsmIzM5NjQwOzogMTAwLDAwMDwvdGV4dD48L2c+PCEtLWVudGl0eSB2Mi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLi4uLi4udjIiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBpZD0iZW50MDAxMyI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzQuMTUzMSIgeD0iNzc5LjkyIiB5PSIyMDQuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNC4xNTMxIiB4PSI3ODkuOTIiIHk9IjIyMC41OTIiPiYjMjA1MTE7JiMyNjA0MTsmIzM3MzI5OyYjMzg5ODk7OiA1MCwwMDA8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdjMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uLi4uLnYzIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImVudDAwMTQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM0LjE1MzEiIHg9Ijk0OC45MiIgeT0iMjA0LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTQuMTUzMSIgeD0iOTU4LjkyIiB5PSIyMjAuNTkyIj4mIzM2MDI0OyYjMjYwNDE7JiMzNzMyOTsmIzM4OTg5OzogMjAsMDAwPC90ZXh0PjwvZz48IS0tZW50aXR5IHY0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLi4uLi52NCIgZGF0YS1zb3VyY2UtbGluZT0iMTgiIGlkPSJlbnQwMDE1Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0My4wNjAzIiB4PSIxMTE4LjQ3IiB5PSIyMDQuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMy4wNjAzIiB4PSIxMTI4LjQ3IiB5PSIyMjAuNTkyIj4mIzI2Mzc2OyYjMjY0MTE7JiMyNzUzMTsmIzM5NjQwOzogMTMwLDAwMDwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMTciIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0iZW50MDAxOCI+PHBhdGggZD0iTTEwNDkuODYsMjg2Ljg4NjkgTDEwNDkuODYsMzI3LjE1MjUgQTAsMCAwIDAgMCAxMDQ5Ljg2LDMyNy4xNTI1IEwxMzMwLjEzMDMsMzI3LjE1MjUgQTAsMCAwIDAgMCAxMzMwLjEzMDMsMzI3LjE1MjUgTDEzMzAuMTMwMywyOTYuODg2OSBMMTMyMC4xMzAzLDI4Ni44ODY5IEwxMTk0LDI4Ni44ODY5IEwxMTkwLDIyNy4zMzY5IEwxMTg2LDI4Ni44ODY5IEwxMDQ5Ljg2LDI4Ni44ODY5IEEwLDAgMCAwIDAgMTA0OS44NiwyODYuODg2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTEzMjAuMTMwMywyODYuODg2OSBMMTMyMC4xMzAzLDI5Ni44ODY5IEwxMzMwLjEzMDMsMjk2Ljg4NjkgTDEzMjAuMTMwMywyODYuODg2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjU5LjI3MDMiIHg9IjEwNTUuODYiIHk9IjMwMy45NTM4Ij4mIzI2Mzc2OyYjMjY0MTE7JiMyNzUzMTsmIzM5NjQwOyA9ICYjMjYzNzY7JiMyMTAyMTsmIzI3NTMxOyYjMzk2NDA7ICsgJiMyMDUxMTsmIzI2MDQxOyYjMzczMjk7JiMzODk4OTsgLSAmIzM2MDI0OyYjMjYwNDE7JiMzNzMyOTsmIzM4OTg5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuMDAwMSIgeD0iMTA1NS44NiIgeT0iMzE5LjA4NjYiPiYjNjUyODg7JiMyMDUxMTsmIzI2MDQxOyYjMzExODU7JiMzMDQ0NjsmIzEyMzk4OyYjMjI1ODA7JiMyMTUxMjsmIzY1Mjg5OzwvdGV4dD48L2c+PCEtLWxpbmsgazEgdG8gdjEtLT48P3BsYW50dW1sLXNyYyBQUEJESmk5MDU4TnRGQ0tETXN0STVqMmFZUnc4a2dYR2I4MWowZXFST3U5alo1TFk4V2sxUTBxRzR5NFdEVnVpNDdjUlNHUGNuSWl1RTVDU3VvcGwtVXhTUy13Q010MUI1ZjBtODR6VDRqTmVlOExFOGpBaHFNZWRhSVhSTVRVcXpuWUd2MElrak4xcUMtdExmeFNIZnZEbTk2Rjg2bzlfR1prZDM1WDhNUkVTT3lxbHVzZEs5NjdSMDV0THFxYW1BcjNLT1o0Q3lGWjEwNTdNSExhVVBPMzZaaWcxYjAxY3pvNi1VOG0xWE9qZjhMQV9KbmpMcmdUZ2drWkIyMGR2SlVHRmFKVDJOV3p2cHlXRmJqcmhWX24tVkx4Ri1jeTZ2Q3JJblVCMFVrQnV4clAtVGwwbEJhaUt0NzVqT0s1VExPTTltcFdxaGhQOXV1RVVyTWR0cWUyQ0hDSnZQd3laWVQwYjhsS3hYZUkzdlBZS1hBSVBKLVFxZzg2b2pMXzh2SW54SHpiU0pCU1RydTlUbnRNVDB0M28zMEczdjdqVzBzSnRpMEFvS3IxMGpoTGpwb1Mxcl9hcGlBLTNFLV91QWZYRnBoeTE/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="1822">18.2.2 マイグレーション<a class="headerlink" href="#1822" title="Permanent link">&para;</a></h3>
<details>
<summary>V019__create_monthly_account_balance_table.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- V019__create_monthly_account_balance_table.sql</span>

<span class="c1">-- 月次勘定科目残高テーブル</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="ss">&quot;決算期&quot;</span><span class="w">               </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;月度&quot;</span><span class="w">                 </span><span class="nb">SMALLINT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;補助科目コード&quot;</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;部門コード&quot;</span><span class="w">            </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;00000&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="w">    </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;決算仕訳フラグ&quot;</span><span class="w">        </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;月初残高&quot;</span><span class="w">             </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;借方金額&quot;</span><span class="w">             </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;貸方金額&quot;</span><span class="w">             </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;月末残高&quot;</span><span class="w">             </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;作成日時&quot;</span><span class="w">             </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;更新日時&quot;</span><span class="w">             </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="ss">&quot;決算期&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;月度&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;決算仕訳フラグ&quot;</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;勘定科目マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;部門コード&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="ss">&quot;部門マスタ&quot;</span><span class="p">(</span><span class="ss">&quot;部門コード&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">chk_month</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="ss">&quot;月度&quot;</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_monthly_balance_fiscal</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="p">(</span><span class="ss">&quot;決算期&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;月度&quot;</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_monthly_balance_account</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="p">(</span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">);</span>

<span class="c1">-- 月次残高集計関数</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">aggregate_monthly_balance</span><span class="p">(</span>
<span class="w">    </span><span class="n">p_fiscal_year</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">p_month</span><span class="w"> </span><span class="nb">SMALLINT</span><span class="p">,</span>
<span class="w">    </span><span class="n">p_from_date</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span>
<span class="w">    </span><span class="n">p_to_date</span><span class="w"> </span><span class="nb">DATE</span>
<span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">$$</span>
<span class="k">DECLARE</span>
<span class="w">    </span><span class="n">v_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">;</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="ss">&quot;決算期&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;月度&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;決算仕訳フラグ&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;月初残高&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;借方金額&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;貸方金額&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;月末残高&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="n">p_fiscal_year</span><span class="p">,</span>
<span class="w">        </span><span class="n">p_month</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;決算仕訳フラグ&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="p">,</span><span class="w">  </span><span class="c1">-- 月初残高は繰越処理で設定</span>
<span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="ss">&quot;借方金額&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="ss">&quot;貸方金額&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="ss">&quot;借方金額&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="ss">&quot;貸方金額&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">-- 暫定月末残高</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="ss">&quot;起票日&quot;</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">p_from_date</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">p_to_date</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;決算仕訳フラグ&quot;</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="ss">&quot;決算期&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;月度&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;勘定科目コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;補助科目コード&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;部門コード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;プロジェクトコード&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;決算仕訳フラグ&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span>
<span class="w">        </span><span class="ss">&quot;借方金額&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXCLUDED</span><span class="p">.</span><span class="ss">&quot;借方金額&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;貸方金額&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXCLUDED</span><span class="p">.</span><span class="ss">&quot;貸方金額&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;月末残高&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="p">.</span><span class="ss">&quot;月初残高&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                    </span><span class="n">EXCLUDED</span><span class="p">.</span><span class="ss">&quot;借方金額&quot;</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">EXCLUDED</span><span class="p">.</span><span class="ss">&quot;貸方金額&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="ss">&quot;更新日時&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">;</span>

<span class="w">    </span><span class="k">GET</span><span class="w"> </span><span class="k">DIAGNOSTICS</span><span class="w"> </span><span class="n">v_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ROW_COUNT</span><span class="p">;</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">v_count</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="err">$$</span><span class="w"> </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span>

<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;日次残高を月単位で集計した残高テーブル&#39;</span><span class="p">;</span>
</code></pre></div>

</details>

<h3 id="1823">18.2.3 ドメインモデル<a class="headerlink" href="#1823" title="Permanent link">&para;</a></h3>
<details>
<summary>MonthlyAccountBalance エンティティ</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/accounting/MonthlyAccountBalance.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 月次勘定科目残高エンティティ</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MonthlyAccountBalance</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">;</span><span class="w">              </span><span class="c1">// 決算期</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">;</span><span class="w">                   </span><span class="c1">// 月度</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">subAccountCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 補助科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">departmentCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 部門コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">projectCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// プロジェクトコード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">closingJournalFlag</span><span class="p">;</span><span class="w">      </span><span class="c1">// 決算仕訳フラグ</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">openingBalance</span><span class="p">;</span><span class="w">       </span><span class="c1">// 月初残高</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w">          </span><span class="c1">// 借方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w">         </span><span class="c1">// 貸方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">closingBalance</span><span class="p">;</span><span class="w">       </span><span class="c1">// 月末残高</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 作成日時</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 更新日時</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 複合主キークラス</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Data</span>
<span class="w">    </span><span class="nd">@Builder</span>
<span class="w">    </span><span class="nd">@NoArgsConstructor</span>
<span class="w">    </span><span class="nd">@AllArgsConstructor</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Key</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">subAccountCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">departmentCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">projectCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">closingJournalFlag</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 月末残高を再計算する</span>
<span class="cm">     * 借方科目の場合: 月初残高 + 借方金額 - 貸方金額</span>
<span class="cm">     * 貸方科目の場合: 月初残高 - 借方金額 + 貸方金額</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">recalculateClosingBalance</span><span class="p">(</span><span class="n">DebitCreditType</span><span class="w"> </span><span class="n">accountType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">accountType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DebitCreditType</span><span class="p">.</span><span class="na">DEBIT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">openingBalance</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">debitAmount</span><span class="p">).</span><span class="na">subtract</span><span class="p">(</span><span class="n">creditAmount</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">openingBalance</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">debitAmount</span><span class="p">).</span><span class="na">add</span><span class="p">(</span><span class="n">creditAmount</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 当月の増減額を取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getNetChange</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">closingBalance</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">openingBalance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>TrialBalanceLine（合計残高試算表行）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/domain/model/accounting/TrialBalanceLine.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 合計残高試算表の1行を表すDTO</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TrialBalanceLine</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">;</span><span class="w">              </span><span class="c1">// 決算期</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">;</span><span class="w">                   </span><span class="c1">// 月度</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountName</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目名</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">bsplType</span><span class="p">;</span><span class="w">                 </span><span class="c1">// BSPL区分</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">debitCreditType</span><span class="p">;</span><span class="w">          </span><span class="c1">// 貸借区分</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">openingBalance</span><span class="p">;</span><span class="w">       </span><span class="c1">// 月初残高</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitTotal</span><span class="p">;</span><span class="w">           </span><span class="c1">// 借方合計</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditTotal</span><span class="p">;</span><span class="w">          </span><span class="c1">// 貸方合計</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">closingBalance</span><span class="p">;</span><span class="w">       </span><span class="c1">// 月末残高</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 累計残高を取得する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getCumulativeBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">closingBalance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 当月増減を取得する</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="nf">getMonthlyChange</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">closingBalance</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">openingBalance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="1824">18.2.4 リポジトリインターフェース<a class="headerlink" href="#1824" title="Permanent link">&para;</a></h3>
<details>
<summary>MonthlyAccountBalanceRepository（Output Port）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/application/port/out/MonthlyAccountBalanceRepository.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.application.port.out</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.MonthlyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.TrialBalanceLine</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 月次勘定科目残高リポジトリ（Output Port）</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">MonthlyAccountBalanceRepository</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">MonthlyAccountBalance</span><span class="w"> </span><span class="n">balance</span><span class="p">);</span>

<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">MonthlyAccountBalance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByKey</span><span class="p">(</span><span class="n">MonthlyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MonthlyAccountBalance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByFiscalYearAndMonth</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">);</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MonthlyAccountBalance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByAccountCode</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 合計残高試算表データを取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">TrialBalanceLine</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getTrialBalance</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * BSPL区分別試算表データを取得</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">TrialBalanceLine</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getTrialBalanceByBSPL</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">bsplType</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 日次残高から月次残高を集計</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">aggregateFromDaily</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">fromDate</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">toDate</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 月次残高の繰越処理</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">carryForward</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">fromMonth</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">toMonth</span><span class="p">);</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAll</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="1825">18.2.5 合計残高試算表の出力<a class="headerlink" href="#1825" title="Permanent link">&para;</a></h3>
<p>合計残高試算表は、月次残高を勘定科目別に集計し、月初残高・借方合計・貸方合計・月末残高を出力する帳票です。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjM0OXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NTA4cHg7aGVpZ2h0OjM0OXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDUwOCAzNDkiIHdpZHRoPSI1MDhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjE1MTI7JiMzNTMzNjsmIzI3NTMxOyYjMzk2NDA7JiMzNTQzMDsmIzMxNjM5OyYjMzQ5MjA7JiMxMjM5ODsmIzI3MDgzOyYjMzY4OTY7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM5Ljk5OTQiIHg9IjE3Ny4wMDAzIiB5PSIyMi45OTUxIj4mIzIxNTEyOyYjMzUzMzY7JiMyNzUzMTsmIzM5NjQwOyYjMzU0MzA7JiMzMTYzOTsmIzM0OTIwOyYjMTIzOTg7JiMyNzA4MzsmIzM2ODk2OzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Pz8/Pz8yMDI0PzQ/Pz8tLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4yMDI0LjQuLi4iIGRhdGEtc291cmNlLWxpbmU9IjMiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjIzNy41OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjQ5NSIgeD0iNyIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMTYuNzA1MyIgeD0iMTQ2LjE0NzMiIHk9IjU5LjI5MiI+JiMyMTUxMjsmIzM1MzM2OyYjMjc1MzE7JiMzOTY0MDsmIzM1NDMwOyYjMzE2Mzk7JiMzNDkyMDsmIzY1Mjg4OzIwMjQmIzI0MTgwOzQmIzI2Mzc2OyYjMjQyMzA7JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/Pz8/P0JTPz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uMjAyNC40Li4uLi4uLi4uLkJTLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMyI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI3My4zIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMjYwIiB4PSIzMSIgeT0iODcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDYuNzUzNCIgeD0iODcuNjIzMyIgeT0iMTAyLjI5MiI+JiMzNjAyNDsmIzIwNTExOyYjMjM1NTA7JiMyOTAzMTsmIzM0OTIwOyYjNjUyODg7QlMmIzY1Mjg5OyYjMzExODU7JiMzMDQ0Njs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/Pz8/P1BMPz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uMjAyNC40Li4uLi4uLi4uLlBMLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxMCIgaWQ9ImVudDAwMDciPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNzMuMyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjE2MyIgeD0iMzE1IiB5PSI4Ny4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NS4xODExIiB4PSIzMjMuOTA5NSIgeT0iMTAyLjI5MiI+JiMyNTYxMzsmIzMwNDEwOyYjMzUzMzY7JiMzMTYzOTsmIzI2MzYwOyYjNjUyODg7UEwmIzY1Mjg5OyYjMzExODU7JiMzMDQ0Njs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uMjAyNC40Li4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTAiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iNzMuMjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxODQiIHg9IjE1MiIgeT0iMTg0LjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iMjMwLjAwMDEiIHk9IjE5OS41OTIiPiYjMzg1OTg7JiMzNTMzNjs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgYXNzZXQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLjIwMjQuNC4uLi4uLi4uLi5CUy4uLi5hc3NldCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDcuOTk5OSIgeD0iNDciIHk9IjEyMi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iNTciIHk9IjEzOC4yOTIiPiYjMzYwMzk7JiMyOTk4Nzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbGlhYmlsaXR5LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4yMDI0LjQuLi4uLi4uLi4uQlMuLi4ubGlhYmlsaXR5IiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0Ny45OTk5IiB4PSIxMzAiIHk9IjEyMi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iMTQwIiB5PSIxMzguMjkyIj4mIzM2MDAwOyYjMjA2NjE7PC90ZXh0PjwvZz48IS0tZW50aXR5IGVxdWl0eS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uMjAyNC40Li4uLi4uLi4uLkJTLi4uLmVxdWl0eSIgZGF0YS1zb3VyY2UtbGluZT0iNyIgaWQ9ImVudDAwMDYiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjEuOTk5OCIgeD0iMjEzIiB5PSIxMjIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjIyMyIgeT0iMTM4LjI5MiI+JiMzMjAyMDsmIzM2MDM5OyYjMjk5ODc7PC90ZXh0PjwvZz48IS0tZW50aXR5IHJldmVudWUtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLjIwMjQuNC4uLi4uLi4uLi5QTC4uLi5yZXZlbnVlIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgaWQ9ImVudDAwMDgiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNDcuOTk5OSIgeD0iMzMxIiB5PSIxMjIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3Ljk5OTkiIHg9IjM0MSIgeT0iMTM4LjI5MiI+JiMyMTQ1NDsmIzMwNDEwOzwvdGV4dD48L2c+PCEtLWVudGl0eSBleHBlbnNlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4yMDI0LjQuLi4uLi4uLi4uUEwuLi4uZXhwZW5zZSIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGlkPSJlbnQwMDA5Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ3Ljk5OTkiIHg9IjQxNCIgeT0iMTIyLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNy45OTk5IiB4PSI0MjQiIHk9IjEzOC4yOTIiPiYjMzYwMjc7JiMyOTk5Mjs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgdG90YWwtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLjIwMjQuNC4uLi4uLi50b3RhbCIgZGF0YS1zb3VyY2UtbGluZT0iMTYiIGlkPSJlbnQwMDExIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1Mi42MzA0IiB4PSIxNjcuNjgiIHk9IjIxOS41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTMyLjYzMDQiIHg9IjE3Ny42OCIgeT0iMjM1LjU5MiI+JiMyMDUxMTsmIzI2MDQxOyYjMjE1MTI7JiMzNTMzNjsgPSAmIzM2MDI0OyYjMjYwNDE7JiMyMTUxMjsmIzM1MzM2OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01OMTciIGRhdGEtc291cmNlLWxpbmU9IjI2IiBpZD0iZW50MDAxOCI+PHBhdGggZD0iTTE4MS41LDMwMS44ODY5IEwxODEuNSwzNDIuMTUyNSBBMCwwIDAgMCAwIDE4MS41LDM0Mi4xNTI1IEwzMDYuNTAwMSwzNDIuMTUyNSBBMCwwIDAgMCAwIDMwNi41MDAxLDM0Mi4xNTI1IEwzMDYuNTAwMSwzMTEuODg2OSBMMjk2LjUwMDEsMzAxLjg4NjkgTDI0OCwzMDEuODg2OSBMMjQ0LDI0Mi4zMzY5IEwyNDAsMzAxLjg4NjkgTDE4MS41LDMwMS44ODY5IEEwLDAgMCAwIDAgMTgxLjUsMzAxLjg4NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yOTYuNTAwMSwzMDEuODg2OSBMMjk2LjUwMDEsMzExLjg4NjkgTDMwNi41MDAxLDMxMS44ODY5IEwyOTYuNTAwMSwzMDEuODg2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMTg3LjUiIHk9IjMxOC45NTM4Ij4mIzM2MDI0OyYjMjA1MTE7JiMxOTk2ODsmIzMzMjY4OyYjMTIzOTg7JiMyMTQwNzsmIzIxMDYzOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQuMDAwMSIgeD0iMTg3LjUiIHk9IjMzNC4wODY2Ij4mIzY1Mjg4OyYjMzU0MzA7JiMzMTYzOTsmIzM0OTIwOyYjMTIzOTg7JiMyNjkwODsmIzM1Mzg4OyYjNjUyODk7PC90ZXh0PjwvZz48IS0tbGluayBhc3NldCB0byB0b3RhbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjAiIGlkPSJsbmsxMiI+PHBhdGggZD0iTTgyLjE5LDE0NC44MjY5IEM5MC4zMywxNTIuMDQ2OSAxMDEuODUsMTYxLjYwNjkgMTEzLDE2OC41OTY5IEMxNDYuODIsMTg5Ljc3NjkgMTgzLjU5MywyMDUuOTk5IDIxMC44MzMsMjE2Ljk0OSIgZmlsbD0ibm9uZSIgaWQ9ImFzc2V0LXRvLXRvdGFsIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTYuNCwyMTkuMTg2OSwyMDkuNTQxMywyMTIuMTE4NywyMTEuNzYwOCwyMTcuMzIyLDIwNi41NTc1LDIxOS41NDE1LDIxNi40LDIxOS4xODY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIGxpYWJpbGl0eSB0byB0b3RhbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA1IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjEiIGlkPSJsbmsxMyI+PHBhdGggZD0iTTE2My45OCwxNDUuMDA2OSBDMTgxLjI4LDE2My4zMjY5IDIxMi41MzAzLDE5Ni40MjQ3IDIyOS44NjAzLDIxNC43NzQ3IiBmaWxsPSJub25lIiBpZD0ibGlhYmlsaXR5LXRvLXRvdGFsIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMzMuOTgsMjE5LjEzNjksMjMwLjcwODYsMjA5Ljg0NzIsMjMwLjU0NjksMjE1LjUwMTgsMjI0Ljg5MjQsMjE1LjM0MDEsMjMzLjk4LDIxOS4xMzY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIGVxdWl0eSB0byB0b3RhbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA2IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjIiIGlkPSJsbmsxNCI+PHBhdGggZD0iTTI0NCwxNDUuMDA2OSBDMjQ0LDE2My4zMjY5IDI0NCwxOTQuNzg2OSAyNDQsMjEzLjEzNjkiIGZpbGw9Im5vbmUiIGlkPSJlcXVpdHktdG8tdG90YWwiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI0NCwyMTkuMTM2OSwyNDgsMjEwLjEzNjksMjQ0LDIxNC4xMzY5LDI0MCwyMTAuMTM2OSwyNDQsMjE5LjEzNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgcmV2ZW51ZSB0byB0b3RhbC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjMiIGlkPSJsbmsxNSI+PHBhdGggZD0iTTM0Mi43LDE0NS4wMDY5IEMzMjEuMzYsMTYzLjMyNjkgMjgyLjI4MjEsMTk2Ljg3ODEgMjYwLjkxMjEsMjE1LjIyODEiIGZpbGw9Im5vbmUiIGlkPSJyZXZlbnVlLXRvLXRvdGFsIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNTYuMzYsMjE5LjEzNjksMjY1Ljc5NCwyMTYuMzA4NCwyNjAuMTUzNCwyMTUuODc5NiwyNjAuNTgyMywyMTAuMjM5LDI1Ni4zNiwyMTkuMTM2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBleHBlbnNlIHRvIHRvdGFsLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDkiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyNCIgaWQ9ImxuazE2Ij48cGF0aCBkPSJNNDI2LjkzLDE0NS4wMDY5IEM0MTguODMsMTUyLjMyNjkgNDA3LjMzLDE2MS45MTY5IDM5NiwxNjguNTk2OSBDMzU4LjAyLDE5MC45NzY5IDMxNi4wMDc1LDIwNi43OTU3IDI4NC4yNjc1LDIxNy4yNzU3IiBmaWxsPSJub25lIiBpZD0iZXhwZW5zZS10by10b3RhbCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjc4LjU3LDIxOS4xNTY5LDI4OC4zNzAzLDIyMC4xMzM0LDI4My4zMTc5LDIxNy41ODkyLDI4NS44NjIxLDIxMi41MzY4LDI3OC41NywyMTkuMTU2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48P3BsYW50dW1sLXNyYyBSTDcxSWlEMDRCdGRBdlJTMnI5dzRsSldzT0ZXcktqUUxtZDRIOUVqQTI5NEdQalFoMU1BMlljYU9jYVlHZUhROFROV3AtWGNxckRfbU1jc1hncUt6aDlsdGhwdFBlUWVIQ0U4amZtcVM5QW1DTnZ2STlfeEJCbkY3dUZsaXAzbjZzRXhBcWFjaFgxNXRtTWNsOTB3WVB0WUtoNTRIeURJcWQ3ZUh0eUlyc0xxOGxRYld1WlE3ZHR6T1hTLXhyWlIxMVJwUnZhUkpoYUxuVG02c2JrRGpQemFmNVptQjRwLXU0Nk5kaHpkaUFPZ1BMTEpvVjZpbjhQamVHYVZMQVVicXhkQ0lVa1FrTFNHNno4Y1JXSlU2LWlCbEViRDRzWVBaOGFGaUx4NWtWaWRRbVRTX3NXVnduUi1QcDFzQnE1VEtCQXp2Nng0THVMTTRDb1VWcENMT1gxNTBtckdvUVA0WFNCZzNDcDc0cDAtYjAzQ3VlYUtkYWowOURxVzY5S0RHZW16UEVubTUycVpWZVlWbzR2aEdwV25STmdxTmpsSU9JYnBiLXpycVkyNjlWcTI/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<details>
<summary>MyBatis Mapper XML（合計残高試算表クエリ）</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- MonthlyAccountBalanceMapper.xml --&gt;</span>
<span class="cm">&lt;!-- 合計残高試算表データ取得 --&gt;</span>
<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;getTrialBalance&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;com.example.fas.domain.model.accounting.TrialBalanceLine&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT
<span class="w">        </span>m.&quot;決算期&quot;<span class="w"> </span>as<span class="w"> </span>fiscalYear,
<span class="w">        </span>m.&quot;月度&quot;<span class="w"> </span>as<span class="w"> </span>month,
<span class="w">        </span>m.&quot;勘定科目コード&quot;<span class="w"> </span>as<span class="w"> </span>accountCode,
<span class="w">        </span>a.&quot;勘定科目名&quot;<span class="w"> </span>as<span class="w"> </span>accountName,
<span class="w">        </span>a.&quot;BSPL区分&quot;<span class="w"> </span>as<span class="w"> </span>bsplType,
<span class="w">        </span>a.&quot;貸借区分&quot;<span class="w"> </span>as<span class="w"> </span>debitCreditType,
<span class="w">        </span>SUM(m.&quot;月初残高&quot;)<span class="w"> </span>as<span class="w"> </span>openingBalance,
<span class="w">        </span>SUM(m.&quot;借方金額&quot;)<span class="w"> </span>as<span class="w"> </span>debitTotal,
<span class="w">        </span>SUM(m.&quot;貸方金額&quot;)<span class="w"> </span>as<span class="w"> </span>creditTotal,
<span class="w">        </span>SUM(m.&quot;月末残高&quot;)<span class="w"> </span>as<span class="w"> </span>closingBalance
<span class="w">    </span>FROM<span class="w"> </span>&quot;月次勘定科目残高&quot;<span class="w"> </span>m
<span class="w">    </span>JOIN<span class="w"> </span>&quot;勘定科目マスタ&quot;<span class="w"> </span>a<span class="w"> </span>ON<span class="w"> </span>m.&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>a.&quot;勘定科目コード&quot;
<span class="w">    </span>WHERE<span class="w"> </span>m.&quot;決算期&quot;<span class="w"> </span>=<span class="w"> </span>#{fiscalYear}<span class="w"> </span>AND<span class="w"> </span>m.&quot;月度&quot;<span class="w"> </span>=<span class="w"> </span>#{month}
<span class="w">    </span>GROUP<span class="w"> </span>BY<span class="w"> </span>m.&quot;決算期&quot;,<span class="w"> </span>m.&quot;月度&quot;,<span class="w"> </span>m.&quot;勘定科目コード&quot;,
<span class="w">             </span>a.&quot;勘定科目名&quot;,<span class="w"> </span>a.&quot;BSPL区分&quot;,<span class="w"> </span>a.&quot;貸借区分&quot;
<span class="w">    </span>ORDER<span class="w"> </span>BY<span class="w"> </span>m.&quot;勘定科目コード&quot;
<span class="nt">&lt;/select&gt;</span>

<span class="cm">&lt;!-- BSPL区分別試算表データ取得 --&gt;</span>
<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;getTrialBalanceByBSPL&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;com.example.fas.domain.model.accounting.TrialBalanceLine&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT
<span class="w">        </span>m.&quot;決算期&quot;<span class="w"> </span>as<span class="w"> </span>fiscalYear,
<span class="w">        </span>m.&quot;月度&quot;<span class="w"> </span>as<span class="w"> </span>month,
<span class="w">        </span>m.&quot;勘定科目コード&quot;<span class="w"> </span>as<span class="w"> </span>accountCode,
<span class="w">        </span>a.&quot;勘定科目名&quot;<span class="w"> </span>as<span class="w"> </span>accountName,
<span class="w">        </span>a.&quot;BSPL区分&quot;<span class="w"> </span>as<span class="w"> </span>bsplType,
<span class="w">        </span>a.&quot;貸借区分&quot;<span class="w"> </span>as<span class="w"> </span>debitCreditType,
<span class="w">        </span>SUM(m.&quot;月初残高&quot;)<span class="w"> </span>as<span class="w"> </span>openingBalance,
<span class="w">        </span>SUM(m.&quot;借方金額&quot;)<span class="w"> </span>as<span class="w"> </span>debitTotal,
<span class="w">        </span>SUM(m.&quot;貸方金額&quot;)<span class="w"> </span>as<span class="w"> </span>creditTotal,
<span class="w">        </span>SUM(m.&quot;月末残高&quot;)<span class="w"> </span>as<span class="w"> </span>closingBalance
<span class="w">    </span>FROM<span class="w"> </span>&quot;月次勘定科目残高&quot;<span class="w"> </span>m
<span class="w">    </span>JOIN<span class="w"> </span>&quot;勘定科目マスタ&quot;<span class="w"> </span>a<span class="w"> </span>ON<span class="w"> </span>m.&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>a.&quot;勘定科目コード&quot;
<span class="w">    </span>WHERE<span class="w"> </span>m.&quot;決算期&quot;<span class="w"> </span>=<span class="w"> </span>#{fiscalYear}
<span class="w">      </span>AND<span class="w"> </span>m.&quot;月度&quot;<span class="w"> </span>=<span class="w"> </span>#{month}
<span class="w">      </span>AND<span class="w"> </span>a.&quot;BSPL区分&quot;<span class="w"> </span>=<span class="w"> </span>#{bsplType}
<span class="w">    </span>GROUP<span class="w"> </span>BY<span class="w"> </span>m.&quot;決算期&quot;,<span class="w"> </span>m.&quot;月度&quot;,<span class="w"> </span>m.&quot;勘定科目コード&quot;,
<span class="w">             </span>a.&quot;勘定科目名&quot;,<span class="w"> </span>a.&quot;BSPL区分&quot;,<span class="w"> </span>a.&quot;貸借区分&quot;
<span class="w">    </span>ORDER<span class="w"> </span>BY<span class="w"> </span>m.&quot;勘定科目コード&quot;
<span class="nt">&lt;/select&gt;</span>
</code></pre></div>

</details>

<h3 id="1826">18.2.6 月次残高の繰越処理<a class="headerlink" href="#1826" title="Permanent link">&para;</a></h3>
<p>月次残高の繰越処理は、前月末残高を翌月初残高として設定する処理です。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjMzNHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjUzcHg7aGVpZ2h0OjMzNHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY1MyAzMzQiIHdpZHRoPSI2NTNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjYzNzY7JiMyNzQyNTsmIzI3NTMxOyYjMzk2NDA7JiMxMjM5ODsmIzMyMzY4OyYjMzYyMzQ7JiMyMDk2NjsmIzI5NzAyOzwvdGl0bGU+PGRlZnMvPjxnPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMSI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSIyNTYuNzUwNCIgeT0iMjIuOTk1MSI+JiMyNjM3NjsmIzI3NDI1OyYjMjc1MzE7JiMzOTY0MDsmIzEyMzk4OyYjMzIzNjg7JiMzNjIzNDsmIzIwOTY2OyYjMjk3MDI7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA0Pz8tLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iNC4uIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSI3My4zIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTc2IiB4PSI3IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM3Ljc0MTEiIHg9Ijc2LjEyOTUiIHk9IjU5LjI5MiI+NCYjMjYzNzY7JiMyNjQxMTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIDU/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSI1Li4iIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDA0Ij48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjczLjI5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iNjEzIiB4PSI3IiB5PSIxNjYuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNy43NDExIiB4PSIyOTQuNjI5NSIgeT0iMTgxLjU5MiI+NSYjMjYzNzY7JiMyMTAyMTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgYXByX2Nsb3NpbmctLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSI0Li4uYXByX2Nsb3NpbmciIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0My4wNjAzIiB4PSIyMy40NyIgeT0iNzkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMy4wNjAzIiB4PSIzMy40NyIgeT0iOTUuMjkyIj4mIzI2Mzc2OyYjMjY0MTE7JiMyNzUzMTsmIzM5NjQwOzogMTMwLDAwMDwvdGV4dD48L2c+PCEtLWVudGl0eSBtYXlfb3BlbmluZy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IjUuLi5tYXlfb3BlbmluZyIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQzLjA2MDMiIHg9IjIzLjQ3IiB5PSIyMDEuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMy4wNjAzIiB4PSIzMy40NyIgeT0iMjE3LjU5MiI+JiMyNjM3NjsmIzIxMDIxOyYjMjc1MzE7JiMzOTY0MDs6IDEzMCwwMDA8L3RleHQ+PC9nPjwhLS1lbnRpdHkgbWF5X2RlYml0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iNS4uLm1heV9kZWJpdCIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImVudDAwMDYiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjIuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTQuMDc0IiB4PSIyMDEuOTYiIHk9IjIwMS41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzQuMDc0IiB4PSIyMTEuOTYiIHk9IjIxNy41OTIiPiYjMjA1MTE7JiMyNjA0MTsmIzM3MzI5OyYjMzg5ODk7OiAwPC90ZXh0PjwvZz48IS0tZW50aXR5IG1heV9jcmVkaXQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSI1Li4ubWF5X2NyZWRpdCIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGlkPSJlbnQwMDA3Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijk0LjA3NCIgeD0iMzMwLjk2IiB5PSIyMDEuNTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc0LjA3NCIgeD0iMzQwLjk2IiB5PSIyMTcuNTkyIj4mIzM2MDI0OyYjMjYwNDE7JiMzNzMyOTsmIzM4OTg5OzogMDwvdGV4dD48L2c+PCEtLWVudGl0eSBtYXlfY2xvc2luZy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IjUuLi5tYXlfY2xvc2luZyIgZGF0YS1zb3VyY2UtbGluZT0iMTEiIGlkPSJlbnQwMDA4Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjIyLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0My4wNjAzIiB4PSI0NjAuNDciIHk9IjIwMS41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIzLjA2MDMiIHg9IjQ3MC40NyIgeT0iMjE3LjU5MiI+JiMyNjM3NjsmIzI2NDExOyYjMjc1MzE7JiMzOTY0MDs6IDEzMCwwMDA8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjEwIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgaWQ9ImVudDAwMTEiPjxwYXRoIGQ9Ik00MTcuNSwyODYuODg2OSBMNDE3LjUsMzI3LjE1MjUgQTAsMCAwIDAgMCA0MTcuNSwzMjcuMTUyNSBMNjQ2LjUwMDIsMzI3LjE1MjUgQTAsMCAwIDAgMCA2NDYuNTAwMiwzMjcuMTUyNSBMNjQ2LjUwMDIsMjk2Ljg4NjkgTDYzNi41MDAyLDI4Ni44ODY5IEw1MzYsMjg2Ljg4NjkgTDUzMiwyMjQuMzI2OSBMNTI4LDI4Ni44ODY5IEw0MTcuNSwyODYuODg2OSBBMCwwIDAgMCAwIDQxNy41LDI4Ni44ODY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNjM2LjUwMDIsMjg2Ljg4NjkgTDYzNi41MDAyLDI5Ni44ODY5IEw2NDYuNTAwMiwyOTYuODg2OSBMNjM2LjUwMDIsMjg2Ljg4NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MS4yNzEyIiB4PSI0MjMuNSIgeT0iMzAzLjk1MzgiPjUmIzI2Mzc2OyYjMTIzOTg7JiMyMDE4MTsmIzM1Mzc5OyYjMTIzNjQ7JiMyMDgzNzsmIzIxMTQ3OyYjMTIzNzM7JiMxMjQyODsmIzEyNDI3OyYjMTIzOTI7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwOC4wMDAyIiB4PSI0MjMuNSIgeT0iMzE5LjA4NjYiPiYjMjA1MTE7JiMyNjA0MTsmIzEyNTM5OyYjMzYwMjQ7JiMyNjA0MTsmIzEyNTM5OyYjMjYzNzY7JiMyNjQxMTsmIzI3NTMxOyYjMzk2NDA7JiMxMjM2NDsmIzI2MzU2OyYjMjYwMzI7JiMxMjM3MzsmIzEyNDI4OyYjMTI0Mjc7PC90ZXh0PjwvZz48IS0tbGluayBhcHJfY2xvc2luZyB0byBtYXlfb3BlbmluZy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJsbms5Ij48cGF0aCBkPSJNOTUsMTAxLjcwNjkgQzk1LDEyNC4zMTY5IDk1LDE3Mi4yNjY5IDk1LDE5NS4xNjY5IiBmaWxsPSJub25lIiBpZD0iYXByX2Nsb3NpbmctdG8tbWF5X29wZW5pbmciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk1LDIwMS4xNjY5LDk5LDE5Mi4xNjY5LDk1LDE5Ni4xNjY5LDkxLDE5Mi4xNjY5LDk1LDIwMS4xNjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iOTYiIHk9IjE0Ni42NjM4Ij4mIzMyMzY4OyYjMzYyMzQ7JiMyMDk2NjsmIzI5NzAyOzwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgQXlhaW9LYkxVM1FkdXpjUVhTX01UUnpTRlVEbnV4aGRFcFV5c0RScmo3dFB5bWJqTjVuNWdTYWJZTmRmRzZMQTlZMjVTck9oQUxIcDlJU01mSVdlR1ZXR1pMT0FYaU82RVdPNjFhZUFZU0tBWUdMNXlTYXYtU01QVVViU2pJWTZjMDhyRlVzT1lzODhhOF9EYURwNG9sWnlXakd5YTI0R2pLeVJ2Wi1SamxEYi15SU4ydGtqNTEyZ0tiQUpDYWtXUWJ2aXNlNUxKTjlIUVdmUzRNd05XdktZTjh4YTRHTFROSmphRG9iT0FRMDZMTHYtSVFmMktkdjlJTndrR2R1UWlhYjBmSTFfMG1GdG9Vd2ZCclBpVmpwT3l4SHJ3VEVrc095UmZwdmt3ZGRTckZzdVNLTEM3aUh4WnZqdEdfbTBQMjJ4NHdaZnNVbWpwd1BqVzZpMjAwMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<details>
<summary>繰越処理のSQL</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 月次残高の繰越処理 --&gt;</span>
<span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;carryForward&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>&quot;月次勘定科目残高&quot;<span class="w"> </span>(
<span class="w">        </span>&quot;決算期&quot;,<span class="w"> </span>&quot;月度&quot;,<span class="w"> </span>&quot;勘定科目コード&quot;,<span class="w"> </span>&quot;補助科目コード&quot;,
<span class="w">        </span>&quot;部門コード&quot;,<span class="w"> </span>&quot;プロジェクトコード&quot;,<span class="w"> </span>&quot;決算仕訳フラグ&quot;,
<span class="w">        </span>&quot;月初残高&quot;,<span class="w"> </span>&quot;借方金額&quot;,<span class="w"> </span>&quot;貸方金額&quot;,<span class="w"> </span>&quot;月末残高&quot;,
<span class="w">        </span>&quot;作成日時&quot;,<span class="w"> </span>&quot;更新日時&quot;
<span class="w">    </span>)
<span class="w">    </span>SELECT
<span class="w">        </span>&quot;決算期&quot;,
<span class="w">        </span>#{toMonth},
<span class="w">        </span>&quot;勘定科目コード&quot;,
<span class="w">        </span>&quot;補助科目コード&quot;,
<span class="w">        </span>&quot;部門コード&quot;,
<span class="w">        </span>&quot;プロジェクトコード&quot;,
<span class="w">        </span>&quot;決算仕訳フラグ&quot;,
<span class="w">        </span>&quot;月末残高&quot;,<span class="w">  </span>--<span class="w"> </span>前月末残高を月初残高に
<span class="w">        </span>0,
<span class="w">        </span>0,
<span class="w">        </span>&quot;月末残高&quot;,<span class="w">  </span>--<span class="w"> </span>暫定で前月末残高
<span class="w">        </span>CURRENT_TIMESTAMP,
<span class="w">        </span>CURRENT_TIMESTAMP
<span class="w">    </span>FROM<span class="w"> </span>&quot;月次勘定科目残高&quot;
<span class="w">    </span>WHERE<span class="w"> </span>&quot;決算期&quot;<span class="w"> </span>=<span class="w"> </span>#{fiscalYear}
<span class="w">      </span>AND<span class="w"> </span>&quot;月度&quot;<span class="w"> </span>=<span class="w"> </span>#{fromMonth}
<span class="w">    </span>ON<span class="w"> </span>CONFLICT<span class="w"> </span>(
<span class="w">        </span>&quot;決算期&quot;,<span class="w"> </span>&quot;月度&quot;,<span class="w"> </span>&quot;勘定科目コード&quot;,<span class="w"> </span>&quot;補助科目コード&quot;,
<span class="w">        </span>&quot;部門コード&quot;,<span class="w"> </span>&quot;プロジェクトコード&quot;,<span class="w"> </span>&quot;決算仕訳フラグ&quot;
<span class="w">    </span>)
<span class="w">    </span>DO<span class="w"> </span>UPDATE<span class="w"> </span>SET
<span class="w">        </span>&quot;月初残高&quot;<span class="w"> </span>=<span class="w"> </span>EXCLUDED.&quot;月初残高&quot;,
<span class="w">        </span>&quot;更新日時&quot;<span class="w"> </span>=<span class="w"> </span>CURRENT_TIMESTAMP
<span class="nt">&lt;/insert&gt;</span>
</code></pre></div>

</details>

<h2 id="183">18.3 残高更新のタイミング<a class="headerlink" href="#183" title="Permanent link">&para;</a></h2>
<h3 id="1831">18.3.1 更新方式の選択<a class="headerlink" href="#1831" title="Permanent link">&para;</a></h3>
<p>残高更新には2つの方式があります。</p>
<table>
<thead>
<tr>
<th>方式</th>
<th>特徴</th>
<th>適用シーン</th>
</tr>
</thead>
<tbody>
<tr>
<td>即時更新</td>
<td>仕訳入力時にリアルタイムで残高を更新</td>
<td>残高をすぐに確認したい場合</td>
</tr>
<tr>
<td>バッチ処理</td>
<td>月末などのタイミングで一括集計</td>
<td>大量データの処理効率を重視する場合</td>
</tr>
</tbody>
</table>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjM2NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzIzcHg7aGVpZ2h0OjM2NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyMyAzNjQiIHdpZHRoPSIzMjNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjc1MzE7JiMzOTY0MDsmIzI2MzU2OyYjMjYwMzI7JiMxMjM5ODsyJiMxMjM4ODsmIzEyMzk4OyYjMjYwNDE7JiMyNDMzNTs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzUuNzQwNyIgeD0iODYuNjI5NyIgeT0iMjIuOTk1MSI+JiMyNzUzMTsmIzM5NjQwOyYjMjYzNTY7JiMyNjAzMjsmIzEyMzk4OzImIzEyMzg4OyYjMTIzOTg7JiMyNjA0MTsmIzI0MzM1OzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMyIgaWQ9ImVudDAwMDIiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMzEzLjg5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMTM2IiB4PSI3IiB5PSI0NC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzLjk5OTYiIHg9IjMzLjAwMDIiIHk9IjU5LjI5MiI+JiMyMTM2MzsmIzI2MTc4OyYjMjYzNTY7JiMyNjAzMjsmIzI2MDQxOyYjMjQzMzU7PC90ZXh0PjwvZz48IS0tY2x1c3RlciA/Pz8/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0iZW50MDAwOCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIzMTMuODkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIxNTAiIHg9IjE2NyIgeT0iNDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIxOTMuMDAwMiIgeT0iNTkuMjkyIj4mIzEyNDk2OyYjMTI0ODM7JiMxMjQ4MTsmIzIwOTY2OyYjMjk3MDI7JiMyNjA0MTsmIzI0MzM1OzwvdGV4dD48L2c+PCEtLWVudGl0eSBqMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi5qMSIgZGF0YS1zb3VyY2UtbGluZT0iNCIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNzUuOTk5OCIgeD0iMzUiIHk9Ijc5LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI0NSIgeT0iMTAyLjI5MiI+JiMyMDE4MTsmIzM1Mzc5OyYjMjA4Mzc7JiMyMTE0Nzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZDEtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uZDEiIGRhdGEtc291cmNlLWxpbmU9IjUiIGlkPSJlbnQwMDA0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEwMy45OTk2IiB4PSIyMyIgeT0iMTkyLjU5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIzMyIgeT0iMjE1LjU5MiI+JiMyNjA4NTsmIzI3NDI1OyYjMjc1MzE7JiMzOTY0MDsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjwvZz48IS0tZW50aXR5IG0xLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLm0xIiBkYXRhLXNvdXJjZS1saW5lPSI2IiBpZD0iZW50MDAwNSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDMuOTk5NiIgeD0iMjMiIHk9IjMwNS44ODY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMuOTk5NiIgeD0iMzMiIHk9IjMyOC44ODIiPiYjMjYzNzY7JiMyNzQyNTsmIzI3NTMxOyYjMzk2NDA7JiMyNjM1NjsmIzI2MDMyOzwvdGV4dD48L2c+PCEtLWVudGl0eSBqMi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uajIiIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAwOSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI3NS45OTk4IiB4PSIxOTYiIHk9Ijc5LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIyMDYiIHk9IjEwMi4yOTIiPiYjMjAxODE7JiMzNTM3OTsmIzIwODM3OyYjMjExNDc7PC90ZXh0PjwvZz48IS0tZW50aXR5IGQyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi5kMiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDEwIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjExNy45OTk2IiB4PSIxODMiIHk9IjE5Mi41OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMTkzIiB5PSIyMTUuNTkyIj4mIzI2MDg1OyYjMjc0MjU7JiMzODU5ODsmIzM1MzM2OyYjMTI0OTY7JiMxMjQ4MzsmIzEyNDgxOzwvdGV4dD48L2c+PCEtLWVudGl0eSBtMi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4ubTIiIGRhdGEtc291cmNlLWxpbmU9IjE1IiBpZD0iZW50MDAxMSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTcuOTk5NiIgeD0iMTgzIiB5PSIzMDUuODg2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjE5MyIgeT0iMzI4Ljg4MiI+JiMyNjM3NjsmIzI3NDI1OyYjMzg1OTg7JiMzNTMzNjsmIzEyNDk2OyYjMTI0ODM7JiMxMjQ4MTs8L3RleHQ+PC9nPjwhLS1saW5rIGoxIHRvIGQxLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDMiIGRhdGEtZW50aXR5LTI9ImVudDAwMDQiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI4IiBpZD0ibG5rNiI+PHBhdGggZD0iTTczLjMxLDExNS44MzY5IEM3My42OSwxMzYuNjE2OSA3NC4yMDM4LDE2NS4yMDc4IDc0LjU3MzgsMTg2LjEwNzgiIGZpbGw9Im5vbmUiIGlkPSJqMS10by1kMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzQuNjgsMTkyLjEwNjksNzguNTIwMSwxODMuMDM3NSw3NC41OTE1LDE4Ny4xMDc3LDcwLjUyMTMsMTgzLjE3OTEsNzQuNjgsMTkyLjEwNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSI3NS4xMiIgeT0iMTU4LjY2MzgiPiYjMTI0ODg7JiMxMjUyMjsmIzEyNDYwOyYjMTI1NDA7PC90ZXh0PjwvZz48IS0tbGluayBkMSB0byBtMS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA0IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImxuazciPjxwYXRoIGQ9Ik03NSwyMjkuMTI2OSBDNzUsMjQ5LjkxNjkgNzUsMjc4LjUwNjkgNzUsMjk5LjQwNjkiIGZpbGw9Im5vbmUiIGlkPSJkMS10by1tMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzUsMzA1LjQwNjksNzksMjk2LjQwNjksNzUsMzAwLjQwNjksNzEsMjk2LjQwNjksNzUsMzA1LjQwNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSI3NiIgeT0iMjcxLjk1MzgiPiYjMTI0NTg7JiMxMjUwMzsmIzEyNDcxOyYjMTI1MTk7JiMxMjUzMTs8L3RleHQ+PC9nPjwhLS1saW5rIGoyIHRvIGQyLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDkiIGRhdGEtZW50aXR5LTI9ImVudDAwMTAiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImxuazEyIj48cGF0aCBkPSJNMjM1LjI1LDExNS44MzY5IEMyMzYuNzQsMTM2LjYxNjkgMjM4LjgwMDUsMTY1LjIyMjMgMjQwLjMwMDUsMTg2LjEyMjMiIGZpbGw9Im5vbmUiIGlkPSJqMi10by1kMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjQwLjczLDE5Mi4xMDY5LDI0NC4wNzU1LDE4Mi44NDM2LDI0MC4zNzIxLDE4Ny4xMTk3LDIzNi4wOTYsMTgzLjQxNjMsMjQwLjczLDE5Mi4xMDY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iMjM5LjQ4IiB5PSIxNTguNjYzOCI+JiMyNjA4NTsmIzI3NDI1OyYjMTI0OTY7JiMxMjQ4MzsmIzEyNDgxOzwvdGV4dD48L2c+PCEtLWxpbmsgZDIgdG8gbTItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMCIgZGF0YS1lbnRpdHktMj0iZW50MDAxMSIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjE4IiBpZD0ibG5rMTMiPjxwYXRoIGQ9Ik0yNDIsMjI5LjEyNjkgQzI0MiwyNDkuOTE2OSAyNDIsMjc4LjUwNjkgMjQyLDI5OS40MDY5IiBmaWxsPSJub25lIiBpZD0iZDItdG8tbTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjcsNzsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI0MiwzMDUuNDA2OSwyNDYsMjk2LjQwNjksMjQyLDMwMC40MDY5LDIzOCwyOTYuNDA2OSwyNDIsMzA1LjQwNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIyNDMiIHk9IjI3MS45NTM4Ij4mIzI2Mzc2OyYjMjc0MjU7JiMxMjQ5NjsmIzEyNDgzOyYjMTI0ODE7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyBaT3pGMm01MTY4Vmx5b2NjbFFfUUVKaHVCaEFJcEpnbURwZGlsYzRaU1I1ZU5QSF84UWJMNGpfY0RPRGxPVGVmTFhvU3ZsMHlfVHZ2ZEE5Sm9iRW53cG1zOG40VUhCMTdUeVZHZFNiNzEyVC13SDVJb1VVU1JCYVdGT3J0OHA3c2JBWW1IY2o5dU5lVXQ1U0hSeW52RXpIZWphZWo4dWQ1UzJ3c3EtSXZNMzhfZk9kX0l4OERHWW8zd2RmNi1aSEQ0Tm80RE5mUlgwaW41UjFadUFxSFhrV1Q0UE84NFFiXzkyM3E0RzMxdlF0NWhUX3lpdTl6THBwMnZkdGJsLVBLMkZpRS1VTlBKQk9tY2FoOTVZUV9oMVBWM1o0TGlzQ01oeG5QX0dhMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="1832">18.3.2 即時更新の実装<a class="headerlink" href="#1832" title="Permanent link">&para;</a></h3>
<p>仕訳入力時に日次残高を即時更新するサービスの実装です。</p>
<details>
<summary>BalanceUpdateService</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/sms/application/service/BalanceUpdateService.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.application.service</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.application.port.out.DailyAccountBalanceRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.application.port.out.MonthlyAccountBalanceRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.DailyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.DebitCreditType</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.Journal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.JournalDebitCreditDetail</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 残高更新サービス</span>
<span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BalanceUpdateService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DailyAccountBalanceRepository</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MonthlyAccountBalanceRepository</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 仕訳登録に伴う残高更新</span>
<span class="cm">     * @param journal 登録された仕訳</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateBalancesForJournal</span><span class="p">(</span><span class="n">Journal</span><span class="w"> </span><span class="n">journal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">postingDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journal</span><span class="p">.</span><span class="na">getPostingDate</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">closingFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">journal</span><span class="p">.</span><span class="na">getClosingJournalFlag</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">journal</span><span class="p">.</span><span class="na">getClosingJournalFlag</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 仕訳の各明細について残高を更新</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">journal</span><span class="p">.</span><span class="na">getDetails</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">dcDetail</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">detail</span><span class="p">.</span><span class="na">getDebitCreditDetails</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">updateDailyBalance</span><span class="p">(</span><span class="n">postingDate</span><span class="p">,</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">,</span><span class="w"> </span><span class="n">closingFlag</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;残高更新完了: 仕訳伝票番号={}, 起票日={}&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">journal</span><span class="p">.</span><span class="na">getJournalVoucherNumber</span><span class="p">(),</span><span class="w"> </span><span class="n">postingDate</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 日次残高の更新</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateDailyBalance</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">postingDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">JournalDebitCreditDetail</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">closingFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">debitAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getDebitCreditType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DebitCreditType</span><span class="p">.</span><span class="na">DEBIT</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getAmount</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">creditAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getDebitCreditType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DebitCreditType</span><span class="p">.</span><span class="na">CREDIT</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getAmount</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">dailyBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">postingDate</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getAccountCode</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getSubAccountCode</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                </span><span class="o">?</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getSubAccountCode</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getDepartmentCode</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                </span><span class="o">?</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getDepartmentCode</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;00000&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getProjectCode</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                </span><span class="o">?</span><span class="w"> </span><span class="n">dcDetail</span><span class="p">.</span><span class="na">getProjectCode</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="n">closingFlag</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="n">debitAmount</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="n">creditAmount</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">dailyBalance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 月次残高の集計</span>
<span class="cm">     * @param fiscalYear 決算期</span>
<span class="cm">     * @param month 月度</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">aggregateMonthlyBalance</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 対象期間を計算</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">fromDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">toDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fromDate</span><span class="p">.</span><span class="na">withDayOfMonth</span><span class="p">(</span><span class="n">fromDate</span><span class="p">.</span><span class="na">lengthOfMonth</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// 日次残高から月次残高を集計</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">aggregateFromDaily</span><span class="p">(</span>
<span class="w">            </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">fromDate</span><span class="p">,</span><span class="w"> </span><span class="n">toDate</span><span class="p">);</span>

<span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;月次残高集計完了: 決算期={}, 月度={}, 件数={}&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 月次残高の繰越処理</span>
<span class="cm">     * @param fiscalYear 決算期</span>
<span class="cm">     * @param fromMonth 繰越元月度</span>
<span class="cm">     * @param toMonth 繰越先月度</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">carryForwardMonthlyBalance</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fromMonth</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">toMonth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">carryForward</span><span class="p">(</span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">fromMonth</span><span class="p">,</span><span class="w"> </span><span class="n">toMonth</span><span class="p">);</span>

<span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;月次残高繰越完了: 決算期={}, {}月 → {}月, 件数={}&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">fiscalYear</span><span class="p">,</span><span class="w"> </span><span class="n">fromMonth</span><span class="p">,</span><span class="w"> </span><span class="n">toMonth</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h3 id="1833">18.3.3 仕訳入力時の残高更新フロー<a class="headerlink" href="#1833" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkFDVElWSVRZIiBoZWlnaHQ9IjQ3MnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzkwcHg7aGVpZ2h0OjQ3MnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM5MCA0NzIiIHdpZHRoPSIzOTBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjAxODE7JiMzNTM3OTsmIzIwODM3OyYjMjExNDc7JiMyNjE3ODsmIzEyMzk1OyYjMjc1MzE7JiMzOTY0MDsmIzEyNDE4OyYjMjEzNjM7JiMyNjE3ODsmIzI2MzU2OyYjMjYwMzI7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgxLjk5OTIiIHg9IjEwMi41MDE0IiB5PSIzMi45OTUxIj4mIzIwMTgxOyYjMzUzNzk7JiMyMDgzNzsmIzIxMTQ3OyYjMjYxNzg7JiMxMjM5NTsmIzI3NTMxOyYjMzk2NDA7JiMxMjQxODsmIzIxMzYzOyYjMjYxNzg7JiMyNjM1NjsmIzI2MDMyOzwvdGV4dD48L2c+PGVsbGlwc2UgY3g9IjE5NS4wMDEiIGN5PSI1Ny4yOTY5IiBmaWxsPSIjMjIyMjIyIiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxOyIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI2OC4wMDA0IiB4PSIxNjEuMDAwOCIgeT0iODcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4LjAwMDQiIHg9IjE3MS4wMDA4IiB5PSIxMDguNDM1NSI+JiMyMDE4MTsmIzM1Mzc5OyYjMjA4Mzc7JiMyMTE0Nzs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY4LjAwMDQiIHg9IjE2MS4wMDA4IiB5PSIxNDEuMjY1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ4LjAwMDQiIHg9IjE3MS4wMDA4IiB5PSIxNjIuNDA0MyI+JiMyMDE4MTsmIzM1Mzc5OyYjMjA5NjY7JiMyOTcwMjs8L3RleHQ+PHJlY3QgZmlsbD0iIzU1NTU1NSIgaGVpZ2h0PSI2IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiM1NTU1NTU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzY4LjAwMiIgeD0iMTEiIHk9IjE5NS4yMzQ0Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQ0LjAwMDIiIHg9IjQ3LjAwMDIiIHk9IjIyMS4yMzQ0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQuMDAwMiIgeD0iNTcuMDAwMiIgeT0iMjQyLjM3MyI+JiMyMDE4MTsmIzM1Mzc5OzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjguMDAwNCIgeD0iMzUuMDAwMSIgeT0iMjkwLjIwMzEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OC4wMDA0IiB4PSI0NS4wMDAxIiB5PSIzMTEuMzQxOCI+JiMyMDE4MTsmIzM1Mzc5OyYjMjYxMjY7JiMzMjA0ODs8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkyLjAwMDUiIHg9IjIzIiB5PSIzNTkuMTcxOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcyLjAwMDUiIHg9IjMzIiB5PSIzODAuMzEwNSI+JiMyMDE4MTsmIzM1Mzc5OyYjMzYwMjQ7JiMyMDUxMTsmIzI2MTI2OyYjMzIwNDg7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMTYuMDAwNyIgeD0iMTI1LjAwMDUiIHk9IjI1NS43MTg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTYuMDAwNyIgeD0iMTM1LjAwMDUiIHk9IjI3Ni44NTc0Ij4mIzI2MDg1OyYjMjc0MjU7JiMyMTIwODsmIzIzNDUwOyYjMzExODU7JiMzMDQ0NjsmIzI3NTMxOyYjMzk2NDA7PC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI1Ni4wMDAzIiB4PSIxNTUuMDAwOCIgeT0iMzI0LjY4NzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNi4wMDAzIiB4PSIxNjUuMDAwOCIgeT0iMzQ1LjgyNjIiPiYjMjYwODU7JiMzNTMzNjsmIzM0OTIwOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTE2LjAwMDciIHg9IjI1MS4wMDEzIiB5PSIyNTUuNzE4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2LjAwMDciIHg9IjI2MS4wMDEzIiB5PSIyNzYuODU3NCI+JiMyNjM3NjsmIzI3NDI1OyYjMjEyMDg7JiMyMzQ1MDsmIzMxMTg1OyYjMzA0NDY7JiMyNzUzMTsmIzM5NjQwOzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTA0LjAwMDYiIHg9IjI1Ny4wMDEzIiB5PSIzMjQuNjg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0LjAwMDYiIHg9IjI2Ny4wMDEzIiB5PSIzNDUuODI2MiI+JiMyMTUxMjsmIzM1MzM2OyYjMjc1MzE7JiMzOTY0MDsmIzM1NDMwOyYjMzE2Mzk7JiMzNDkyMDs8L3RleHQ+PHJlY3QgZmlsbD0iIzU1NTU1NSIgaGVpZ2h0PSI2IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiM1NTU1NTU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzY4LjAwMiIgeD0iMTEiIHk9IjQxMy4xNDA2Ii8+PGVsbGlwc2UgY3g9IjE5NS4wMDEiIGN5PSI0NTAuMTQwNiIgZmlsbD0ibm9uZSIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48ZWxsaXBzZSBjeD0iMTk1LjAwMSIgY3k9IjQ1MC4xNDA2IiBmaWxsPSIjMjIyMjIyIiByeD0iNiIgcnk9IjYiIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTk1LjAwMSIgeDI9IjE5NS4wMDEiIHkxPSI2Ny4yOTY5IiB5Mj0iODcuMjk2OSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTkxLjAwMSw3Ny4yOTY5LDE5NS4wMDEsODcuMjk2OSwxOTkuMDAxLDc3LjI5NjksMTk1LjAwMSw4MS4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE5NS4wMDEiIHgyPSIxOTUuMDAxIiB5MT0iMTIxLjI2NTYiIHkyPSIxNDEuMjY1NiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTkxLjAwMSwxMzEuMjY1NiwxOTUuMDAxLDE0MS4yNjU2LDE5OS4wMDEsMTMxLjI2NTYsMTk1LjAwMSwxMzUuMjY1NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI2OS4wMDAzIiB4Mj0iNjkuMDAwMyIgeTE9IjI1NS4yMDMxIiB5Mj0iMjkwLjIwMzEiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY1LjAwMDMsMjgwLjIwMzEsNjkuMDAwMywyOTAuMjAzMSw3My4wMDAzLDI4MC4yMDMxLDY5LjAwMDMsMjg0LjIwMzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjkuMDAwMyIgeDI9IjY5LjAwMDMiIHkxPSIzMjQuMTcxOSIgeTI9IjM1OS4xNzE5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NS4wMDAzLDM0OS4xNzE5LDY5LjAwMDMsMzU5LjE3MTksNzMuMDAwMywzNDkuMTcxOSw2OS4wMDAzLDM1My4xNzE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE4My4wMDA5IiB4Mj0iMTgzLjAwMDkiIHkxPSIyODkuNjg3NSIgeTI9IjMyNC42ODc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNzkuMDAwOSwzMTQuNjg3NSwxODMuMDAwOSwzMjQuNjg3NSwxODcuMDAwOSwzMTQuNjg3NSwxODMuMDAwOSwzMTguNjg3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMDkuMDAxNiIgeDI9IjMwOS4wMDE2IiB5MT0iMjg5LjY4NzUiIHkyPSIzMjQuNjg3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA1LjAwMTYsMzE0LjY4NzUsMzA5LjAwMTYsMzI0LjY4NzUsMzEzLjAwMTYsMzE0LjY4NzUsMzA5LjAwMTYsMzE4LjY4NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjkuMDAwMyIgeDI9IjY5LjAwMDMiIHkxPSIyMDEuMjM0NCIgeTI9IjIyMS4yMzQ0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NS4wMDAzLDIxMS4yMzQ0LDY5LjAwMDMsMjIxLjIzNDQsNzMuMDAwMywyMTEuMjM0NCw2OS4wMDAzLDIxNS4yMzQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE4My4wMDA5IiB4Mj0iMTgzLjAwMDkiIHkxPSIyMDEuMjM0NCIgeTI9IjI1NS43MTg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNzkuMDAwOSwyNDUuNzE4OCwxODMuMDAwOSwyNTUuNzE4OCwxODcuMDAwOSwyNDUuNzE4OCwxODMuMDAwOSwyNDkuNzE4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMDkuMDAxNiIgeDI9IjMwOS4wMDE2IiB5MT0iMjAxLjIzNDQiIHkyPSIyNTUuNzE4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA1LjAwMTYsMjQ1LjcxODgsMzA5LjAwMTYsMjU1LjcxODgsMzEzLjAwMTYsMjQ1LjcxODgsMzA5LjAwMTYsMjQ5LjcxODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iNjkuMDAwMyIgeDI9IjY5LjAwMDMiIHkxPSIzOTMuMTQwNiIgeTI9IjQxMy4xNDA2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NS4wMDAzLDQwMy4xNDA2LDY5LjAwMDMsNDEzLjE0MDYsNzMuMDAwMyw0MDMuMTQwNiw2OS4wMDAzLDQwNy4xNDA2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE4My4wMDA5IiB4Mj0iMTgzLjAwMDkiIHkxPSIzNTguNjU2MyIgeTI9IjQxMy4xNDA2Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxNzkuMDAwOSw0MDMuMTQwNiwxODMuMDAwOSw0MTMuMTQwNiwxODcuMDAwOSw0MDMuMTQwNiwxODMuMDAwOSw0MDcuMTQwNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzMDkuMDAxNiIgeDI9IjMwOS4wMDE2IiB5MT0iMzU4LjY1NjMiIHkyPSI0MTMuMTQwNiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA1LjAwMTYsNDAzLjE0MDYsMzA5LjAwMTYsNDEzLjE0MDYsMzEzLjAwMTYsNDAzLjE0MDYsMzA5LjAwMTYsNDA3LjE0MDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTk1LjAwMSIgeDI9IjE5NS4wMDEiIHkxPSIxNzUuMjM0NCIgeTI9IjE5NS4yMzQ0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxOTEuMDAxLDE4NS4yMzQ0LDE5NS4wMDEsMTk1LjIzNDQsMTk5LjAwMSwxODUuMjM0NCwxOTUuMDAxLDE4OS4yMzQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE5NS4wMDEiIHgyPSIxOTUuMDAxIiB5MT0iNDE5LjE0MDYiIHkyPSI0MzkuMTQwNiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTkxLjAwMSw0MjkuMTQwNiwxOTUuMDAxLDQzOS4xNDA2LDE5OS4wMDEsNDI5LjE0MDYsMTk1LjAwMSw0MzMuMTQwNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjw/cGxhbnR1bWwtc3JjIEF5YWlvS2JMVUI5eHdlaUxjdi1zQmR0UURWbFBwQVI3WlFrVmhVai1rTmg2dXdRY2Z4c1JXSUJGUGN6dkRjcTM1clRuSU05SDJIVU41Ujg2UXBZdFZUZHAyTXRNTjVuZi1LTlBTNExtd01TcC1mdmxzRzNkbGpZcXVzZDNWOVdXTTh6Mk9kZllQWHdOclJGZkl2LWpNVllxVXlSSlRSRVVCdl91VkZPd1k3RWltTDhsTGRJeU1CVzJOU2tTM2JuUWRheGUwNmcxUzUtaU5GUHl0Tkk4empJeTUwTThJdWpCeVdpMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="1834-tdd">18.3.4 TDD によるテスト実装<a class="headerlink" href="#1834-tdd" title="Permanent link">&para;</a></h3>
<details>
<summary>日次残高リポジトリのテスト</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/test/java/com/example/sms/infrastructure/persistence/DailyAccountBalanceRepositoryTest.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.infrastructure.persistence</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.DailyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.infrastructure.persistence.repository.DailyAccountBalanceRepositoryImpl</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.DisplayName</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Nested</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.boot.test.autoconfigure.MybatisTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertyRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertySource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.containers.PostgreSQLContainer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Container</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Testcontainers</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@MybatisTest</span>
<span class="nd">@AutoConfigureTestDatabase</span><span class="p">(</span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AutoConfigureTestDatabase</span><span class="p">.</span><span class="na">Replace</span><span class="p">.</span><span class="na">NONE</span><span class="p">)</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@Import</span><span class="p">(</span><span class="n">DailyAccountBalanceRepositoryImpl</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;日次勘定科目残高リポジトリのテスト&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">DailyAccountBalanceRepositoryTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:16&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withDatabaseName</span><span class="p">(</span><span class="s">&quot;testdb&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withUsername</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withPassword</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@DynamicPropertySource</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureProperties</span><span class="p">(</span><span class="n">DynamicPropertyRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getJdbcUrl</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.username&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getUsername</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getPassword</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DailyAccountBalanceRepositoryImpl</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;日次残高の登録&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">DailyBalanceRegistrationTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;新規の日次残高を登録できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRegisterNewDailyBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Given</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// When</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Then</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">found</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">found</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getDebitAmount</span><span class="p">()).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;既存の日次残高に金額を加算できる（UPSERT）&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldAddAmountToExistingBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Given: 既存残高</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">existingBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">existingBalance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// When: 同じキーで追加</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">additionalBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;50000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">additionalBalance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Then: 金額が加算されている</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">found</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">found</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getDebitAmount</span><span class="p">()).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="s">&quot;150000&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;日計表&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">DailyReportTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;日計表データを取得できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetDailyReport</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Given: 日次残高データ</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;30000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// When</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">getDailyReport</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>

<span class="w">            </span><span class="c1">// Then</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">report</span><span class="p">).</span><span class="na">isNotEmpty</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">report</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getAccountCode</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>月次残高リポジトリのテスト</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/test/java/com/example/sms/infrastructure/persistence/MonthlyAccountBalanceRepositoryTest.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.infrastructure.persistence</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.MonthlyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.infrastructure.persistence.repository.MonthlyAccountBalanceRepositoryImpl</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.DisplayName</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Nested</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mybatis.spring.boot.test.autoconfigure.MybatisTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertyRegistry</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.DynamicPropertySource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.containers.PostgreSQLContainer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Container</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.testcontainers.junit.jupiter.Testcontainers</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@MybatisTest</span>
<span class="nd">@AutoConfigureTestDatabase</span><span class="p">(</span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AutoConfigureTestDatabase</span><span class="p">.</span><span class="na">Replace</span><span class="p">.</span><span class="na">NONE</span><span class="p">)</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@Import</span><span class="p">(</span><span class="n">MonthlyAccountBalanceRepositoryImpl</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;月次勘定科目残高リポジトリのテスト&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">MonthlyAccountBalanceRepositoryTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Container</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PostgreSQLContainer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="s">&quot;postgres:16&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withDatabaseName</span><span class="p">(</span><span class="s">&quot;testdb&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withUsername</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withPassword</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="nd">@DynamicPropertySource</span>
<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureProperties</span><span class="p">(</span><span class="n">DynamicPropertyRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.url&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getJdbcUrl</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.username&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getUsername</span><span class="p">);</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;spring.datasource.password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">postgres</span><span class="p">::</span><span class="n">getPassword</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MonthlyAccountBalanceRepositoryImpl</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;月次残高の繰越処理&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">CarryForwardTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;前月末残高を翌月初残高として繰越できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCarryForwardToNextMonth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Given: 4月末残高が存在</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">aprilBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonthlyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">fiscalYear</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">month</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">openingBalance</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;50000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;20000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingBalance</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;130000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">aprilBalance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// When: 5月の月初残高として繰越</span>
<span class="w">            </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">carryForward</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Then: 5月の月初残高が4月末残高と一致</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">mayBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span>
<span class="w">                </span><span class="n">MonthlyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fiscalYear</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">month</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">mayBalance</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">mayBalance</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getOpeningBalance</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="s">&quot;130000&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;合計残高試算表&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">TrialBalanceTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;合計残高試算表データを取得できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetTrialBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Given: 月次残高データ</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonthlyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">fiscalYear</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">month</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">openingBalance</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;50000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;20000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingBalance</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;130000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// When</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">trialBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">getTrialBalance</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Then</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">trialBalance</span><span class="p">).</span><span class="na">isNotNull</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h2 id="184-er">18.4 ER図<a class="headerlink" href="#184-er" title="Permanent link">&para;</a></h2>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkNMQVNTIiBoZWlnaHQ9Ijk3OXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NDA5cHg7aGVpZ2h0Ojk3OXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwOSA5NzkiIHdpZHRoPSI0MDlweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjEyMDg7JiMyMzQ1MDsmIzMxMTg1OyYjMzA0NDY7JiMyNzUzMTsmIzM5NjQwOyYjMTIzOTg7RVImIzIyMjU5OzwvdGl0bGU+PGRlZnMvPjxnPjxnIGNsYXNzPSJ0aXRsZSIgZGF0YS1zb3VyY2UtbGluZT0iMSI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMi4zNDMzIiB4PSIxMzEuNDMwMyIgeT0iMjIuOTk1MSI+JiMyMTIwODsmIzIzNDUwOyYjMzExODU7JiMzMDQ0NjsmIzI3NTMxOyYjMzk2NDA7JiMxMjM5ODtFUiYjMjIyNTk7PC90ZXh0PjwvZz48IS0tY2xhc3MgRGFpbHlCYWxhbmNlLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iRGFpbHlCYWxhbmNlIiBkYXRhLXNvdXJjZS1saW5lPSIzIiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyMTAuOTY4OCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjAyLjAxODEiIHg9IjExMC41OSIgeT0iMjUwLjc3NjkiLz48ZWxsaXBzZSBjeD0iMTUxLjY5ODQiIGN5PSIyNjYuNzc2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMTU1LjgwNzgsMjcyLjc3NjkgTDE0OC4wODksMjcyLjc3NjkgTDE0OC4wODksMjYwLjM4NjMgTDE1NS44MDc4LDI2MC4zODYzIEwxNTUuODA3OCwyNjIuNTQyNSBMMTUwLjU0MjEsMjYyLjU0MjUgTDE1MC41NDIxLDI2NS4yMTQ0IEwxNTUuMzA3OCwyNjUuMjE0NCBMMTU1LjMwNzgsMjY3LjM3MDYgTDE1MC41NDIxLDI2Ny4zNzA2IEwxNTAuNTQyMSwyNzAuNjIwNiBMMTU1LjgwNzgsMjcwLjYyMDYgTDE1NS44MDc4LDI3Mi43NzY5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjk5OTUiIHg9IjE3MS41MDAyIiB5PSIyNzEuNjIzNiI+JiMyNjA4NTsmIzI3NDI1OyYjMjEyMDg7JiMyMzQ1MDsmIzMxMTg1OyYjMzA0NDY7JiMyNzUzMTsmIzM5NjQwOzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTEuNTkiIHgyPSIzMTEuNjA4MSIgeTE9IjI4Mi43NzY5IiB5Mj0iMjgyLjc3NjkiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjEyMS41OSIgY3k9IjI5Ni40MjUzIiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQxLjk5OTgiIHg9IjEzMC41OSIgeT0iMjk5Ljc3MiI+JiMzNjIxNTsmIzMxMDgwOyYjMjYwODU7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0Ljc1MzkiIHg9IjE3Ny4wNCIgeT0iMjk5Ljc3MiI+JiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIxMjEuNTkiIGN5PSIzMTIuNzIyMiIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIxMzAuNTkiIHk9IjMxNi4wNjg5Ij4mIzIxMjA4OyYjMjM0NTA7JiMzMTE4NTsmIzMwNDQ2OyYjMTI0Njc7JiMxMjU0MDsmIzEyNDg5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3My41Njg0IiB4PSIyMzMuMDM5OCIgeT0iMzE2LjA2ODkiPiYjMTcxO1BLJiMxODc7ICYjMTcxO0ZLJiMxODc7PC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iSUVfTUFOREFUT1JZIj48ZWxsaXBzZSBjeD0iMTIxLjU5IiBjeT0iMzI5LjAxOTEiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMTMwLjU5IiB5PSIzMzIuMzY1NyI+JiMzNTAzNjsmIzIxMTYxOyYjMzExODU7JiMzMDQ0NjsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQuNzUzOSIgeD0iMjMzLjAzOTgiIHk9IjMzMi4zNjU3Ij4mIzE3MTtQSyYjMTg3OzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjEyMS41OSIgY3k9IjM0NS4zMTU5IiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjEzMC41OSIgeT0iMzQ4LjY2MjYiPiYjMzcwOTY7JiMzODI3MjsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuNTY4NCIgeD0iMjA1LjAzOTkiIHk9IjM0OC42NjI2Ij4mIzE3MTtQSyYjMTg3OyAmIzE3MTtGSyYjMTg3OzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjEyMS41OSIgY3k9IjM2MS42MTI4IiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSIxMzAuNTkiIHk9IjM2NC45NTk1Ij4mIzEyNTAzOyYjMTI1MjU7JiMxMjQ3MjsmIzEyNDU1OyYjMTI0NjM7JiMxMjQ4ODsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQuNzUzOSIgeD0iMjYxLjAzOTYiIHk9IjM2NC45NTk1Ij4mIzE3MTtQSyYjMTg3OzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjEyMS41OSIgY3k9IjM3Ny45MDk3IiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjEzMC41OSIgeT0iMzgxLjI1NjQiPiYjMjc3NzA7JiMzMTYzOTsmIzIwMTgxOyYjMzUzNzk7JiMxMjUwMTsmIzEyNTIxOyYjMTI0NjQ7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0Ljc1MzkiIHg9IjIzMy4wMzk4IiB5PSIzODEuMjU2NCI+JiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExMS41OSIgeDI9IjMxMS42MDgxIiB5MT0iMzg4LjU1ODEiIHkyPSIzODguNTU4MSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjExNi41OSIgeT0iNDA1LjU1MzIiPiYjMjA1MTE7JiMyNjA0MTsmIzM3MzI5OyYjMzg5ODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjExNi41OSIgeT0iNDIxLjg1MDEiPiYjMzYwMjQ7JiMyNjA0MTsmIzM3MzI5OyYjMzg5ODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjExNi41OSIgeT0iNDM4LjE0NyI+JiMyMDMxNjsmIzI1MTA0OyYjMjYwODU7JiMyNjE3ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTE2LjU5IiB5PSI0NTQuNDQzOSI+JiMyNjM1NjsmIzI2MDMyOyYjMjYwODU7JiMyNjE3ODs8L3RleHQ+PC9nPjwhLS1jbGFzcyBNb250aGx5QmFsYW5jZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ik1vbnRobHlCYWxhbmNlIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMjU5Ljg1OTQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwMi4wMTgxIiB4PSIxMTAuNTkiIHk9IjUzOC43NDY5Ii8+PGVsbGlwc2UgY3g9IjE1MS42OTg0IiBjeT0iNTU0Ljc0NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE1NS44MDc4LDU2MC43NDY5IEwxNDguMDg5LDU2MC43NDY5IEwxNDguMDg5LDU0OC4zNTYzIEwxNTUuODA3OCw1NDguMzU2MyBMMTU1LjgwNzgsNTUwLjUxMjUgTDE1MC41NDIxLDU1MC41MTI1IEwxNTAuNTQyMSw1NTMuMTg0NCBMMTU1LjMwNzgsNTUzLjE4NDQgTDE1NS4zMDc4LDU1NS4zNDA2IEwxNTAuNTQyMSw1NTUuMzQwNiBMMTUwLjU0MjEsNTU4LjU5MDYgTDE1NS44MDc4LDU1OC41OTA2IEwxNTUuODA3OCw1NjAuNzQ2OSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS45OTk1IiB4PSIxNzEuNTAwMiIgeT0iNTU5LjU5MzYiPiYjMjYzNzY7JiMyNzQyNTsmIzIxMjA4OyYjMjM0NTA7JiMzMTE4NTsmIzMwNDQ2OyYjMjc1MzE7JiMzOTY0MDs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTExLjU5IiB4Mj0iMzExLjYwODEiIHkxPSI1NzAuNzQ2OSIgeTI9IjU3MC43NDY5Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIxMjEuNTkiIGN5PSI1ODQuMzk1MyIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIxMzAuNTkiIHk9IjU4Ny43NDIiPiYjMjc3NzA7JiMzMTYzOTsmIzI2Mzk5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNC43NTM5IiB4PSIxNzcuMDQiIHk9IjU4Ny43NDIiPiYjMTcxO1BLJiMxODc7PC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iSUVfTUFOREFUT1JZIj48ZWxsaXBzZSBjeD0iMTIxLjU5IiBjeT0iNjAwLjY5MjIiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjcuOTk5OSIgeD0iMTMwLjU5IiB5PSI2MDQuMDM4OSI+JiMyNjM3NjsmIzI0MjMwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNC43NTM5IiB4PSIxNjMuMDQwMSIgeT0iNjA0LjAzODkiPiYjMTcxO1BLJiMxODc7PC90ZXh0PjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iSUVfTUFOREFUT1JZIj48ZWxsaXBzZSBjeD0iMTIxLjU5IiBjeT0iNjE2Ljk4OTEiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMTMwLjU5IiB5PSI2MjAuMzM1NyI+JiMyMTIwODsmIzIzNDUwOyYjMzExODU7JiMzMDQ0NjsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMuNTY4NCIgeD0iMjMzLjAzOTgiIHk9IjYyMC4zMzU3Ij4mIzE3MTtQSyYjMTg3OyAmIzE3MTtGSyYjMTg3OzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjEyMS41OSIgY3k9IjYzMy4yODU5IiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjEzMC41OSIgeT0iNjM2LjYzMjYiPiYjMzUwMzY7JiMyMTE2MTsmIzMxMTg1OyYjMzA0NDY7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0Ljc1MzkiIHg9IjIzMy4wMzk4IiB5PSI2MzYuNjMyNiI+JiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIxMjEuNTkiIGN5PSI2NDkuNTgyOCIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIxMzAuNTkiIHk9IjY1Mi45Mjk1Ij4mIzM3MDk2OyYjMzgyNzI7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjczLjU2ODQiIHg9IjIwNS4wMzk5IiB5PSI2NTIuOTI5NSI+JiMxNzE7UEsmIzE4NzsgJiMxNzE7RksmIzE4Nzs8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIxMjEuNTkiIGN5PSI2NjUuODc5NyIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjUuOTk5NSIgeD0iMTMwLjU5IiB5PSI2NjkuMjI2NCI+JiMxMjUwMzsmIzEyNTI1OyYjMTI0NzI7JiMxMjQ1NTsmIzEyNDYzOyYjMTI0ODg7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0Ljc1MzkiIHg9IjI2MS4wMzk2IiB5PSI2NjkuMjI2NCI+JiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIxMjEuNTkiIGN5PSI2ODIuMTc2NiIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIxMzAuNTkiIHk9IjY4NS41MjMyIj4mIzI3NzcwOyYjMzE2Mzk7JiMyMDE4MTsmIzM1Mzc5OyYjMTI1MDE7JiMxMjUyMTsmIzEyNDY0OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNC43NTM5IiB4PSIyMzMuMDM5OCIgeT0iNjg1LjUyMzIiPiYjMTcxO1BLJiMxODc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTEuNTkiIHgyPSIzMTEuNjA4MSIgeTE9IjY5Mi44MjUiIHkyPSI2OTIuODI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTE2LjU5IiB5PSI3MDkuODIwMSI+JiMyNjM3NjsmIzIxMDIxOyYjMjc1MzE7JiMzOTY0MDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTE2LjU5IiB5PSI3MjYuMTE3Ij4mIzIwNTExOyYjMjYwNDE7JiMzNzMyOTsmIzM4OTg5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMTYuNTkiIHk9Ijc0Mi40MTM5Ij4mIzM2MDI0OyYjMjYwNDE7JiMzNzMyOTsmIzM4OTg5OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMTYuNTkiIHk9Ijc1OC43MTA3Ij4mIzI2Mzc2OyYjMjY0MTE7JiMyNzUzMTsmIzM5NjQwOzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMTYuNTkiIHk9Ijc3NS4wMDc2Ij4mIzIwMzE2OyYjMjUxMDQ7JiMyNjA4NTsmIzI2MTc4OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIxMTYuNTkiIHk9Ijc5MS4zMDQ1Ij4mIzI2MzU2OyYjMjYwMzI7JiMyNjA4NTsmIzI2MTc4OzwvdGV4dD48L2c+PCEtLWNsYXNzIEFjY291bnQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJBY2NvdW50IiBkYXRhLXNvdXJjZS1saW5lPSIzNCIgaWQ9ImVudDAwMDQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMTEzLjE4NzUiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2My4yMDM3IiB4PSI3IiB5PSI4NTkuNjA2OSIvPjxlbGxpcHNlIGN4PSIzNi45NDE4IiBjeT0iODc1LjYwNjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTQxLjA1MTIsODgxLjYwNjkgTDMzLjMzMjUsODgxLjYwNjkgTDMzLjMzMjUsODY5LjIxNjMgTDQxLjA1MTIsODY5LjIxNjMgTDQxLjA1MTIsODcxLjM3MjUgTDM1Ljc4NTYsODcxLjM3MjUgTDM1Ljc4NTYsODc0LjA0NDQgTDQwLjU1MTIsODc0LjA0NDQgTDQwLjU1MTIsODc2LjIwMDYgTDM1Ljc4NTYsODc2LjIwMDYgTDM1Ljc4NTYsODc5LjQ1MDYgTDQxLjA1MTIsODc5LjQ1MDYgTDQxLjA1MTIsODgxLjYwNjkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSI1NC4yNjIzIiB5PSI4ODAuNDUzNiI+JiMyMTIwODsmIzIzNDUwOyYjMzExODU7JiMzMDQ0NjsmIzEyNTEwOyYjMTI0NzM7JiMxMjQ3OTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iOCIgeDI9IjE2OS4yMDM3IiB5MT0iODkxLjYwNjkiIHkyPSI4OTEuNjA2OSIvPjxnIGRhdGEtdmlzaWJpbGl0eS1tb2RpZmllcj0iSUVfTUFOREFUT1JZIj48ZWxsaXBzZSBjeD0iMTgiIGN5PSI5MDUuMjU1MyIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5Ny45OTk2IiB4PSIyNyIgeT0iOTA4LjYwMiI+JiMyMTIwODsmIzIzNDUwOyYjMzExODU7JiMzMDQ0NjsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQuNzUzOSIgeD0iMTI5LjQ0OTgiIHk9IjkwOC42MDIiPiYjMTcxO1BLJiMxODc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSI4IiB4Mj0iMTY5LjIwMzciIHkxPSI5MTUuOTAzOCIgeTI9IjkxNS45MDM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iMTMiIHk9IjkzMi44OTg5Ij4mIzIxMjA4OyYjMjM0NTA7JiMzMTE4NTsmIzMwNDQ2OyYjMjE1MTc7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYyLjczMzMiIHg9IjEzIiB5PSI5NDkuMTk1NyI+QlNQTCYjMjEzMDY7JiMyMDk5ODs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMTMiIHk9Ijk2NS40OTI2Ij4mIzM2MDI0OyYjMjA1MTE7JiMyMTMwNjsmIzIwOTk4OzwvdGV4dD48L2c+PCEtLWNsYXNzIERlcGFydG1lbnQtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJEZXBhcnRtZW50IiBkYXRhLXNvdXJjZS1saW5lPSI0MiIgaWQ9ImVudDAwMDUiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iODAuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM1LjIwMzgiIHg9IjI2NyIgeT0iODc1LjkwNjkiLz48ZWxsaXBzZSBjeD0iMjk2Ljk0MTgiIGN5PSI4OTEuOTA2OSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cGF0aCBkPSJNMzAxLjA1MTIsODk3LjkwNjkgTDI5My4zMzI1LDg5Ny45MDY5IEwyOTMuMzMyNSw4ODUuNTE2MyBMMzAxLjA1MTIsODg1LjUxNjMgTDMwMS4wNTEyLDg4Ny42NzI1IEwyOTUuNzg1Niw4ODcuNjcyNSBMMjk1Ljc4NTYsODkwLjM0NDQgTDMwMC41NTEyLDg5MC4zNDQ0IEwzMDAuNTUxMiw4OTIuNTAwNiBMMjk1Ljc4NTYsODkyLjUwMDYgTDI5NS43ODU2LDg5NS43NTA2IEwzMDEuMDUxMiw4OTUuNzUwNiBMMzAxLjA1MTIsODk3LjkwNjkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIzMTQuMjYyMyIgeT0iODk2Ljc1MzYiPiYjMzcwOTY7JiMzODI3MjsmIzEyNTEwOyYjMTI0NzM7JiMxMjQ3OTs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjY4IiB4Mj0iNDAxLjIwMzgiIHkxPSI5MDcuOTA2OSIgeTI9IjkwNy45MDY5Ii8+PGcgZGF0YS12aXNpYmlsaXR5LW1vZGlmaWVyPSJJRV9NQU5EQVRPUlkiPjxlbGxpcHNlIGN4PSIyNzgiIGN5PSI5MjEuNTU1MyIgZmlsbD0iIzAwMDAwMCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSIyODciIHk9IjkyNC45MDIiPiYjMzcwOTY7JiMzODI3MjsmIzEyNDY3OyYjMTI1NDA7JiMxMjQ4OTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQuNzUzOSIgeD0iMzYxLjQ0OTkiIHk9IjkyNC45MDIiPiYjMTcxO1BLJiMxODc7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNjgiIHgyPSI0MDEuMjAzOCIgeTE9IjkzMi4yMDM4IiB5Mj0iOTMyLjIwMzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MS45OTk4IiB4PSIyNzMiIHk9Ijk0OS4xOTg5Ij4mIzM3MDk2OyYjMzgyNzI7JiMyMTUxNzs8L3RleHQ+PC9nPjwhLS1jbGFzcyBKb3VybmFsREMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJKb3VybmFsREMiIGRhdGEtc291cmNlLWxpbmU9IjQ4IiBpZD0iZW50MDAwNiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMjkuNDg0NCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTYzLjIwMzciIHg9IjEzMCIgeT0iNDQuMjk2OSIvPjxlbGxpcHNlIGN4PSIxNjYuMjQxOCIgY3k9IjYwLjI5NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBhdGggZD0iTTE3MC4zNTEyLDY2LjI5NjkgTDE2Mi42MzI0LDY2LjI5NjkgTDE2Mi42MzI0LDUzLjkwNjMgTDE3MC4zNTEyLDUzLjkwNjMgTDE3MC4zNTEyLDU2LjA2MjUgTDE2NS4wODU2LDU2LjA2MjUgTDE2NS4wODU2LDU4LjczNDQgTDE2OS44NTEyLDU4LjczNDQgTDE2OS44NTEyLDYwLjg5MDYgTDE2NS4wODU2LDYwLjg5MDYgTDE2NS4wODU2LDY0LjE0MDYgTDE3MC4zNTEyLDY0LjE0MDYgTDE3MC4zNTEyLDY2LjI5NjkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIxODQuOTYyMiIgeT0iNjUuMTQzNiI+JiMyMDE4MTsmIzM1Mzc5OyYjMzYwMjQ7JiMyMDUxMTsmIzI2MTI2OyYjMzIwNDg7PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjEzMSIgeDI9IjI5Mi4yMDM3IiB5MT0iNzYuMjk2OSIgeTI9Ijc2LjI5NjkiLz48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjE0MSIgY3k9Ijg5Ljk0NTMiIGZpbGw9IiMwMDAwMDAiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODMuOTk5NiIgeD0iMTUwIiB5PSI5My4yOTIiPiYjMjAxODE7JiMzNTM3OTsmIzIwMjUzOyYjMzEwODA7JiMzMDA1ODsmIzIxNDk1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNC43NTM5IiB4PSIyMzguNDQ5OCIgeT0iOTMuMjkyIj4mIzE3MTtQSyYjMTg3OzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjE0MSIgY3k9IjEwNi4yNDIyIiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY5Ljk5OTciIHg9IjE1MCIgeT0iMTA5LjU4ODkiPiYjMjAxODE7JiMzNTM3OTsmIzM0ODkyOyYjMzAwNTg7JiMyMTQ5NTs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQuNzUzOSIgeD0iMjI0LjQ0OTkiIHk9IjEwOS41ODg5Ij4mIzE3MTtQSyYjMTg3OzwvdGV4dD48ZyBkYXRhLXZpc2liaWxpdHktbW9kaWZpZXI9IklFX01BTkRBVE9SWSI+PGVsbGlwc2UgY3g9IjE0MSIgY3k9IjEyMi41MzkxIiBmaWxsPSIjMDAwMDAwIiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjE1MCIgeT0iMTI1Ljg4NTciPiYjMjAxODE7JiMzNTM3OTsmIzM0ODkyOyYjMzYwMjQ7JiMyMDUxMTsmIzIxMzA2OyYjMjA5OTg7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM0Ljc1MzkiIHg9IjI1Mi40NDk4IiB5PSIxMjUuODg1NyI+JiMxNzE7UEsmIzE4Nzs8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEzMSIgeDI9IjI5Mi4yMDM3IiB5MT0iMTMzLjE4NzUiIHkyPSIxMzMuMTg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk3Ljk5OTYiIHg9IjEzNiIgeT0iMTUwLjE4MjYiPiYjMjEyMDg7JiMyMzQ1MDsmIzMxMTg1OyYjMzA0NDY7JiMxMjQ2NzsmIzEyNTQwOyYjMTI0ODk7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI3Ljk5OTkiIHg9IjEzNiIgeT0iMTY2LjQ3OTUiPiYjMzczMjk7JiMzODk4OTs8L3RleHQ+PC9nPjwhLS1saW5rIERhaWx5QmFsYW5jZSB0byBBY2NvdW50LS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDIiIGRhdGEtZW50aXR5LTI9ImVudDAwMDQiIGRhdGEtbGluay10eXBlPSJjcm93Zm9vdCIgZGF0YS1zb3VyY2UtbGluZT0iNTciIGlkPSJsbms3Ij48cGF0aCBjb2RlTGluZT0iNTciIGQ9Ik0xMTkuMjM3LDQ3Ny4zODQ5IEMxMDQuNDU3LDUwMS4zMzQ5IDEwMC42Nyw1MTIuMjU2OSA5Mi42LDUzOC43NDY5IEM1OS4yNCw2NDguMzI2OSA2OC42MzA0LDc3Ni4zNjYgNzguNTQwNCw4NTEuMjQ2IiBmaWxsPSJub25lIiBpZD0iRGFpbHlCYWxhbmNlLUFjY291bnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTI0LjQ4ODciIHgyPSIxMjMuNTg0IiB5MT0iNDY4Ljg3NDkiIHkyPSI0NTguOTE1OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMjQuNDg4NyIgeDI9IjEzMy43OTYiIHkxPSI0NjguODc0OSIgeTI9IjQ2NS4yMTc5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyNC40ODg3IiB4Mj0iMTI4LjY5IiB5MT0iNDY4Ljg3NDkiIHkyPSI0NjIuMDY2OSIvPjxlbGxpcHNlIGN4PSIxMjEuMzM3NyIgY3k9IjQ3My45ODA5IiBmaWxsPSJub25lIiByeD0iNCIgcnk9IjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iODMuMDMwNiIgeDI9Ijc1LjA5OTgiIHkxPSI4NTQuNjg2NiIgeTI9Ijg1NS43MzYzIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjgyLjYzNyIgeDI9Ijc0LjcwNjIiIHkxPSI4NTEuNzEyNiIgeTI9Ijg1Mi43NjIyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9Ijc4LjU0MDQiIHgyPSI3OS41OSIgeTE9Ijg1MS4yNDYiIHkyPSI4NTkuMTc2OSIvPjwvZz48IS0tbGluayBEYWlseUJhbGFuY2UgdG8gRGVwYXJ0bWVudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAyIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA1IiBkYXRhLWxpbmstdHlwZT0iY3Jvd2Zvb3QiIGRhdGEtc291cmNlLWxpbmU9IjU4IiBpZD0ibG5rOCI+PHBhdGggY29kZUxpbmU9IjU4IiBkPSJNMzAzLjk2Myw0NzcuMzg0OSBDMzE4Ljc0Myw1MDEuMzM0OSAzMjIuNTQsNTEyLjI1NjkgMzMwLjYsNTM4Ljc0NjkgQzM2Ni41OCw2NTYuOTI2OSAzNTMuNzk2OCw3OTAuOTU3MSAzNDMuNTA2OCw4NjAuNzg3MSIgZmlsbD0ibm9uZSIgaWQ9IkRhaWx5QmFsYW5jZS1EZXBhcnRtZW50IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI5OC43MTEzIiB4Mj0iMjg5LjQwNCIgeTE9IjQ2OC44NzQ5IiB5Mj0iNDY1LjIxNzkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjk4LjcxMTMiIHgyPSIyOTkuNjE2IiB5MT0iNDY4Ljg3NDkiIHkyPSI0NTguOTE1OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyOTguNzExMyIgeDI9IjI5NC41MSIgeTE9IjQ2OC44NzQ5IiB5Mj0iNDYyLjA2NjkiLz48ZWxsaXBzZSBjeD0iMzAxLjg2MjMiIGN5PSI0NzMuOTgwOSIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjM0Mi45MjM2IiB4Mj0iMzQxLjMyIiB5MT0iODY0Ljc0NDQiIHkyPSI4NzUuNjI2OSIvPjxlbGxpcHNlIGN4PSIzNDIuOTIzNiIgY3k9Ijg2NC43NDQ0IiBmaWxsPSJub25lIiByeD0iNCIgcnk9IjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzQ1Ljg2MDQiIHgyPSIzMzcuOTQ1OSIgeTE9Ijg3Mi4yNTI3IiB5Mj0iODcxLjA4NjUiLz48L2c+PCEtLWxpbmsgTW9udGhseUJhbGFuY2UgdG8gQWNjb3VudC0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA0IiBkYXRhLWxpbmstdHlwZT0iY3Jvd2Zvb3QiIGRhdGEtc291cmNlLWxpbmU9IjU5IiBpZD0ibG5rOSI+PHBhdGggY29kZUxpbmU9IjU5IiBkPSJNMTM4Ljc5NSw4MTUuMDA5IEMxMjguMTQ1LDgzNi4yNTkgMTI5LjI3NCw4MzQuMDE0NiAxMjAuMTY0LDg1Mi4xOTQ2IiBmaWxsPSJub25lIiBpZD0iTW9udGhseUJhbGFuY2UtQWNjb3VudCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxNDMuMjc1NiIgeDI9IjE0MS40OTYiIHkxPSI4MDYuMDY4OSIgeTI9Ijc5Ni4yMjg1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjE0My4yNzU2IiB4Mj0iMTUyLjIyNCIgeTE9IjgwNi4wNjg5IiB5Mj0iODAxLjYwNTIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMTQzLjI3NTYiIHgyPSIxNDYuODYiIHkxPSI4MDYuMDY4OSIgeTI9Ijc5OC45MTY5Ii8+PGVsbGlwc2UgY3g9IjE0MC41ODcyIiBjeT0iODExLjQzMyIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyMS45NDgxIiB4Mj0iMTE0Ljc5NTkiIHkxPSI4NTcuNTYyNyIgeTI9Ijg1My45Nzg3Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyMy4yOTIxIiB4Mj0iMTE2LjEzOTkiIHkxPSI4NTQuODgwNiIgeTI9Ijg1MS4yOTY2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjEyMC4xNjQiIHgyPSIxMTYuNTgiIHkxPSI4NTIuMTk0NiIgeTI9Ijg1OS4zNDY5Ii8+PC9nPjwhLS1saW5rIE1vbnRobHlCYWxhbmNlIHRvIERlcGFydG1lbnQtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMyIgZGF0YS1lbnRpdHktMj0iZW50MDAwNSIgZGF0YS1saW5rLXR5cGU9ImNyb3dmb290IiBkYXRhLXNvdXJjZS1saW5lPSI2MCIgaWQ9ImxuazEwIj48cGF0aCBjb2RlTGluZT0iNjAiIGQ9Ik0yODQuNDA2LDgxNS4wMDg1IEMyOTguNDE2LDg0Mi45NTg1IDI5Ny40MTE3LDg0MC45NjU1IDMwOC4wNTE3LDg2Mi4yMDU1IiBmaWxsPSJub25lIiBpZD0iTW9udGhseUJhbGFuY2UtRGVwYXJ0bWVudCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNzkuOTI0OSIgeDI9IjI3MC45NzYxIiB5MT0iODA2LjA2ODciIHkyPSI4MDEuNjA1NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNzkuOTI0OSIgeDI9IjI4MS43MDM5IiB5MT0iODA2LjA2ODciIHkyPSI3OTYuMjI4MiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIyNzkuOTI0OSIgeDI9IjI3Ni4zNCIgeTE9IjgwNi4wNjg3IiB5Mj0iNzk4LjkxNjkiLz48ZWxsaXBzZSBjeD0iMjgyLjYxMzUiIGN5PSI4MTEuNDMyNiIgZmlsbD0ibm9uZSIgcng9IjQiIHJ5PSI0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjMwOS44NDMyIiB4Mj0iMzE0Ljc3IiB5MT0iODY1Ljc4MTkiIHkyPSI4NzUuNjE2OSIvPjxlbGxpcHNlIGN4PSIzMDkuODQzMiIgY3k9Ijg2NS43ODE5IiBmaWxsPSJub25lIiByeD0iNCIgcnk9IjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzE2LjU1NDgiIHgyPSIzMDkuNDAyMSIgeTE9Ijg3MC4yNDkiIHkyPSI4NzMuODMyMSIvPjwvZz48IS0tbGluayBKb3VybmFsREMgdG8gRGFpbHlCYWxhbmNlLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDYiIGRhdGEtZW50aXR5LTI9ImVudDAwMDIiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSI2MSIgaWQ9ImxuazExIj48cGF0aCBjb2RlTGluZT0iNjEiIGQ9Ik0yMTEuNiwxNzQuMTQ2OSBDMjExLjYsMTk3LjU2NjkgMjExLjYsMjE4LjY5NjkgMjExLjYsMjQ0LjcxNjkiIGZpbGw9Im5vbmUiIGlkPSJKb3VybmFsREMtdG8tRGFpbHlCYWxhbmNlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheTo3LDc7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTEuNiwyNTAuNzE2OSwyMTUuNiwyNDEuNzE2OSwyMTEuNiwyNDUuNzE2OSwyMDcuNiwyNDEuNzE2OSwyMTEuNiwyNTAuNzE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjIxMi42IiB5PSIyMTYuODQzOCI+JiMxMjQ4ODsmIzEyNTIyOyYjMTI0NjA7JiMxMjU0MDsmIzI2MzU2OyYjMjYwMzI7PC90ZXh0PjwvZz48IS0tbGluayBEYWlseUJhbGFuY2UgdG8gTW9udGhseUJhbGFuY2UtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjYyIiBpZD0ibG5rMTIiPjxwYXRoIGNvZGVMaW5lPSI2MiIgZD0iTTIxMS42LDQ2MS45MjY5IEMyMTEuNiw0ODYuNDc2OSAyMTEuNiw1MDYuOTI2OSAyMTEuNiw1MzIuNDE2OSIgZmlsbD0ibm9uZSIgaWQ9IkRhaWx5QmFsYW5jZS10by1Nb250aGx5QmFsYW5jZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6Nyw3OyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjExLjYsNTM4LjQxNjksMjE1LjYsNTI5LjQxNjksMjExLjYsNTMzLjQxNjksMjA3LjYsNTI5LjQxNjksMjExLjYsNTM4LjQxNjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSIyMTIuNiIgeT0iNTA0LjgxMzgiPiYjMjYzNzY7JiMyNjQxMTsmIzM4NTk4OyYjMzUzMzY7PC90ZXh0PjwvZz48P3BsYW50dW1sLXNyYyB0UEpCSWlEMDU4UnR5bkkzb3ExejA5NjJNYnJ1V1E5RjQ0aDBHYXI0dXc5T2VTdzBuaGlrVWo2Y0lYNnJNZXRyWGJlTDdzT3dhLUdqcENxc1lRUXVUWExFcGRfRS1VVVJZdm9NQ21BYU1zTWc3VWFOMXRmNU96Z01zSVlKTE1ycWNiT1UwMTE0RUlyZE9IeWhkUjdoc2F6YjctR05PTzlGUHhCM1Y4T05LbTlTMVhwYUVFRmZNSi1oTXJLUzFtUzdhbkZua0ZGUnR1MlcxdUJWMlR4ZUlBcEZzQlZJRTVOZnZjTUtxZjZPazZ1TXl4dFI0NW1ZLThRVzV1OGsyQmViTThiZW5rdlFrYlBnbG5NQ2tmS2w0N245S0JDaFlTSzBwUC1tdWdrdlZjM01UZTFuX3o4RHNYeWdLX1BqSDhTOGlDZVpBcFF6T0NMN0s1TVkyS3Y5ZVptUlBrWFFPa2Y5b0FjZ3FEUnZfLTVnaHFVZmtaMXdHQlJ2Z0dyRnpZVlkwSVp1Y0ExTldadVR0NEVmYkJHYW9YeGR0bDJTaFZTZndGdUU2OXY5SmpCajViTk1SOC1NUG9fbTNWU1cxaU9jWDdiLUdQdUpFZkVaSURpcHRQbXpwVFZMdlVaRVBFTFRfUjdmRDF3TmJYUDRGZkNPeVZnd2lsUHhyUmczVWs2QXhacTdEeUxoS3psa2NWR2xCSDk3bnBwbXppYm82dFdGTGdIT0I5VnhIbHVwOS1MeU40M2U4ZUlBVnlhNm94aVctbGxabU5UZjBEZzc1NXlIVDZxUFRpekNxOHJUNGZlbTBEclpQclJNWkJobzFHMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h2 id="185">18.5 リレーションと楽観ロックの設計<a class="headerlink" href="#185" title="Permanent link">&para;</a></h2>
<h3 id="mybatis-resultmap">MyBatis ネストした ResultMap によるリレーション設定<a class="headerlink" href="#mybatis-resultmap" title="Permanent link">&para;</a></h3>
<p>残高テーブルは、勘定科目マスタや部門マスタとのリレーションを持ちます。MyBatis でこれらの関係を効率的に取得するためのリレーション設定を実装します。</p>
<h4 id="resultmap">ネストした ResultMap の定義<a class="headerlink" href="#resultmap" title="Permanent link">&para;</a></h4>
<details>
<summary>DailyAccountBalanceMapper.xml（リレーション設定）</summary>

<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="cm">&lt;!-- src/main/resources/mapper/DailyAccountBalanceMapper.xml --&gt;</span>
<span class="nt">&lt;mapper</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;com.example.fas.infrastructure.persistence.mapper.DailyAccountBalanceMapper&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 日次勘定科目残高 ResultMap --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;dailyAccountBalanceResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.fas.domain.model.accounting.DailyAccountBalance&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;postingDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;起票日&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;accountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;勘定科目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;subAccountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;補助科目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;departmentCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;部門コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;projectCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;プロジェクトコード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;closingJournalFlag&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;決算仕訳フラグ&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;debitAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;借方金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;creditAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;貸方金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;バージョン&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 日次残高 + 勘定科目情報 ResultMap --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;dailyBalanceWithAccountResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.fas.domain.model.accounting.DailyAccountBalance&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;postingDate&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_起票日&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;accountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_勘定科目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;subAccountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_補助科目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;departmentCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_部門コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;projectCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_プロジェクトコード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;closingJournalFlag&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_決算仕訳フラグ&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;debitAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_借方金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;creditAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_貸方金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_バージョン&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;d_更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 勘定科目情報との関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;account&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.fas.domain.model.account.Account&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;accountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;a_勘定科目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;accountName&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;a_勘定科目名&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;bsplType&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;a_BSPL区分&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;debitCreditType&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;a_貸借区分&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- 部門情報との関連 --&gt;</span>
<span class="w">        </span><span class="nt">&lt;association</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;department&quot;</span><span class="w"> </span><span class="na">javaType=</span><span class="s">&quot;com.example.fas.domain.model.department.Department&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;departmentCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;dept_部門コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;departmentName&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;dept_部門名&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/association&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 月次勘定科目残高 ResultMap --&gt;</span>
<span class="w">    </span><span class="nt">&lt;resultMap</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;monthlyAccountBalanceResultMap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;com.example.fas.domain.model.accounting.MonthlyAccountBalance&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;fiscalYear&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;決算期&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;month&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;月度&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;accountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;勘定科目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;subAccountCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;補助科目コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;departmentCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;部門コード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;projectCode&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;プロジェクトコード&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;closingJournalFlag&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;決算仕訳フラグ&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;openingBalance&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;月初残高&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;debitAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;借方金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;creditAmount&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;貸方金額&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;closingBalance&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;月末残高&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;バージョン&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;createdAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;作成日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;result</span><span class="w"> </span><span class="na">property=</span><span class="s">&quot;updatedAt&quot;</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;更新日時&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/resultMap&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- JOIN による日次残高と勘定科目・部門の一括取得クエリ --&gt;</span>
<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findWithAccountByKey&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;dailyBalanceWithAccountResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT
<span class="w">            </span>d.&quot;起票日&quot;<span class="w"> </span>AS<span class="w"> </span>d_起票日,
<span class="w">            </span>d.&quot;勘定科目コード&quot;<span class="w"> </span>AS<span class="w"> </span>d_勘定科目コード,
<span class="w">            </span>d.&quot;補助科目コード&quot;<span class="w"> </span>AS<span class="w"> </span>d_補助科目コード,
<span class="w">            </span>d.&quot;部門コード&quot;<span class="w"> </span>AS<span class="w"> </span>d_部門コード,
<span class="w">            </span>d.&quot;プロジェクトコード&quot;<span class="w"> </span>AS<span class="w"> </span>d_プロジェクトコード,
<span class="w">            </span>d.&quot;決算仕訳フラグ&quot;<span class="w"> </span>AS<span class="w"> </span>d_決算仕訳フラグ,
<span class="w">            </span>d.&quot;借方金額&quot;<span class="w"> </span>AS<span class="w"> </span>d_借方金額,
<span class="w">            </span>d.&quot;貸方金額&quot;<span class="w"> </span>AS<span class="w"> </span>d_貸方金額,
<span class="w">            </span>d.&quot;バージョン&quot;<span class="w"> </span>AS<span class="w"> </span>d_バージョン,
<span class="w">            </span>d.&quot;作成日時&quot;<span class="w"> </span>AS<span class="w"> </span>d_作成日時,
<span class="w">            </span>d.&quot;更新日時&quot;<span class="w"> </span>AS<span class="w"> </span>d_更新日時,
<span class="w">            </span>a.&quot;勘定科目コード&quot;<span class="w"> </span>AS<span class="w"> </span>a_勘定科目コード,
<span class="w">            </span>a.&quot;勘定科目名&quot;<span class="w"> </span>AS<span class="w"> </span>a_勘定科目名,
<span class="w">            </span>a.&quot;BSPL区分&quot;<span class="w"> </span>AS<span class="w"> </span>a_BSPL区分,
<span class="w">            </span>a.&quot;貸借区分&quot;<span class="w"> </span>AS<span class="w"> </span>a_貸借区分,
<span class="w">            </span>dept.&quot;部門コード&quot;<span class="w"> </span>AS<span class="w"> </span>dept_部門コード,
<span class="w">            </span>dept.&quot;部門名&quot;<span class="w"> </span>AS<span class="w"> </span>dept_部門名
<span class="w">        </span>FROM<span class="w"> </span>&quot;日次勘定科目残高&quot;<span class="w"> </span>d
<span class="w">        </span>JOIN<span class="w"> </span>&quot;勘定科目マスタ&quot;<span class="w"> </span>a<span class="w"> </span>ON<span class="w"> </span>d.&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>a.&quot;勘定科目コード&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;部門マスタ&quot;<span class="w"> </span>dept<span class="w"> </span>ON<span class="w"> </span>d.&quot;部門コード&quot;<span class="w"> </span>=<span class="w"> </span>dept.&quot;部門コード&quot;
<span class="w">        </span>WHERE<span class="w"> </span>d.&quot;起票日&quot;<span class="w"> </span>=<span class="w"> </span>#{postingDate}
<span class="w">          </span>AND<span class="w"> </span>d.&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{accountCode}
<span class="w">          </span>AND<span class="w"> </span>d.&quot;補助科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{subAccountCode}
<span class="w">          </span>AND<span class="w"> </span>d.&quot;部門コード&quot;<span class="w"> </span>=<span class="w"> </span>#{departmentCode}
<span class="w">          </span>AND<span class="w"> </span>d.&quot;プロジェクトコード&quot;<span class="w"> </span>=<span class="w"> </span>#{projectCode}
<span class="w">          </span>AND<span class="w"> </span>d.&quot;決算仕訳フラグ&quot;<span class="w"> </span>=<span class="w"> </span>#{closingJournalFlag}
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- 日付範囲での残高一覧取得（勘定科目情報付き） --&gt;</span>
<span class="w">    </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findByDateRangeWithAccount&quot;</span><span class="w"> </span><span class="na">resultMap=</span><span class="s">&quot;dailyBalanceWithAccountResultMap&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>SELECT
<span class="w">            </span>d.&quot;起票日&quot;<span class="w"> </span>AS<span class="w"> </span>d_起票日,
<span class="w">            </span>d.&quot;勘定科目コード&quot;<span class="w"> </span>AS<span class="w"> </span>d_勘定科目コード,
<span class="w">            </span>d.&quot;補助科目コード&quot;<span class="w"> </span>AS<span class="w"> </span>d_補助科目コード,
<span class="w">            </span>d.&quot;部門コード&quot;<span class="w"> </span>AS<span class="w"> </span>d_部門コード,
<span class="w">            </span>d.&quot;プロジェクトコード&quot;<span class="w"> </span>AS<span class="w"> </span>d_プロジェクトコード,
<span class="w">            </span>d.&quot;決算仕訳フラグ&quot;<span class="w"> </span>AS<span class="w"> </span>d_決算仕訳フラグ,
<span class="w">            </span>d.&quot;借方金額&quot;<span class="w"> </span>AS<span class="w"> </span>d_借方金額,
<span class="w">            </span>d.&quot;貸方金額&quot;<span class="w"> </span>AS<span class="w"> </span>d_貸方金額,
<span class="w">            </span>d.&quot;バージョン&quot;<span class="w"> </span>AS<span class="w"> </span>d_バージョン,
<span class="w">            </span>d.&quot;作成日時&quot;<span class="w"> </span>AS<span class="w"> </span>d_作成日時,
<span class="w">            </span>d.&quot;更新日時&quot;<span class="w"> </span>AS<span class="w"> </span>d_更新日時,
<span class="w">            </span>a.&quot;勘定科目コード&quot;<span class="w"> </span>AS<span class="w"> </span>a_勘定科目コード,
<span class="w">            </span>a.&quot;勘定科目名&quot;<span class="w"> </span>AS<span class="w"> </span>a_勘定科目名,
<span class="w">            </span>a.&quot;BSPL区分&quot;<span class="w"> </span>AS<span class="w"> </span>a_BSPL区分,
<span class="w">            </span>a.&quot;貸借区分&quot;<span class="w"> </span>AS<span class="w"> </span>a_貸借区分,
<span class="w">            </span>dept.&quot;部門コード&quot;<span class="w"> </span>AS<span class="w"> </span>dept_部門コード,
<span class="w">            </span>dept.&quot;部門名&quot;<span class="w"> </span>AS<span class="w"> </span>dept_部門名
<span class="w">        </span>FROM<span class="w"> </span>&quot;日次勘定科目残高&quot;<span class="w"> </span>d
<span class="w">        </span>JOIN<span class="w"> </span>&quot;勘定科目マスタ&quot;<span class="w"> </span>a<span class="w"> </span>ON<span class="w"> </span>d.&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>a.&quot;勘定科目コード&quot;
<span class="w">        </span>LEFT<span class="w"> </span>JOIN<span class="w"> </span>&quot;部門マスタ&quot;<span class="w"> </span>dept<span class="w"> </span>ON<span class="w"> </span>d.&quot;部門コード&quot;<span class="w"> </span>=<span class="w"> </span>dept.&quot;部門コード&quot;
<span class="w">        </span>WHERE<span class="w"> </span>d.&quot;起票日&quot;<span class="w"> </span>BETWEEN<span class="w"> </span>#{fromDate}<span class="w"> </span>AND<span class="w"> </span>#{toDate}
<span class="w">        </span>ORDER<span class="w"> </span>BY<span class="w"> </span>d.&quot;起票日&quot;,<span class="w"> </span>d.&quot;勘定科目コード&quot;,<span class="w"> </span>d.&quot;部門コード&quot;
<span class="w">    </span><span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div>

</details>

<h4 id="_2">リレーション設定のポイント<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>設定項目</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;association&gt;</code></td>
<td>N:1 関連のマッピング（残高 → 勘定科目マスタ、部門マスタ）</td>
</tr>
<tr>
<td>複合主キー</td>
<td>6つの <code>&lt;id&gt;</code> カラムで複合主キーを表現</td>
</tr>
<tr>
<td><code>resultMap</code></td>
<td>ネストした ResultMap の参照</td>
</tr>
<tr>
<td>エイリアス（AS）</td>
<td>カラム名の重複を避けるためのプレフィックス（d_, a_, dept_）</td>
</tr>
<tr>
<td><code>LEFT JOIN</code></td>
<td>部門マスタは省略可能のため LEFT JOIN</td>
</tr>
</tbody>
</table>
<h3 id="_3">楽観ロックの実装<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>残高テーブルは仕訳入力時のトリガー更新や月次集計バッチなど、複数の処理で同時に更新される可能性があります。楽観ロックによる整合性確保が重要です。</p>
<h4 id="flyway">Flyway マイグレーション: バージョンカラム追加<a class="headerlink" href="#flyway" title="Permanent link">&para;</a></h4>
<details>
<summary>V020__add_balance_version_columns.sql</summary>

<div class="highlight"><pre><span></span><code><span class="c1">-- src/main/resources/db/migration/V020__add_balance_version_columns.sql</span>

<span class="c1">-- 日次勘定科目残高にバージョンカラムを追加</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- 月次勘定科目残高にバージョンカラムを追加</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- コメント追加</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;日次勘定科目残高&quot;</span><span class="p">.</span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;楽観ロック用バージョン番号&#39;</span><span class="p">;</span>
<span class="k">COMMENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="ss">&quot;月次勘定科目残高&quot;</span><span class="p">.</span><span class="ss">&quot;バージョン&quot;</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="s1">&#39;楽観ロック用バージョン番号&#39;</span><span class="p">;</span>
</code></pre></div>

</details>

<h4 id="_4">エンティティへのバージョンフィールド追加<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<details>
<summary>DailyAccountBalance.java（バージョンフィールド追加）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/fas/domain/model/accounting/DailyAccountBalance.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DailyAccountBalance</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">postingDate</span><span class="p">;</span><span class="w">           </span><span class="c1">// 起票日</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">subAccountCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 補助科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">departmentCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 部門コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">projectCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// プロジェクトコード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">closingJournalFlag</span><span class="p">;</span><span class="w">      </span><span class="c1">// 決算仕訳フラグ</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w">          </span><span class="c1">// 借方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w">         </span><span class="c1">// 貸方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 作成日時</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 更新日時</span>

<span class="w">    </span><span class="c1">// 楽観ロック用バージョン</span>
<span class="w">    </span><span class="nd">@Builder.Default</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">;</span><span class="w">                 </span><span class="c1">// 勘定科目情報</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Department</span><span class="w"> </span><span class="n">department</span><span class="p">;</span><span class="w">           </span><span class="c1">// 部門情報</span>

<span class="w">    </span><span class="c1">// 既存のメソッド...</span>
<span class="p">}</span>
</code></pre></div>

</details>

<details>
<summary>MonthlyAccountBalance.java（バージョンフィールド追加）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/fas/domain/model/accounting/MonthlyAccountBalance.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.*</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MonthlyAccountBalance</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">fiscalYear</span><span class="p">;</span><span class="w">              </span><span class="c1">// 決算期</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">month</span><span class="p">;</span><span class="w">                   </span><span class="c1">// 月度</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// 勘定科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">subAccountCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 補助科目コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">departmentCode</span><span class="p">;</span><span class="w">           </span><span class="c1">// 部門コード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">projectCode</span><span class="p">;</span><span class="w">              </span><span class="c1">// プロジェクトコード</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">closingJournalFlag</span><span class="p">;</span><span class="w">      </span><span class="c1">// 決算仕訳フラグ</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">openingBalance</span><span class="p">;</span><span class="w">       </span><span class="c1">// 月初残高</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitAmount</span><span class="p">;</span><span class="w">          </span><span class="c1">// 借方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditAmount</span><span class="p">;</span><span class="w">         </span><span class="c1">// 貸方金額</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">closingBalance</span><span class="p">;</span><span class="w">       </span><span class="c1">// 月末残高</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 作成日時</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span><span class="w">         </span><span class="c1">// 更新日時</span>

<span class="w">    </span><span class="c1">// 楽観ロック用バージョン</span>
<span class="w">    </span><span class="nd">@Builder.Default</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// リレーション</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Account</span><span class="w"> </span><span class="n">account</span><span class="p">;</span><span class="w">                 </span><span class="c1">// 勘定科目情報</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Department</span><span class="w"> </span><span class="n">department</span><span class="p">;</span><span class="w">           </span><span class="c1">// 部門情報</span>

<span class="w">    </span><span class="c1">// 既存のメソッド...</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="mybatis-mapper">MyBatis Mapper: 楽観ロック対応の更新<a class="headerlink" href="#mybatis-mapper" title="Permanent link">&para;</a></h4>
<details>
<summary>AccountBalanceMapper.xml（楽観ロック対応 UPDATE）</summary>

<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 楽観ロック対応の日次残高更新 --&gt;</span>
<span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateDailyBalanceWithOptimisticLock&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.fas.domain.model.accounting.DailyAccountBalance&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>UPDATE<span class="w"> </span>&quot;日次勘定科目残高&quot;
<span class="w">    </span>SET
<span class="w">        </span>&quot;借方金額&quot;<span class="w"> </span>=<span class="w"> </span>#{debitAmount},
<span class="w">        </span>&quot;貸方金額&quot;<span class="w"> </span>=<span class="w"> </span>#{creditAmount},
<span class="w">        </span>&quot;更新日時&quot;<span class="w"> </span>=<span class="w"> </span>CURRENT_TIMESTAMP,
<span class="w">        </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>+<span class="w"> </span>1
<span class="w">    </span>WHERE<span class="w"> </span>&quot;起票日&quot;<span class="w"> </span>=<span class="w"> </span>#{postingDate}
<span class="w">      </span>AND<span class="w"> </span>&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{accountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;補助科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{subAccountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;部門コード&quot;<span class="w"> </span>=<span class="w"> </span>#{departmentCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;プロジェクトコード&quot;<span class="w"> </span>=<span class="w"> </span>#{projectCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;決算仕訳フラグ&quot;<span class="w"> </span>=<span class="w"> </span>#{closingJournalFlag}
<span class="w">      </span>AND<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>#{version}
<span class="nt">&lt;/update&gt;</span>

<span class="cm">&lt;!-- 楽観ロック対応の月次残高更新 --&gt;</span>
<span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateMonthlyBalanceWithOptimisticLock&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.fas.domain.model.accounting.MonthlyAccountBalance&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>UPDATE<span class="w"> </span>&quot;月次勘定科目残高&quot;
<span class="w">    </span>SET
<span class="w">        </span>&quot;月初残高&quot;<span class="w"> </span>=<span class="w"> </span>#{openingBalance},
<span class="w">        </span>&quot;借方金額&quot;<span class="w"> </span>=<span class="w"> </span>#{debitAmount},
<span class="w">        </span>&quot;貸方金額&quot;<span class="w"> </span>=<span class="w"> </span>#{creditAmount},
<span class="w">        </span>&quot;月末残高&quot;<span class="w"> </span>=<span class="w"> </span>#{closingBalance},
<span class="w">        </span>&quot;更新日時&quot;<span class="w"> </span>=<span class="w"> </span>CURRENT_TIMESTAMP,
<span class="w">        </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>+<span class="w"> </span>1
<span class="w">    </span>WHERE<span class="w"> </span>&quot;決算期&quot;<span class="w"> </span>=<span class="w"> </span>#{fiscalYear}
<span class="w">      </span>AND<span class="w"> </span>&quot;月度&quot;<span class="w"> </span>=<span class="w"> </span>#{month}
<span class="w">      </span>AND<span class="w"> </span>&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{accountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;補助科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{subAccountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;部門コード&quot;<span class="w"> </span>=<span class="w"> </span>#{departmentCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;プロジェクトコード&quot;<span class="w"> </span>=<span class="w"> </span>#{projectCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;決算仕訳フラグ&quot;<span class="w"> </span>=<span class="w"> </span>#{closingJournalFlag}
<span class="w">      </span>AND<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>#{version}
<span class="nt">&lt;/update&gt;</span>

<span class="cm">&lt;!-- UPSERT（楽観ロック対応） --&gt;</span>
<span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;upsertDailyBalanceWithOptimisticLock&quot;</span><span class="w"> </span><span class="na">parameterType=</span><span class="s">&quot;com.example.fas.domain.model.accounting.DailyAccountBalance&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>&quot;日次勘定科目残高&quot;<span class="w"> </span>(
<span class="w">        </span>&quot;起票日&quot;,<span class="w"> </span>&quot;勘定科目コード&quot;,<span class="w"> </span>&quot;補助科目コード&quot;,
<span class="w">        </span>&quot;部門コード&quot;,<span class="w"> </span>&quot;プロジェクトコード&quot;,<span class="w"> </span>&quot;決算仕訳フラグ&quot;,
<span class="w">        </span>&quot;借方金額&quot;,<span class="w"> </span>&quot;貸方金額&quot;,<span class="w"> </span>&quot;バージョン&quot;,<span class="w"> </span>&quot;作成日時&quot;,<span class="w"> </span>&quot;更新日時&quot;
<span class="w">    </span>)<span class="w"> </span>VALUES<span class="w"> </span>(
<span class="w">        </span>#{postingDate},<span class="w"> </span>#{accountCode},<span class="w"> </span>#{subAccountCode},
<span class="w">        </span>#{departmentCode},<span class="w"> </span>#{projectCode},<span class="w"> </span>#{closingJournalFlag},
<span class="w">        </span>#{debitAmount},<span class="w"> </span>#{creditAmount},<span class="w"> </span>1,<span class="w"> </span>CURRENT_TIMESTAMP,<span class="w"> </span>CURRENT_TIMESTAMP
<span class="w">    </span>)
<span class="w">    </span>ON<span class="w"> </span>CONFLICT<span class="w"> </span>(
<span class="w">        </span>&quot;起票日&quot;,<span class="w"> </span>&quot;勘定科目コード&quot;,<span class="w"> </span>&quot;補助科目コード&quot;,
<span class="w">        </span>&quot;部門コード&quot;,<span class="w"> </span>&quot;プロジェクトコード&quot;,<span class="w"> </span>&quot;決算仕訳フラグ&quot;
<span class="w">    </span>)
<span class="w">    </span>DO<span class="w"> </span>UPDATE<span class="w"> </span>SET
<span class="w">        </span>&quot;借方金額&quot;<span class="w"> </span>=<span class="w"> </span>&quot;日次勘定科目残高&quot;.&quot;借方金額&quot;<span class="w"> </span>+<span class="w"> </span>EXCLUDED.&quot;借方金額&quot;,
<span class="w">        </span>&quot;貸方金額&quot;<span class="w"> </span>=<span class="w"> </span>&quot;日次勘定科目残高&quot;.&quot;貸方金額&quot;<span class="w"> </span>+<span class="w"> </span>EXCLUDED.&quot;貸方金額&quot;,
<span class="w">        </span>&quot;更新日時&quot;<span class="w"> </span>=<span class="w"> </span>CURRENT_TIMESTAMP,
<span class="w">        </span>&quot;バージョン&quot;<span class="w"> </span>=<span class="w"> </span>&quot;日次勘定科目残高&quot;.&quot;バージョン&quot;<span class="w"> </span>+<span class="w"> </span>1
<span class="nt">&lt;/insert&gt;</span>

<span class="cm">&lt;!-- バージョンのみ取得 --&gt;</span>
<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findDailyBalanceVersion&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;Integer&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>FROM<span class="w"> </span>&quot;日次勘定科目残高&quot;
<span class="w">    </span>WHERE<span class="w"> </span>&quot;起票日&quot;<span class="w"> </span>=<span class="w"> </span>#{postingDate}
<span class="w">      </span>AND<span class="w"> </span>&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{accountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;補助科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{subAccountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;部門コード&quot;<span class="w"> </span>=<span class="w"> </span>#{departmentCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;プロジェクトコード&quot;<span class="w"> </span>=<span class="w"> </span>#{projectCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;決算仕訳フラグ&quot;<span class="w"> </span>=<span class="w"> </span>#{closingJournalFlag}
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;findMonthlyBalanceVersion&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;Integer&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>SELECT<span class="w"> </span>&quot;バージョン&quot;<span class="w"> </span>FROM<span class="w"> </span>&quot;月次勘定科目残高&quot;
<span class="w">    </span>WHERE<span class="w"> </span>&quot;決算期&quot;<span class="w"> </span>=<span class="w"> </span>#{fiscalYear}
<span class="w">      </span>AND<span class="w"> </span>&quot;月度&quot;<span class="w"> </span>=<span class="w"> </span>#{month}
<span class="w">      </span>AND<span class="w"> </span>&quot;勘定科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{accountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;補助科目コード&quot;<span class="w"> </span>=<span class="w"> </span>#{subAccountCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;部門コード&quot;<span class="w"> </span>=<span class="w"> </span>#{departmentCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;プロジェクトコード&quot;<span class="w"> </span>=<span class="w"> </span>#{projectCode}
<span class="w">      </span>AND<span class="w"> </span>&quot;決算仕訳フラグ&quot;<span class="w"> </span>=<span class="w"> </span>#{closingJournalFlag}
<span class="nt">&lt;/select&gt;</span>
</code></pre></div>

</details>

<h4 id="repository">Repository 実装: 楽観ロック対応<a class="headerlink" href="#repository" title="Permanent link">&para;</a></h4>
<details>
<summary>AccountBalanceRepositoryImpl.java（楽観ロック対応）</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/main/java/com/example/fas/infrastructure/persistence/repository/DailyAccountBalanceRepositoryImpl.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.infrastructure.persistence.repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.application.port.out.DailyAccountBalanceRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.exception.OptimisticLockException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.DailyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.infrastructure.persistence.mapper.DailyAccountBalanceMapper</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.RequiredArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="nd">@Repository</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DailyAccountBalanceRepositoryImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DailyAccountBalanceRepository</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DailyAccountBalanceMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateWithOptimisticLock</span><span class="p">(</span><span class="n">DailyAccountBalance</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">updatedCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">updateDailyBalanceWithOptimisticLock</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">updatedCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">currentVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">findDailyBalanceVersion</span><span class="p">(</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getPostingDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getAccountCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getSubAccountCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getDepartmentCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getProjectCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getClosingJournalFlag</span><span class="p">()</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s/%s/%s/%s/%s/%s&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getPostingDate</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getAccountCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getSubAccountCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getDepartmentCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getProjectCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">balance</span><span class="p">.</span><span class="na">getClosingJournalFlag</span><span class="p">());</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentVersion</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OptimisticLockException</span><span class="p">(</span><span class="s">&quot;日次残高&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OptimisticLockException</span><span class="p">(</span><span class="s">&quot;日次残高&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span>
<span class="w">                    </span><span class="n">balance</span><span class="p">.</span><span class="na">getVersion</span><span class="p">(),</span><span class="w"> </span><span class="n">currentVersion</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">upsert</span><span class="p">(</span><span class="n">DailyAccountBalance</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// UPSERT は競合時に自動でバージョンインクリメント</span>
<span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">upsertDailyBalanceWithOptimisticLock</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">DailyAccountBalance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findWithAccountByKey</span><span class="p">(</span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">findWithAccountByKey</span><span class="p">(</span>
<span class="w">            </span><span class="n">key</span><span class="p">.</span><span class="na">getPostingDate</span><span class="p">(),</span>
<span class="w">            </span><span class="n">key</span><span class="p">.</span><span class="na">getAccountCode</span><span class="p">(),</span>
<span class="w">            </span><span class="n">key</span><span class="p">.</span><span class="na">getSubAccountCode</span><span class="p">(),</span>
<span class="w">            </span><span class="n">key</span><span class="p">.</span><span class="na">getDepartmentCode</span><span class="p">(),</span>
<span class="w">            </span><span class="n">key</span><span class="p">.</span><span class="na">getProjectCode</span><span class="p">(),</span>
<span class="w">            </span><span class="n">key</span><span class="p">.</span><span class="na">getClosingJournalFlag</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// その他のメソッド...</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="tdd">TDD: 楽観ロックのテスト<a class="headerlink" href="#tdd" title="Permanent link">&para;</a></h4>
<details>
<summary>AccountBalanceOptimisticLockTest.java</summary>

<div class="highlight"><pre><span></span><code><span class="c1">// src/test/java/com/example/fas/infrastructure/persistence/repository/AccountBalanceOptimisticLockTest.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.fas.infrastructure.persistence.repository</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.application.port.out.DailyAccountBalanceRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.application.port.out.MonthlyAccountBalanceRepository</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.exception.OptimisticLockException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.DailyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.domain.model.accounting.MonthlyAccountBalance</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.fas.testsetup.BaseIntegrationTest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>

<span class="kn">import static</span><span class="w"> </span><span class="nn">org.assertj.core.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;勘定科目残高 - 楽観ロック&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">AccountBalanceOptimisticLockTest</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">BaseIntegrationTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DailyAccountBalanceRepository</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MonthlyAccountBalanceRepository</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;日次残高の楽観ロック&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">DailyBalanceOptimisticLocking</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;同じバージョンで更新できる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">canUpdateWithSameVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestDailyBalance</span><span class="p">();</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Act</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">fetched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="n">fetched</span><span class="p">.</span><span class="na">setDebitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;200000&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">updateWithOptimisticLock</span><span class="p">(</span><span class="n">fetched</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">updated</span><span class="p">.</span><span class="na">getDebitAmount</span><span class="p">()).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="s">&quot;200000&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">updated</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;異なるバージョンで更新すると楽観ロック例外が発生する&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">throwsExceptionWhenVersionMismatch</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestDailyBalance</span><span class="p">();</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// 処理Aが取得</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balanceA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="c1">// 処理Bが取得</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balanceB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">get</span><span class="p">();</span>

<span class="w">            </span><span class="c1">// 処理Aが更新（成功）</span>
<span class="w">            </span><span class="n">balanceA</span><span class="p">.</span><span class="na">setDebitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;200000&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">updateWithOptimisticLock</span><span class="p">(</span><span class="n">balanceA</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Act &amp; Assert: 処理Bが古いバージョンで更新（失敗）</span>
<span class="w">            </span><span class="n">balanceB</span><span class="p">.</span><span class="na">setDebitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;300000&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">updateWithOptimisticLock</span><span class="p">(</span><span class="n">balanceB</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">OptimisticLockException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">hasMessageContaining</span><span class="p">(</span><span class="s">&quot;他のユーザーによって更新されています&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;UPSERTでは自動的にバージョンがインクリメントされる&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">upsertIncrementsVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestDailyBalance</span><span class="p">();</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Act: 同じキーでUPSERT（金額追加）</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">additionalBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;50000&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">upsert</span><span class="p">(</span><span class="n">additionalBalance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dailyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">updated</span><span class="p">.</span><span class="na">getDebitAmount</span><span class="p">()).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="s">&quot;150000&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">updated</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Nested</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;月次残高の楽観ロック&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">class</span> <span class="nc">MonthlyBalanceOptimisticLocking</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Test</span>
<span class="w">        </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;繰越処理で楽観ロック例外が発生しない&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">carryForwardDoesNotCauseOptimisticLock</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Arrange</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestMonthlyBalance</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="w">            </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">balance</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Act: 繰越処理</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">carryForward</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Assert</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">count</span><span class="p">).</span><span class="na">isGreaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MonthlyAccountBalance</span><span class="p">.</span><span class="na">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">fiscalYear</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">month</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">mayBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monthlyBalanceRepository</span><span class="p">.</span><span class="na">findByKey</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">mayBalance</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<span class="w">            </span><span class="n">assertThat</span><span class="p">(</span><span class="n">mayBalance</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getOpeningBalance</span><span class="p">()).</span><span class="na">isEqualByComparingTo</span><span class="p">(</span><span class="s">&quot;130000&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="w"> </span><span class="nf">createTestDailyBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DailyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">postingDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MonthlyAccountBalance</span><span class="w"> </span><span class="nf">createTestMonthlyBalance</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MonthlyAccountBalance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">fiscalYear</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">month</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">accountCode</span><span class="p">(</span><span class="s">&quot;11110&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">subAccountCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">departmentCode</span><span class="p">(</span><span class="s">&quot;10100&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">projectCode</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">closingJournalFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">openingBalance</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">debitAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;50000&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">creditAmount</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;20000&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">closingBalance</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;130000&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>

<h4 id="_5">楽観ロックのベストプラクティス<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>ポイント</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>複合主キーの扱い</strong></td>
<td>WHERE条件に全ての複合主キーカラムを含める</td>
</tr>
<tr>
<td><strong>UPSERT時の注意</strong></td>
<td>ON CONFLICT DO UPDATE で自動バージョンインクリメント</td>
</tr>
<tr>
<td><strong>バッチ処理</strong></td>
<td>月次集計時は個別の残高ごとにバージョンチェック</td>
</tr>
<tr>
<td><strong>トリガー更新</strong></td>
<td>トリガーでのUPSERTは競合時に自動リトライ</td>
</tr>
</tbody>
</table>
<h3 id="_6">残高更新における整合性確保<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>残高テーブルは即時更新とバッチ処理の両方で更新されるため、整合性確保が特に重要です。</p>
<h4 id="_7">更新パターンと楽観ロック<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>更新パターン</th>
<th>処理内容</th>
<th>ロック戦略</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>仕訳入力時</strong></td>
<td>日次残高のUPSERT</td>
<td>ON CONFLICT での自動バージョン管理</td>
</tr>
<tr>
<td><strong>日次集計</strong></td>
<td>仕訳データからの再集計</td>
<td>バッチ単位でのトランザクション管理</td>
</tr>
<tr>
<td><strong>月次集計</strong></td>
<td>日次残高からの月次集計</td>
<td>集計前に対象レコードをロック</td>
</tr>
<tr>
<td><strong>繰越処理</strong></td>
<td>前月末 → 翌月初への転記</td>
<td>UPSERT による競合回避</td>
</tr>
</tbody>
</table>
<h4 id="_8">即時更新とバッチ処理の共存<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMD8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjY1N3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6MzY4cHg7aGVpZ2h0OjY1N3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDM2OCA2NTciIHdpZHRoPSIzNjhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMjc1MzE7JiMzOTY0MDsmIzI2MzU2OyYjMjYwMzI7JiMxMjM5ODsmIzMxNDc4OyYjMjE1MTI7JiMyMjIzODsmIzM2OTkxOyYjMTI1MDE7JiMxMjUyNTsmIzEyNTQwOzwvdGl0bGU+PGRlZnMvPjxnPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjcuOTk5MyIgeD0iOTYuMDcxOCIgeT0iMjcuOTk1MSI+JiMyNzUzMTsmIzM5NjQwOyYjMjYzNTY7JiMyNjAzMjsmIzEyMzk4OyYjMzE0Nzg7JiMyMTUxMjsmIzIyMjM4OyYjMzY5OTE7JiMxMjUwMTsmIzEyNTI1OyYjMTI1NDA7PC90ZXh0PjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLiIgaWQ9InBhcnQxLWxpZmVsaW5lIj48Zz48dGl0bGU+Li4uLjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjQ1OC4xMjUiIHdpZHRoPSI4IiB4PSIzMS45OTk5IiB5PSIxMTguNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjM1IiB4Mj0iMzUiIHkxPSIxMTguNTkzOCIgeTI9IjU3Ni43MTg4Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQtbGlmZWxpbmUiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uIiBpZD0icGFydDItbGlmZWxpbmUiPjxnPjx0aXRsZT4uLi4uLjwvdGl0bGU+PHJlY3QgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIwLjAwMDAwIiBoZWlnaHQ9IjQ1OC4xMjUiIHdpZHRoPSI4IiB4PSIxMTAuOTk5NiIgeT0iMTE4LjU5MzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIxMTMuOTk5OCIgeDI9IjExMy45OTk4IiB5MT0iMTE4LjU5MzgiIHkyPSI1NzYuNzE4OCIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uIiBpZD0icGFydDMtbGlmZWxpbmUiPjxnPjx0aXRsZT4uLi4uPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iNDU4LjEyNSIgd2lkdGg9IjgiIHg9IjI0OS4xNDMzIiB5PSIxMTguNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjI1Mi4xNDM0IiB4Mj0iMjUyLjE0MzQiIHkxPSIxMTguNTkzOCIgeTI9IjU3Ni43MTg4Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQtbGlmZWxpbmUiIGRhdGEtZW50aXR5LXVpZD0icGFydDQiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4iIGlkPSJwYXJ0NC1saWZlbGluZSI+PGc+PHRpdGxlPi4uLi48L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSI0NTguMTI1IiB3aWR0aD0iOCIgeD0iMzIxLjE0MyIgeT0iMTE4LjU5MzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSIzMjQuMTQzMiIgeDI9IjMyNC4xNDMyIiB5MT0iMTE4LjU5MzgiIHkyPSI1NzYuNzE4OCIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4iIGlkPSJwYXJ0MS1oZWFkIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI1IiB5PSIxMTUuMjkyIj4mIzIwMTgxOyYjMzUzNzk7JiMyMDgzNzsmIzIxMTQ3OzwvdGV4dD48ZWxsaXBzZSBjeD0iMzUuOTk5OSIgY3k9IjUwLjc5NjkiIGZpbGw9IiNFMkUyRjAiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTM1Ljk5OTksNTguNzk2OSBMMzUuOTk5OSw4NS43OTY5IE0yMi45OTk5LDY2Ljc5NjkgTDQ4Ljk5OTksNjYuNzk2OSBNMzUuOTk5OSw4NS43OTY5IEwyMi45OTk5LDEwMC43OTY5IE0zNS45OTk5LDg1Ljc5NjkgTDQ4Ljk5OTksMTAwLjc5NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLiIgaWQ9InBhcnQxLXRhaWwiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjUiIHk9IjU4OC43MTM5Ij4mIzIwMTgxOyYjMzUzNzk7JiMyMDgzNzsmIzIxMTQ3OzwvdGV4dD48ZWxsaXBzZSBjeD0iMzUuOTk5OSIgY3k9IjYwMC41MTU2IiBmaWxsPSIjRTJFMkYwIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0zNS45OTk5LDYwOC41MTU2IEwzNS45OTk5LDYzNS41MTU2IE0yMi45OTk5LDYxNi41MTU2IEw0OC45OTk5LDYxNi41MTU2IE0zNS45OTk5LDYzNS41MTU2IEwyMi45OTk5LDY1MC41MTU2IE0zNS45OTk5LDYzNS41MTU2IEw0OC45OTk5LDY1MC41MTU2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uIiBpZD0icGFydDItaGVhZCI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjkuOTk5NyIgeD0iNzYuOTk5OCIgeT0iMTE1LjI5MiI+JiMyNjM3NjsmIzI3NDI1OyYjMTI0OTY7JiMxMjQ4MzsmIzEyNDgxOzwvdGV4dD48ZWxsaXBzZSBjeD0iMTE0Ljk5OTYiIGN5PSI1MC43OTY5IiBmaWxsPSIjRTJFMkYwIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0xMTQuOTk5Niw1OC43OTY5IEwxMTQuOTk5Niw4NS43OTY5IE0xMDEuOTk5Niw2Ni43OTY5IEwxMjcuOTk5Niw2Ni43OTY5IE0xMTQuOTk5Niw4NS43OTY5IEwxMDEuOTk5NiwxMDAuNzk2OSBNMTE0Ljk5OTYsODUuNzk2OSBMMTI3Ljk5OTYsMTAwLjc5NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MiIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4iIGlkPSJwYXJ0Mi10YWlsIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI3Ni45OTk4IiB5PSI1ODguNzEzOSI+JiMyNjM3NjsmIzI3NDI1OyYjMTI0OTY7JiMxMjQ4MzsmIzEyNDgxOzwvdGV4dD48ZWxsaXBzZSBjeD0iMTE0Ljk5OTYiIGN5PSI2MDAuNTE1NiIgZmlsbD0iI0UyRTJGMCIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMTE0Ljk5OTYsNjA4LjUxNTYgTDExNC45OTk2LDYzNS41MTU2IE0xMDEuOTk5Niw2MTYuNTE1NiBMMTI3Ljk5OTYsNjE2LjUxNTYgTTExNC45OTk2LDYzNS41MTU2IEwxMDEuOTk5Niw2NTAuNTE1NiBNMTE0Ljk5OTYsNjM1LjUxNTYgTDEyNy45OTk2LDY1MC41MTU2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4iIGlkPSJwYXJ0My1oZWFkIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSIyMjIuMTQzNCIgeT0iMTE1LjI5MiI+JiMyNjA4NTsmIzI3NDI1OyYjMjc1MzE7JiMzOTY0MDs8L3RleHQ+PHBhdGggZD0iTTIzNS4xNDMzLDY2LjI5NjkgQzIzNS4xNDMzLDU2LjI5NjkgMjUzLjE0MzMsNTYuMjk2OSAyNTMuMTQzMyw1Ni4yOTY5IEMyNTMuMTQzMyw1Ni4yOTY5IDI3MS4xNDMzLDU2LjI5NjkgMjcxLjE0MzMsNjYuMjk2OSBMMjcxLjE0MzMsOTIuMjk2OSBDMjcxLjE0MzMsMTAyLjI5NjkgMjUzLjE0MzMsMTAyLjI5NjkgMjUzLjE0MzMsMTAyLjI5NjkgQzI1My4xNDMzLDEwMi4yOTY5IDIzNS4xNDMzLDEwMi4yOTY5IDIzNS4xNDMzLDkyLjI5NjkgTDIzNS4xNDMzLDY2LjI5NjkiIGZpbGw9IiNFMkUyRjAiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yMzUuMTQzMyw2Ni4yOTY5IEMyMzUuMTQzMyw3Ni4yOTY5IDI1My4xNDMzLDc2LjI5NjkgMjUzLjE0MzMsNzYuMjk2OSBDMjUzLjE0MzMsNzYuMjk2OSAyNzEuMTQzMyw3Ni4yOTY5IDI3MS4xNDMzLDY2LjI5NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLiIgaWQ9InBhcnQzLXRhaWwiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjIyMi4xNDM0IiB5PSI1ODguNzEzOSI+JiMyNjA4NTsmIzI3NDI1OyYjMjc1MzE7JiMzOTY0MDs8L3RleHQ+PHBhdGggZD0iTTIzNS4xNDMzLDYwMi4wMTU2IEMyMzUuMTQzMyw1OTIuMDE1NiAyNTMuMTQzMyw1OTIuMDE1NiAyNTMuMTQzMyw1OTIuMDE1NiBDMjUzLjE0MzMsNTkyLjAxNTYgMjcxLjE0MzMsNTkyLjAxNTYgMjcxLjE0MzMsNjAyLjAxNTYgTDI3MS4xNDMzLDYyOC4wMTU2IEMyNzEuMTQzMyw2MzguMDE1NiAyNTMuMTQzMyw2MzguMDE1NiAyNTMuMTQzMyw2MzguMDE1NiBDMjUzLjE0MzMsNjM4LjAxNTYgMjM1LjE0MzMsNjM4LjAxNTYgMjM1LjE0MzMsNjI4LjAxNTYgTDIzNS4xNDMzLDYwMi4wMTU2IiBmaWxsPSIjRTJFMkYwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjM1LjE0MzMsNjAyLjAxNTYgQzIzNS4xNDMzLDYxMi4wMTU2IDI1My4xNDMzLDYxMi4wMTU2IDI1My4xNDMzLDYxMi4wMTU2IEMyNTMuMTQzMyw2MTIuMDE1NiAyNzEuMTQzMyw2MTIuMDE1NiAyNzEuMTQzMyw2MDIuMDE1NiIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQ0IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uIiBpZD0icGFydDQtaGVhZCI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMjk0LjE0MzIiIHk9IjExNS4yOTIiPiYjMjYzNzY7JiMyNzQyNTsmIzI3NTMxOyYjMzk2NDA7PC90ZXh0PjxwYXRoIGQ9Ik0zMDcuMTQzLDY2LjI5NjkgQzMwNy4xNDMsNTYuMjk2OSAzMjUuMTQzLDU2LjI5NjkgMzI1LjE0Myw1Ni4yOTY5IEMzMjUuMTQzLDU2LjI5NjkgMzQzLjE0Myw1Ni4yOTY5IDM0My4xNDMsNjYuMjk2OSBMMzQzLjE0Myw5Mi4yOTY5IEMzNDMuMTQzLDEwMi4yOTY5IDMyNS4xNDMsMTAyLjI5NjkgMzI1LjE0MywxMDIuMjk2OSBDMzI1LjE0MywxMDIuMjk2OSAzMDcuMTQzLDEwMi4yOTY5IDMwNy4xNDMsOTIuMjk2OSBMMzA3LjE0Myw2Ni4yOTY5IiBmaWxsPSIjRTJFMkYwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzA3LjE0Myw2Ni4yOTY5IEMzMDcuMTQzLDc2LjI5NjkgMzI1LjE0Myw3Ni4yOTY5IDMyNS4xNDMsNzYuMjk2OSBDMzI1LjE0Myw3Ni4yOTY5IDM0My4xNDMsNzYuMjk2OSAzNDMuMTQzLDY2LjI5NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0NCIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLiIgaWQ9InBhcnQ0LXRhaWwiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjI5NC4xNDMyIiB5PSI1ODguNzEzOSI+JiMyNjM3NjsmIzI3NDI1OyYjMjc1MzE7JiMzOTY0MDs8L3RleHQ+PHBhdGggZD0iTTMwNy4xNDMsNjAyLjAxNTYgQzMwNy4xNDMsNTkyLjAxNTYgMzI1LjE0Myw1OTIuMDE1NiAzMjUuMTQzLDU5Mi4wMTU2IEMzMjUuMTQzLDU5Mi4wMTU2IDM0My4xNDMsNTkyLjAxNTYgMzQzLjE0Myw2MDIuMDE1NiBMMzQzLjE0Myw2MjguMDE1NiBDMzQzLjE0Myw2MzguMDE1NiAzMjUuMTQzLDYzOC4wMTU2IDMyNS4xNDMsNjM4LjAxNTYgQzMyNS4xNDMsNjM4LjAxNTYgMzA3LjE0Myw2MzguMDE1NiAzMDcuMTQzLDYyOC4wMTU2IEwzMDcuMTQzLDYwMi4wMTU2IiBmaWxsPSIjRTJFMkYwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMzA3LjE0Myw2MDIuMDE1NiBDMzA3LjE0Myw2MTIuMDE1NiAzMjUuMTQzLDYxMi4wMTU2IDMyNS4xNDMsNjEyLjAxNTYgQzMyNS4xNDMsNjEyLjAxNTYgMzQzLjE0Myw2MTIuMDE1NiAzNDMuMTQzLDYwMi4wMTU2IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48L2c+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIzIiBzdHlsZT0ic3Ryb2tlOiNFRUVFRUU7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzYxLjE0MjkiIHg9IjAiIHk9IjE0OS4xNjAyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIgeDE9IjAiIHgyPSIzNjEuMTQyOSIgeTE9IjE0OS4xNjAyIiB5Mj0iMTQ5LjE2MDIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9IjM2MS4xNDI5IiB5MT0iMTUyLjE2MDIiIHkyPSIxNTIuMTYwMiIvPjxyZWN0IGZpbGw9IiNFRUVFRUUiIGhlaWdodD0iMjMuMTMyOCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyOyIgd2lkdGg9IjgzLjUyNiIgeD0iMTM4LjgwODUiIHk9IjEzOC41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1LjAwMDEiIHg9IjE0NC44MDg1IiB5PSIxNTQuNjYwNiI+JiMzNjg5MDsmIzI0MTIwOyYjMTI1MDE7JiMxMjUyNTsmIzEyNTQwOzwvdGV4dD48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDEiIGRhdGEtZW50aXR5LTI9InBhcnQzIiBpZD0ibXNnMSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDEuMTQzMywyMDMuOTkyMiwyNTEuMTQzMywyMDcuOTkyMiwyNDEuMTQzMywyMTEuOTkyMiwyNDUuMTQzMywyMDcuOTkyMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIzNS45OTk5IiB4Mj0iMjQ3LjE0MzMiIHkxPSIyMDcuOTkyMiIgeTI9IjIwNy45OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTAuNzkzOSIgeD0iNDIuOTk5OSIgeT0iMTg3Ljc5MzUiPlVQU0VSVDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjIuMTc2MyIgeD0iNDIuOTk5OSIgeT0iMjAyLjkyNjMiPih2ZXJzaW9uIGF1dG8taW5jcmVtZW50KTwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQzIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzIiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDYuOTk5OSwyMzMuMTI1LDM2Ljk5OTksMjM3LjEyNSw0Ni45OTk5LDI0MS4xMjUsNDIuOTk5OSwyMzcuMTI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjQwLjk5OTkiIHgyPSIyNTIuMTQzMyIgeTE9IjIzNy4xMjUiIHkyPSIyMzcuMTI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iNTIuOTk5OSIgeT0iMjMyLjA1OTEiPiYjMjYzNTY7JiMyNjAzMjsmIzI1MTA0OyYjMjExNTE7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDIiIGRhdGEtZW50aXR5LTI9InBhcnQzIiBpZD0ibXNnMyI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyNDEuMTQzMywyNjIuMjU3OCwyNTEuMTQzMywyNjYuMjU3OCwyNDEuMTQzMywyNzAuMjU3OCwyNDUuMTQzMywyNjYuMjU3OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiIHgxPSIxMTQuOTk5NiIgeDI9IjI0Ny4xNDMzIiB5MT0iMjY2LjI1NzgiIHkyPSIyNjYuMjU3OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS4wMjY5IiB4PSIxMjEuOTk5NiIgeT0iMjYxLjE5MTkiPlNFTEVDVCB3aXRoIGxvY2s8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MyIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyNS45OTk2LDI5MS4zOTA2LDExNS45OTk2LDI5NS4zOTA2LDEyNS45OTk2LDI5OS4zOTA2LDEyMS45OTk2LDI5NS4zOTA2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjExOS45OTk2IiB4Mj0iMjUyLjE0MzMiIHkxPSIyOTUuMzkwNiIgeTI9IjI5NS4zOTA2Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iMTMxLjk5OTYiIHk9IjI5MC4zMjQ3Ij4mIzEyNDg3OyYjMTI1NDA7JiMxMjQ3OTsmIzIxNDYyOyYjMjQ0NzE7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDIiIGRhdGEtZW50aXR5LTI9InBhcnQ0IiBpZD0ibXNnNSI+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzMTMuMTQzLDMzNS42NTYzLDMyMy4xNDMsMzM5LjY1NjMsMzEzLjE0MywzNDMuNjU2MywzMTcuMTQzLDMzOS42NTYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExNC45OTk2IiB4Mj0iMzE5LjE0MyIgeTE9IjMzOS42NTYzIiB5Mj0iMzM5LjY1NjMiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MC43OTM5IiB4PSIxMjEuOTk5NiIgeT0iMzE5LjQ1NzUiPlVQU0VSVDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjIuMTc2MyIgeD0iMTIxLjk5OTYiIHk9IjMzNC41OTAzIj4odmVyc2lvbiBhdXRvLWluY3JlbWVudCk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0NCIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2c2Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyNS45OTk2LDM2NC43ODkxLDExNS45OTk2LDM2OC43ODkxLDEyNS45OTk2LDM3Mi43ODkxLDEyMS45OTk2LDM2OC43ODkxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxO3N0cm9rZS1kYXNoYXJyYXk6MiwyOyIgeDE9IjExOS45OTk2IiB4Mj0iMzI0LjE0MyIgeTE9IjM2OC43ODkxIiB5Mj0iMzY4Ljc4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSIxMzEuOTk5NiIgeT0iMzYzLjcyMzEiPiYjMzg1OTg7JiMzNTMzNjsmIzIzNDM2OyYjMjAxMDI7PC90ZXh0PjwvZz48cmVjdCBmaWxsPSIjRUVFRUVFIiBoZWlnaHQ9IjMiIHN0eWxlPSJzdHJva2U6I0VFRUVFRTtzdHJva2Utd2lkdGg6MTsiIHdpZHRoPSIzNjEuMTQyOSIgeD0iMCIgeT0iMzk3LjM1NTUiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMCIgeDI9IjM2MS4xNDI5IiB5MT0iMzk3LjM1NTUiIHkyPSIzOTcuMzU1NSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiIHgxPSIwIiB4Mj0iMzYxLjE0MjkiIHkxPSI0MDAuMzU1NSIgeTI9IjQwMC4zNTU1Ii8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgaGVpZ2h0PSIyMy4xMzI4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7IiB3aWR0aD0iODMuNTI2IiB4PSIxMzguODA4NSIgeT0iMzg2Ljc4OTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iMTQ0LjgwODUiIHk9IjQwMi44NTYiPiYjMzE0Nzg7JiMyMTUxMjsmIzMwMzMwOyYjMjk5ODM7JiMyNjE3ODs8L3RleHQ+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQxIiBkYXRhLWVudGl0eS0yPSJwYXJ0MyIgaWQ9Im1zZzciPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMjQxLjE0MzMsNDM3LjA1NDcsMjUxLjE0MzMsNDQxLjA1NDcsMjQxLjE0MzMsNDQ1LjA1NDcsMjQ1LjE0MzMsNDQxLjA1NDciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMzUuOTk5OSIgeDI9IjI0Ny4xNDMzIiB5MT0iNDQxLjA1NDciIHkyPSI0NDEuMDU0NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUwLjc5MzkiIHg9IjQyLjk5OTkiIHk9IjQzNS45ODg4Ij5VUFNFUlQ8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2c4Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI0MS4xNDMzLDQ4MS4zMjAzLDI1MS4xNDMzLDQ4NS4zMjAzLDI0MS4xNDMzLDQ4OS4zMjAzLDI0NS4xNDMzLDQ4NS4zMjAzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjExNC45OTk2IiB4Mj0iMjQ3LjE0MzMiIHkxPSI0ODUuMzIwMyIgeTI9IjQ4NS4zMjAzIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjAyNjkiIHg9IjEyMS45OTk2IiB5PSI0NjUuMTIxNiI+U0VMRUNUIHdpdGggbG9jazwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNi4xNDM2IiB4PSIxMjEuOTk5NiIgeT0iNDgwLjI1NDQiPigmIzI0NDUzOyYjMjcyMzE7KTwvdGV4dD48L2c+PGcgY2xhc3M9Im1lc3NhZ2UiIGRhdGEtZW50aXR5LTE9InBhcnQzIiBkYXRhLWVudGl0eS0yPSJwYXJ0MSIgaWQ9Im1zZzkiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDYuOTk5OSw1MTAuNDUzMSwzNi45OTk5LDUxNC40NTMxLDQ2Ljk5OTksNTE4LjQ1MzEsNDIuOTk5OSw1MTQuNDUzMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTtzdHJva2UtZGFzaGFycmF5OjIsMjsiIHgxPSI0MC45OTk5IiB4Mj0iMjUyLjE0MzMiIHkxPSI1MTQuNDUzMSIgeTI9IjUxNC40NTMxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iNTIuOTk5OSIgeT0iNTA5LjM4NzIiPiYjMjYzNTY7JiMyNjAzMjsmIzI1MTA0OyYjMjExNTE7PC90ZXh0PjwvZz48ZyBjbGFzcz0ibWVzc2FnZSIgZGF0YS1lbnRpdHktMT0icGFydDMiIGRhdGEtZW50aXR5LTI9InBhcnQyIiBpZD0ibXNnMTAiPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTI1Ljk5OTYsNTU0LjcxODgsMTE1Ljk5OTYsNTU4LjcxODgsMTI1Ljk5OTYsNTYyLjcxODgsMTIxLjk5OTYsNTU4LjcxODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWRhc2hhcnJheToyLDI7IiB4MT0iMTE5Ljk5OTYiIHgyPSIyNTIuMTQzMyIgeTE9IjU1OC43MTg4IiB5Mj0iNTU4LjcxODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NS4wMDAxIiB4PSIxMzEuOTk5NiIgeT0iNTM4LjUyIj4mIzEyNTI1OyYjMTI0ODM7JiMxMjQ2MzsmIzIxNDYyOyYjMjQ0NzE7PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNC4xNDM3IiB4PSIxMzEuOTk5NiIgeT0iNTUzLjY1MjgiPigmIzI2MzY4OyYjMjYwMzI7JiMxMjQ4NzsmIzEyNTQwOyYjMTI0Nzk7JiMxMjM5MTsmIzM4NTk4OyYjMzUzMzY7KTwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgQXlhaW9LYkxVQlFrLS1OZzZTemNSdGFzUlNGWm5kTkZMc3p4RWc3WndVbnZCbmx0RnN3VS1oWHZ4VUZjRkxuU1lTYWItS0tBSnRQRlZSNVl5ekZNZksteFBhRTVkaXRmVUJQY3VVRmMyTy1SY255dER0QWI5OU9hOVlLTTB5c1RsWEdlMEo0VElISWk3MmhBUE1raHlCOVhyakNURS0wc0FUWlFTWTdSZWcxaFhzQUlXZkwyUTQybVFyMThKOXY2TU1mSFNNUC1kYTlZUUtjLVJjUFVTYjVnUmNmVVlJT05ZZGZUZTA0ZTFiZWZHRnB3aDZGMnF3eHZONW5lN2kxWU9SMmhad2pwWTQ5dlBhYzZHYXYtU1pRYzFVWGNNMmF5UmN1Ny1rUG5xX3dkX1RFVXhma0VySFFhZTIzQU15WmdpVGx3U2RSUlluS1RKelZyRkRkTDFXdlRJNm0tZHhkaC1QSnZwc09zNEhzd1A4R0FxRUxGenhLLU1wY1ZuMFdXQVozTldqWER3bzYxMlJKZnNQbTZLN0E1MVZCWm5rS0doc2kyMDAwMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<hr />
<h2 id="186">18.6 まとめ<a class="headerlink" href="#186" title="Permanent link">&para;</a></h2>
<p>本章では、勘定科目残高の設計について解説しました。</p>
<h3 id="_9">設計のポイント<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>複合主キーによる多次元管理</strong></li>
<li>起票日/決算期・月度 + 勘定科目 + 補助科目 + 部門 + プロジェクト</li>
<li>
<p>決算仕訳フラグによる通常/決算の分離</p>
</li>
<li>
<p><strong>日次残高の即時更新</strong></p>
</li>
<li>仕訳登録トリガーによる自動更新</li>
<li>
<p>UPSERT（INSERT ON CONFLICT）による効率的な処理</p>
</li>
<li>
<p><strong>月次残高の集計と繰越</strong></p>
</li>
<li>日次残高からの月末一括集計</li>
<li>
<p>前月末残高 → 翌月初残高の繰越処理</p>
</li>
<li>
<p><strong>帳票出力対応</strong></p>
</li>
<li>日計表：日次残高からの勘定科目別集計</li>
<li>合計残高試算表：月次残高からのBS/PL分類</li>
</ol>
<h3 id="_10">次章の予告<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>第19章では、財務会計データモデルの統合設計を行います。これまで設計した勘定科目マスタ、仕訳、自動仕訳、勘定科目残高を統合し、財務会計システム全体のER図を完成させます。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/practical-database-design" target="_blank" rel="noopener" title="GitHub Repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../docs/assets/js/extra.js"></script>
      
    
  </body>
</html>