# 第1章：基幹業務システムとは

本章では、基幹業務システムの概要と、ドメイン駆動設計（DDD）との関係について解説します。

## 1.1 ドメイン駆動設計と基幹業務システム

ドメイン駆動設計（Domain-Driven Design、以下 DDD）は、複雑なビジネスドメインを扱うソフトウェア開発において有効なアプローチです。基幹業務システムは、まさにこの複雑なビジネスドメインの典型例といえます。

```plantuml
@startmindmap

* ドメイン駆動設計
** 戦略的設計
*** ドメイン分析
*** 境界付けられたコンテキスト
*** コンテキストマップ
*** ユビキタス言語
** 戦術的設計
*** エンティティ
*** 値オブジェクト
*** 集約
*** リポジトリ
*** ドメインサービス
left side
** 基幹業務システム
*** 販売管理システム
*** 財務会計システム
*** 生産管理システム
*** 人事システム

@endmindmap
```

### 戦略的設計と戦術的設計

DDD は大きく「戦略的設計」と「戦術的設計」の2つのレベルに分けられます。

#### 戦略的設計

戦略的設計は、ビジネスドメイン全体を俯瞰し、システムの境界を定義するための手法です。

| 概念 | 説明 |
|---|---|
| ドメイン | ビジネスの問題領域全体 |
| サブドメイン | ドメインを分割した個々の領域（コア・サポート・汎用） |
| 境界付けられたコンテキスト | 特定のモデルが適用される明確な境界 |
| コンテキストマップ | コンテキスト間の関係を可視化したもの |
| ユビキタス言語 | チーム全体で共有する共通言語 |

#### 戦術的設計

戦術的設計は、境界付けられたコンテキスト内部のモデルを実装するためのパターン群です。

| パターン | 説明 |
|---|---|
| エンティティ | 識別子を持つオブジェクト |
| 値オブジェクト | 識別子を持たない不変オブジェクト |
| 集約 | 整合性を保つオブジェクトの集まり |
| リポジトリ | 集約の永続化を担当 |
| ドメインサービス | エンティティに属さない業務ロジック |

### 基幹業務システムへの適用

基幹業務システムを DDD の観点から分析すると、各サブシステムは「境界付けられたコンテキスト」として捉えることができます。

```plantuml
@startuml
!define RECTANGLE class

skinparam rectangle {
    BackgroundColor<<core>> LightBlue
    BackgroundColor<<support>> LightGreen
    BackgroundColor<<generic>> LightGray
}

rectangle "基幹業務システム" {
    rectangle "販売管理\nコンテキスト" <<core>> as sales
    rectangle "財務会計\nコンテキスト" <<core>> as accounting
    rectangle "生産管理\nコンテキスト" <<core>> as production
    rectangle "人事\nコンテキスト" <<support>> as hr
    rectangle "在庫管理\nコンテキスト" <<support>> as inventory
    rectangle "認証・認可\nコンテキスト" <<generic>> as auth
}

sales --> accounting : 売上仕訳
sales --> inventory : 在庫引当
production --> accounting : 製造原価仕訳
production --> inventory : 入出庫
hr --> accounting : 給与仕訳

@enduml
```

各コンテキストは以下のように分類できます。

| 分類 | コンテキスト | 説明 |
|---|---|---|
| コアドメイン | 販売管理、財務会計、生産管理 | 事業の競争優位性を生む中核領域 |
| サポートドメイン | 人事、在庫管理 | コアドメインを支援する領域 |
| 汎用ドメイン | 認証・認可 | 汎用的に利用可能な領域 |

---

## 1.2 基幹業務システムを構成するサブシステム

基幹業務システムは、企業の基幹となる業務を支えるシステムの総称です。一般的に以下の4つのサブシステムで構成されます。

```plantuml
@startuml

skinparam state {
    BackgroundColor LightBlue
    BorderColor DarkBlue
}

state "基幹業務システム" as ERP {
    state "販売管理システム" as Sales {
        Sales : 見積・受注・出荷・売上
        Sales : 請求・入金
    }

    state "財務会計システム" as Accounting {
        Accounting : 仕訳・決算
        Accounting : 債権・債務管理
    }

    state "生産管理システム" as Production {
        Production : 生産計画・MRP
        Production : 工程管理・品質管理
    }

    state "人事システム" as HR {
        HR : 給与計算
        HR : 人事管理
    }
}

Sales --> Accounting : 売上・入金データ
Production --> Accounting : 製造原価データ
HR --> Accounting : 給与データ
Sales --> Production : 需要予測・製造指示

@enduml
```

### 販売管理システム

販売管理システムは、企業の販売活動を管理するシステムです。得意先からの受注を起点に、出荷・売上・請求・入金までの一連の業務フローを管理します。

**主要機能**

- **見積管理**：得意先への見積書作成・管理
- **受注管理**：受注情報の登録・管理
- **出荷管理**：出荷指示・出荷実績の管理
- **売上管理**：売上計上・売上分析
- **債権管理**：請求書発行・入金消込・残高管理

```plantuml
@startuml

[*] --> 得意先
得意先 --> 営業部門
営業部門 -> 販売管理
販売管理 : 見積 \n受注 \n出荷 \n売上
販売管理 -> 調達管理
販売管理 --> 債権管理
債権管理 : 締請求 \n入金
調達管理 : 発注 \n入荷 \n仕入
調達管理 -> 仕入先
仕入先 -> 調達管理
販売管理 --> 在庫管理
在庫管理 --> 販売管理
在庫管理 : 在庫 \n受払 \n棚卸
調達管理 --> 在庫管理
調達管理 --> 債務管理
債務管理 : 支払締 \n支払

得意先 -> [*]

@enduml
```

### 財務会計システム

財務会計システムは、企業の財務状況を管理・報告するシステムです。日々の取引を仕訳として記録し、決算処理を通じて財務諸表を作成します。

**主要機能**

- **仕訳管理**：日々の取引を仕訳として記録
- **決算処理**：月次・年次決算、財務諸表作成
- **債権管理**：売掛金・受取手形の管理
- **債務管理**：買掛金・支払手形の管理
- **資産管理**：固定資産の管理・減価償却

```plantuml
@startuml

[*] -> 会計部門

会計部門 --> 財務会計
財務会計 : 債権 \n債務 \n手形 \n資産 \n経理
会計部門 --> 管理会計
管理会計 : 経営分析 \n損益分岐点分析 \n限界利益と貢献利益 \n投資の経済性計算 \nキャッシュフロー計算

会計部門 -> [*]

@enduml
```

### 生産管理システム

生産管理システムは、製造業における生産活動を管理するシステムです。需要予測に基づく生産計画の立案から、資材調達、製造実行、品質管理までを一貫して管理します。

**主要機能**

- **生産計画**：MPS（基準生産計画）・MRP（資材所要量計画）
- **購買管理**：発注・入荷・検収
- **工程管理**：製造指示・製造実績・工数管理
- **在庫管理**：資材在庫・製品在庫・受払管理
- **品質管理**：受入検査・出荷検査・トレーサビリティ
- **製造原価管理**：標準原価・実際原価・原価差異分析

```plantuml
@startuml

[*] -> 得意先
得意先 --> 営業部門
営業部門 -> 生産計画
生産計画 : 生産計画立案 \n - 販売計画 \n - 基準生産計画（MPS) \n MRP/スケジューラ \n - 所要量展開（MRP) \n - オーダー作成
生産計画 -> 購買管理
購買管理 : 資材調達 \n - 発注 \n - 入荷、受入、検収 \n 外注委託 \n - 有償／無償支給
購買管理 -> 仕入先
仕入先 -> 購買管理
購買管理 --> 委託先
委託先 --> 購買管理
購買管理 --> 在庫管理
生産計画 --> 工程管理
工程管理 : 製造指示 \n 製造実績 \n - 完成実績報告 \n - 工数実績報告
工程管理 --> 在庫管理
在庫管理 : 受払管理 \n - 製品在庫 \n - 資材在庫 \n 在庫状態管理
工程管理 --> 製造原価管理
製造原価管理 : 標準／実際原価 \n 製造原価配賦
製造原価管理 -> 工程管理
工程管理 -> 品質管理
品質管理 : 受入検査 \n 出荷検査 \n トレーサビリティ
品質管理 -> 工程管理

state 基準情報 {
  基準情報 : BOM \n品目 \n工程 \n取引先 \n部門 \nカレンダー
}

' 双方向の矢印は2行に分けて記述します
生産計画 -> 基準情報
基準情報 -> 生産計画

購買管理 -> 基準情報
基準情報 -> 購買管理

工程管理 -> 基準情報
基準情報 -> 工程管理

得意先 -> [*]

@enduml
```

### 人事システム

人事システムは、企業の人事・労務管理を行うシステムです。従業員情報の管理から給与計算、勤怠管理までを担当します。

**主要機能**

- **人事管理**：従業員情報・組織情報の管理
- **給与計算**：給与・賞与計算、年末調整
- **勤怠管理**：出退勤・休暇の管理
- **採用管理**：採用プロセスの管理

---

## まとめ

本章では、基幹業務システムの全体像と DDD との関係について解説しました。

- **DDD の戦略的設計**を適用することで、基幹業務システムを複数の境界付けられたコンテキストとして整理できる
- 基幹業務システムは主に**販売管理・財務会計・生産管理・人事**の4つのサブシステムで構成される
- 各サブシステムは相互に連携し、企業の基幹業務を支える

次章では、これらのサブシステムが担う業務領域について、より詳細に解説します。
